From: Kyle Moffett <kyle@moffetthome.net>
Date: Sun, 12 Apr 2015 03:50:25 +0000
Subject: Remove xcode/ios/objc support

---
 compile.sh                                         |   26 +-
 examples/BUILD                                     |    1 -
 examples/objc/BUILD                                |  115 --
 examples/objc/PrenotCalculator/AppDelegate.h       |   21 -
 examples/objc/PrenotCalculator/AppDelegate.m       |   59 -
 examples/objc/PrenotCalculator/CalculatedValues.h  |   28 -
 examples/objc/PrenotCalculator/CalculatedValues.m  |   48 -
 .../PrenotCalculator/CalculatorViewController.h    |   35 -
 .../PrenotCalculator/CalculatorViewController.m    |  127 --
 .../PrenotCalculator/CalculatorViewController.xib  |  257 ---
 examples/objc/PrenotCalculator/CoreData.h          |   23 -
 examples/objc/PrenotCalculator/CoreData.m          |   41 -
 .../DataModel.xcdatamodeld/.xccurrentversion       |   23 -
 .../DataModel-1.0.xcdatamodel/contents             |   24 -
 .../DataModel-1.1.xcdatamodel/contents             |   25 -
 examples/objc/PrenotCalculator/Equation.h          |   34 -
 examples/objc/PrenotCalculator/Equation.m          |  108 -
 examples/objc/PrenotCalculator/Expression.h        |   21 -
 examples/objc/PrenotCalculator/Expression.m        |   34 -
 examples/objc/PrenotCalculator/Literal.h           |   21 -
 examples/objc/PrenotCalculator/Literal.m           |   44 -
 .../PrenotCalculator/PrenotCalculator-Info.plist   |   60 -
 examples/objc/PrenotCalculator/Resources/test.txt  |    1 -
 .../objc/PrenotCalculator/ValuesViewController.h   |   19 -
 .../objc/PrenotCalculator/ValuesViewController.m   |   64 -
 examples/objc/PrenotCalculator/main.m              |   22 -
 examples/objc/README.md                            |   17 -
 examples/objc/expression_prebuilt.a                |  Bin 9460 -> 0 bytes
 src/main/java/BUILD                                |    3 -
 .../lib/analysis/config/BuildConfiguration.java    |    9 -
 .../lib/bazel/rules/BazelRuleClassProvider.java    |   53 +-
 .../build/lib/bazel/rules/objc/BazelIosTest.java   |   57 -
 .../lib/bazel/rules/objc/BazelIosTestRule.java     |   74 -
 .../lib/rules/objc/ArtifactListAttribute.java      |   45 -
 .../devtools/build/lib/rules/objc/Attribute.java   |   43 -
 .../lib/rules/objc/BinaryLinkingTargetFactory.java |  189 --
 .../lib/rules/objc/BundleMergeControlBytes.java    |  122 --
 .../build/lib/rules/objc/BundleSupport.java        |  422 ----
 .../build/lib/rules/objc/BundleableFile.java       |  175 --
 .../devtools/build/lib/rules/objc/Bundling.java    |  331 ---
 .../build/lib/rules/objc/CompilationArtifacts.java |   98 -
 .../build/lib/rules/objc/CompilationSupport.java   |  372 ----
 .../lib/rules/objc/ExecutionRequirements.java      |   23 -
 .../build/lib/rules/objc/InfoplistMerging.java     |  141 --
 .../lib/rules/objc/IntermediateArtifacts.java      |  267 ---
 .../build/lib/rules/objc/Interspersing.java        |   71 -
 .../build/lib/rules/objc/IosApplication.java       |   61 -
 .../build/lib/rules/objc/IosApplicationRule.java   |   98 -
 .../devtools/build/lib/rules/objc/IosDevice.java   |   42 -
 .../build/lib/rules/objc/IosDeviceProvider.java    |   73 -
 .../build/lib/rules/objc/IosDeviceRule.java        |   72 -
 .../build/lib/rules/objc/IosExtension.java         |   36 -
 .../build/lib/rules/objc/IosExtensionBinary.java   |   28 -
 .../lib/rules/objc/IosExtensionBinaryRule.java     |   62 -
 .../build/lib/rules/objc/IosExtensionRule.java     |  106 -
 .../build/lib/rules/objc/IosSdkCommands.java       |  158 --
 .../devtools/build/lib/rules/objc/IosTest.java     |  208 --
 .../build/lib/rules/objc/IterableWrapper.java      |   40 -
 .../lib/rules/objc/J2ObjcMappingFileProvider.java  |   55 -
 .../build/lib/rules/objc/J2ObjcSource.java         |  124 --
 .../build/lib/rules/objc/J2ObjcSrcsProvider.java   |   45 -
 .../build/lib/rules/objc/ObjcActionsBuilder.java   |  306 ---
 .../devtools/build/lib/rules/objc/ObjcBinary.java  |   34 -
 .../build/lib/rules/objc/ObjcBinaryRule.java       |   86 -
 .../build/lib/rules/objc/ObjcBuildInfoFactory.java |   52 -
 .../devtools/build/lib/rules/objc/ObjcBundle.java  |   51 -
 .../build/lib/rules/objc/ObjcBundleLibrary.java    |  105 -
 .../lib/rules/objc/ObjcBundleLibraryRule.java      |   61 -
 .../build/lib/rules/objc/ObjcBundleRule.java       |   64 -
 .../lib/rules/objc/ObjcCommandLineOptions.java     |  157 --
 .../devtools/build/lib/rules/objc/ObjcCommon.java  |  626 ------
 .../build/lib/rules/objc/ObjcConfiguration.java    |  275 ---
 .../lib/rules/objc/ObjcConfigurationLoader.java    |   42 -
 .../build/lib/rules/objc/ObjcFramework.java        |   60 -
 .../build/lib/rules/objc/ObjcFrameworkRule.java    |   66 -
 .../devtools/build/lib/rules/objc/ObjcImport.java  |   71 -
 .../build/lib/rules/objc/ObjcImportRule.java       |   74 -
 .../devtools/build/lib/rules/objc/ObjcLibrary.java |  124 --
 .../build/lib/rules/objc/ObjcLibraryRule.java      |   62 -
 .../devtools/build/lib/rules/objc/ObjcOptions.java |   40 -
 .../build/lib/rules/objc/ObjcOptionsRule.java      |   70 -
 .../build/lib/rules/objc/ObjcProtoLibrary.java     |  249 ---
 .../build/lib/rules/objc/ObjcProtoLibraryRule.java |   96 -
 .../build/lib/rules/objc/ObjcProvider.java         |  345 ----
 .../build/lib/rules/objc/ObjcRuleClasses.java      |  979 ---------
 .../build/lib/rules/objc/ObjcSdkFrameworks.java    |   71 -
 .../build/lib/rules/objc/ObjcXcodeproj.java        |   47 -
 .../build/lib/rules/objc/ObjcXcodeprojRule.java    |   82 -
 .../build/lib/rules/objc/OptionsProvider.java      |   86 -
 .../devtools/build/lib/rules/objc/Platform.java    |   58 -
 .../lib/rules/objc/ReleaseBundlingSupport.java     |  755 -------
 .../rules/objc/ReleaseBundlingTargetFactory.java   |  130 --
 .../build/lib/rules/objc/ResourceSupport.java      |   86 -
 .../build/lib/rules/objc/SdkFramework.java         |   47 -
 .../devtools/build/lib/rules/objc/Storyboards.java |   76 -
 .../build/lib/rules/objc/TargetDeviceFamily.java   |  123 --
 .../devtools/build/lib/rules/objc/Value.java       |   70 -
 .../build/lib/rules/objc/XcTestAppProvider.java    |   57 -
 .../devtools/build/lib/rules/objc/Xcdatamodel.java |  133 --
 .../build/lib/rules/objc/Xcdatamodels.java         |   79 -
 .../build/lib/rules/objc/XcodeProductType.java     |   41 -
 .../build/lib/rules/objc/XcodeProvider.java        |  552 -----
 .../build/lib/rules/objc/XcodeSupport.java         |  132 --
 .../devtools/build/lib/rules/objc/XibFiles.java    |   42 -
 src/main/protobuf/BUILD                            |    2 -
 src/main/protobuf/bundlemerge.proto                |  118 --
 src/main/protobuf/xcodegen.proto                   |  179 --
 src/objc_tools/bundlemerge/README                  |    2 -
 .../build/xcode/bundlemerge/BundleMerge.java       |   54 -
 .../build/xcode/bundlemerge/BundleMerging.java     |  227 ---
 src/objc_tools/momczip/README                      |    2 -
 .../devtools/build/xcode/momczip/MomcZip.java      |   56 -
 src/objc_tools/plmerge/README                      |    2 -
 .../xcode/plmerge/KeysToRemoveIfEmptyString.java   |   37 -
 .../devtools/build/xcode/plmerge/PlMerge.java      |   84 -
 .../devtools/build/xcode/plmerge/PlistMerging.java |  318 ---
 src/objc_tools/xcodegen/README                     |    2 -
 .../build/xcode/xcodegen/AggregateKey.java         |   62 -
 .../xcode/xcodegen/AggregateReferenceType.java     |  129 --
 .../build/xcode/xcodegen/CurrentVersionSetter.java |   92 -
 .../build/xcode/xcodegen/FileReference.java        |   98 -
 .../xcode/xcodegen/HasProjectNavigatorFiles.java   |   28 -
 .../build/xcode/xcodegen/LibraryObjects.java       |  133 --
 .../xcode/xcodegen/LocalPBXContainerItemProxy.java |   62 -
 .../xcode/xcodegen/LocalPBXTargetDependency.java   |   36 -
 .../build/xcode/xcodegen/PBXBuildFiles.java        |  175 --
 .../build/xcode/xcodegen/PBXFileReferences.java    |   48 -
 .../build/xcode/xcodegen/PbxReferencesGrouper.java |  173 --
 .../xcode/xcodegen/PbxReferencesProcessor.java     |   37 -
 .../build/xcode/xcodegen/RelativePaths.java        |   52 -
 .../devtools/build/xcode/xcodegen/Resources.java   |  113 --
 .../devtools/build/xcode/xcodegen/SourceFile.java  |   77 -
 .../build/xcode/xcodegen/Xcdatamodels.java         |   67 -
 .../devtools/build/xcode/xcodegen/XcodeGen.java    |  117 --
 .../build/xcode/xcodegen/XcodeprojGeneration.java  |  539 -----
 .../build/xcode/xcodegen/testing/PbxTypes.java     |  100 -
 .../build/lib/analysis/BazelAnalysisMock.java      |    4 +-
 src/test/shell/bazel/BUILD                         |    1 -
 src/tools/xcode-common/BUILD                       |   20 -
 .../devtools/build/xcode/actoolzip/ActoolZip.java  |  128 --
 .../google/devtools/build/xcode/actoolzip/README   |    4 -
 .../build/xcode/common/BuildOptionsUtil.java       |   25 -
 .../build/xcode/common/PathTransformer.java        |   46 -
 .../devtools/build/xcode/common/Platform.java      |   59 -
 .../devtools/build/xcode/common/XcodeprojPath.java |  121 --
 .../devtools/build/xcode/ibtoolzip/IbtoolZip.java  |   58 -
 .../google/devtools/build/xcode/ibtoolzip/README   |    4 -
 .../devtools/build/xcode/util/Containing.java      |   71 -
 .../google/devtools/build/xcode/util/Equaling.java |   80 -
 .../google/devtools/build/xcode/util/Mapping.java  |   39 -
 .../google/devtools/build/xcode/util/Value.java    |   69 -
 .../google/devtools/build/xcode/zip/ZipFiles.java  |  153 --
 .../devtools/build/xcode/zip/ZipInputEntry.java    |  141 --
 .../build/xcode/zippingoutput/Arguments.java       |   57 -
 .../xcode/zippingoutput/ArgumentsParsing.java      |   99 -
 .../build/xcode/zippingoutput/Wrapper.java         |   55 -
 .../build/xcode/zippingoutput/Wrappers.java        |  161 --
 third_party/iossim/BUILD                           |    3 -
 third_party/iossim/LICENSE                         |   27 -
 third_party/iossim/iossim                          |  Bin 47656 -> 0 bytes
 third_party/java/buck-ios-support/LICENSE          |  202 --
 third_party/java/buck-ios-support/README           |   15 -
 .../java/com/facebook/buck/apple/FileTypes.java    |  121 --
 .../facebook/buck/apple/xcode/GidGenerator.java    |   50 -
 .../buck/apple/xcode/XcodeprojSerializer.java      |  140 --
 .../apple/xcode/xcodeproj/PBXAggregateTarget.java  |   31 -
 .../buck/apple/xcode/xcodeproj/PBXBuildFile.java   |   80 -
 .../buck/apple/xcode/xcodeproj/PBXBuildPhase.java  |   44 -
 .../buck/apple/xcode/xcodeproj/PBXBuildStyle.java  |   61 -
 .../buck/apple/xcode/xcodeproj/PBXContainer.java   |   28 -
 .../apple/xcode/xcodeproj/PBXContainerItem.java    |   36 -
 .../xcode/xcodeproj/PBXContainerItemProxy.java     |   88 -
 .../xcode/xcodeproj/PBXCopyFilesBuildPhase.java    |   85 -
 .../apple/xcode/xcodeproj/PBXFileReference.java    |   78 -
 .../xcode/xcodeproj/PBXFrameworksBuildPhase.java   |   28 -
 .../buck/apple/xcode/xcodeproj/PBXGroup.java       |  165 --
 .../xcode/xcodeproj/PBXHeadersBuildPhase.java      |   28 -
 .../apple/xcode/xcodeproj/PBXNativeTarget.java     |   32 -
 .../buck/apple/xcode/xcodeproj/PBXObject.java      |   67 -
 .../buck/apple/xcode/xcodeproj/PBXProject.java     |  102 -
 .../buck/apple/xcode/xcodeproj/PBXProjectItem.java |   24 -
 .../buck/apple/xcode/xcodeproj/PBXReference.java   |  158 --
 .../xcode/xcodeproj/PBXResourcesBuildPhase.java    |   30 -
 .../xcode/xcodeproj/PBXShellScriptBuildPhase.java  |  130 --
 .../xcode/xcodeproj/PBXSourcesBuildPhase.java      |   29 -
 .../buck/apple/xcode/xcodeproj/PBXTarget.java      |  138 --
 .../apple/xcode/xcodeproj/PBXTargetDependency.java |   53 -
 .../apple/xcode/xcodeproj/PBXVariantGroup.java     |   96 -
 .../buck/apple/xcode/xcodeproj/SourceTreePath.java |   65 -
 .../xcode/xcodeproj/XCBuildConfiguration.java      |   55 -
 .../apple/xcode/xcodeproj/XCConfigurationList.java |   82 -
 .../buck/apple/xcode/xcodeproj/XCVersionGroup.java |  114 --
 .../java/com/facebook/buck/log/Logger.java         |  451 -----
 third_party/java/dd_plist/LICENSE                  |   19 -
 third_party/java/dd_plist/README                   |   34 -
 .../java/com/dd/plist/ASCIIPropertyListParser.java |  645 ------
 .../java/dd_plist/java/com/dd/plist/Base64.java    | 2124 --------------------
 .../com/dd/plist/BinaryPropertyListParser.java     |  541 -----
 .../com/dd/plist/BinaryPropertyListWriter.java     |  301 ---
 .../java/dd_plist/java/com/dd/plist/NSArray.java   |  335 ---
 .../java/dd_plist/java/com/dd/plist/NSData.java    |  182 --
 .../java/dd_plist/java/com/dd/plist/NSDate.java    |  185 --
 .../dd_plist/java/com/dd/plist/NSDictionary.java   |  539 -----
 .../java/dd_plist/java/com/dd/plist/NSNumber.java  |  407 ----
 .../java/dd_plist/java/com/dd/plist/NSObject.java  |  431 ----
 .../java/dd_plist/java/com/dd/plist/NSSet.java     |  354 ----
 .../java/dd_plist/java/com/dd/plist/NSString.java  |  270 ---
 .../com/dd/plist/PropertyListFormatException.java  |   40 -
 .../java/com/dd/plist/PropertyListParser.java      |  383 ----
 .../java/dd_plist/java/com/dd/plist/UID.java       |   93 -
 .../java/com/dd/plist/XMLPropertyListParser.java   |  273 ---
 tools/BUILD                                        |    1 -
 tools/objc/BUILD                                   |   45 -
 tools/objc/dummy.c                                 |   25 -
 tools/objc/ios_runner.sh.mac_template              |   42 -
 215 files changed, 3 insertions(+), 26581 deletions(-)
 delete mode 100644 examples/objc/BUILD
 delete mode 100644 examples/objc/PrenotCalculator/AppDelegate.h
 delete mode 100644 examples/objc/PrenotCalculator/AppDelegate.m
 delete mode 100644 examples/objc/PrenotCalculator/CalculatedValues.h
 delete mode 100644 examples/objc/PrenotCalculator/CalculatedValues.m
 delete mode 100644 examples/objc/PrenotCalculator/CalculatorViewController.h
 delete mode 100644 examples/objc/PrenotCalculator/CalculatorViewController.m
 delete mode 100644 examples/objc/PrenotCalculator/CalculatorViewController.xib
 delete mode 100644 examples/objc/PrenotCalculator/CoreData.h
 delete mode 100644 examples/objc/PrenotCalculator/CoreData.m
 delete mode 100644 examples/objc/PrenotCalculator/DataModel.xcdatamodeld/.xccurrentversion
 delete mode 100644 examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.0.xcdatamodel/contents
 delete mode 100644 examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.1.xcdatamodel/contents
 delete mode 100644 examples/objc/PrenotCalculator/Equation.h
 delete mode 100644 examples/objc/PrenotCalculator/Equation.m
 delete mode 100644 examples/objc/PrenotCalculator/Expression.h
 delete mode 100644 examples/objc/PrenotCalculator/Expression.m
 delete mode 100644 examples/objc/PrenotCalculator/Literal.h
 delete mode 100644 examples/objc/PrenotCalculator/Literal.m
 delete mode 100644 examples/objc/PrenotCalculator/PrenotCalculator-Info.plist
 delete mode 100644 examples/objc/PrenotCalculator/Resources/test.txt
 delete mode 100644 examples/objc/PrenotCalculator/ValuesViewController.h
 delete mode 100644 examples/objc/PrenotCalculator/ValuesViewController.m
 delete mode 100644 examples/objc/PrenotCalculator/main.m
 delete mode 100644 examples/objc/README.md
 delete mode 100644 examples/objc/expression_prebuilt.a
 delete mode 100644 src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTest.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTestRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ArtifactListAttribute.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Attribute.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/BinaryLinkingTargetFactory.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/BundleMergeControlBytes.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/BundleSupport.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/BundleableFile.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Bundling.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/CompilationArtifacts.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/CompilationSupport.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ExecutionRequirements.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/InfoplistMerging.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IntermediateArtifacts.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Interspersing.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosApplication.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosApplicationRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosDevice.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceProvider.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosExtension.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinary.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinaryRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosSdkCommands.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IosTest.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/IterableWrapper.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcMappingFileProvider.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSource.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSrcsProvider.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcActionsBuilder.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinary.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinaryRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBuildInfoFactory.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundle.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibrary.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibraryRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommandLineOptions.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommon.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfiguration.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfigurationLoader.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFramework.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFrameworkRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImport.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImportRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibrary.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibraryRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptions.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptionsRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibrary.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibraryRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProvider.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcRuleClasses.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcSdkFrameworks.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeproj.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeprojRule.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/OptionsProvider.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Platform.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingSupport.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingTargetFactory.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/ResourceSupport.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/SdkFramework.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Storyboards.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/TargetDeviceFamily.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Value.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/XcTestAppProvider.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodel.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodels.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProductType.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProvider.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/XcodeSupport.java
 delete mode 100644 src/main/java/com/google/devtools/build/lib/rules/objc/XibFiles.java
 delete mode 100644 src/main/protobuf/bundlemerge.proto
 delete mode 100644 src/main/protobuf/xcodegen.proto
 delete mode 100644 src/objc_tools/bundlemerge/README
 delete mode 100644 src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerge.java
 delete mode 100644 src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerging.java
 delete mode 100644 src/objc_tools/momczip/README
 delete mode 100644 src/objc_tools/momczip/java/com/google/devtools/build/xcode/momczip/MomcZip.java
 delete mode 100644 src/objc_tools/plmerge/README
 delete mode 100644 src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/KeysToRemoveIfEmptyString.java
 delete mode 100644 src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlMerge.java
 delete mode 100644 src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlistMerging.java
 delete mode 100644 src/objc_tools/xcodegen/README
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateKey.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateReferenceType.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/CurrentVersionSetter.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/FileReference.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/HasProjectNavigatorFiles.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LibraryObjects.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXContainerItemProxy.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXTargetDependency.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXBuildFiles.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXFileReferences.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesGrouper.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesProcessor.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/RelativePaths.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Resources.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/SourceFile.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Xcdatamodels.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeGen.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeprojGeneration.java
 delete mode 100644 src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/testing/PbxTypes.java
 delete mode 100644 src/tools/xcode-common/BUILD
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/ActoolZip.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/README
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/common/BuildOptionsUtil.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/common/PathTransformer.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/common/Platform.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/common/XcodeprojPath.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/IbtoolZip.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/README
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Containing.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Equaling.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Mapping.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Value.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipFiles.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipInputEntry.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Arguments.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/ArgumentsParsing.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrapper.java
 delete mode 100644 src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrappers.java
 delete mode 100644 third_party/iossim/BUILD
 delete mode 100644 third_party/iossim/LICENSE
 delete mode 100755 third_party/iossim/iossim
 delete mode 100644 third_party/java/buck-ios-support/LICENSE
 delete mode 100644 third_party/java/buck-ios-support/README
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/FileTypes.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/GidGenerator.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/XcodeprojSerializer.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXAggregateTarget.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildFile.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildPhase.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildStyle.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainer.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItem.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItemProxy.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXCopyFilesBuildPhase.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFileReference.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFrameworksBuildPhase.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXGroup.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXHeadersBuildPhase.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXNativeTarget.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXObject.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProject.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProjectItem.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXReference.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXResourcesBuildPhase.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXShellScriptBuildPhase.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXSourcesBuildPhase.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTarget.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTargetDependency.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXVariantGroup.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/SourceTreePath.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCBuildConfiguration.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCConfigurationList.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCVersionGroup.java
 delete mode 100644 third_party/java/buck-ios-support/java/com/facebook/buck/log/Logger.java
 delete mode 100644 third_party/java/dd_plist/LICENSE
 delete mode 100644 third_party/java/dd_plist/README
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/ASCIIPropertyListParser.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/Base64.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListParser.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListWriter.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSArray.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSData.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSDate.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSDictionary.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSNumber.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSObject.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSSet.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/NSString.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/PropertyListFormatException.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/PropertyListParser.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/UID.java
 delete mode 100644 third_party/java/dd_plist/java/com/dd/plist/XMLPropertyListParser.java
 delete mode 100644 tools/objc/BUILD
 delete mode 100644 tools/objc/dummy.c
 delete mode 100644 tools/objc/ios_runner.sh.mac_template

diff --git a/compile.sh b/compile.sh
index 28d050d..41120e2 100755
--- a/compile.sh
+++ b/compile.sh
@@ -46,7 +46,7 @@ EXE_EXT=""
 
 PROTO_FILES=$(ls src/main/protobuf/*.proto)
 LIBRARY_JARS=$(find third_party -name *.jar | tr "\n" " ")
-DIRS=$(echo src/{main/java,tools/xcode-common/java/com/google/devtools/build/xcode/{common,util}} output/src)
+DIRS=$(echo src/main/java output/src)
 SINGLEJAR_DIRS="src/java_tools/singlejar/java src/main/java/com/google/devtools/build/lib/shell"
 SINGLEJAR_LIBRARIES="third_party/guava/guava-18.0.jar third_party/jsr305/jsr-305.jar"
 BUILDJAR_DIRS="src/java_tools/buildjar/java/com/google/devtools/build/buildjar output/src/com/google/devtools/build/lib/view/proto"
@@ -457,30 +457,6 @@ zip -qA output/bazel \
 
 chmod 755 output/bazel
 
-log "Creating objc helper tools..."
-
-zip_common="src/tools/xcode-common/java/com/google/devtools/build/xcode/zip src/tools/xcode-common/java/com/google/devtools/build/xcode/util src/java_tools/singlejar/java/com/google/devtools/build/singlejar/ZipCombiner.java src/java_tools/singlejar/java/com/google/devtools/build/singlejar/ZipEntryFilter.java src/java_tools/singlejar/java/com/google/devtools/build/singlejar/ExtraData.java src/java_tools/singlejar/java/com/google/devtools/build/singlejar/CopyEntryFilter.java"
-
-java_compilation "actoolzip" "src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput ${zip_common}" "third_party/guava/guava-18.0.jar third_party/jsr305/jsr-305.jar" "output/actoolzip"
-create_deploy_jar "precomp_actoolzip_deploy" "com.google.devtools.build.xcode.actoolzip.ActoolZip" "output/actoolzip"
-
-java_compilation "ibtoolzip" "src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput ${zip_common}" "third_party/guava/guava-18.0.jar third_party/jsr305/jsr-305.jar" "output/ibtoolzip"
-create_deploy_jar "precomp_ibtoolzip_deploy" "com.google.devtools.build.xcode.ibtoolzip.IbtoolZip" "output/ibtoolzip"
-
-java_compilation "momczip" "src/objc_tools/momczip/java/com/google/devtools/build/xcode/momczip src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput ${zip_common}" "third_party/guava/guava-18.0.jar third_party/jsr305/jsr-305.jar" "output/momczip"
-create_deploy_jar "precomp_momczip_deploy" "com.google.devtools.build.xcode.momczip.MomcZip" "output/momczip"
-
-java_compilation "bundlemerge" "src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge src/tools/xcode-common/java/com/google/devtools/build/xcode/common output/src/com/google/devtools/build/xcode/bundlemerge/proto/BundleMergeProtos.java ${zip_common} third_party/java/dd_plist src/main/java/com/google/devtools/common/options" "third_party/guava/guava-18.0.jar third_party/jsr305/jsr-305.jar third_party/protobuf/protobuf-2.5.0.jar" "output/bundlemerge"
-create_deploy_jar "precomp_bundlemerge_deploy" "com.google.devtools.build.xcode.bundlemerge.BundleMerge" "output/bundlemerge"
-
-java_compilation "plmerge" "src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge src/tools/xcode-common/java/com/google/devtools/build/xcode/common third_party/java/dd_plist src/main/java/com/google/devtools/common/options ${zip_common}" "third_party/guava/guava-18.0.jar third_party/jsr305/jsr-305.jar" "output/plmerge"
-create_deploy_jar "precomp_plmerge_deploy" "com.google.devtools.build.xcode.plmerge.PlMerge" "output/plmerge"
-
-java_compilation "xcodegen" "src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen src/main/java/com/google/devtools/common/options output/src/com/google/devtools/build/xcode/xcodegen/proto/XcodeGenProtos.java third_party/java/buck-ios-support/java src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge src/tools/xcode-common/java/com/google/devtools/build/xcode/common src/tools/xcode-common/java/com/google/devtools/build/xcode/util third_party/java/dd_plist" "third_party/guava/guava-18.0.jar third_party/jsr305/jsr-305.jar third_party/protobuf/protobuf-2.5.0.jar" "output/xcodegen"
-create_deploy_jar "precomp_xcodegen_deploy" "com.google.devtools.build.xcode.xcodegen.XcodeGen" "output/xcodegen"
-
-cp -f output/actoolzip/precomp_actoolzip_deploy.jar output/ibtoolzip/precomp_ibtoolzip_deploy.jar output/momczip/precomp_momczip_deploy.jar output/bundlemerge/precomp_bundlemerge_deploy.jar output/plmerge/precomp_plmerge_deploy.jar output/xcodegen/precomp_xcodegen_deploy.jar tools/objc/
-
 # Create a bazelrc file with the base_workspace directory in the package path.
 package_path="build --package_path %workspace%:$base_workspace"
 if [ ! -f $HOME/.bazelrc ]; then
diff --git a/examples/BUILD b/examples/BUILD
index 3ce954e..7ffa69f 100644
--- a/examples/BUILD
+++ b/examples/BUILD
@@ -7,7 +7,6 @@ filegroup(
         "//examples/gen:srcs",
         "//examples/java-native:srcs",
         "//examples/java-skylark:srcs",
-        "//examples/objc:srcs",
         "//examples/proto:srcs",
         "//examples/py:srcs",
         "//examples/py_native:srcs",
diff --git a/examples/objc/BUILD b/examples/objc/BUILD
deleted file mode 100644
index 3480775..0000000
--- a/examples/objc/BUILD
+++ /dev/null
@@ -1,115 +0,0 @@
-# Copyright 2015 Google Inc. All rights reserved.
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#    http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-
-objc_binary(
-    name = "PrenotCalculator",
-    srcs = [
-        "PrenotCalculator/main.m",
-    ],
-    infoplist = "PrenotCalculator/PrenotCalculator-Info.plist",
-    visibility = ["//visibility:public"],
-    deps = [
-        ":PrenotCalculatorClasses",
-    ],
-)
-
-objc_library(
-    name = "PrenotCalculatorClasses",
-    srcs = [
-        "PrenotCalculator/AppDelegate.m",
-        "PrenotCalculator/CalculatedValues.m",
-        "PrenotCalculator/CalculatorViewController.m",
-        "PrenotCalculator/CoreData.m",
-        "PrenotCalculator/Equation.m",
-        "PrenotCalculator/Literal.m",
-        "PrenotCalculator/ValuesViewController.m",
-    ],
-    hdrs = glob(
-        ["**/*.h"],
-        exclude = ["PrenotCalculator/Expression.h"],
-    ),
-    bundles = [":PrenotCalculatorResources"],
-    sdk_frameworks = ["CoreData"],
-    xibs = ["PrenotCalculator/CalculatorViewController.xib"],
-    deps = [
-        ":CoreDataResources",
-        ":ExpressionPrebuilt",
-    ],
-)
-
-# A prebuilt library that contains multiple architectures.
-# Currently compiled for: i386, x86_64, armv7.
-objc_import(
-    name = "ExpressionPrebuilt",
-    hdrs = ["PrenotCalculator/Expression.h"],
-    archives = [
-        "expression_prebuilt.a",
-    ],
-)
-
-# Don't use this directly, instead use it to construct ExpressionPrebuilt and
-# depend on that instead. Instructions:
-# Build using the following command repeatedly with the desired CPU values:
-#   bazel build --ios_cpu=<cpu> examples/objc/PrenotCalculator:ExpressionClasses
-# and combining the resulting .a's (copied after each bazel build) using lipo:
-#   /usr/bin/lipo -create expression_i386.a expression_armv7.a -output expression_prebuilt.a
-objc_library(
-    name = "ExpressionClasses",
-    srcs = [
-        "PrenotCalculator/Expression.m",
-    ],
-    hdrs = ["PrenotCalculator/Expression.h"],
-)
-
-objc_bundle_library(
-    name = "PrenotCalculatorResources",
-    resources = glob(["PrenotCalculator/Resources/**"]),
-)
-
-objc_library(
-    name = "CoreDataResources",
-    datamodels = glob(["PrenotCalculator/DataModel.xcdatamodeld/**"]),
-)
-
-# If instruments is supported this genrule should *not timeout* and it should
-# produce a screenshot of the PrenotCalculator.ipa in ~ few seconds.
-genrule(
-    name = "PrenotCalculatorInstruments",
-    srcs = [":PrenotCalculator.ipa"],
-    outs = ["hello_instruments.png"],
-    cmd =
-        # This command expects the PrenotCalculator.ipa as input then unzips
-        # it into a temporary directory, creates a .js script on the fly
-        # that captures a screenshot, and finally invokes /usr/bin/instruments
-        # with the former as arguments.
-        "unzip -q $(location :PrenotCalculator.ipa) -d $${TMPDIR} ; " +
-        "echo 'UIATarget.localTarget().delay(5); UIATarget.localTarget().captureScreenWithName(\"hello_instruments\");' > $${TMPDIR}/hello_instruments.js && " +
-        "/usr/bin/instruments " +
-        "-t /Applications/Xcode.app/Contents/Applications/Instruments.app/Contents/PlugIns/AutomationInstrument.xrplugin/Contents/Resources/Automation.tracetemplate " +
-        "-w 'iPhone 5 (8.1 Simulator)' " +
-        "$${TMPDIR}/Payload/PrenotCalculator.app " +
-        "-e UIASCRIPT $${TMPDIR}/hello_instruments.js " +
-        "-e UIARESULTSPATH $${TMPDIR} -v && " +
-        "cp $${TMPDIR}'/Run 1/hello_instruments.png' $(@)",
-    tags = ["requires-darwin"],
-)
-
-filegroup(
-    name = "srcs",
-    srcs = glob([
-        "**",
-        "BUILD",
-    ]),
-    visibility = ["//examples:__pkg__"],
-)
diff --git a/examples/objc/PrenotCalculator/AppDelegate.h b/examples/objc/PrenotCalculator/AppDelegate.h
deleted file mode 100644
index 75b1f1d..0000000
--- a/examples/objc/PrenotCalculator/AppDelegate.h
+++ /dev/null
@@ -1,21 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <UIKit/UIKit.h>
-
-@interface AppDelegate : UIResponder <UIApplicationDelegate>
-
-@property (strong, nonatomic) UIWindow *window;
-
-@end
diff --git a/examples/objc/PrenotCalculator/AppDelegate.m b/examples/objc/PrenotCalculator/AppDelegate.m
deleted file mode 100644
index f6ecc4d..0000000
--- a/examples/objc/PrenotCalculator/AppDelegate.m
+++ /dev/null
@@ -1,59 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "AppDelegate.h"
-
-#import "CalculatorViewController.h"
-#import "ValuesViewController.h"
-
-@implementation AppDelegate
-
-- (BOOL)application:(UIApplication *)application
-    didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
-  [self validateBundleLibrary];
-
-  UITabBarController *bar = [[UITabBarController alloc] init];
-  [bar setViewControllers:
-      @[[[CalculatorViewController alloc] init], [[ValuesViewController alloc] init]]];
-  bar.selectedIndex = 0;
-  self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
-  self.window.rootViewController = bar;
-  [self.window makeKeyAndVisible];
-  return YES;
-}
-
-- (void)applicationWillResignActive:(UIApplication *)application {}
-
-- (void)applicationDidEnterBackground:(UIApplication *)application {}
-
-- (void)applicationWillEnterForeground:(UIApplication *)application {}
-
-- (void)applicationDidBecomeActive:(UIApplication *)application {}
-
-- (void)applicationWillTerminate:(UIApplication *)application {}
-
-- (void)validateBundleLibrary {
-  NSString *bundlePath = [[[NSBundle mainBundle] bundlePath]
-      stringByAppendingPathComponent:@"PrenotCalculatorResources.bundle"];
-  NSBundle *bundle = [NSBundle bundleWithPath:bundlePath];
-  NSString *testPath = [bundle pathForResource:@"test" ofType:@"txt"];
-  NSString *testContents = [NSString stringWithContentsOfFile:testPath
-                                                     encoding:NSUTF8StringEncoding
-                                                        error:NULL];
-  NSAssert([testContents hasSuffix:@"It worked!\n"],
-           @"Unable to find file given mainBundle: %@",
-           [[NSBundle mainBundle] description]);
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/CalculatedValues.h b/examples/objc/PrenotCalculator/CalculatedValues.h
deleted file mode 100644
index 026fadf..0000000
--- a/examples/objc/PrenotCalculator/CalculatedValues.h
+++ /dev/null
@@ -1,28 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <Foundation/Foundation.h>
-
-#import "Equation.h"
-#import "Expression.h"
-
-@interface CalculatedValues : NSObject
-
-+ (CalculatedValues *)sharedInstance;
-
-- (NSArray *)values;
-
-- (void)addEquation:(Equation *)equation;
-
-@end
diff --git a/examples/objc/PrenotCalculator/CalculatedValues.m b/examples/objc/PrenotCalculator/CalculatedValues.m
deleted file mode 100644
index 2e401cb..0000000
--- a/examples/objc/PrenotCalculator/CalculatedValues.m
+++ /dev/null
@@ -1,48 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "CalculatedValues.h"
-
-#import "Equation.h"
-
-@implementation CalculatedValues {
-  NSMutableArray *_values;
-}
-
-+ (CalculatedValues *)sharedInstance {
-  static CalculatedValues *values = nil;
-  if (!values) {
-    values = [[[self class] alloc] init];
-  }
-  return values;
-}
-
-- (id)init {
-  self = [super init];
-  if (self) {
-    _values = [NSMutableArray array];
-  }
-  return self;
-}
-
-- (NSArray *)values {
-  return [_values copy];
-}
-
-- (void)addEquation:(Equation *)equation {
-  [_values addObject:
-      [NSString stringWithFormat:@"%@ = %0.2lf", equation, [equation calculate]]];
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/CalculatorViewController.h b/examples/objc/PrenotCalculator/CalculatorViewController.h
deleted file mode 100644
index 60dbc83..0000000
--- a/examples/objc/PrenotCalculator/CalculatorViewController.h
+++ /dev/null
@@ -1,35 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <UIKit/UIKit.h>
-
-@interface CalculatorViewController : UIViewController
-
-- (IBAction)enterDigit:(id)sender;
-
-- (IBAction)finish:(id)sender;
-
-- (IBAction)operate:(id)sender;
-
-@property (weak, nonatomic) IBOutlet UIButton *divideButton;
-@property (weak, nonatomic) IBOutlet UIButton *multiplyButton;
-@property (weak, nonatomic) IBOutlet UIButton *plusButton;
-@property (weak, nonatomic) IBOutlet UIButton *minusButton;
-@property (strong, nonatomic) IBOutletCollection(UIButton)
-    NSArray *nonZeroDigitButtons;
-@property (weak, nonatomic) IBOutlet UILabel *resultLabel;
-@property (weak, nonatomic) IBOutlet UIButton *finishButton;
-@property (weak, nonatomic) IBOutlet UIButton *zeroButton;
-
-@end
diff --git a/examples/objc/PrenotCalculator/CalculatorViewController.m b/examples/objc/PrenotCalculator/CalculatorViewController.m
deleted file mode 100644
index 5d26fef..0000000
--- a/examples/objc/PrenotCalculator/CalculatorViewController.m
+++ /dev/null
@@ -1,127 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "CalculatorViewController.h"
-
-#import "CalculatedValues.h"
-#import "CoreData.h"
-#import "Equation.h"
-#import "Expression.h"
-#import "Literal.h"
-
-@interface CalculatorViewController ()
-- (void)updateEnabledViews;
-- (void)updateButtonColor:(UIButton *)button;
-@end
-
-@implementation CalculatorViewController {
-  NSMutableArray *_locationStack;
-  NSMutableString *_currentNumber;
-}
-
-- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
-  self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
-  if (self) {
-    self.title = @"Calculator";
-    CoreData *coreData = [[CoreData alloc] init];
-    [coreData verify];
-  }
-  return self;
-}
-
-- (void)viewDidLoad {
-  [super viewDidLoad];
-  _locationStack = [NSMutableArray array];
-  _currentNumber = [NSMutableString stringWithString:@""];
-  [self updateEnabledViews];
-}
-
-- (IBAction)enterDigit:(id)sender {
-  UIButton *button = (UIButton *)sender;
-  [_currentNumber appendString:button.titleLabel.text];
-  self.resultLabel.text = _currentNumber;
-  [self updateEnabledViews];
-}
-
-- (IBAction)finish:(id)sender {
-  if (![_locationStack count]) {
-    _currentNumber = [NSMutableString stringWithString:@""];
-    self.resultLabel.text = @"hello";
-  }
-  if (![_locationStack count]) {
-    _currentNumber = [NSMutableString stringWithString:@""];
-  } else if ([_currentNumber length]) {
-    Equation *last = [_locationStack lastObject];
-    [last addExpressionAsChild:[[Literal alloc] initWithDouble:
-        atof([_currentNumber cStringUsingEncoding:NSUTF8StringEncoding])]];
-    _currentNumber = [NSMutableString stringWithString:@""];
-    self.resultLabel.text = [NSString stringWithFormat:@"%@", last];
-  } else {
-    Equation *popped = [_locationStack lastObject];
-    [_locationStack removeLastObject];
-    [[CalculatedValues sharedInstance] addEquation:popped];
-    self.resultLabel.text =
-        [NSString stringWithFormat:@"%lf", [popped calculate]];
-  }
-  [self updateEnabledViews];
-}
-
-- (IBAction)operate:(id)sender {
-  Operation operation;
-  if ([_currentNumber length]) {
-    // finish the current number first automatically:
-    [self finish:nil];
-  }
-  if (sender == self.multiplyButton) {
-    operation = kMultiply;
-  } else if (sender == self.plusButton) {
-    operation = kAdd;
-  } else if (sender == self.divideButton) {
-    operation = kDivide;
-  } else if (sender == self.minusButton) {
-    operation = kSubtract;
-  } else {
-    // Shouldn't happen
-    operation = kAdd;
-  }
-  Equation *newEquation = [[Equation alloc] initWithOperation:operation];
-  if ([_locationStack count]) {
-    [[_locationStack lastObject] addExpressionAsChild:newEquation];
-  }
-  [_locationStack addObject:newEquation];
-  self.resultLabel.text = [NSString stringWithFormat:@"%@", _locationStack[0]];
-  [self updateEnabledViews];
-}
-
-#pragma mark - Private
-
-
-- (void)updateEnabledViews {
-  self.finishButton.enabled = [_locationStack count] || [_currentNumber length];
-  [self updateButtonColor:self.finishButton];
-  self.zeroButton.enabled = self.finishButton.enabled;
-  [self updateButtonColor:self.zeroButton];
-  BOOL enableNonZeroDigits = ![_currentNumber isEqualToString:@"0"];
-  for (UIButton *digit in self.nonZeroDigitButtons) {
-    digit.enabled = enableNonZeroDigits;
-    [self updateButtonColor:digit];
-  }
-}
-
-- (void)updateButtonColor:(UIButton *)button {
-  button.backgroundColor = button.enabled ?
-      [UIColor whiteColor] : [UIColor grayColor];
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/CalculatorViewController.xib b/examples/objc/PrenotCalculator/CalculatorViewController.xib
deleted file mode 100644
index 7ed3f42..0000000
--- a/examples/objc/PrenotCalculator/CalculatorViewController.xib
+++ /dev/null
@@ -1,257 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!--
- Copyright 2015 Google Inc. All rights reserved.
-
- Licensed under the Apache License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
-
-    http://www.apache.org/licenses/LICENSE-2.0
-
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-<document type="com.apple.InterfaceBuilder3.CocoaTouch.XIB" version="3.0" toolsVersion="4510" systemVersion="13E28" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES">
-    <dependencies>
-        <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="3742"/>
-    </dependencies>
-    <objects>
-        <placeholder placeholderIdentifier="IBFilesOwner" id="-1" userLabel="File's Owner" customClass="CalculatorViewController">
-            <connections>
-                <outlet property="divideButton" destination="STk-6l-Wip" id="gGY-Iy-x7P"/>
-                <outlet property="finishButton" destination="21D-tW-sLR" id="GnM-vO-sHD"/>
-                <outlet property="minusButton" destination="7W2-TS-tLI" id="Wuh-b2-g8J"/>
-                <outlet property="multiplyButton" destination="dwp-YR-bfM" id="MHy-Ot-4Hd"/>
-                <outlet property="plusButton" destination="4rB-gA-S5X" id="9kZ-af-Os4"/>
-                <outlet property="resultLabel" destination="N03-1W-Z1G" id="YjW-BO-1Ta"/>
-                <outlet property="view" destination="1" id="3"/>
-                <outlet property="zeroButton" destination="YUO-Hc-CsJ" id="dgK-Dt-4YR"/>
-                <outletCollection property="nonZeroDigitButtons" destination="2ud-fg-6iP" id="SNy-6m-XHb"/>
-                <outletCollection property="nonZeroDigitButtons" destination="1Od-z8-5N1" id="Iq0-uY-IaD"/>
-                <outletCollection property="nonZeroDigitButtons" destination="1s9-bG-Fyv" id="CZv-no-Ubi"/>
-                <outletCollection property="nonZeroDigitButtons" destination="Y9P-jJ-ztr" id="nfC-U0-yxl"/>
-                <outletCollection property="nonZeroDigitButtons" destination="Iiq-p2-KYo" id="5A3-Y3-95R"/>
-                <outletCollection property="nonZeroDigitButtons" destination="zR0-hJ-XV8" id="5x0-pC-eis"/>
-                <outletCollection property="nonZeroDigitButtons" destination="Y4i-o9-uQp" id="qP7-dC-GQ0"/>
-                <outletCollection property="nonZeroDigitButtons" destination="auh-CA-fzQ" id="NiV-AO-FiS"/>
-                <outletCollection property="nonZeroDigitButtons" destination="CuZ-P3-3iO" id="snu-lY-DUt"/>
-            </connections>
-        </placeholder>
-        <placeholder placeholderIdentifier="IBFirstResponder" id="-2" customClass="UIResponder"/>
-        <view contentMode="scaleToFill" id="1">
-            <rect key="frame" x="0.0" y="0.0" width="320" height="568"/>
-            <autoresizingMask key="autoresizingMask" widthSizable="YES" heightSizable="YES"/>
-            <subviews>
-                <label opaque="NO" clipsSubviews="YES" userInteractionEnabled="NO" contentMode="left" horizontalHuggingPriority="251" verticalHuggingPriority="251" fixedFrame="YES" text="hello" textAlignment="right" lineBreakMode="tailTruncation" baselineAdjustment="alignBaselines" adjustsFontSizeToFit="NO" translatesAutoresizingMaskIntoConstraints="NO" id="N03-1W-Z1G">
-                    <rect key="frame" x="20" y="20" width="280" height="45"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" white="0.33333333333333331" alpha="1" colorSpace="calibratedWhite"/>
-                    <fontDescription key="fontDescription" name="CourierNewPS-BoldMT" family="Courier New" pointSize="24"/>
-                    <color key="textColor" white="1" alpha="1" colorSpace="calibratedWhite"/>
-                    <nil key="highlightedColor"/>
-                </label>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="Y4i-o9-uQp">
-                    <rect key="frame" x="44" y="73" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="7">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="oJx-RX-3SU"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="auh-CA-fzQ">
-                    <rect key="frame" x="123" y="73" width="73" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="8">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="pDd-AA-AXS"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="CuZ-P3-3iO">
-                    <rect key="frame" x="205" y="73" width="70" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="9">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="mdP-nK-k9T"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="Y9P-jJ-ztr">
-                    <rect key="frame" x="44" y="149" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="4">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="Eye-1S-G5k"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="Iiq-p2-KYo">
-                    <rect key="frame" x="123" y="149" width="73" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="5">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="NJt-1M-OKG"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="zR0-hJ-XV8">
-                    <rect key="frame" x="205" y="149" width="70" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="6">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="iZc-DU-5Nf"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="2ud-fg-6iP">
-                    <rect key="frame" x="44" y="225" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="1">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="sr8-xD-Dop"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="1Od-z8-5N1">
-                    <rect key="frame" x="125" y="225" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="2">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="r1w-Qx-lmh"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="1s9-bG-Fyv">
-                    <rect key="frame" x="204" y="225" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="3">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="z3W-9d-k3D"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="YUO-Hc-CsJ">
-                    <rect key="frame" x="125" y="301" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="0">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="enterDigit:" destination="-1" eventType="touchUpInside" id="E2G-nh-OjY"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="21D-tW-sLR">
-                    <rect key="frame" x="205" y="301" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="finish:" destination="-1" eventType="touchUpInside" id="Gr9-nP-eFW"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="4rB-gA-S5X">
-                    <rect key="frame" x="44" y="301" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="+">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="operate:" destination="-1" eventType="touchUpInside" id="pPf-Dl-b44"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="dwp-YR-bfM">
-                    <rect key="frame" x="44" y="377" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="operate:" destination="-1" eventType="touchUpInside" id="f6K-EQ-j18"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="7W2-TS-tLI">
-                    <rect key="frame" x="125" y="377" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="-">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="operate:" destination="-1" eventType="touchUpInside" id="MRD-ct-q82"/>
-                    </connections>
-                </button>
-                <button opaque="NO" contentMode="scaleToFill" fixedFrame="YES" contentHorizontalAlignment="center" contentVerticalAlignment="center" buttonType="roundedRect" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="STk-6l-Wip">
-                    <rect key="frame" x="205" y="377" width="71" height="68"/>
-                    <autoresizingMask key="autoresizingMask" flexibleMaxX="YES" flexibleMaxY="YES"/>
-                    <color key="backgroundColor" cocoaTouchSystemColor="darkTextColor"/>
-                    <fontDescription key="fontDescription" name="HelveticaNeue-Bold" family="Helvetica Neue" pointSize="15"/>
-                    <state key="normal" title="">
-                        <color key="titleColor" red="1" green="1" blue="0.0" alpha="1" colorSpace="calibratedRGB"/>
-                        <color key="titleShadowColor" white="0.5" alpha="1" colorSpace="calibratedWhite"/>
-                    </state>
-                    <connections>
-                        <action selector="operate:" destination="-1" eventType="touchUpInside" id="7cN-RA-mPR"/>
-                    </connections>
-                </button>
-            </subviews>
-            <color key="backgroundColor" red="0.0" green="0.79869981749999996" blue="0.78823562960000004" alpha="1" colorSpace="calibratedRGB"/>
-            <simulatedStatusBarMetrics key="simulatedStatusBarMetrics"/>
-            <simulatedScreenMetrics key="simulatedDestinationMetrics" type="retina4"/>
-        </view>
-    </objects>
-</document>
\ No newline at end of file
diff --git a/examples/objc/PrenotCalculator/CoreData.h b/examples/objc/PrenotCalculator/CoreData.h
deleted file mode 100644
index 2b55bb1..0000000
--- a/examples/objc/PrenotCalculator/CoreData.h
+++ /dev/null
@@ -1,23 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <Foundation/Foundation.h>
-
-// A simple class to confirm CoreData versioning works properly.
-@interface CoreData : NSObject
-
-// Check that the datamodel was loaded properly.
-- (void)verify;
-
-@end
diff --git a/examples/objc/PrenotCalculator/CoreData.m b/examples/objc/PrenotCalculator/CoreData.m
deleted file mode 100644
index 43a1e89..0000000
--- a/examples/objc/PrenotCalculator/CoreData.m
+++ /dev/null
@@ -1,41 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "CoreData.h"
-
-@implementation CoreData
-- (id)init {
-  self = [super init];
-  if (self) {
-
-  }
-  return self;
-}
-
-- (void)verify {
-  NSURL *modelURL = [self modelURL];
-  NSAssert(modelURL,
-           @"Unable to find modelURL given mainBundle: %@",
-           [[NSBundle mainBundle] description]);
-}
-
-#pragma mark Private Methods.
-
-- (NSURL *)modelURL {
-  NSBundle *bundle = [NSBundle bundleForClass:[CoreData class]];
-  NSURL *modelURL = [bundle URLForResource:@"DataModel" withExtension:@"momd"];
-  return modelURL;
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/.xccurrentversion b/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/.xccurrentversion
deleted file mode 100644
index aae30cd..0000000
--- a/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/.xccurrentversion
+++ /dev/null
@@ -1,23 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!--
- Copyright 2015 Google Inc. All rights reserved.
-
- Licensed under the Apache License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
-
-    http://www.apache.org/licenses/LICENSE-2.0
-
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
-<plist version="1.0">
-<dict>
-	<key>_XCCurrentVersionName</key>
-	<string>DataModel-1.1.xcdatamodel</string>
-</dict>
-</plist>
diff --git a/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.0.xcdatamodel/contents b/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.0.xcdatamodel/contents
deleted file mode 100644
index 1cd3e57..0000000
--- a/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.0.xcdatamodel/contents
+++ /dev/null
@@ -1,24 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
-<!--
- Copyright 2015 Google Inc. All rights reserved.
-
- Licensed under the Apache License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
-
-    http://www.apache.org/licenses/LICENSE-2.0
-
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-<model userDefinedModelVersionIdentifier="" type="com.apple.IDECoreDataModeler.DataModel" documentVersion="1.0" lastSavedToolsVersion="5063" systemVersion="13C1021" minimumToolsVersion="Xcode 4.3" macOSVersion="Automatic" iOSVersion="Automatic">
-    <entity name="PCModel" representedClassName="PCModel" syncable="YES">
-        <attribute name="one" optional="YES" attributeType="Boolean" syncable="YES"/>
-    </entity>
-    <elements>
-        <element name="PCModel" positionX="0" positionY="0" width="128" height="135"/>
-    </elements>
-</model>
\ No newline at end of file
diff --git a/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.1.xcdatamodel/contents b/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.1.xcdatamodel/contents
deleted file mode 100644
index 80b28dd..0000000
--- a/examples/objc/PrenotCalculator/DataModel.xcdatamodeld/DataModel-1.1.xcdatamodel/contents
+++ /dev/null
@@ -1,25 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
-<!--
- Copyright 2015 Google Inc. All rights reserved.
-
- Licensed under the Apache License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
-
-    http://www.apache.org/licenses/LICENSE-2.0
-
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-<model userDefinedModelVersionIdentifier="" type="com.apple.IDECoreDataModeler.DataModel" documentVersion="1.0" lastSavedToolsVersion="5063" systemVersion="13C1021" minimumToolsVersion="Xcode 4.3" macOSVersion="Automatic" iOSVersion="Automatic">
-    <entity name="PCModel" representedClassName="PCModel" syncable="YES">
-        <attribute name="one" optional="YES" attributeType="Boolean" syncable="YES"/>
-        <attribute name="two" optional="YES" attributeType="Boolean" syncable="YES"/>
-    </entity>
-    <elements>
-        <element name="PCModel" positionX="0" positionY="0" width="128" height="135"/>
-    </elements>
-</model>
\ No newline at end of file
diff --git a/examples/objc/PrenotCalculator/Equation.h b/examples/objc/PrenotCalculator/Equation.h
deleted file mode 100644
index c04fc70..0000000
--- a/examples/objc/PrenotCalculator/Equation.h
+++ /dev/null
@@ -1,34 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <Foundation/Foundation.h>
-
-#import "Expression.h"
-
-typedef enum {
-  kAdd,
-  kSubtract,
-  kMultiply,
-  kDivide
-} Operation;
-
-@interface Equation : Expression
-
-@property (nonatomic, assign) Operation operation;
-
-- (id)initWithOperation:(Operation)operation;
-- (NSArray *)children;
-- (void)addExpressionAsChild:(Expression *)child;
-
-@end
diff --git a/examples/objc/PrenotCalculator/Equation.m b/examples/objc/PrenotCalculator/Equation.m
deleted file mode 100644
index 4894e82..0000000
--- a/examples/objc/PrenotCalculator/Equation.m
+++ /dev/null
@@ -1,108 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "Equation.h"
-
-@implementation Equation {
-  NSMutableArray *_children;
-}
-
-@synthesize operation = _operation;
-
-- (id)init {
-  [self doesNotRecognizeSelector:_cmd];
-  return nil;
-}
-
-- (id)initWithOperation:(Operation)operation {
-  self = [super init];
-  if (self) {
-    _children = [NSMutableArray array];
-    _operation = operation;
-  }
-  return self;
-}
-
-- (NSArray *)children {
-  return [_children copy];
-}
-
-- (void)addExpressionAsChild:(Expression *)child {
-  [_children addObject:child];
-}
-
-- (double)calculate {
-  if ([_children count] == 1) {
-    return (_operation == kSubtract)
-        ? -[_children[0] calculate] : [_children[0] calculate];
-  } else if ([_children count] == 0) {
-    return (_operation == kSubtract || _operation == kAdd) ? 0 : 1;
-  }
-  double value = [_children[0] calculate];
-  for (Equation *child in [_children subarrayWithRange:
-      NSMakeRange(1, [_children count] - 1)]) {
-    double childValue = [child calculate];
-    switch (_operation) {
-      case kAdd:
-        value += childValue;
-        break;
-      case kSubtract:
-        value -= childValue;
-        break;
-      case kMultiply:
-        value *= childValue;
-        break;
-      case kDivide:
-        value /= childValue;
-        break;
-    }
-  }
-  return value;
-}
-
-- (NSString *)description {
-  NSMutableString *result = [[NSMutableString alloc] init];
-  [result appendString:@"("];
-  switch (_operation) {
-    case kAdd:
-      [result appendString:@"+"];
-      break;
-    case kSubtract:
-      [result appendString:@"-"];
-      break;
-    case kMultiply:
-      [result appendString:@"*"];
-      break;
-    case kDivide:
-      [result appendString:@"/"];
-      break;
-  }
-  for (Equation *child in _children) {
-    [result appendString:@" "];
-    [result appendString:[child description]];
-  }
-  [result appendString:@")"];
-  return [result copy];
-}
-
-- (BOOL)isEqual:(id)object {
-  if (![object isKindOfClass:[self class]]) {
-    return NO;
-  }
-  Equation *other = object;
-  return other->_operation == _operation &&
-      [other->_children isEqual:_children];
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/Expression.h b/examples/objc/PrenotCalculator/Expression.h
deleted file mode 100644
index f5b2dcf..0000000
--- a/examples/objc/PrenotCalculator/Expression.h
+++ /dev/null
@@ -1,21 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <Foundation/Foundation.h>
-
-@interface Expression : NSObject
-
-- (double)calculate;
-
-@end
diff --git a/examples/objc/PrenotCalculator/Expression.m b/examples/objc/PrenotCalculator/Expression.m
deleted file mode 100644
index 68e9541..0000000
--- a/examples/objc/PrenotCalculator/Expression.m
+++ /dev/null
@@ -1,34 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "Expression.h"
-
-@implementation Expression
-
-- (double)calculate {
-  [self doesNotRecognizeSelector:_cmd];
-  return NAN;
-}
-
-- (BOOL)isEqual:(id)object {
-  [self doesNotRecognizeSelector:_cmd];
-  return NO;
-}
-
-- (NSString *)description {
-  [self doesNotRecognizeSelector:_cmd];
-  return nil;
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/Literal.h b/examples/objc/PrenotCalculator/Literal.h
deleted file mode 100644
index 62ee13c..0000000
--- a/examples/objc/PrenotCalculator/Literal.h
+++ /dev/null
@@ -1,21 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "Expression.h"
-
-@interface Literal : Expression
-
-- (id)initWithDouble:(double)value;
-
-@end
diff --git a/examples/objc/PrenotCalculator/Literal.m b/examples/objc/PrenotCalculator/Literal.m
deleted file mode 100644
index c103f46..0000000
--- a/examples/objc/PrenotCalculator/Literal.m
+++ /dev/null
@@ -1,44 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "Literal.h"
-
-@implementation Literal {
-  double _value;
-}
-
-- (id)initWithDouble:(double)value {
-  self = [super init];
-  if (self) {
-    _value = value;
-  }
-  return self;
-}
-
-- (double)calculate {
-  return _value;
-}
-
-- (NSString *)description {
-  return [NSString stringWithFormat:@"%0.2lf", _value];
-}
-
-- (BOOL)isEqual:(id)object {
-  if (![object isKindOfClass:[self class]]) {
-    return NO;
-  }
-  return _value == ((Literal *)object)->_value;
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/PrenotCalculator-Info.plist b/examples/objc/PrenotCalculator/PrenotCalculator-Info.plist
deleted file mode 100644
index 178f34c..0000000
--- a/examples/objc/PrenotCalculator/PrenotCalculator-Info.plist
+++ /dev/null
@@ -1,60 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!--
- Copyright 2015 Google Inc. All rights reserved.
-
- Licensed under the Apache License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
-
-    http://www.apache.org/licenses/LICENSE-2.0
-
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
-<plist version="1.0">
-<dict>
-	<key>CFBundleDevelopmentRegion</key>
-	<string>en</string>
-	<key>CFBundleDisplayName</key>
-	<string>PrenotCalculator</string>
-	<key>CFBundleExecutable</key>
-	<string>PrenotCalculator</string>
-	<key>CFBundleIdentifier</key>
-	<string>Google.PrenotCalculator</string>
-	<key>CFBundleInfoDictionaryVersion</key>
-	<string>6.0</string>
-	<key>CFBundleName</key>
-	<string>PrenotCalculator</string>
-	<key>CFBundlePackageType</key>
-	<string>APPL</string>
-	<key>CFBundleShortVersionString</key>
-	<string>1.0</string>
-	<key>CFBundleSignature</key>
-	<string>????</string>
-	<key>CFBundleVersion</key>
-	<string>1.0</string>
-	<key>LSRequiresIPhoneOS</key>
-	<true/>
-	<key>UIRequiredDeviceCapabilities</key>
-	<array>
-		<string>armv7</string>
-	</array>
-	<key>UISupportedInterfaceOrientations</key>
-	<array>
-		<string>UIInterfaceOrientationPortrait</string>
-		<string>UIInterfaceOrientationLandscapeLeft</string>
-		<string>UIInterfaceOrientationLandscapeRight</string>
-	</array>
-	<key>UISupportedInterfaceOrientations~ipad</key>
-	<array>
-		<string>UIInterfaceOrientationPortrait</string>
-		<string>UIInterfaceOrientationPortraitUpsideDown</string>
-		<string>UIInterfaceOrientationLandscapeLeft</string>
-		<string>UIInterfaceOrientationLandscapeRight</string>
-	</array>
-</dict>
-</plist>
diff --git a/examples/objc/PrenotCalculator/Resources/test.txt b/examples/objc/PrenotCalculator/Resources/test.txt
deleted file mode 100644
index 3dc3aa5..0000000
--- a/examples/objc/PrenotCalculator/Resources/test.txt
+++ /dev/null
@@ -1 +0,0 @@
-It worked!
diff --git a/examples/objc/PrenotCalculator/ValuesViewController.h b/examples/objc/PrenotCalculator/ValuesViewController.h
deleted file mode 100644
index 27055b9..0000000
--- a/examples/objc/PrenotCalculator/ValuesViewController.h
+++ /dev/null
@@ -1,19 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <UIKit/UIKit.h>
-
-@interface ValuesViewController : UITableViewController
-
-@end
diff --git a/examples/objc/PrenotCalculator/ValuesViewController.m b/examples/objc/PrenotCalculator/ValuesViewController.m
deleted file mode 100644
index 333ea11..0000000
--- a/examples/objc/PrenotCalculator/ValuesViewController.m
+++ /dev/null
@@ -1,64 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import "ValuesViewController.h"
-
-#import "CalculatedValues.h"
-
-@interface ValuesViewController ()
-
-@end
-
-@implementation ValuesViewController
-
-- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
-  self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
-  if (self) {
-    self.title = @"Values";
-  }
-  return self;
-}
-
-#pragma mark - Table view data source
-
-- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {
-  return 1;
-}
-
-- (NSInteger)tableView:(UITableView *)tableView
-    numberOfRowsInSection:(NSInteger)section {
-  return [[[CalculatedValues sharedInstance] values] count];
-}
-
-- (UITableViewCell *)tableView:(UITableView *)tableView
-         cellForRowAtIndexPath:(NSIndexPath *)indexPath {
-  static NSString *CellIdentifier = @"Cell";
-  UITableViewCell *cell =
-      [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
-  if (!cell) {
-    cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault
-                                  reuseIdentifier:CellIdentifier];
-  }
-
-  cell.textLabel.text =
-      [CalculatedValues sharedInstance].values[[indexPath indexAtPosition:1]];
-
-  return cell;
-}
-
-- (void)viewDidAppear:(BOOL)animated {
-  [self.tableView reloadData];
-}
-
-@end
diff --git a/examples/objc/PrenotCalculator/main.m b/examples/objc/PrenotCalculator/main.m
deleted file mode 100644
index d70550a..0000000
--- a/examples/objc/PrenotCalculator/main.m
+++ /dev/null
@@ -1,22 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-#import <UIKit/UIKit.h>
-
-int main(int argc, char * argv[]) {
-  @autoreleasepool {
-    NSString *delegateClassName = @"AppDelegate";
-    return UIApplicationMain(argc, argv, nil, delegateClassName);
-  }
-}
diff --git a/examples/objc/README.md b/examples/objc/README.md
deleted file mode 100644
index 045264f..0000000
--- a/examples/objc/README.md
+++ /dev/null
@@ -1,17 +0,0 @@
-Objective C Examples
-======
-
-The example in this directory show typical use of Objective C libraries,
-binaries and imports. Because they build iOS an application they can only be run
-on Mac OSX.
-
-Build the top-level application with
-`bazel build examples/objc:PrenotCalculator`, which when finished prints the
-path to the generated .ipa. which you can then install to your test device. The
-same build will also print the path to an Xcode project directory which you can
-open to continue working with the application in Xcode.
-
-Running `bazel build examples/objc:PrenotCalculatorInstruments` will build and
-run the application to obtain a screenshot, the path to which it then prints.
-
-
diff --git a/examples/objc/expression_prebuilt.a b/examples/objc/expression_prebuilt.a
deleted file mode 100644
index 8bb74bb..0000000
--- a/examples/objc/expression_prebuilt.a
+++ /dev/null
@@ -1,23 +0,0 @@
-            D                       	    0   !<arch>
-#1/20           1425511825  25623 5000  100644  100       `
-__.SYMDEF SORTED                    8   _OBJC_CLASS_$_Expression _OBJC_METACLASS_$_Expression   #1/20           1425511820  25623 0     100555  2796      `
-Expression.o                                                     0                 __text          __TEXT              6  0                    __literal8      __TEXT          8     h                        __literal4      __TEXT          @     p                        __objc_methname __TEXT          D  9   t                         __objc_selrefs  __DATA                                   __objc_classname__TEXT                                        __objc_const    __DATA            |                         __objc_data     __DATA            (   <                      __objc_methtype __TEXT          4     d                         __objc_classlist__DATA          L     |     (                __objc_imageinfo__DATA          P                              __jump_table    __IMPORT        X  
-                          __eh_frame      __TEXT          d  t        0       h              h     4	       P       
-   
-                                    `                     UWV0    XMU+  UMUs  OwEE  E3  0^_]fffff.     USWV,    XMUu}uUE    <$L$E  E    Uu}  $\$t$EM  E   E$D$       ,^_[]D  UV$    XMU    UMMU   $D$T$u+  E$^]          doesNotRecognizeSelector: calculate isEqual: description    D  Expression                                           ^  4      h  ;  `   q  E                                                                        d8@0:4 c12@0:4@8 @8@0:4                     zR |        |R    ABE     <       ABF   \   ,F    ABD)                              n        G  @        >     '            8              h     d     P     L   	  H     D     @   	  <     8     4   	  0          $                                               `          @  `                                        `                        +      H    d  R    |  m            L               e                    9          |                   _OBJC_METACLASS_$_Expression _OBJC_METACLASS_$_NSObject __objc_empty_cache _OBJC_CLASS_$_Expression _OBJC_CLASS_$_NSObject _objc_msgSend _objc_storeStrong -[Expression calculate] -[Expression isEqual:] -[Expression description] l_OBJC_METACLASS_RO_$_Expression l_OBJC_$_INSTANCE_METHODS_Expression l_OBJC_CLASS_RO_$_Expression EH_frame0 -[Expression calculate].eh -[Expression isEqual:].eh -[Expression description].eh !<arch>
-#1/20           1425511863  25623 5000  100644  100       `
-__.SYMDEF SORTED                    8   _OBJC_CLASS_$_Expression _OBJC_METACLASS_$_Expression   #1/20           1425511858  25623 0     100555  3276      `
-Expression.o                                                           h      @      h                   __text          __TEXT                        @       	                 __literal8      __TEXT                       X                            __objc_methname __TEXT                 9       `                             __objc_selrefs  __DATA          `                                     __objc_classname__TEXT          h                                          __objc_const    __DATA          x                                       __objc_data     __DATA          X      P            X                     __objc_methtype __TEXT                                                    __objc_classlist__DATA                                                __objc_imageinfo__DATA                                                    __eh_frame      __TEXT                                   h                       `
-  X     P                                                                      UHH   H}HuHuHUH=9  H}HHuE    EH ]f     UHH0HEH}HuHE    HH    H}H        HEHUH   H}HHuH    E   H}Hu    A AAH0]@ UHH H        H}HuHuHUH=g   H}HHuHE    HEH ]       doesNotRecognizeSelector: calculate isEqual: description                Expression         (   (                                                                                                                                                                                                                                                                                                  d16@0:8 B24@0:8@16 @16@0:8                             zR x  $      G        AC       $   D   |        AC       $   l   G        AC       	    -          -     -     s     -8     -#                                       
-  x     p   	  h     `      X     P          H     8     0     (                                 p     ^p     H     ^H           ^                         P                                    h          x      /    :      F          \    D      s              M                                                                  9    @      l           !     X                    >              Y                                           _objc_msgSend _objc_storeStrong _OBJC_METACLASS_$_Expression _OBJC_METACLASS_$_NSObject __objc_empty_cache _OBJC_CLASS_$_Expression _OBJC_CLASS_$_NSObject -[Expression calculate] -[Expression isEqual:] -[Expression description] L_OBJC_METH_VAR_NAME_ L_OBJC_CLASS_NAME_ l_OBJC_METACLASS_RO_$_Expression L_OBJC_METH_VAR_NAME_1 L_OBJC_METH_VAR_TYPE_ L_OBJC_METH_VAR_NAME_2 L_OBJC_METH_VAR_TYPE_3 L_OBJC_METH_VAR_NAME_4 L_OBJC_METH_VAR_TYPE_5 l_OBJC_$_INSTANCE_METHODS_Expression l_OBJC_CLASS_RO_$_Expression EH_frame0 -[Expression calculate].eh -[Expression isEqual:].eh -[Expression description].eh   !<arch>
-#1/20           1425658286  25623 5000  100644  100       `
-__.SYMDEF SORTED                    8   _OBJC_CLASS_$_Expression _OBJC_METACLASS_$_Expression   #1/20           1425658281  25623 0     100555  2636      `
-Expression.o           	                  4                                         __text          __TEXT                                    __textcoal_nt   __TEXT                                        __const_coal    __TEXT                                         __picsymbolstub4__TEXT                                        __StaticInit    __TEXT                                         __cstring       __TEXT                                         __objc_methname __TEXT            9                            __objc_selrefs  __DATA          <                         __objc_classname__TEXT          @                              __objc_const    __DATA          L  |                         __objc_data     __DATA            (                          __objc_methtype __TEXT                                        __objc_classlist__DATA                    @                __objc_imageinfo__DATA                                        __nl_symbol_ptr __DATA                                       )      H           T       H     P                                              P                     lF$F@ zDhF Q0<F      oF@ 	 	FF ! " @ {Dh@	 	D `FIF rFG     @ oF " @< {Dh@X	 	D IF JFG doesNotRecognizeSelector: calculate isEqual: description    Expression               @                                   &    I   /                    @  t                                  L                  d8@0:4 c12@0:4@8 @8@0:4                 <  X       <            <                   m  <         <        z     ~   v       ~   d     m.     m  <         <               h   
-  d   	  P     L     H     D     @     <     8     4     0        	  $   
-     
-               
-     
-     	      	        @                    H             
-  L    
-  t  +  
-    l       !                 >          Y                               _objc_msgSend _objc_storeStrong _OBJC_METACLASS_$_Expression _OBJC_METACLASS_$_NSObject __objc_empty_cache _OBJC_CLASS_$_Expression _OBJC_CLASS_$_NSObject -[Expression calculate] -[Expression isEqual:] -[Expression description] l_OBJC_METACLASS_RO_$_Expression l_OBJC_$_INSTANCE_METHODS_Expression l_OBJC_CLASS_RO_$_Expression 
\ No newline at end of file
diff --git a/src/main/java/BUILD b/src/main/java/BUILD
index c2e3dbe..8fc7fa6 100644
--- a/src/main/java/BUILD
+++ b/src/main/java/BUILD
@@ -34,12 +34,9 @@ java_library(
     deps = [
         ":shell",
         "//src/main/protobuf:proto_build",
-        "//src/main/protobuf:proto_bundlemerge",
         "//src/main/protobuf:proto_crosstool_config",
         "//src/main/protobuf:proto_extra_actions_base",
         "//src/main/protobuf:proto_test_status",
-        "//src/main/protobuf:proto_xcodegen",
-        "//src/tools/xcode-common",
         "//third_party:aether",
         "//third_party:apache_commons_compress",
         "//third_party:auto_value",
diff --git a/src/main/java/com/google/devtools/build/lib/analysis/config/BuildConfiguration.java b/src/main/java/com/google/devtools/build/lib/analysis/config/BuildConfiguration.java
index e6e55d4..1d3786d 100644
--- a/src/main/java/com/google/devtools/build/lib/analysis/config/BuildConfiguration.java
+++ b/src/main/java/com/google/devtools/build/lib/analysis/config/BuildConfiguration.java
@@ -777,12 +777,6 @@ public final class BuildConfiguration implements Serializable {
     )
     public List<Label> targetEnvironments;
 
-    @Option(name = "objc_gcov_binary",
-        converter = LabelConverter.class,
-        defaultValue = "//third_party/gcov:gcov_for_xcode",
-        category = "undocumented")
-    public Label objcGcovBinary;
-
     @Override
     public FragmentOptions getHost(boolean fallback) {
       Options host = (Options) getDefault();
@@ -833,9 +827,6 @@ public final class BuildConfiguration implements Serializable {
       if ((runUnder != null) && (runUnder.getLabel() != null)) {
         labelMap.put("RunUnder", runUnder.getLabel());
       }
-      if (collectCodeCoverage) {
-        labelMap.put("objc_gcov", objcGcovBinary);
-      }
     }
   }
 
diff --git a/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java b/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java
index feb1402..9a01889 100644
--- a/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java
+++ b/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java
@@ -43,7 +43,6 @@ import com.google.devtools.build.lib.bazel.rules.java.BazelJavaLibraryRule;
 import com.google.devtools.build.lib.bazel.rules.java.BazelJavaPluginRule;
 import com.google.devtools.build.lib.bazel.rules.java.BazelJavaRuleClasses;
 import com.google.devtools.build.lib.bazel.rules.java.BazelJavaTestRule;
-import com.google.devtools.build.lib.bazel.rules.objc.BazelIosTestRule;
 import com.google.devtools.build.lib.bazel.rules.python.BazelPyBinaryRule;
 import com.google.devtools.build.lib.bazel.rules.python.BazelPyLibraryRule;
 import com.google.devtools.build.lib.bazel.rules.python.BazelPyRuleClasses;
@@ -76,23 +75,6 @@ import com.google.devtools.build.lib.rules.java.JavaOptions;
 import com.google.devtools.build.lib.rules.java.JavaToolchainRule;
 import com.google.devtools.build.lib.rules.java.Jvm;
 import com.google.devtools.build.lib.rules.java.JvmConfigurationLoader;
-import com.google.devtools.build.lib.rules.objc.IosApplicationRule;
-import com.google.devtools.build.lib.rules.objc.IosDeviceRule;
-import com.google.devtools.build.lib.rules.objc.IosExtensionBinaryRule;
-import com.google.devtools.build.lib.rules.objc.IosExtensionRule;
-import com.google.devtools.build.lib.rules.objc.ObjcBinaryRule;
-import com.google.devtools.build.lib.rules.objc.ObjcBuildInfoFactory;
-import com.google.devtools.build.lib.rules.objc.ObjcBundleLibraryRule;
-import com.google.devtools.build.lib.rules.objc.ObjcBundleRule;
-import com.google.devtools.build.lib.rules.objc.ObjcCommandLineOptions;
-import com.google.devtools.build.lib.rules.objc.ObjcConfigurationLoader;
-import com.google.devtools.build.lib.rules.objc.ObjcFrameworkRule;
-import com.google.devtools.build.lib.rules.objc.ObjcImportRule;
-import com.google.devtools.build.lib.rules.objc.ObjcLibraryRule;
-import com.google.devtools.build.lib.rules.objc.ObjcOptionsRule;
-import com.google.devtools.build.lib.rules.objc.ObjcProtoLibraryRule;
-import com.google.devtools.build.lib.rules.objc.ObjcRuleClasses;
-import com.google.devtools.build.lib.rules.objc.ObjcXcodeprojRule;
 import com.google.devtools.build.lib.rules.python.PythonConfigurationLoader;
 import com.google.devtools.build.lib.rules.python.PythonOptions;
 import com.google.devtools.build.lib.rules.workspace.BindRule;
@@ -178,8 +160,7 @@ public class BazelRuleClassProvider {
           BuildConfiguration.Options.class,
           CppOptions.class,
           JavaOptions.class,
-          PythonOptions.class,
-          ObjcCommandLineOptions.class
+          PythonOptions.class
       );
 
   /**
@@ -194,7 +175,6 @@ public class BazelRuleClassProvider {
   public static void setup(ConfiguredRuleClassProvider.Builder builder) {
     builder
         .addBuildInfoFactory(new BazelJavaBuildInfoFactory())
-        .addBuildInfoFactory(new ObjcBuildInfoFactory())
         .setConfigurationCollectionFactory(new BazelConfigurationCollection())
         .setPrerequisiteValidator(new BazelPrerequisiteValidator())
         .setSkylarkAccessibleJavaClasses(skylarkBuiltinJavaObects);
@@ -256,36 +236,6 @@ public class BazelRuleClassProvider {
     builder.addRuleDefinition(new BazelJavaPluginRule());
     builder.addRuleDefinition(new JavaToolchainRule());
 
-    builder.addRuleDefinition(new BazelIosTestRule());
-    builder.addRuleDefinition(new IosDeviceRule());
-    builder.addRuleDefinition(new ObjcBinaryRule());
-    builder.addRuleDefinition(new ObjcBundleRule());
-    builder.addRuleDefinition(new ObjcBundleLibraryRule());
-    builder.addRuleDefinition(new ObjcFrameworkRule());
-    builder.addRuleDefinition(new ObjcImportRule());
-    builder.addRuleDefinition(new ObjcLibraryRule());
-    builder.addRuleDefinition(new ObjcOptionsRule());
-    builder.addRuleDefinition(new ObjcProtoLibraryRule());
-    builder.addRuleDefinition(new ObjcXcodeprojRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.CoptsRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.ObjcProtoRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.IosTestBaseRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.BundlingRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.ReleaseBundlingRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.SimulatorRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.CompilingRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.LinkingRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.ResourcesRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.XcodegenRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.AlwaysLinkRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.OptionsRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.SdkFrameworksDependerRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.CompileDependencyRule());
-    builder.addRuleDefinition(new ObjcRuleClasses.ResourceToolsRule());
-    builder.addRuleDefinition(new IosApplicationRule());
-    builder.addRuleDefinition(new IosExtensionBinaryRule());
-    builder.addRuleDefinition(new IosExtensionRule());
-
     builder.addRuleDefinition(new BazelExtraActionRule());
     builder.addRuleDefinition(new BazelActionListenerRule());
 
@@ -303,6 +253,5 @@ public class BazelRuleClassProvider {
     builder.addConfigurationFragment(new PythonConfigurationLoader(Functions.<String>identity()));
     builder.addConfigurationFragment(new JvmConfigurationLoader(JAVA_CPU_SUPPLIER));
     builder.addConfigurationFragment(new JavaConfigurationLoader(JAVA_CPU_SUPPLIER));
-    builder.addConfigurationFragment(new ObjcConfigurationLoader());
   }
 }
diff --git a/src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTest.java b/src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTest.java
deleted file mode 100644
index f45ca08..0000000
--- a/src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTest.java
+++ /dev/null
@@ -1,57 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.bazel.rules.objc;
-
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.Runfiles;
-import com.google.devtools.build.lib.analysis.RunfilesProvider;
-import com.google.devtools.build.lib.analysis.RunfilesSupport;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.rules.objc.IosTest;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon;
-import com.google.devtools.build.lib.rules.objc.XcodeProvider;
-
-/**
- * Implementation for ios_test rule in Bazel.
- */
-public final class BazelIosTest extends IosTest {
-  static final String IOS_TEST_ON_BAZEL_ATTR = "$ios_test_on_bazel";
-
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext, ObjcCommon common,
-      XcodeProvider xcodeProvider, NestedSet<Artifact> filesToBuild) throws InterruptedException {
-    Artifact testRunner = ruleContext.getPrerequisiteArtifact(IOS_TEST_ON_BAZEL_ATTR, Mode.TARGET);
-    Runfiles runfiles = new Runfiles.Builder()
-        .addArtifact(testRunner)
-        .build();
-    RunfilesSupport runfilesSupport =
-        RunfilesSupport.withExecutable(ruleContext, runfiles, testRunner);
-
-    return new RuleConfiguredTargetBuilder(ruleContext)
-        .setFilesToBuild(NestedSetBuilder.<Artifact>stableOrder()
-            .addTransitive(filesToBuild)
-            .add(testRunner)
-            .build())
-        .add(XcodeProvider.class, xcodeProvider)
-        .add(RunfilesProvider.class, RunfilesProvider.simple(runfiles))
-        .setRunfilesSupport(runfilesSupport, testRunner)
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTestRule.java b/src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTestRule.java
deleted file mode 100644
index 40c254e..0000000
--- a/src/main/java/com/google/devtools/build/lib/bazel/rules/objc/BazelIosTestRule.java
+++ /dev/null
@@ -1,74 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.bazel.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.LABEL;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.ImplicitOutputsFunction;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder.RuleClassType;
-import com.google.devtools.build.lib.rules.objc.ObjcRuleClasses;
-import com.google.devtools.build.lib.rules.objc.ReleaseBundlingSupport;
-import com.google.devtools.build.lib.rules.objc.XcodeSupport;
-
-/**
- * Rule definition for the ios_test rule.
- */
-public final class BazelIosTestRule implements RuleDefinition {
-  @Override
-  public RuleClass build(RuleClass.Builder builder, final RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(ios_test).IMPLICIT_OUTPUTS -->
-        <ul>
-          <li><code><var>name</var>.ipa</code>: the test bundle as an
-              <code>.ipa</code> file
-          <li><code><var>name</var>.xcodeproj/project.pbxproj: An Xcode project file which can be
-              used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(
-            ImplicitOutputsFunction.fromFunctions(ReleaseBundlingSupport.IPA, XcodeSupport.PBXPROJ))
-        .add(attr(BazelIosTest.IOS_TEST_ON_BAZEL_ATTR, LABEL)
-            .value(env.getLabel("//tools/objc:ios_test_on_bazel")).exec())
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("ios_test")
-        .type(RuleClassType.TEST)
-        .ancestors(BaseRuleClasses.BaseRule.class, BaseRuleClasses.TestBaseRule.class,
-            ObjcRuleClasses.IosTestBaseRule.class)
-        .factoryClass(BazelIosTest.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = ios_test, TYPE = TEST, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule provides a way to build iOS unit tests written in KIF, GTM and XCTest test frameworks
-on both iOS simulator and real devices.
-</p>
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ArtifactListAttribute.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ArtifactListAttribute.java
deleted file mode 100644
index d6c993b..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ArtifactListAttribute.java
+++ /dev/null
@@ -1,45 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-
-import java.util.Locale;
-
-/**
- * Attributes containing one or more labels.
- */
-public enum ArtifactListAttribute {
-  BUNDLE_IMPORTS;
-
-  public String attrName() {
-    return name().toLowerCase(Locale.US);
-  }
-
-  /**
-   * The artifacts specified by this attribute on the given rule. Returns an empty sequence if the
-   * attribute is omitted or not available on the rule type.
-   */
-  public Iterable<Artifact> get(RuleContext context) {
-    if (context.attributes().getAttributeDefinition(attrName()) == null) {
-      return ImmutableList.of();
-    } else {
-      return context.getPrerequisiteArtifacts(attrName(), Mode.TARGET).list();
-    }
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Attribute.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Attribute.java
deleted file mode 100644
index 95e628d..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Attribute.java
+++ /dev/null
@@ -1,43 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-
-/**
- * Container for an attribute name and access mode such as are commonly passed to
- * {@link RuleContext#getPrerequisite(String, Mode)} and related methods.
- */
-public class Attribute {
-  private final String name;
-  private final Mode accessMode;
-
-  /**
-   * Creates an attribute reference with the given name and access mode.
-   */
-  public Attribute(String name, Mode accessMode) {
-    this.name = name;
-    this.accessMode = accessMode;
-  }
-
-  public String getName() {
-    return name;
-  }
-
-  public Mode getAccessMode() {
-    return accessMode;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/BinaryLinkingTargetFactory.java b/src/main/java/com/google/devtools/build/lib/rules/objc/BinaryLinkingTargetFactory.java
deleted file mode 100644
index d50bdd8..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/BinaryLinkingTargetFactory.java
+++ /dev/null
@@ -1,189 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.IMPORTED_LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.LIBRARY;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Optional;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.RunfilesSupport;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkArgs;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkInputs;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.CompilationAttributes;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.ResourceAttributes;
-import com.google.devtools.build.lib.rules.objc.ReleaseBundlingSupport.LinkedBinary;
-
-/**
- * Implementation for rules that link binaries.
- */
-abstract class BinaryLinkingTargetFactory implements RuleConfiguredTargetFactory {
-  /**
-   * Indicates whether this binary generates an application bundle. If so, it causes the
-   * {@code infoplist} attribute to be read and a bundle to be added to the files-to-build.
-   */
-  enum HasReleaseBundlingSupport {
-    YES, NO;
-  }
-
-  private final HasReleaseBundlingSupport hasReleaseBundlingSupport;
-  private final ExtraLinkArgs extraLinkArgs;
-  private final XcodeProductType productType;
-
-  protected BinaryLinkingTargetFactory(HasReleaseBundlingSupport hasReleaseBundlingSupport,
-      ExtraLinkArgs extraLinkArgs, XcodeProductType productType) {
-    this.hasReleaseBundlingSupport = hasReleaseBundlingSupport;
-    this.extraLinkArgs = extraLinkArgs;
-    this.productType = productType;
-  }
-
-  @VisibleForTesting
-  static final String REQUIRES_AT_LEAST_ONE_LIBRARY_OR_SOURCE_FILE =
-      "At least one library dependency or source file is required.";
-
-  @Override
-  public final ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    ObjcCommon common = common(ruleContext);
-    OptionsProvider optionsProvider = optionsProvider(ruleContext);
-
-    ObjcProvider objcProvider = common.getObjcProvider();
-    if (!hasLibraryOrSources(objcProvider)) {
-      ruleContext.ruleError(REQUIRES_AT_LEAST_ONE_LIBRARY_OR_SOURCE_FILE);
-      return null;
-    }
-
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-
-    XcodeProvider.Builder xcodeProviderBuilder = new XcodeProvider.Builder();
-    NestedSetBuilder<Artifact> filesToBuild = NestedSetBuilder.<Artifact>stableOrder()
-        .add(intermediateArtifacts.singleArchitectureBinary());
-
-    new CompilationSupport(ruleContext)
-        .registerJ2ObjcCompileAndArchiveActions(optionsProvider, objcProvider)
-        .registerCompileAndArchiveActions(common, optionsProvider)
-        .addXcodeSettings(xcodeProviderBuilder, common, optionsProvider)
-        .registerLinkActions(objcProvider, extraLinkArgs, new ExtraLinkInputs())
-        .validateAttributes();
-
-    Optional<XcTestAppProvider> xcTestAppProvider;
-    Optional<RunfilesSupport> maybeRunfilesSupport = Optional.absent();
-    switch (hasReleaseBundlingSupport) {
-      case YES:
-        // TODO(bazel-team): Remove once all bundle users are migrated to ios_application.
-        ReleaseBundlingSupport releaseBundlingSupport = new ReleaseBundlingSupport(
-            ruleContext, objcProvider, optionsProvider,
-            LinkedBinary.LOCAL_AND_DEPENDENCIES, ReleaseBundlingSupport.APP_BUNDLE_DIR_FORMAT);
-        releaseBundlingSupport
-            .registerActions()
-            .addXcodeSettings(xcodeProviderBuilder)
-            .addFilesToBuild(filesToBuild)
-            .validateResources()
-            .validateAttributes();
-
-        ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-        xcTestAppProvider = Optional.of(releaseBundlingSupport.xcTestAppProvider());
-        if (objcConfiguration.getBundlingPlatform() == Platform.SIMULATOR) {
-          Artifact runnerScript = intermediateArtifacts.runnerScript();
-          Artifact ipaFile = ruleContext.getImplicitOutputArtifact(ReleaseBundlingSupport.IPA);
-          releaseBundlingSupport.registerGenerateRunnerScriptAction(runnerScript, ipaFile);
-          maybeRunfilesSupport = Optional.of(releaseBundlingSupport.runfilesSupport(runnerScript));
-        }
-        break;
-      case NO:
-        xcTestAppProvider = Optional.absent();
-        break;
-      default:
-        throw new AssertionError();
-    }
-
-    new ResourceSupport(ruleContext)
-        .validateAttributes()
-        .addXcodeSettings(xcodeProviderBuilder);
-
-    XcodeSupport xcodeSupport = new XcodeSupport(ruleContext)
-        // TODO(bazel-team): Use LIBRARY_STATIC as parameter instead of APPLICATION once objc_binary
-        // no longer creates an application bundle
-        .addXcodeSettings(xcodeProviderBuilder, objcProvider, productType)
-        .addDependencies(xcodeProviderBuilder, new Attribute("bundles", Mode.TARGET))
-        .addDependencies(xcodeProviderBuilder, new Attribute("deps", Mode.TARGET))
-        .addNonPropagatedDependencies(
-            xcodeProviderBuilder, new Attribute("non_propagated_deps", Mode.TARGET))
-        .addFilesToBuild(filesToBuild);
-    XcodeProvider xcodeProvider = xcodeProviderBuilder.build();
-    xcodeSupport.registerActions(xcodeProvider);
-
-    // TODO(bazel-team): Stop exporting an XcTestAppProvider once objc_binary no longer creates an
-    // application bundle.
-    RuleConfiguredTargetBuilder target = common.configuredTargetBuilder(
-        filesToBuild.build(),
-        Optional.of(xcodeProvider),
-        Optional.of(objcProvider),
-        xcTestAppProvider,
-        Optional.<J2ObjcSrcsProvider>absent());
-    for (RunfilesSupport runfilesSupport : maybeRunfilesSupport.asSet()) {
-      target.setRunfilesSupport(runfilesSupport, runfilesSupport.getExecutable());
-    }
-    return target.build();
-  }
-
-  private OptionsProvider optionsProvider(RuleContext ruleContext) {
-    OptionsProvider.Builder provider = new OptionsProvider.Builder()
-        .addCopts(ruleContext.getTokenizedStringListAttr("copts"))
-        .addTransitive(Optional.fromNullable(
-            ruleContext.getPrerequisite("options", Mode.TARGET, OptionsProvider.class)));
-    if (hasReleaseBundlingSupport == HasReleaseBundlingSupport.YES) {
-        provider
-            .addInfoplists(ruleContext.getPrerequisiteArtifacts("infoplist", Mode.TARGET).list());
-    }
-    return provider.build();
-  }
-
-  private boolean hasLibraryOrSources(ObjcProvider objcProvider) {
-    return !Iterables.isEmpty(objcProvider.get(LIBRARY)) // Includes sources from this target.
-        || !Iterables.isEmpty(objcProvider.get(IMPORTED_LIBRARY));
-  }
-
-  private ObjcCommon common(RuleContext ruleContext) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    CompilationArtifacts compilationArtifacts =
-        CompilationSupport.compilationArtifacts(ruleContext);
-
-    return new ObjcCommon.Builder(ruleContext)
-        .setCompilationAttributes(new CompilationAttributes(ruleContext))
-        .setResourceAttributes(new ResourceAttributes(ruleContext))
-        .setCompilationArtifacts(compilationArtifacts)
-        .addDefines(ruleContext.getTokenizedStringListAttr("defines"))
-        .addDepObjcProviders(ruleContext.getPrerequisites("deps", Mode.TARGET, ObjcProvider.class))
-        .addDepObjcProviders(
-            ruleContext.getPrerequisites("bundles", Mode.TARGET, ObjcProvider.class))
-        .addNonPropagatedDepObjcProviders(
-            ruleContext.getPrerequisites("non_propagated_deps", Mode.TARGET, ObjcProvider.class))
-        .setIntermediateArtifacts(intermediateArtifacts)
-        .setAlwayslink(false)
-        .addExtraImportLibraries(ObjcRuleClasses.j2ObjcLibraries(ruleContext))
-        .setLinkedBinary(intermediateArtifacts.singleArchitectureBinary())
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/BundleMergeControlBytes.java b/src/main/java/com/google/devtools/build/lib/rules/objc/BundleMergeControlBytes.java
deleted file mode 100644
index d0be20c..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/BundleMergeControlBytes.java
+++ /dev/null
@@ -1,122 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.BUNDLE_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.NESTED_BUNDLE;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.io.ByteSource;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.Control;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.MergeZip;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.VariableSubstitution;
-
-import java.io.InputStream;
-import java.util.Map;
-
-/**
- * A byte source that can be used to generate a control file for the tool:
- * {@code //java/com/google/devtools/build/xcode/bundlemerge}. Note that this generates the control
- * proto and bytes on-the-fly rather than eagerly. This is to prevent a copy of the bundle files and
- * .xcdatamodels from being stored for each {@code objc_binary} (or any bundle) being built.
- */
-final class BundleMergeControlBytes extends ByteSource {
-  private final Bundling rootBundling;
-  private final Artifact mergedIpa;
-  private final ObjcConfiguration objcConfiguration;
-  private final ImmutableSet<TargetDeviceFamily> families;
-
-  public BundleMergeControlBytes(
-      Bundling rootBundling, Artifact mergedIpa, ObjcConfiguration objcConfiguration,
-      ImmutableSet<TargetDeviceFamily> families) {
-    this.rootBundling = Preconditions.checkNotNull(rootBundling);
-    this.mergedIpa = Preconditions.checkNotNull(mergedIpa);
-    this.objcConfiguration = Preconditions.checkNotNull(objcConfiguration);
-    this.families = Preconditions.checkNotNull(families);
-  }
-
-  @Override
-  public InputStream openStream() {
-    return control("", rootBundling)
-        .toByteString()
-        .newInput();
-  }
-
-  private Control control(String mergeZipPrefix, Bundling bundling) {
-    ObjcProvider objcProvider = bundling.getObjcProvider();
-    mergeZipPrefix += bundling.getBundleDir() + "/";
-
-    BundleMergeProtos.Control.Builder control = BundleMergeProtos.Control.newBuilder()
-        .addAllBundleFile(BundleableFile.toBundleFiles(bundling.getExtraBundleFiles()))
-        .addAllBundleFile(BundleableFile.toBundleFiles(objcProvider.get(BUNDLE_FILE)))
-        .addAllSourcePlistFile(Artifact.toExecPaths(
-            bundling.getInfoplistMerging().getPlistWithEverything().asSet()))
-        // TODO(bazel-team): Add rule attribute for specifying targeted device family
-        .setMinimumOsVersion(objcConfiguration.getMinimumOs())
-        .setSdkVersion(objcConfiguration.getIosSdkVersion())
-        .setPlatform(objcConfiguration.getBundlingPlatform().name())
-        .setBundleRoot(bundling.getBundleDir());
-
-    for (Artifact mergeZip : bundling.getMergeZips()) {
-      control.addMergeZip(MergeZip.newBuilder()
-          .setEntryNamePrefix(mergeZipPrefix)
-          .setSourcePath(mergeZip.getExecPathString())
-          .build());
-    }
-
-    for (TargetDeviceFamily targetDeviceFamily : families) {
-      control.addTargetDeviceFamily(targetDeviceFamily.name());
-    }
-
-    Map<String, String> variableSubstitutions = bundling.variableSubstitutions();
-    for (String variable : variableSubstitutions.keySet()) {
-      control.addVariableSubstitution(VariableSubstitution.newBuilder()
-          .setName(variable)
-          .setValue(variableSubstitutions.get(variable))
-          .build());
-    }
-
-    control.setOutFile(mergedIpa.getExecPathString());
-
-    for (Artifact linkedBinary : bundling.getCombinedArchitectureBinary().asSet()) {
-      control
-          .addBundleFile(BundleMergeProtos.BundleFile.newBuilder()
-              .setSourceFile(linkedBinary.getExecPathString())
-              .setBundlePath(bundling.getName())
-              .setExternalFileAttribute(BundleableFile.EXECUTABLE_EXTERNAL_FILE_ATTRIBUTE)
-              .build())
-          .setExecutableName(bundling.getName());
-    }
-
-    for (Bundling nestedBundling : bundling.getObjcProvider().get(NESTED_BUNDLE)) {
-      if (nestedBundling.getArchitecture().equals(bundling.getArchitecture())) {
-        control.addNestedBundle(control(mergeZipPrefix, nestedBundling));
-      }
-    }
-    
-    if (bundling.getPrimaryBundleId()  != null) {
-      control.setPrimaryBundleIdentifier(bundling.getPrimaryBundleId());
-    }
-    
-    if (bundling.getFallbackBundleId() != null) {
-      control.setFallbackBundleIdentifier(bundling.getFallbackBundleId());
-    }
-    
-    return control.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/BundleSupport.java b/src/main/java/com/google/devtools/build/lib/rules/objc/BundleSupport.java
deleted file mode 100644
index 8d51f57..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/BundleSupport.java
+++ /dev/null
@@ -1,422 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.ASSET_CATALOG;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.STRINGS;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XCASSETS_DIR;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Verify;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.FilesToRunProvider;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.actions.CommandLine;
-import com.google.devtools.build.lib.analysis.actions.CustomCommandLine;
-import com.google.devtools.build.lib.analysis.actions.SpawnAction;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraActoolArgs;
-import com.google.devtools.build.lib.rules.objc.XcodeProvider.Builder;
-import com.google.devtools.build.lib.vfs.FileSystemUtils;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-import java.util.HashMap;
-import java.util.Locale;
-import java.util.Map;
-import java.util.Objects;
-import java.util.Set;
-
-/**
- * Support for generating iOS bundles which contain metadata (a plist file), assets, resources and
- * optionally a binary: registers actions that assemble resources and merge plists, provides data
- * to providers and validates bundle-related attributes.
- *
- * <p>Methods on this class can be called in any order without impacting the result.
- */
-final class BundleSupport {
-
-  static class ExtraMergePlists extends IterableWrapper<Artifact> {
-    ExtraMergePlists(Artifact... inputs) {
-      super(inputs);
-    }
-  }
-
-  private final RuleContext ruleContext;
-  private final Set<TargetDeviceFamily> targetDeviceFamilies;
-  private final ExtraActoolArgs extraActoolArgs;
-  private final Bundling bundling;
-  private final Attributes attributes;
-
-  /**
-   * Returns merging instructions for a bundle's {@code Info.plist}.
-   *
-   * @param ruleContext context this bundle is constructed in
-   * @param objcProvider provider containing all dependencies' information as well as some of this
-   *    rule's
-   * @param optionsProvider provider containing options and plist settings for this rule and its
-   *    dependencies
-   * @param extraMergePlists additional plist files to merge
-   */
-  static InfoplistMerging infoPlistMerging(
-      RuleContext ruleContext,
-      ObjcProvider objcProvider,
-      OptionsProvider optionsProvider,
-      ExtraMergePlists extraMergePlists) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-
-    return new InfoplistMerging.Builder(ruleContext)
-        .setIntermediateArtifacts(intermediateArtifacts)
-        .setInputPlists(NestedSetBuilder.<Artifact>stableOrder()
-            .addTransitive(optionsProvider.getInfoplists())
-            .addAll(actoolPartialInfoplist(ruleContext, objcProvider).asSet())
-            .addAll(extraMergePlists)
-            .build())
-        .setPlmerge(ruleContext.getExecutablePrerequisite("$plmerge", Mode.HOST))
-        .build();
-  }
-
-  /**
-   * Creates a new bundle support with no special {@code actool} arguments.
-   *
-   * @param ruleContext context this bundle is constructed in
-   * @param targetDeviceFamilies device families used in asset catalogue construction
-   * @param bundling bundle information as configured for this rule
-   */
-  public BundleSupport(
-      RuleContext ruleContext, Set<TargetDeviceFamily> targetDeviceFamilies, Bundling bundling) {
-    this(ruleContext, targetDeviceFamilies, bundling, new ExtraActoolArgs());
-  }
-
-  /**
-   * Creates a new bundle support.
-   *
-   * @param ruleContext context this bundle is constructed in
-   * @param targetDeviceFamilies device families used in asset catalogue construction
-   * @param bundling bundle information as configured for this rule
-   * @param extraActoolArgs any additional parameters to be used for invoking {@code actool}
-   */
-  public BundleSupport(RuleContext ruleContext, Set<TargetDeviceFamily> targetDeviceFamilies,
-      Bundling bundling, ExtraActoolArgs extraActoolArgs) {
-    this.ruleContext = ruleContext;
-    this.targetDeviceFamilies = targetDeviceFamilies;
-    this.extraActoolArgs = extraActoolArgs;
-    this.bundling = bundling;
-    this.attributes = new Attributes(ruleContext);
-  }
-
-  /**
-   * Registers actions required for constructing this bundle, namely merging all involved {@code
-   * Info.plist} files and generating asset catalogues.
-   *
-   * @param objcProvider source of information from this rule's attributes and its dependencies
-   * @return this bundle support
-   */
-  BundleSupport registerActions(ObjcProvider objcProvider) {
-    registerConvertStringsActions(objcProvider);
-    registerConvertXibsActions(objcProvider);
-    registerMomczipActions(objcProvider);
-    registerInterfaceBuilderActions(objcProvider);
-    registerMergeInfoplistAction();
-    registerActoolActionIfNecessary(objcProvider);
-
-    return this;
-  }
-
-  /**
-   * Adds any Xcode settings related to this bundle to the given provider builder.
-   *
-   * @return this bundle support
-   */
-  BundleSupport addXcodeSettings(Builder xcodeProviderBuilder) {
-    xcodeProviderBuilder.setInfoplistMerging(bundling.getInfoplistMerging());
-    return this;
-  }
-
-  /**
-   * Validates that resources defined in this rule and its dependencies and written to this bundle
-   * are legal (for example that they are not mapped to the same bundle location).
-   *
-   * @return this bundle support
-   */
-  BundleSupport validateResources(ObjcProvider objcProvider) {
-    Map<String, Artifact> bundlePathToFile = new HashMap<>();
-    for (Artifact stringsFile : objcProvider.get(STRINGS)) {
-      String bundlePath = BundleableFile.flatBundlePath(stringsFile.getExecPath());
-
-      // Normally any two resources mapped to the same path in the bundle are illegal. However, we
-      // currently don't have a good solution for resources generated by a genrule in
-      // multi-architecture builds: They map to the same bundle path but have different owners (the
-      // genrules targets in the various configurations) and roots (one for each architecture).
-      // Since we know that architecture shouldn't matter for strings file generation we silently
-      // ignore cases like this and pick one of the outputs at random to put in the bundle (see also
-      // related filtering code in Bundling.Builder.build()).
-      if (bundlePathToFile.containsKey(bundlePath)) {
-        Artifact original = bundlePathToFile.get(bundlePath);
-        if (!Objects.equals(original.getOwner(), stringsFile.getOwner())) {
-          ruleContext.ruleError(String.format(
-              "Two string files map to the same path [%s] in this bundle but come from different "
-                  + "locations: %s and %s",
-              bundlePath, original.getOwner(), stringsFile.getOwner()));
-        } else {
-          Verify.verify(!original.getRoot().equals(stringsFile.getRoot()),
-              "%s and %s should have different roots but have %s and %s",
-              original, stringsFile, original.getRoot(), stringsFile.getRoot());
-        }
-
-      } else {
-        bundlePathToFile.put(bundlePath, stringsFile);
-      }
-    }
-
-    // TODO(bazel-team): Do the same validation for storyboards and datamodels which could also be
-    // generated by genrules or doubly defined.
-
-    return this;
-  }
-
-  private void registerInterfaceBuilderActions(ObjcProvider objcProvider) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    String minimumOs = objcConfiguration.getMinimumOs();
-    for (Artifact storyboardInput : objcProvider.get(ObjcProvider.STORYBOARD)) {
-      String archiveRoot = BundleableFile.flatBundlePath(storyboardInput.getExecPath()) + "c";
-      Artifact zipOutput = intermediateArtifacts.compiledStoryboardZip(storyboardInput);
-
-      ruleContext.registerAction(
-          ObjcActionsBuilder.spawnJavaOnDarwinActionBuilder(attributes.ibtoolzipDeployJar())
-              .setMnemonic("StoryboardCompile")
-              .setCommandLine(CustomCommandLine.builder()
-                  // The next three arguments are positional,
-                  // i.e. they don't have flags before them.
-                  .addPath(zipOutput.getExecPath())
-                  .add(archiveRoot)
-                  .addPath(ObjcActionsBuilder.IBTOOL)
-
-                  .add("--minimum-deployment-target").add(minimumOs)
-                  .addPath(storyboardInput.getExecPath())
-                  .build())
-              .addOutput(zipOutput)
-              .addInput(storyboardInput)
-              .build(ruleContext));
-    }
-  }
-
-  private void registerMomczipActions(ObjcProvider objcProvider) {
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    Iterable<Xcdatamodel> xcdatamodels = Xcdatamodels.xcdatamodels(
-        intermediateArtifacts, objcProvider.get(ObjcProvider.XCDATAMODEL));
-    for (Xcdatamodel datamodel : xcdatamodels) {
-      Artifact outputZip = datamodel.getOutputZip();
-      ruleContext.registerAction(
-          ObjcActionsBuilder.spawnJavaOnDarwinActionBuilder(attributes.momczipDeployJar())
-              .setMnemonic("MomCompile")
-              .addOutput(outputZip)
-              .addInputs(datamodel.getInputs())
-              .setCommandLine(CustomCommandLine.builder()
-                  .addPath(outputZip.getExecPath())
-                  .add(datamodel.archiveRootForMomczip())
-                  .add(IosSdkCommands.MOMC_PATH)
-                  .add(commonMomczipArguments(objcConfiguration))
-                  .add(datamodel.getContainer().getSafePathString())
-                  .build())
-              .build(ruleContext));
-    }
-  }
-
-  static Iterable<String> commonMomczipArguments(ObjcConfiguration configuration) {
-    return ImmutableList.of(
-        "-XD_MOMC_SDKROOT=" + IosSdkCommands.sdkDir(configuration),
-        "-XD_MOMC_IOS_TARGET_VERSION=" + configuration.getMinimumOs(),
-        "-MOMC_PLATFORMS", configuration.getBundlingPlatform().getLowerCaseNameInPlist(),
-        "-XD_MOMC_TARGET_VERSION=10.6");
-  }
-
-  private void registerConvertXibsActions(ObjcProvider objcProvider) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    for (Artifact original : objcProvider.get(ObjcProvider.XIB)) {
-      Artifact zipOutput = intermediateArtifacts.compiledXibFileZip(original);
-      String archiveRoot = BundleableFile.flatBundlePath(
-          FileSystemUtils.replaceExtension(original.getExecPath(), ".nib"));
-      ruleContext.registerAction(
-          ObjcActionsBuilder.spawnJavaOnDarwinActionBuilder(attributes.ibtoolzipDeployJar())
-              .setMnemonic("XibCompile")
-              .setCommandLine(CustomCommandLine.builder()
-                  // The next three arguments are positional,
-                  // i.e. they don't have flags before them.
-                  .addPath(zipOutput.getExecPath())
-                  .add(archiveRoot)
-                  .addPath(ObjcActionsBuilder.IBTOOL)
-
-                  .add("--minimum-deployment-target").add(objcConfiguration.getMinimumOs())
-                  .addPath(original.getExecPath())
-                  .build())
-              .addOutput(zipOutput)
-              .addInput(original)
-              .build(ruleContext));
-    }
-  }
-
-  private void registerConvertStringsActions(ObjcProvider objcProvider) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    for (Artifact strings : objcProvider.get(ObjcProvider.STRINGS)) {
-      Artifact bundled = intermediateArtifacts.convertedStringsFile(strings);
-      ruleContext.registerAction(new SpawnAction.Builder()
-          .setMnemonic("ConvertStringsPlist")
-          .setExecutable(attributes.plmerge())
-          .setCommandLine(CustomCommandLine.builder()
-              .addExecPath("--source_file", strings)
-              .addExecPath("--out_file", bundled)
-              .build())
-          .addInput(strings)
-          .addOutput(bundled)
-          .build(ruleContext));
-    }
-  }
-
-  /**
-   * Validates any rule attributes and dependencies related to this bundle.
-   *
-   * @return this bundle support
-   */
-  BundleSupport validateAttributes() {
-    return this;
-  }
-
-  private void registerMergeInfoplistAction() {
-    // TODO(bazel-team): Move action implementation from InfoplistMerging to this class.
-    ruleContext.registerAction(bundling.getInfoplistMerging().getMergeAction());
-  }
-
-  private void registerActoolActionIfNecessary(ObjcProvider objcProvider) {
-    Optional<Artifact> actoolzipOutput = bundling.getActoolzipOutput();
-    if (!actoolzipOutput.isPresent()) {
-      return;
-    }
-
-    Artifact actoolPartialInfoplist = actoolPartialInfoplist(ruleContext, objcProvider).get();
-    Artifact zipOutput = actoolzipOutput.get();
-
-    // TODO(bazel-team): Do not use the deploy jar explicitly here. There is currently a bug where
-    // we cannot .setExecutable({java_binary target}) and set REQUIRES_DARWIN in the execution info.
-    // Note that below we set the archive root to the empty string. This means that the generated
-    // zip file will be rooted at the bundle root, and we have to prepend the bundle root to each
-    // entry when merging it with the final .ipa file.
-    ruleContext.registerAction(
-        ObjcActionsBuilder.spawnJavaOnDarwinActionBuilder(attributes.actoolzipDeployJar())
-            .setMnemonic("AssetCatalogCompile")
-            .addTransitiveInputs(objcProvider.get(ASSET_CATALOG))
-            .addOutput(zipOutput)
-            .addOutput(actoolPartialInfoplist)
-            .setCommandLine(actoolzipCommandLine(
-                objcProvider,
-                zipOutput,
-                actoolPartialInfoplist))
-            .build(ruleContext));
-  }
-
-  private CommandLine actoolzipCommandLine(
-      final ObjcProvider provider,
-      final Artifact zipOutput,
-      final Artifact partialInfoPlist) {
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    CustomCommandLine.Builder commandLine = CustomCommandLine.builder()
-        // The next three arguments are positional, i.e. they don't have flags before them.
-        .addPath(zipOutput.getExecPath())
-        .add("") // archive root
-        .add(IosSdkCommands.ACTOOL_PATH)
-
-        .add("--platform").add(objcConfiguration.getBundlingPlatform().getLowerCaseNameInPlist())
-        .addExecPath("--output-partial-info-plist", partialInfoPlist)
-        .add("--minimum-deployment-target").add(objcConfiguration.getMinimumOs());
-
-    for (TargetDeviceFamily targetDeviceFamily : targetDeviceFamilies) {
-      commandLine.add("--target-device").add(targetDeviceFamily.name().toLowerCase(Locale.US));
-    }
-
-    return commandLine
-        .add(PathFragment.safePathStrings(provider.get(XCASSETS_DIR)))
-        .add(extraActoolArgs)
-        .build();
-  }
-
-
-  /**
-   * Returns the artifact that is a plist file generated by an invocation of {@code actool} or
-   * {@link Optional#absent()} if no asset catalogues are present in this target and its
-   * dependencies.
-   *
-   * <p>All invocations of {@code actool} generate this kind of plist file, which contains metadata
-   * about the {@code app_icon} and {@code launch_image} if supplied. If neither an app icon or a
-   * launch image was supplied, the plist file generated is empty.
-   */
-  private static Optional<Artifact> actoolPartialInfoplist(
-      RuleContext ruleContext, ObjcProvider objcProvider) {
-    if (objcProvider.hasAssetCatalogs()) {
-      IntermediateArtifacts intermediateArtifacts =
-          ObjcRuleClasses.intermediateArtifacts(ruleContext);
-      return Optional.of(intermediateArtifacts.actoolPartialInfoplist());
-    } else {
-      return Optional.absent();
-    }
-  }
-
-  /**
-   * Common rule attributes used by a bundle support.
-   */
-  private static class Attributes {
-    private final RuleContext ruleContext;
-
-    private Attributes(RuleContext ruleContext) {
-      this.ruleContext = ruleContext;
-    }
-
-    /**
-     * Returns a reference to the plmerge executable.
-     */
-    FilesToRunProvider plmerge() {
-      return ruleContext.getExecutablePrerequisite("$plmerge", Mode.HOST);
-    }
-
-    /**
-     * Returns the location of the ibtoolzip deploy jar.
-     */
-    Artifact ibtoolzipDeployJar() {
-      return ruleContext.getPrerequisiteArtifact("$ibtoolzip_deploy", Mode.HOST);
-    }
-
-    /**
-     * Returns the location of the momczip deploy jar.
-     */
-    Artifact momczipDeployJar() {
-      return ruleContext.getPrerequisiteArtifact("$momczip_deploy", Mode.HOST);
-    }
-
-    /**
-     * Returns the location of the actoolzip deploy jar.
-     */
-    Artifact actoolzipDeployJar() {
-      return ruleContext.getPrerequisiteArtifact("$actoolzip_deploy", Mode.HOST);
-    }
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/BundleableFile.java b/src/main/java/com/google/devtools/build/lib/rules/objc/BundleableFile.java
deleted file mode 100644
index e82891e..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/BundleableFile.java
+++ /dev/null
@@ -1,175 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ArtifactListAttribute.BUNDLE_IMPORTS;
-import static com.google.devtools.build.lib.rules.objc.ObjcCommon.BUNDLE_CONTAINER_TYPE;
-
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.vfs.PathFragment;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.BundleFile;
-
-/**
- * Represents a file which is processed to another file and bundled. It contains the
- * {@code Artifact} corresponding to the original file as well as the {@code Artifact} for the file
- * converted to its bundled form. Examples of files that fit this pattern are .strings and .xib
- * files.
- */
-public final class BundleableFile extends Value<BundleableFile> {
-  static final int EXECUTABLE_EXTERNAL_FILE_ATTRIBUTE = 0100755 << 16;
-  static final int DEFAULT_EXTERNAL_FILE_ATTRIBUTE = 0100644 << 16;
-
-  private final Artifact bundled;
-  private final String bundlePath;
-  private final int zipExternalFileAttribute;
-
-  /**
-   * Creates an instance whose {@code zipExternalFileAttribute} value is
-   * {@link #DEFAULT_EXTERNAL_FILE_ATTRIBUTE}.
-   */
-  BundleableFile(Artifact bundled, String bundlePath) {
-    this(bundled, bundlePath, DEFAULT_EXTERNAL_FILE_ATTRIBUTE);
-  }
-
-  /**
-   * @param bundled the {@link Artifact} whose data is placed in the bundle
-   * @param bundlePath the path of the file in the bundle
-   * @param zipExternalFileAttribute external file attribute of the file in the central directory of
-   *     the bundle (zip file). The lower 16 bits contain the MS-DOS file attributes. The upper 16
-   *     bits contain the Unix file attributes, for instance 0100755 (octal) for a regular file with
-   *     permissions {@code rwxr-xr-x}.
-   */
-  BundleableFile(Artifact bundled, String bundlePath, int zipExternalFileAttribute) {
-    super(new ImmutableMap.Builder<String, Object>()
-        .put("bundled", bundled)
-        .put("bundlePath", bundlePath)
-        .put("zipExternalFileAttribute", zipExternalFileAttribute)
-        .build());
-    this.bundled = bundled;
-    this.bundlePath = bundlePath;
-    this.zipExternalFileAttribute = zipExternalFileAttribute;
-  }
-
-  static String flatBundlePath(PathFragment path) {
-    String containingDir = path.getParentDirectory().getBaseName();
-    return (containingDir.endsWith(".lproj") ? (containingDir + "/") : "") + path.getBaseName();
-  }
-
-  /**
-   * Given a sequence of non-compiled resource files, returns a sequence of the same length of
-   * instances of this class with the resource paths flattened (resources are put in the bundle
-   * root) or, if the source file is in a directory ending in {@code .lproj}, in a directory of that
-   * name directly under the bundle root.
-   *
-   * <p>Non-compiled resource files are resources which are not processed before placing them in the
-   * final bundle. This is different from (for example) {@code .strings} and {@code .xib} files,
-   * which must be converted to binary plist form or compiled.
-   *
-   * @param files a sequence of artifacts corresponding to non-compiled resource files
-   */
-  public static Iterable<BundleableFile> flattenedRawResourceFiles(Iterable<Artifact> files) {
-    ImmutableList.Builder<BundleableFile> result = new ImmutableList.Builder<>();
-    for (Artifact file : files) {
-      result.add(new BundleableFile(file, flatBundlePath(file.getExecPath())));
-    }
-    return result.build();
-  }
-
-  /**
-   * Given a sequence of non-compiled resource files, returns a sequence of the same length of
-   * instances of this class with the resource paths copied as-is into the bundle root.
-   *
-   * <p>Non-compiled resource files are resources which are not processed before placing them in the
-   * final bundle. This is different from (for example) {@code .strings} and {@code .xib} files,
-   * which must be converted to binary plist form or compiled.
-   *
-   * @param files a sequence of artifacts corresponding to non-compiled resource files
-   */
-  public static Iterable<BundleableFile> structuredRawResourceFiles(Iterable<Artifact> files) {
-    ImmutableList.Builder<BundleableFile> result = new ImmutableList.Builder<>();
-    for (Artifact file : files) {
-      result.add(new BundleableFile(file, ownerBundlePath(file)));
-    }
-    return result.build();
-  }
-
-  private static String ownerBundlePath(Artifact file) {
-    PathFragment packageFragment = file.getArtifactOwner().getLabel().getPackageFragment();
-    return file.getRootRelativePath().relativeTo(packageFragment).toString();
-  }
-
-  /**
-   * Returns an instance for every file in a bundle directory.
-   * <p>
-   * This uses the parent-most container matching {@code *.bundle} as the bundle root.
-   * TODO(bazel-team): add something like an import_root attribute to specify this explicitly, which
-   * will be helpful if a bundle that appears to be nested needs to be imported alone.
-   */
-  public static Iterable<BundleableFile> bundleImportsFromRule(RuleContext context) {
-    ImmutableList.Builder<BundleableFile> result = new ImmutableList.Builder<>();
-    for (Artifact artifact : BUNDLE_IMPORTS.get(context)) {
-      for (PathFragment container :
-          ObjcCommon.farthestContainerMatching(BUNDLE_CONTAINER_TYPE, artifact).asSet()) {
-        // TODO(bazel-team): Figure out if we need to remove symbols of architectures we aren't 
-        // building for from the binary in the bundle.
-        result.add(new BundleableFile(
-            artifact,
-            // The path from the artifact's container (including the container), to the artifact
-            // itself. For instance, if artifact is foo/bar.bundle/baz, then this value
-            // is bar.bundle/baz.
-            artifact.getExecPath().relativeTo(container.getParentDirectory()).getSafePathString()));
-      }
-    }
-    return result.build();
-  }
-
-  /**
-   * Returns the location into which this file should be put in, relative to the bundle root.
-   */
-  public String getBundlePath() {
-    return bundlePath;
-  }
-
-  /**
-   * Returns bundle files for each given strings file. These are used to merge the strings files to
-   * the final application bundle.
-   */
-  public static Iterable<BundleFile> toBundleFiles(Iterable<BundleableFile> files) {
-    ImmutableList.Builder<BundleFile> result = new ImmutableList.Builder<>();
-    for (BundleableFile file : files) {
-      result.add(BundleFile.newBuilder()
-          .setBundlePath(file.bundlePath)
-          .setSourceFile(file.bundled.getExecPathString())
-          .setExternalFileAttribute(file.zipExternalFileAttribute)
-          .build());
-    }
-    return result.build();
-  }
-
-  /**
-   * Returns the artifacts for the bundled files. These can be used, for instance, as the input
-   * files to add to the bundlemerge action for a bundle that contains all the given files.
-   */
-  public static Iterable<Artifact> toArtifacts(Iterable<BundleableFile> files) {
-    ImmutableList.Builder<Artifact> result = new ImmutableList.Builder<>();
-    for (BundleableFile file : files) {
-      result.add(file.bundled);
-    }
-    return result.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Bundling.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Bundling.java
deleted file mode 100644
index 8b5edfd..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Bundling.java
+++ /dev/null
@@ -1,331 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.ASSET_CATALOG;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.BUNDLE_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.IMPORTED_LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.MERGE_ZIP;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.NESTED_BUNDLE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.STORYBOARD;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.STRINGS;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XCDATAMODEL;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XIB;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableList.Builder;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-import java.util.HashSet;
-import java.util.Map;
-import java.util.Set;
-
-/**
- * Contains information regarding the creation of an iOS bundle.
- */
-@Immutable
-final class Bundling {
-  static final class Builder {
-    private String name;
-    private String bundleDirFormat;
-    private ImmutableList.Builder<BundleableFile> extraBundleFilesBuilder =
-        new ImmutableList.Builder<>();
-    private ObjcProvider objcProvider;
-    private InfoplistMerging infoplistMerging;
-    private IntermediateArtifacts intermediateArtifacts;
-    private String primaryBundleId;
-    private String fallbackBundleId;
-    private String architecture;
-
-    public Builder setName(String name) {
-      this.name = name;
-      return this;
-    }
-
-    /**
-     * Sets the CPU architecture this bundling was constructed for. Legal value are any that may be
-     * set on {@link ObjcConfiguration#getIosCpu()}.
-     */
-    public Builder setArchitecture(String architecture) {
-      this.architecture = architecture;
-      return this;
-    }
-
-    public Builder setBundleDirFormat(String bundleDirFormat) {
-      this.bundleDirFormat = bundleDirFormat;
-      return this;
-    }
-
-    public Builder addExtraBundleFiles(ImmutableList<BundleableFile> extraBundleFiles) {
-      this.extraBundleFilesBuilder.addAll(extraBundleFiles);
-      return this;
-    }
-
-    public Builder setObjcProvider(ObjcProvider objcProvider) {
-      this.objcProvider = objcProvider;
-      return this;
-    }
-
-    public Builder setInfoplistMerging(InfoplistMerging infoplistMerging) {
-      this.infoplistMerging = infoplistMerging;
-      return this;
-    }
-
-    public Builder setIntermediateArtifacts(IntermediateArtifacts intermediateArtifacts) {
-      this.intermediateArtifacts = intermediateArtifacts;
-      return this;
-    }
-    
-    public Builder setPrimaryBundleId(String primaryId) {
-      this.primaryBundleId = primaryId;
-      return this;
-    }
-    
-    public Builder setFallbackBundleId(String fallbackId) {
-      this.fallbackBundleId = fallbackId;
-      return this;
-    }
-
-    private static NestedSet<Artifact> nestedBundleContentArtifacts(Iterable<Bundling> bundles) {
-      NestedSetBuilder<Artifact> artifacts = NestedSetBuilder.stableOrder();
-      for (Bundling bundle : bundles) {
-        artifacts.addTransitive(bundle.getBundleContentArtifacts());
-      }
-      return artifacts.build();
-    }
-
-    private NestedSet<Artifact> getMergeZips(Optional<Artifact> actoolzipOutput) {
-      NestedSetBuilder<Artifact> mergeZipBuilder = NestedSetBuilder.<Artifact>stableOrder()
-          .addAll(actoolzipOutput.asSet())
-          .addAll(Xcdatamodel.outputZips(
-              Xcdatamodels.xcdatamodels(intermediateArtifacts, objcProvider.get(XCDATAMODEL))))
-          .addTransitive(objcProvider.get(MERGE_ZIP));
-      for (Artifact xibFile : objcProvider.get(XIB)) {
-        mergeZipBuilder.add(intermediateArtifacts.compiledXibFileZip(xibFile));
-      }
-      for (Artifact storyboard : objcProvider.get(STORYBOARD)) {
-        mergeZipBuilder.add(intermediateArtifacts.compiledStoryboardZip(storyboard));
-      }
-      return mergeZipBuilder.build();
-    }
-
-    public Bundling build() {
-      Preconditions.checkNotNull(intermediateArtifacts, "intermediateArtifacts");
-
-      Optional<Artifact> actoolzipOutput = Optional.absent();
-      if (!Iterables.isEmpty(objcProvider.get(ASSET_CATALOG))) {
-        actoolzipOutput = Optional.of(intermediateArtifacts.actoolzipOutput());
-      }
-
-      Optional<Artifact> combinedArchitectureBinary = Optional.absent();
-      if (!Iterables.isEmpty(objcProvider.get(LIBRARY))
-          || !Iterables.isEmpty(objcProvider.get(IMPORTED_LIBRARY))) {
-        combinedArchitectureBinary =
-            Optional.of(intermediateArtifacts.combinedArchitectureBinary());
-      }
-
-      NestedSet<Artifact> mergeZips = getMergeZips(actoolzipOutput);
-      NestedSetBuilder<Artifact> bundleContentArtifactsBuilder =
-          NestedSetBuilder.<Artifact>stableOrder()
-              .addTransitive(nestedBundleContentArtifacts(objcProvider.get(NESTED_BUNDLE)))
-              .addAll(combinedArchitectureBinary.asSet())
-              .addAll(infoplistMerging.getPlistWithEverything().asSet())
-              .addTransitive(mergeZips)
-              .addAll(BundleableFile.toArtifacts(objcProvider.get(BUNDLE_FILE)));
-
-      Set<String> bundlePaths = new HashSet<>();
-      for (Artifact stringsFile : objcProvider.get(STRINGS)) {
-        Artifact binaryStrings = intermediateArtifacts.convertedStringsFile(stringsFile);
-        BundleableFile bundleFile = new BundleableFile(
-            binaryStrings, BundleableFile.flatBundlePath(stringsFile.getExecPath()));
-        if (bundlePaths.add(bundleFile.getBundlePath())) {
-          // Filter files that would map to the same location. Files can have the same bundle path
-          // for various illegal reasons and errors are raised for that separately. Otherwise we
-          // only want a single file for a mapping in the bundle. See
-          // ReleaseBundlingSupport.validateResources for details.
-          extraBundleFilesBuilder.add(bundleFile);
-          bundleContentArtifactsBuilder.add(binaryStrings);
-        }
-      }
-
-      ImmutableList<BundleableFile> extraBundleFiles = extraBundleFilesBuilder.build();
-
-      bundleContentArtifactsBuilder.addAll(BundleableFile.toArtifacts(extraBundleFiles));
-
-      return new Bundling(name, bundleDirFormat, combinedArchitectureBinary, extraBundleFiles,
-          objcProvider, infoplistMerging, actoolzipOutput, bundleContentArtifactsBuilder.build(),
-          mergeZips, primaryBundleId, fallbackBundleId, architecture);
-    }
-  }
-
-  private final String name;
-  private final String architecture;
-  private final String bundleDirFormat;
-  private final Optional<Artifact> combinedArchitectureBinary;
-  private final ImmutableList<BundleableFile> extraBundleFiles;
-  private final ObjcProvider objcProvider;
-  private final InfoplistMerging infoplistMerging;
-  private final Optional<Artifact> actoolzipOutput;
-  private final NestedSet<Artifact> bundleContentArtifacts;
-  private final NestedSet<Artifact> mergeZips;
-  private final String primaryBundleId;
-  private final String fallbackBundleId;
-
-  private Bundling(
-      String name,
-      String bundleDirFormat,
-      Optional<Artifact> combinedArchitectureBinary,
-      ImmutableList<BundleableFile> extraBundleFiles,
-      ObjcProvider objcProvider,
-      InfoplistMerging infoplistMerging,
-      Optional<Artifact> actoolzipOutput,
-      NestedSet<Artifact> bundleContentArtifacts,
-      NestedSet<Artifact> mergeZips,
-      String primaryBundleId,
-      String fallbackBundleId,
-      String architecture) {
-    this.name = Preconditions.checkNotNull(name);
-    this.bundleDirFormat = Preconditions.checkNotNull(bundleDirFormat);
-    this.combinedArchitectureBinary = Preconditions.checkNotNull(combinedArchitectureBinary);
-    this.extraBundleFiles = Preconditions.checkNotNull(extraBundleFiles);
-    this.objcProvider = Preconditions.checkNotNull(objcProvider);
-    this.infoplistMerging = Preconditions.checkNotNull(infoplistMerging);
-    this.actoolzipOutput = Preconditions.checkNotNull(actoolzipOutput);
-    this.bundleContentArtifacts = Preconditions.checkNotNull(bundleContentArtifacts);
-    this.mergeZips = Preconditions.checkNotNull(mergeZips);
-    this.fallbackBundleId = fallbackBundleId;
-    this.primaryBundleId = primaryBundleId;
-    this.architecture = Preconditions.checkNotNull(architecture);
-  }
-
-  /**
-   * The bundle directory. For apps, this would be {@code "Payload/TARGET_NAME.app"}, which is where
-   * in the bundle zip archive every file is found, including the linked binary, nested bundles, and
-   * everything returned by {@link #getExtraBundleFiles()}.
-   */
-  public String getBundleDir() {
-    return String.format(bundleDirFormat, name);
-  }
-
-  /**
-   * The name of the bundle, from which the bundle root and the path of the linked binary in the
-   * bundle archive are derived.
-   */
-  public String getName() {
-    return name;
-  }
-
-  /**
-   * An {@link Optional} with the linked binary artifact, or {@link Optional#absent()} if it is
-   * empty and should not be included in the bundle.
-   */
-  public Optional<Artifact> getCombinedArchitectureBinary() {
-    return combinedArchitectureBinary;
-  }
-
-  /**
-   * Extra bundle files to include in the bundle which are not automatically deduced by the contents
-   * of the provider. These files are placed under the bundle root (possibly nested, of course,
-   * depending on the bundle path of the files).
-   */
-  public ImmutableList<BundleableFile> getExtraBundleFiles() {
-    return extraBundleFiles;
-  }
-
-  /**
-   * The {@link ObjcProvider} for this bundle.
-   */
-  public ObjcProvider getObjcProvider() {
-    return objcProvider;
-  }
-
-  /**
-   * Information on the Info.plist and its merge inputs for this bundle. Note that an infoplist is
-   * only included in the bundle if it has one or more merge inputs.
-   */
-  public InfoplistMerging getInfoplistMerging() {
-    return infoplistMerging;
-  }
-
-  /**
-   * The location of the actoolzip output for this bundle. This is non-absent only included in the
-   * bundle if there is at least one asset catalog artifact supplied by
-   * {@link ObjcProvider#ASSET_CATALOG}.
-   */
-  public Optional<Artifact> getActoolzipOutput() {
-    return actoolzipOutput;
-  }
-
-  /**
-   * Returns all zip files whose contents should be merged into this bundle under the main bundle
-   * directory. For instance, if a merge zip contains files a/b and c/d, then the resulting bundling
-   * would have additional files at:
-   * <ul>
-   *   <li>{bundleDir}/a/b
-   *   <li>{bundleDir}/c/d
-   * </ul>
-   */
-  public NestedSet<Artifact> getMergeZips() {
-    return mergeZips;
-  }
-
-  /**
-   * Returns the variable substitutions that should be used when merging the plist info file of
-   * this bundle.
-   */
-  public Map<String, String> variableSubstitutions() {
-    return ImmutableMap.of(
-        "EXECUTABLE_NAME", name,
-        "BUNDLE_NAME", new PathFragment(getBundleDir()).getBaseName(),
-        "PRODUCT_NAME", name);
-  }
-
-  /**
-   * Returns the artifacts that are required to generate this bundle.
-   */
-  public NestedSet<Artifact> getBundleContentArtifacts() {
-    return bundleContentArtifacts;
-  }
-  
-  /**
-   * Returns primary bundle ID to use, can be null.
-   */
-  public String getPrimaryBundleId() {
-    return primaryBundleId;
-  }
-  
-  /**
-   * Returns fallback bundle ID to use when primary isn't set.
-   */
-  public String getFallbackBundleId() {
-    return fallbackBundleId;
-  }
-
-  /**
-   * Returns the iOS CPU architecture this bundle was constructed for.
-   */
-  public String getArchitecture() {
-    return architecture;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/CompilationArtifacts.java b/src/main/java/com/google/devtools/build/lib/rules/objc/CompilationArtifacts.java
deleted file mode 100644
index 5aac139..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/CompilationArtifacts.java
+++ /dev/null
@@ -1,98 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-
-/**
- * Artifacts related to compilation. Any rule containing compilable sources will create an instance
- * of this class.
- */
-final class CompilationArtifacts {
-  static class Builder {
-    private Iterable<Artifact> srcs = ImmutableList.of();
-    private Iterable<Artifact> nonArcSrcs = ImmutableList.of();
-    private Optional<Artifact> pchFile;
-    private IntermediateArtifacts intermediateArtifacts;
-
-    Builder addSrcs(Iterable<Artifact> srcs) {
-      this.srcs = Iterables.concat(this.srcs, srcs);
-      return this;
-    }
-
-    Builder addNonArcSrcs(Iterable<Artifact> nonArcSrcs) {
-      this.nonArcSrcs = Iterables.concat(this.nonArcSrcs, nonArcSrcs);
-      return this;
-    }
-
-    Builder setPchFile(Optional<Artifact> pchFile) {
-      Preconditions.checkState(this.pchFile == null,
-          "pchFile is already set to: %s", this.pchFile);
-      this.pchFile = Preconditions.checkNotNull(pchFile);
-      return this;
-    }
-
-    Builder setIntermediateArtifacts(IntermediateArtifacts intermediateArtifacts) {
-      Preconditions.checkState(this.intermediateArtifacts == null,
-          "intermediateArtifacts is already set to: %s", this.intermediateArtifacts);
-      this.intermediateArtifacts = intermediateArtifacts;
-      return this;
-    }
-
-    CompilationArtifacts build() {
-      Optional<Artifact> archive = Optional.absent();
-      if (!Iterables.isEmpty(srcs) || !Iterables.isEmpty(nonArcSrcs)) {
-        archive = Optional.of(intermediateArtifacts.archive());
-      }
-      return new CompilationArtifacts(srcs, nonArcSrcs, archive, pchFile);
-    }
-  }
-
-  private final Iterable<Artifact> srcs;
-  private final Iterable<Artifact> nonArcSrcs;
-  private final Optional<Artifact> archive;
-  private final Optional<Artifact> pchFile;
-
-  private CompilationArtifacts(
-      Iterable<Artifact> srcs,
-      Iterable<Artifact> nonArcSrcs,
-      Optional<Artifact> archive,
-      Optional<Artifact> pchFile) {
-    this.srcs = Preconditions.checkNotNull(srcs);
-    this.nonArcSrcs = Preconditions.checkNotNull(nonArcSrcs);
-    this.archive = Preconditions.checkNotNull(archive);
-    this.pchFile = Preconditions.checkNotNull(pchFile);
-  }
-
-  public Iterable<Artifact> getSrcs() {
-    return srcs;
-  }
-
-  public Iterable<Artifact> getNonArcSrcs() {
-    return nonArcSrcs;
-  }
-
-  public Optional<Artifact> getArchive() {
-    return archive;
-  }
-
-  public Optional<Artifact> getPchFile() {
-    return pchFile;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/CompilationSupport.java b/src/main/java/com/google/devtools/build/lib/rules/objc/CompilationSupport.java
deleted file mode 100644
index cc29288..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/CompilationSupport.java
+++ /dev/null
@@ -1,372 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.DEFINE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FRAMEWORK_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.HEADER;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.INCLUDE;
-import static com.google.devtools.build.lib.rules.objc.ObjcRuleClasses.NON_ARC_SRCS_TYPE;
-import static com.google.devtools.build.lib.rules.objc.ObjcRuleClasses.SRCS_TYPE;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Action;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.actions.ActionConstructionContext;
-import com.google.devtools.build.lib.analysis.actions.CustomCommandLine;
-import com.google.devtools.build.lib.analysis.actions.FileWriteAction;
-import com.google.devtools.build.lib.analysis.actions.SpawnAction;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkArgs;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkInputs;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.CompilationAttributes;
-import com.google.devtools.build.lib.rules.objc.XcodeProvider.Builder;
-import com.google.devtools.build.lib.shell.ShellUtils;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-/**
- * Support for rules that compile sources. Provides ways to determine files that should be output,
- * registering Xcode settings and generating the various actions that might be needed for
- * compilation.
- *
- * <p>Methods on this class can be called in any order without impacting the result.
- */
-final class CompilationSupport {
-
-  @VisibleForTesting
-  static final String ABSOLUTE_INCLUDES_PATH_FORMAT =
-      "The path '%s' is absolute, but only relative paths are allowed.";
-
-  @VisibleForTesting
-  static final ImmutableList<String> LINKER_COVERAGE_FLAGS = ImmutableList.<String>of(
-      "-ftest-coverage", "-fprofile-arcs");
-
-  @VisibleForTesting
-  static final ImmutableList<String> CLANG_COVERAGE_FLAGS =
-      ImmutableList.of("-fprofile-arcs", "-ftest-coverage", "-fprofile-dir=./coverage_output");
-
-  /**
-   * Returns information about the given rule's compilation artifacts.
-   */
-  // TODO(bazel-team): Remove this information from ObjcCommon and move it internal to this class.
-  static CompilationArtifacts compilationArtifacts(RuleContext ruleContext) {
-    return new CompilationArtifacts.Builder()
-        .addSrcs(ruleContext.getPrerequisiteArtifacts("srcs", Mode.TARGET)
-            .errorsForNonMatching(SRCS_TYPE)
-            .list())
-        .addNonArcSrcs(ruleContext.getPrerequisiteArtifacts("non_arc_srcs", Mode.TARGET)
-            .errorsForNonMatching(NON_ARC_SRCS_TYPE)
-            .list())
-        .setIntermediateArtifacts(ObjcRuleClasses.intermediateArtifacts(ruleContext))
-        .setPchFile(Optional.fromNullable(ruleContext.getPrerequisiteArtifact("pch", Mode.TARGET)))
-        .build();
-  }
-
-  private final RuleContext ruleContext;
-  private final CompilationAttributes attributes;
-
-  /**
-   * Creates a new compilation support for the given rule.
-   */
-  CompilationSupport(RuleContext ruleContext) {
-    this.ruleContext = ruleContext;
-    this.attributes = new CompilationAttributes(ruleContext);
-  }
-
-  /**
-   * Registers all actions necessary to compile this rule's sources and archive them.
-   *
-   * @param common common information about this rule and its dependencies
-   * @param optionsProvider option and plist information about this rule and its dependencies
-   *
-   * @return this compilation support
-   */
-  CompilationSupport registerCompileAndArchiveActions(
-      ObjcCommon common, OptionsProvider optionsProvider) {
-    if (common.getCompilationArtifacts().isPresent()) {
-      registerCompileAndArchiveActions(
-          common.getCompilationArtifacts().get(),
-          ObjcRuleClasses.intermediateArtifacts(ruleContext),
-          common.getObjcProvider(), optionsProvider,
-          ruleContext.getConfiguration().isCodeCoverageEnabled());
-    }
-    return this;
-  }
-
-  /**
-   * Creates actions to compile each source file individually, and link all the compiled object
-   * files into a single archive library.
-   */
-  private void registerCompileAndArchiveActions(CompilationArtifacts compilationArtifacts,
-      IntermediateArtifacts intermediateArtifacts,
-      ObjcProvider objcProvider, OptionsProvider optionsProvider, boolean isCodeCoverageEnabled) {
-    ImmutableList.Builder<Artifact> objFiles = new ImmutableList.Builder<>();
-    for (Artifact sourceFile : compilationArtifacts.getSrcs()) {
-      Artifact objFile = intermediateArtifacts.objFile(sourceFile);
-      objFiles.add(objFile);
-      registerCompileAction(sourceFile, objFile, compilationArtifacts.getPchFile(),
-          objcProvider, intermediateArtifacts, ImmutableList.of("-fobjc-arc"), optionsProvider,
-          isCodeCoverageEnabled);
-    }
-    for (Artifact nonArcSourceFile : compilationArtifacts.getNonArcSrcs()) {
-      Artifact objFile = intermediateArtifacts.objFile(nonArcSourceFile);
-      objFiles.add(objFile);
-      registerCompileAction(nonArcSourceFile, objFile, compilationArtifacts.getPchFile(),
-          objcProvider, intermediateArtifacts, ImmutableList.of("-fno-objc-arc"), optionsProvider,
-          isCodeCoverageEnabled);
-    }
-    for (Artifact archive : compilationArtifacts.getArchive().asSet()) {
-      registerArchiveActions(intermediateArtifacts, objFiles, archive);
-    }
-  }
-
-  private void registerCompileAction(
-      Artifact sourceFile,
-      Artifact objFile,
-      Optional<Artifact> pchFile,
-      ObjcProvider objcProvider,
-      IntermediateArtifacts intermediateArtifacts,
-      Iterable<String> otherFlags,
-      OptionsProvider optionsProvider,
-      boolean isCodeCoverageEnabled) {
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    ImmutableList.Builder<String> coverageFlags = new ImmutableList.Builder<>();
-    ImmutableList.Builder<Artifact> gcnoFiles = new ImmutableList.Builder<>();
-    if (isCodeCoverageEnabled) {
-      coverageFlags.addAll(CLANG_COVERAGE_FLAGS);
-      gcnoFiles.add(intermediateArtifacts.gcnoFile(sourceFile));
-    }
-    CustomCommandLine.Builder commandLine = new CustomCommandLine.Builder();
-    if (ObjcRuleClasses.CPP_SOURCES.matches(sourceFile.getExecPath())) {
-      commandLine.add("-stdlib=libc++");
-    }
-    commandLine
-        .add(IosSdkCommands.compileFlagsForClang(objcConfiguration))
-        .add(IosSdkCommands.commonLinkAndCompileFlagsForClang(
-            objcProvider, objcConfiguration))
-        .add(objcConfiguration.getCoptsForCompilationMode())
-        .addBeforeEachPath(
-            "-iquote", ObjcCommon.userHeaderSearchPaths(ruleContext.getConfiguration()))
-        .addBeforeEachExecPath("-include", pchFile.asSet())
-        .addBeforeEachPath("-I", objcProvider.get(INCLUDE))
-        .add(otherFlags)
-        .addFormatEach("-D%s", objcProvider.get(DEFINE))
-        .add(coverageFlags.build())
-        .add(objcConfiguration.getCopts())
-        .add(optionsProvider.getCopts())
-        .addExecPath("-c", sourceFile)
-        .addExecPath("-o", objFile);
-
-    ruleContext.registerAction(ObjcActionsBuilder.spawnOnDarwinActionBuilder()
-        .setMnemonic("ObjcCompile")
-        .setExecutable(ObjcRuleClasses.CLANG)
-        .setCommandLine(commandLine.build())
-        .addInput(sourceFile)
-        .addOutput(objFile)
-        .addOutputs(gcnoFiles.build())
-        .addTransitiveInputs(objcProvider.get(HEADER))
-        .addTransitiveInputs(objcProvider.get(FRAMEWORK_FILE))
-        .addInputs(pchFile.asSet())
-        .build(ruleContext));
-  }
-
-  private void registerArchiveActions(IntermediateArtifacts intermediateArtifacts,
-      ImmutableList.Builder<Artifact> objFiles, Artifact archive) {
-    for (Action action : archiveActions(ruleContext, objFiles.build(), archive,
-        ObjcRuleClasses.objcConfiguration(ruleContext),
-        intermediateArtifacts.objList())) {
-      ruleContext.registerAction(action);
-    }
-  }
-
-  private static Iterable<Action> archiveActions(
-      ActionConstructionContext context,
-      Iterable<Artifact> objFiles,
-      Artifact archive,
-      ObjcConfiguration objcConfiguration,
-      Artifact objList) {
-
-    ImmutableList.Builder<Action> actions = new ImmutableList.Builder<>();
-
-    actions.add(new FileWriteAction(
-        context.getActionOwner(),
-        objList,
-        Artifact.joinExecPaths("\n", objFiles),
-        /*makeExecutable=*/ false));
-
-    actions.add(ObjcActionsBuilder.spawnOnDarwinActionBuilder()
-        .setMnemonic("ObjcLink")
-        .setExecutable(ObjcRuleClasses.LIBTOOL)
-        .setCommandLine(new CustomCommandLine.Builder()
-            .add("-static")
-            .add("-filelist").add(objList.getExecPathString())
-            .add("-arch_only").add(objcConfiguration.getIosCpu())
-            .add("-syslibroot").add(IosSdkCommands.sdkDir(objcConfiguration))
-            .add("-o").add(archive.getExecPathString())
-            .build())
-        .addInputs(objFiles)
-        .addInput(objList)
-        .addOutput(archive)
-        .build(context));
-
-    return actions.build();
-  }
-
-  /**
-   * Registers any actions necessary to link this rule and its dependencies. Debug symbols are
-   * generated if {@link ObjcConfiguration#generateDebugSymbols()} is set.
-   *
-   * @param objcProvider common information about this rule's attributes and its dependencies
-   * @param extraLinkArgs any additional arguments to pass to the linker
-   * @param extraLinkInputs any additional input artifacts to pass to the link action
-   *
-   * @return this compilation support
-   */
-  CompilationSupport registerLinkActions(ObjcProvider objcProvider, ExtraLinkArgs extraLinkArgs,
-      ExtraLinkInputs extraLinkInputs) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    Optional<Artifact> dsymBundle;
-    if (ObjcRuleClasses.objcConfiguration(ruleContext).generateDebugSymbols()) {
-      registerDsymActions();
-      dsymBundle = Optional.of(intermediateArtifacts.dsymBundle());
-    } else {
-      dsymBundle = Optional.absent();
-    }
-
-    ExtraLinkArgs coverageLinkArgs = new ExtraLinkArgs();
-    if (ruleContext.getConfiguration().isCodeCoverageEnabled()) {
-      coverageLinkArgs = new ExtraLinkArgs(LINKER_COVERAGE_FLAGS);
-    }
-
-    ObjcRuleClasses.actionsBuilder(ruleContext).registerLinkAction(
-        intermediateArtifacts.singleArchitectureBinary(), objcProvider,
-        extraLinkArgs.appendedWith(coverageLinkArgs), extraLinkInputs,
-        dsymBundle);
-    return this;
-  }
-
-  /**
-   * Registers actions that compile and archive j2Objc dependencies of this rule.
-   *
-   * @param optionsProvider option and plist information about this rule and its dependencies
-   * @param objcProvider common information about this rule's attributes and its dependencies
-   *
-   * @return this compilation support
-   */
-  CompilationSupport registerJ2ObjcCompileAndArchiveActions(
-      OptionsProvider optionsProvider, ObjcProvider objcProvider) {
-    for (J2ObjcSource j2ObjcSource : ObjcRuleClasses.j2ObjcSrcsProvider(ruleContext).getSrcs()) {
-      IntermediateArtifacts intermediateArtifacts =
-          ObjcRuleClasses.j2objcIntermediateArtifacts(ruleContext, j2ObjcSource);
-      CompilationArtifacts compilationArtifact = new CompilationArtifacts.Builder()
-          .addNonArcSrcs(j2ObjcSource.getObjcSrcs())
-          .setIntermediateArtifacts(intermediateArtifacts)
-          .setPchFile(Optional.<Artifact>absent())
-          .build();
-      registerCompileAndArchiveActions(compilationArtifact, intermediateArtifacts, objcProvider,
-          optionsProvider, ruleContext.getConfiguration().isCodeCoverageEnabled());
-    }
-
-    return this;
-  }
-
-  /**
-   * Sets compilation-related Xcode project information on the given provider builder.
-   *
-   * @param common common information about this rule's attributes and its dependencies
-   * @param optionsProvider option and plist information about this rule and its dependencies
-   * @return this compilation support
-   */
-  CompilationSupport addXcodeSettings(Builder xcodeProviderBuilder,
-      ObjcCommon common, OptionsProvider optionsProvider) {
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    for (CompilationArtifacts artifacts : common.getCompilationArtifacts().asSet()) {
-      xcodeProviderBuilder.setCompilationArtifacts(artifacts);
-    }
-    xcodeProviderBuilder
-        .addHeaders(attributes.hdrs())
-        .addUserHeaderSearchPaths(ObjcCommon.userHeaderSearchPaths(ruleContext.getConfiguration()))
-        .addHeaderSearchPaths("$(WORKSPACE_ROOT)", attributes.headerSearchPaths())
-        .addHeaderSearchPaths("$(SDKROOT)/usr/include", attributes.sdkIncludes())
-        .addCompilationModeCopts(objcConfiguration.getCoptsForCompilationMode())
-        .addCopts(objcConfiguration.getCopts())
-        .addCopts(optionsProvider.getCopts());
-    return this;
-  }
-
-  /**
-   * Validates compilation-related attributes on this rule.
-   *
-   * @return this compilation support
-   */
-  CompilationSupport validateAttributes() {
-    for (PathFragment absoluteInclude :
-        Iterables.filter(attributes.includes(), PathFragment.IS_ABSOLUTE)) {
-      ruleContext.attributeError(
-          "includes", String.format(ABSOLUTE_INCLUDES_PATH_FORMAT, absoluteInclude));
-    }
-
-    return this;
-  }
-
-  private CompilationSupport registerDsymActions() {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    Artifact dsymBundle = intermediateArtifacts.dsymBundle();
-    Artifact debugSymbolFile = intermediateArtifacts.dsymSymbol();
-    ruleContext.registerAction(new SpawnAction.Builder()
-        .setMnemonic("UnzipDsym")
-        .setProgressMessage("Unzipping dSYM file: " + ruleContext.getLabel())
-        .setExecutable(new PathFragment("/usr/bin/unzip"))
-        .addInput(dsymBundle)
-        .setCommandLine(CustomCommandLine.builder()
-            .add(dsymBundle.getExecPathString())
-            .add("-d")
-            .add(stripSuffix(dsymBundle.getExecPathString(),
-                IntermediateArtifacts.TMP_DSYM_BUNDLE_SUFFIX) + ".app.dSYM")
-            .build())
-        .addOutput(intermediateArtifacts.dsymPlist())
-        .addOutput(debugSymbolFile)
-        .build(ruleContext));
-
-    Artifact dumpsyms = ruleContext.getPrerequisiteArtifact(":dumpsyms", Mode.HOST);
-    Artifact breakpadFile = intermediateArtifacts.breakpadSym();
-    ruleContext.registerAction(new SpawnAction.Builder()
-        .setMnemonic("GenBreakpad")
-        .setProgressMessage("Generating breakpad file: " + ruleContext.getLabel())
-        .setShellCommand(ImmutableList.of("/bin/bash", "-c"))
-        .setExecutionInfo(ImmutableMap.of(ExecutionRequirements.REQUIRES_DARWIN, ""))
-        .addInput(dumpsyms)
-        .addInput(debugSymbolFile)
-        .addArgument(String.format("%s %s > %s",
-            ShellUtils.shellEscape(dumpsyms.getExecPathString()),
-            ShellUtils.shellEscape(debugSymbolFile.getExecPathString()),
-            ShellUtils.shellEscape(breakpadFile.getExecPathString())))
-        .addOutput(breakpadFile)
-        .build(ruleContext));
-    return this;
-  }
-
-  private String stripSuffix(String str, String suffix) {
-    // TODO(bazel-team): Throw instead of returning null?
-    return str.endsWith(suffix) ? str.substring(0, str.length() - suffix.length()) : null;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ExecutionRequirements.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ExecutionRequirements.java
deleted file mode 100644
index 2257136..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ExecutionRequirements.java
+++ /dev/null
@@ -1,23 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-/**
- * Strings used to express requirements on action execution environments.
- */
-public class ExecutionRequirements {
-  /** If an action would not successfully run other than on Darwin. */
-  public static final String REQUIRES_DARWIN = "requires-darwin";
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/InfoplistMerging.java b/src/main/java/com/google/devtools/build/lib/rules/objc/InfoplistMerging.java
deleted file mode 100644
index 017e15f..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/InfoplistMerging.java
+++ /dev/null
@@ -1,141 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Action;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.FilesToRunProvider;
-import com.google.devtools.build.lib.analysis.actions.ActionConstructionContext;
-import com.google.devtools.build.lib.analysis.actions.CommandLine;
-import com.google.devtools.build.lib.analysis.actions.SpawnAction;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-
-/**
- * Supplies information regarding Infoplist merging for a particular binary. This includes:
- * <ul>
- *   <li>the Info.plist which contains the fields from every source. If there is only one source
- *       plist, this is that plist.
- *   <li>the action to merge all the Infoplists into a single one. This is present even if there is
- *       only one Infoplist, to prevent a Bazel error when an Artifact does not have a generating
- *       action.
- * </ul>
- */
-class InfoplistMerging {
-  static class Builder {
-    private final ActionConstructionContext context;
-    private NestedSet<Artifact> inputPlists;
-    private FilesToRunProvider plmerge;
-    private IntermediateArtifacts intermediateArtifacts;
-
-    public Builder(ActionConstructionContext context) {
-      this.context = Preconditions.checkNotNull(context);
-    }
-
-    public Builder setInputPlists(NestedSet<Artifact> inputPlists) {
-      Preconditions.checkState(this.inputPlists == null);
-      this.inputPlists = inputPlists;
-      return this;
-    }
-
-    public Builder setPlmerge(FilesToRunProvider plmerge) {
-      Preconditions.checkState(this.plmerge == null);
-      this.plmerge = plmerge;
-      return this;
-    }
-
-    public Builder setIntermediateArtifacts(IntermediateArtifacts intermediateArtifacts) {
-      this.intermediateArtifacts = intermediateArtifacts;
-      return this;
-    }
-
-    /**
-     * This static factory method prevents retention of the outer {@link Builder} class reference by
-     * the anonymous {@link CommandLine} instance.
-     */
-    private static CommandLine mergeCommandLine(
-        final NestedSet<Artifact> inputPlists, final Artifact mergedInfoplist) {
-      return new CommandLine() {
-        @Override
-        public Iterable<String> arguments() {
-          return new ImmutableList.Builder<String>()
-              .addAll(Interspersing.beforeEach(
-                  "--source_file", Artifact.toExecPaths(inputPlists)))
-              .add("--out_file", mergedInfoplist.getExecPathString())
-              .build();
-        }
-      };
-    }
-
-    public InfoplistMerging build() {
-      Preconditions.checkNotNull(intermediateArtifacts, "intermediateArtifacts");
-
-      Optional<Artifact> plistWithEverything = Optional.absent();
-      Action[] mergeActions = new Action[0];
-
-      int inputs = Iterables.size(inputPlists);
-      if (inputs == 1) {
-        plistWithEverything = Optional.of(Iterables.getOnlyElement(inputPlists));
-      } else if (inputs > 1) {
-        Artifact merged = intermediateArtifacts.mergedInfoplist();
-
-        plistWithEverything = Optional.of(merged);
-        mergeActions = new SpawnAction.Builder()
-            .setMnemonic("MergeInfoPlistFiles")
-            .setExecutable(plmerge)
-            .setCommandLine(mergeCommandLine(inputPlists, merged))
-            .addTransitiveInputs(inputPlists)
-            .addOutput(merged)
-            .build(context);
-      }
-
-      return new InfoplistMerging(plistWithEverything, mergeActions, inputPlists);
-    }
-  }
-
-  private final Optional<Artifact> plistWithEverything;
-  private final Action[] mergeActions;
-  private final NestedSet<Artifact> inputPlists;
-
-  private InfoplistMerging(Optional<Artifact> plistWithEverything, Action[] mergeActions,
-      NestedSet<Artifact> inputPlists) {
-    this.plistWithEverything = plistWithEverything;
-    this.mergeActions = mergeActions;
-    this.inputPlists = inputPlists;
-  }
-
-  /**
-   * Creates action to merge multiple Info.plist files of a binary into a single Info.plist. No
-   * action is necessary if there is only one source.
-   */
-  public Action[] getMergeAction() {
-    return mergeActions;
-  }
-
-  /**
-   * An {@link Optional} with the merged infoplist, or {@link Optional#absent()} if there are no
-   * merge inputs and it should not be included in the bundle.
-   */
-  public Optional<Artifact> getPlistWithEverything() {
-    return plistWithEverything;
-  }
-
-  public NestedSet<Artifact> getInputPlists() {
-    return inputPlists;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IntermediateArtifacts.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IntermediateArtifacts.java
deleted file mode 100644
index d852bb4..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IntermediateArtifacts.java
+++ /dev/null
@@ -1,267 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.actions.Root;
-import com.google.devtools.build.lib.analysis.AnalysisEnvironment;
-import com.google.devtools.build.lib.analysis.AnalysisUtils;
-import com.google.devtools.build.lib.syntax.Label;
-import com.google.devtools.build.lib.vfs.FileSystemUtils;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-/**
- * Factory class for generating artifacts which are used as intermediate output.
- */
-// TODO(bazel-team): This should really be named DerivedArtifacts as it contains methods for
-// final as well as intermediate artifacts.
-final class IntermediateArtifacts {
-
-  /**
-   * Extension used on the temporary dsym bundle location. Must end in {@code .dSYM} for dsymutil
-   * to generate a plist file.
-   */
-  static final String TMP_DSYM_BUNDLE_SUFFIX = ".temp.app.dSYM";
-
-  private final AnalysisEnvironment analysisEnvironment;
-  private final Root binDirectory;
-  private final Label ownerLabel;
-  private final String archiveFileNameSuffix;
-
-  /**
-   * Label to scope the output paths of generated artifacts, in addition to {@link ownerLabel}.
-   */
-  private final Optional<Label> scopingLabel;
-
-  IntermediateArtifacts(
-      AnalysisEnvironment analysisEnvironment, Root binDirectory, Label ownerLabel,
-      String archiveFileNameSuffix) {
-    this.analysisEnvironment = Preconditions.checkNotNull(analysisEnvironment);
-    this.binDirectory = Preconditions.checkNotNull(binDirectory);
-    this.ownerLabel = Preconditions.checkNotNull(ownerLabel);
-    this.scopingLabel = Optional.<Label>absent();
-    this.archiveFileNameSuffix = Preconditions.checkNotNull(archiveFileNameSuffix);
-  }
-
-  IntermediateArtifacts(
-      AnalysisEnvironment analysisEnvironment, Root binDirectory, Label ownerLabel,
-      Label scopingLabel, String archiveFileNameSuffix) {
-    this.analysisEnvironment = Preconditions.checkNotNull(analysisEnvironment);
-    this.binDirectory = Preconditions.checkNotNull(binDirectory);
-    this.ownerLabel = Preconditions.checkNotNull(ownerLabel);
-    this.scopingLabel = Optional.of(Preconditions.checkNotNull(scopingLabel));
-    this.archiveFileNameSuffix = Preconditions.checkNotNull(archiveFileNameSuffix);
-  }
-
-  /**
-   * Returns a derived artifact in the bin directory obtained by appending some extension to the end
-   * of the given {@link PathFragment}.
-   */
-  private Artifact appendExtension(PathFragment original, String extension) {
-    return analysisEnvironment.getDerivedArtifact(
-        FileSystemUtils.appendExtension(original, extension), binDirectory);
-  }
-
-  /**
-   * Returns a derived artifact in the bin directory obtained by appending some extension to the end
-   * of the {@link PathFragment} corresponding to the owner {@link Label}.
-   */
-  private Artifact appendExtension(String extension) {
-    return appendExtension(labelScopedDir(), extension);
-  }
-
-  /**
-   * The output of using {@code actooloribtoolzip} to run {@code actool} for a given bundle which is
-   * merged under the {@code .app} or {@code .bundle} directory root.
-   */
-  public Artifact actoolzipOutput() {
-    return appendExtension(".actool.zip");
-  }
-
-  /**
-   * Output of the partial infoplist generated by {@code actool} when given the
-   * {@code --output-partial-info-plist [path]} flag.
-   */
-  public Artifact actoolPartialInfoplist() {
-    return appendExtension(".actool-PartialInfo.plist");
-  }
-
-  /**
-   * The Info.plist file for a bundle which is comprised of more than one originating plist file.
-   * This is not needed for a bundle which has no source Info.plist files, or only one Info.plist
-   * file, since no merging occurs in that case.
-   */
-  public Artifact mergedInfoplist() {
-    return appendExtension("-MergedInfo.plist");
-  }
-
-  /**
-   * The .objlist file, which contains a list of paths of object files to archive  and is read by
-   * libtool in the archive action.
-   */
-  public Artifact objList() {
-    return appendExtension(".objlist");
-  }
-
-  /**
-   * The artifact which is the binary (or library) which is comprised of one or more .a files linked
-   * together.
-   */
-  public Artifact singleArchitectureBinary() {
-    return appendExtension("_bin");
-  }
-
-  /**
-   * Lipo binary generated by combining one or more linked binaries. This binary is the one included
-   * in generated bundles and invoked as entry point to the application.
-   */
-  public Artifact combinedArchitectureBinary() {
-    return appendExtension("_lipobin");
-  }
-
-  /**
-   * The {@code .a} file which contains all the compiled sources for a rule.
-   */
-  public Artifact archive() {
-    PathFragment labelPath = labelScopedDir();
-    PathFragment rootRelative = labelPath
-        .getParentDirectory()
-        .getRelative(String.format("lib%s%s.a", labelPath.getBaseName(), archiveFileNameSuffix));
-    return analysisEnvironment.getDerivedArtifact(rootRelative, binDirectory);
-  }
-
-  /**
-   * The debug symbol bundle file which contains debug symbols generated by dsymutil.
-   */
-  public Artifact dsymBundle() {
-    return appendExtension(TMP_DSYM_BUNDLE_SUFFIX);
-  }
-
-  /**
-   * Returns a unique directory scoped by {@code ownerLabel} and {@code scopingLabel}. Normally
-   * when {@code scopingLabel} is absent, the returned directory is just a path fragment
-   * containing the package and the name of the ownerLabel. If scopingLabel is present, the
-   * returned directory is scoped by scopingLabel first. For example, if ownerLabel is
-   * //a/b:c and scopingLabel is //d/e:f, the returned directory will be: d/e/a/b/c/f/.
-   */
-  private PathFragment labelScopedDir() {
-    if (scopingLabel.isPresent()) {
-      return AnalysisUtils.getUniqueDirectory(scopingLabel.get(), ownerLabel.toPathFragment());
-    } else {
-      return ownerLabel.toPathFragment();
-    }
-  }
-
-  private PathFragment inUniqueObjsDir(Artifact source, String extension) {
-    PathFragment labelPath = labelScopedDir();
-    PathFragment uniqueDir = labelPath.getParentDirectory().getRelative(new PathFragment("_objs"))
-        .getRelative(labelPath.getBaseName());
-    PathFragment sourceFile = uniqueDir.getRelative(source.getRootRelativePath());
-    return FileSystemUtils.replaceExtension(sourceFile, extension);
-  }
-
-  /**
-   * The artifact for the .o file that should be generated when compiling the {@code source}
-   * artifact.
-   */
-  public Artifact objFile(Artifact source) {
-     return analysisEnvironment.getDerivedArtifact(inUniqueObjsDir(source, ".o"), binDirectory);
-  }
-
-  /**
-   * The artifact for the .gcno file that should be generated when compiling the {@code source}
-   * artifact.
-   */
-  public Artifact gcnoFile(Artifact source) {
-     return analysisEnvironment.getDerivedArtifact(inUniqueObjsDir(source, ".gcno"), binDirectory);
-  }
-
-  /**
-   * Returns the artifact corresponding to the pbxproj control file, which specifies the information
-   * required to generate the Xcode project file.
-   */
-  public Artifact pbxprojControlArtifact() {
-    return appendExtension(".xcodeproj-control");
-  }
-
-  /**
-   * The artifact which contains the zipped-up results of compiling the storyboard. This is merged
-   * into the final bundle under the {@code .app} or {@code .bundle} directory root.
-   */
-  public Artifact compiledStoryboardZip(Artifact input) {
-    return appendExtension("/" + BundleableFile.flatBundlePath(input.getExecPath()) + ".zip");
-  }
-
-  /**
-   * Returns the artifact which is the output of building an entire xcdatamodel[d] made of artifacts
-   * specified by a single rule.
-   *
-   * @param containerDir the containing *.xcdatamodeld or *.xcdatamodel directory
-   * @return the artifact for the zipped up compilation results.
-   */
-  public Artifact compiledMomZipArtifact(PathFragment containerDir) {
-    return appendExtension(
-        "/" + FileSystemUtils.replaceExtension(containerDir, ".zip").getBaseName());
-  }
-
-  /**
-   * Returns the compiled (i.e. converted to binary plist format) artifact corresponding to the
-   * given {@code .strings} file.
-   */
-  public Artifact convertedStringsFile(Artifact originalFile) {
-    return appendExtension(originalFile.getExecPath(), ".binary");
-  }
-
-  /**
-   * Returns the artifact corresponding to the zipped-up compiled form of the given {@code .xib}
-   * file.
-   */
-  public Artifact compiledXibFileZip(Artifact originalFile) {
-    return analysisEnvironment.getDerivedArtifact(
-        FileSystemUtils.replaceExtension(originalFile.getExecPath(), ".nib.zip"),
-        binDirectory);
-  }
-
-  /**
-   * Debug symbol plist generated for a linked binary.
-   */
-  public Artifact dsymPlist() {
-    return appendExtension(".app.dSYM/Contents/Info.plist");
-  }
-
-  /**
-   * Debug symbol file generated for a linked binary.
-   */
-  public Artifact dsymSymbol() {
-    return appendExtension(
-        String.format(".app.dSYM/Contents/Resources/DWARF/%s_bin", ownerLabel.getName()));
-  }
-
-  /**
-   * Breakpad debug symbol representation.
-   */
-  public Artifact breakpadSym() {
-    return appendExtension(".breakpad");
-  }
-
-  /**
-   * Shell script that launches the binary.
-   */
-  public Artifact runnerScript() {
-    return appendExtension("_runner.sh");
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Interspersing.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Interspersing.java
deleted file mode 100644
index 23813dd..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Interspersing.java
+++ /dev/null
@@ -1,71 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Function;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Iterables;
-
-/**
- * Utility code for interspersing items into sequences.
- */
-public class Interspersing {
-  private Interspersing() {}
-
-  /**
-   * Inserts {@code what} before each item in {@code sequence}, returning a lazy sequence of twice
-   * the length.
-   */
-  public static <E> Iterable<E> beforeEach(final E what, Iterable<E> sequence) {
-    Preconditions.checkNotNull(what);
-    return Iterables.concat(
-        Iterables.transform(
-            sequence,
-            new Function<E, Iterable<E>>() {
-              @Override
-              public Iterable<E> apply(E element) {
-                return ImmutableList.of(what, element);
-              }
-            }
-        ));
-  }
-
-  /**
-   * Prepends {@code what} to each string in {@code sequence}, returning a lazy sequence of the 
-   * same length.
-   */
-  public static Iterable<String>
-      prependEach(final String what, Iterable<String> sequence) {
-    Preconditions.checkNotNull(what);
-    return Iterables.transform(
-        sequence,
-        new Function<String, String>() {
-          @Override
-          public String apply(String input) {
-            return what + input;
-          }
-        });
-  }
-
-  /**
-   * Similar to {@link #prependEach(String, Iterable)}, but also converts each item in the sequence
-   * to a string.
-   */
-  public static <E> Iterable<String>
-      prependEach(String what, Iterable<E> sequence, Function<? super E, String> toString) {
-    return prependEach(what, Iterables.transform(sequence, toString));
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosApplication.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosApplication.java
deleted file mode 100644
index 4b8c760..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosApplication.java
+++ /dev/null
@@ -1,61 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableSet;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-
-/**
- * Implementation for {@code ios_application}.
- */
-public class IosApplication extends ReleaseBundlingTargetFactory {
-
-  private static final ImmutableSet<Attribute> DEPENDENCY_ATTRIBUTES =
-      ImmutableSet.of(
-          new Attribute("binary", Mode.SPLIT),
-          new Attribute("extensions", Mode.TARGET));
-
-  public IosApplication() {
-    super(ReleaseBundlingSupport.APP_BUNDLE_DIR_FORMAT, XcodeProductType.APPLICATION,
-        ExposeAsNestedBundle.NO, DEPENDENCY_ATTRIBUTES);
-  }
-
-  @Override
-  protected OptionsProvider optionsProvider(RuleContext ruleContext) {
-    return new OptionsProvider.Builder()
-        .addInfoplists(ruleContext.getPrerequisiteArtifacts("infoplist", Mode.TARGET).list())
-        .addTransitive(
-            Optional.fromNullable(
-                ruleContext.getPrerequisite("options", Mode.TARGET, OptionsProvider.class)))
-        .build();
-  }
-
-  @Override
-  protected void configureTarget(RuleConfiguredTargetBuilder target, RuleContext ruleContext,
-      ReleaseBundlingSupport releaseBundlingSupport) {
-    // If this is an application built for the simulator, make it runnable.
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    if (objcConfiguration.getBundlingPlatform() == Platform.SIMULATOR) {
-      Artifact runnerScript = ObjcRuleClasses.intermediateArtifacts(ruleContext).runnerScript();
-      Artifact ipaFile = ruleContext.getImplicitOutputArtifact(ReleaseBundlingSupport.IPA);
-      releaseBundlingSupport.registerGenerateRunnerScriptAction(runnerScript, ipaFile);
-      target.setRunfilesSupport(releaseBundlingSupport.runfilesSupport(runnerScript), runnerScript);
-    }
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosApplicationRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosApplicationRule.java
deleted file mode 100644
index 898150b..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosApplicationRule.java
+++ /dev/null
@@ -1,98 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.ConfigurationTransition.HOST;
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.BOOLEAN;
-import static com.google.devtools.build.lib.packages.Type.LABEL;
-import static com.google.devtools.build.lib.packages.Type.LABEL_LIST;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.ImplicitOutputsFunction;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for ios_application.
- */
-public class IosApplicationRule implements RuleDefinition {
-
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(ios_application).IMPLICIT_OUTPUTS -->
-        <ul>
-         <li><code><var>name</var>.ipa</code>: the application bundle as an <code>.ipa</code>
-             file
-         <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: An Xcode project file which
-             can be used to develop or build on a Mac.
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(
-            ImplicitOutputsFunction.fromFunctions(ReleaseBundlingSupport.IPA, XcodeSupport.PBXPROJ))
-        /* <!-- #BLAZE_RULE(ios_application).ATTRIBUTE(binary) -->
-        The binary target included in the final bundle.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("binary", LABEL)
-            .allowedRuleClasses("objc_binary")
-            .allowedFileTypes()
-            .mandatory()
-            .direct_compile_time_input()
-            .cfg(ReleaseBundlingSupport.SPLIT_ARCH_TRANSITION))
-        /* <!-- #BLAZE_RULE(ios_application).ATTRIBUTE(extensions) -->
-        Any extensions to include in the final application.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("extensions", LABEL_LIST)
-            .allowedRuleClasses("ios_extension")
-            .allowedFileTypes()
-            .direct_compile_time_input())
-        .add(attr("$runner_script_template", LABEL).cfg(HOST)
-            .value(env.getLabel("//tools/objc:ios_runner.sh.mac_template")))
-        .add(attr("$is_executable", BOOLEAN).value(true)
-            .nonconfigurable("Called from RunCommand.isExecutable, which takes a Target"))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("ios_application")
-        .factoryClass(IosApplication.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.ReleaseBundlingRule.class,
-            ObjcRuleClasses.XcodegenRule.class, ObjcRuleClasses.SimulatorRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = ios_application, TYPE = BINARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule produces an application bundle for iOS.</p>
-<p>When running an iOS application using the <code>run</code> command, environment variables that
-are prefixed with <code>IOS_</code> will be passed to the launched application, with the prefix
-stripped. For example, if you export <code>IOS_ENV=foo</code>, <code>ENV=foo</code> will be
-passed to the application.</p>
-
-${IMPLICIT_OUTPUTS}
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosDevice.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosDevice.java
deleted file mode 100644
index 2f01633..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosDevice.java
+++ /dev/null
@@ -1,42 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Type.STRING;
-
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.RunfilesProvider;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-
-/**
- * Implementation for the "ios_device" rule.
- */
-public final class IosDevice implements RuleConfiguredTargetFactory {
-  @Override
-  public ConfiguredTarget create(RuleContext context) throws InterruptedException {
-    IosDeviceProvider provider = new IosDeviceProvider.Builder()
-        .setType(context.attributes().get("type", STRING))
-        .setIosVersion(context.attributes().get("ios_version", STRING))
-        .setLocale(context.attributes().get("locale", STRING))
-        .build();
-
-    return new RuleConfiguredTargetBuilder(context)
-        .add(RunfilesProvider.class, RunfilesProvider.EMPTY)
-        .add(IosDeviceProvider.class, provider)
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceProvider.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceProvider.java
deleted file mode 100644
index 6f01e11..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceProvider.java
+++ /dev/null
@@ -1,73 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Preconditions;
-import com.google.devtools.build.lib.analysis.TransitiveInfoProvider;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-
-/**
- * Provider that describes a simulator device.
- */
-@Immutable
-public final class IosDeviceProvider implements TransitiveInfoProvider {
-  /** A builder of {@link IosDeviceProvider}s. */
-  public static final class Builder {
-    private String type;
-    private String iosVersion;
-    private String locale;
-
-    public Builder setType(String type) {
-      this.type = type;
-      return this;
-    }
-
-    public Builder setIosVersion(String iosVersion) {
-      this.iosVersion = iosVersion;
-      return this;
-    }
-
-    public Builder setLocale(String locale) {
-      this.locale = locale;
-      return this;
-    }
-
-    public IosDeviceProvider build() {
-      return new IosDeviceProvider(this);
-    }
-  }
-
-  private final String type;
-  private final String iosVersion;
-  private final String locale;
-
-  private IosDeviceProvider(Builder builder) {
-    this.type = Preconditions.checkNotNull(builder.type);
-    this.iosVersion = Preconditions.checkNotNull(builder.iosVersion);
-    this.locale = Preconditions.checkNotNull(builder.locale);
-  }
-
-  public String getType() {
-    return type;
-  }
-
-  public String getIosVersion() {
-    return iosVersion;
-  }
-
-  public String getLocale() {
-    return locale;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceRule.java
deleted file mode 100644
index 9122a0a..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosDeviceRule.java
+++ /dev/null
@@ -1,72 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.STRING;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for ios_device.
- */
-public final class IosDeviceRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /* <!-- #BLAZE_RULE(ios_device).ATTRIBUTE(ios_version) -->
-        The operating system version of the device. This corresponds to the
-        <code>simctl</code> runtime.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("ios_version", STRING)
-            .mandatory())
-        /* <!-- #BLAZE_RULE(ios_device).ATTRIBUTE(type) -->
-        The hardware type. This corresponds to the <code>simctl</code> device
-        type.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("type", STRING)
-            .mandatory())
-        .add(attr("locale", STRING)
-            .undocumented("this is not yet supported by any test runner")
-            .value("en"))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("ios_device")
-        .factoryClass(IosDevice.class)
-        .ancestors(BaseRuleClasses.BaseRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = ios_device, TYPE = BINARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule defines an iOS device profile that defines a simulator against
-which to run tests.</p>
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtension.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtension.java
deleted file mode 100644
index fa2e8fb..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtension.java
+++ /dev/null
@@ -1,36 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.collect.ImmutableSet;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-
-/**
- * Implementation for {@code ios_extension}.
- */
-public class IosExtension extends ReleaseBundlingTargetFactory {
-
-  public IosExtension() {
-    super(ReleaseBundlingSupport.EXTENSION_BUNDLE_DIR_FORMAT, XcodeProductType.EXTENSION,
-        ExposeAsNestedBundle.YES, ImmutableSet.of(new Attribute("binary", Mode.SPLIT)));
-  }
-
-  protected OptionsProvider optionsProvider(RuleContext ruleContext) {
-    return new OptionsProvider.Builder()
-        .addInfoplists(ruleContext.getPrerequisiteArtifacts("infoplist", Mode.TARGET).list())
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinary.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinary.java
deleted file mode 100644
index cecc3d9..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinary.java
+++ /dev/null
@@ -1,28 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkArgs;
-
-/**
- * Implementation for the "ios_extension_binary" rule.
- */
-public class IosExtensionBinary extends BinaryLinkingTargetFactory {
-  public IosExtensionBinary() {
-    super(HasReleaseBundlingSupport.NO,
-        new ExtraLinkArgs("-e", "_NSExtensionMain", "-fapplication-extension"),
-        XcodeProductType.LIBRARY_STATIC);
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinaryRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinaryRule.java
deleted file mode 100644
index f5bbdee..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionBinaryRule.java
+++ /dev/null
@@ -1,62 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for ios_extension_binary.
- */
-public class IosExtensionBinaryRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(ios_extension_binary).IMPLICIT_OUTPUTS -->
-        <ul>
-         <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: An Xcode project file which
-             can be used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(XcodeSupport.PBXPROJ)
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("ios_extension_binary")
-        .factoryClass(IosExtensionBinary.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.LinkingRule.class,
-            ObjcRuleClasses.XcodegenRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = ios_extension_binary, TYPE = BINARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule produces a binary for an iOS app extension by linking one or more
-Objective-C libraries.</p>
-
-${IMPLICIT_OUTPUTS}
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionRule.java
deleted file mode 100644
index eaf0f0a..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosExtensionRule.java
+++ /dev/null
@@ -1,106 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.LABEL;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.ImplicitOutputsFunction;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for ios_extension.
- */
-public class IosExtensionRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(ios_extension).IMPLICIT_OUTPUTS -->
-        <ul>
-         <li><code><var>name</var>.ipa</code>: the extension bundle as an <code>.ipa</code>
-             file</li>
-         <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: An Xcode project file which
-             can be used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(
-            ImplicitOutputsFunction.fromFunctions(ReleaseBundlingSupport.IPA, XcodeSupport.PBXPROJ))
-        /* <!-- #BLAZE_RULE(ios_extension).ATTRIBUTE(binary) -->
-        The binary target containing the logic for the extension.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("binary", LABEL)
-            .allowedRuleClasses("ios_extension_binary")
-            .allowedFileTypes()
-            .mandatory()
-            .direct_compile_time_input()
-            .cfg(ReleaseBundlingSupport.SPLIT_ARCH_TRANSITION))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("ios_extension")
-        .factoryClass(IosExtension.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.ReleaseBundlingRule.class,
-            ObjcRuleClasses.XcodegenRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = ios_extension, TYPE = BINARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule produces a bundled binary for an iOS app extension from a compiled binary and bundle
-metadata.</p>
-
-<p>An iOS app extension is a nested bundle that is located inside the application bundle and is
-released with it. An iOS app extension cannot be released alone, although this rule allows you to
-build an <code>.ipa</code> with only the extension.
-
-<p>Bundles generated by this rule use a bundle directory called
-<code>PlugIns/<var>target-name</var>.appex</code>, while an application bundle uses
-<code>Payload/<var>target-name</var>.app</code>. For instance, if an application call Foo has an app
-extension called Bar, the Bar extension bundle files will be stored in
-<code>Payload/Foo.app/PlugIns/Bar.appex</code> in the final application <code>.ipa</code>.
-
-<p>There are many similarities between app extensions and applications with little to no difference
-between how each thing is processed:
-<ul>
-  <li>both have entitlements and Info.plist files
-  <li>both are code-signed. Signing and merging happens in this order: the extension is code-signed,
-      bundles are merged, application is code-signed
-  <li>both can have an app icon and launch image, and of course asset catalogs and all kinds of
-      resources
-  <li>both have linked binaries. The app extension binary is different in that it is linked with
-      these additional flags:
-      <ul>
-          <li><code>-e _NSExtensionMain</code> - sets the entry point to a standard function in the
-              iOS runtime rather than <code>main()</code>
-          <li><code>-fapplicationextension</code>
-      </ul>
-</ul>
-
-${IMPLICIT_OUTPUTS}
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosSdkCommands.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosSdkCommands.java
deleted file mode 100644
index 32c24c1..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosSdkCommands.java
+++ /dev/null
@@ -1,158 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FRAMEWORK_DIR;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Function;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.vfs.PathFragment;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.XcodeprojBuildSetting;
-
-import java.util.List;
-
-/**
- * Utility code for use when generating iOS SDK commands.
- */
-public class IosSdkCommands {
-  public static final String DEVELOPER_DIR = "/Applications/Xcode.app/Contents/Developer";
-  public static final String ACTOOL_PATH = DEVELOPER_DIR + "/usr/bin/actool";
-  public static final String IBTOOL_PATH = DEVELOPER_DIR + "/usr/bin/ibtool";
-  public static final String MOMC_PATH = DEVELOPER_DIR + "/usr/bin/momc";
-
-  // There is a handy reference to many clang warning flags at
-  // http://nshipster.com/clang-diagnostics/
-  // There is also a useful narrative for many Xcode settings at
-  // http://www.xs-labs.com/en/blog/2011/02/04/xcode-build-settings/
-  @VisibleForTesting
-  static final ImmutableMap<String, String> DEFAULT_WARNINGS =
-      new ImmutableMap.Builder<String, String>()
-          .put("GCC_WARN_64_TO_32_BIT_CONVERSION", "-Wshorten-64-to-32")
-          .put("CLANG_WARN_BOOL_CONVERSION", "-Wbool-conversion")
-          .put("CLANG_WARN_CONSTANT_CONVERSION", "-Wconstant-conversion")
-          // Double-underscores are intentional - thanks Xcode.
-          .put("CLANG_WARN__DUPLICATE_METHOD_MATCH", "-Wduplicate-method-match")
-          .put("CLANG_WARN_EMPTY_BODY", "-Wempty-body")
-          .put("CLANG_WARN_ENUM_CONVERSION", "-Wenum-conversion")
-          .put("CLANG_WARN_INT_CONVERSION", "-Wint-conversion")
-          .put("CLANG_WARN_UNREACHABLE_CODE", "-Wunreachable-code")
-          .put("GCC_WARN_ABOUT_RETURN_TYPE", "-Wmismatched-return-types")
-          .put("GCC_WARN_UNDECLARED_SELECTOR", "-Wundeclared-selector")
-          .put("GCC_WARN_UNINITIALIZED_AUTOS", "-Wuninitialized")
-          .put("GCC_WARN_UNUSED_FUNCTION", "-Wunused-function")
-          .put("GCC_WARN_UNUSED_VARIABLE", "-Wunused-variable")
-          .build();
-
-  static final ImmutableList<String> DEFAULT_COMPILER_FLAGS = ImmutableList.of("-DOS_IOS");
-
-  static final ImmutableList<String> DEFAULT_LINKER_FLAGS = ImmutableList.of("-ObjC");
-
-  private IosSdkCommands() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  private static String getPlatformPlistName(ObjcConfiguration configuration) {
-    return Platform.forArch(configuration.getIosCpu()).getNameInPlist();
-  }
-
-  private static String platformDir(ObjcConfiguration configuration) {
-    return DEVELOPER_DIR + "/Platforms/" + getPlatformPlistName(configuration) + ".platform";
-  }
-
-  public static String sdkDir(ObjcConfiguration configuration) {
-    return platformDir(configuration) + "/Developer/SDKs/"
-        + getPlatformPlistName(configuration) + configuration.getIosSdkVersion() + ".sdk";
-  }
-
-  public static String frameworkDir(ObjcConfiguration configuration) {
-    return platformDir(configuration) + "/Developer/Library/Frameworks";
-  }
-
-  private static Iterable<PathFragment> uniqueParentDirectories(Iterable<PathFragment> paths) {
-    ImmutableSet.Builder<PathFragment> parents = new ImmutableSet.Builder<>();
-    for (PathFragment path : paths) {
-      parents.add(path.getParentDirectory());
-    }
-    return parents.build();
-  }
-
-  public static List<String> commonLinkAndCompileFlagsForClang(
-      ObjcProvider provider, ObjcConfiguration configuration) {
-    ImmutableList.Builder<String> builder = new ImmutableList.Builder<>();
-    if (Platform.forArch(configuration.getIosCpu()) == Platform.SIMULATOR) {
-      builder.add("-mios-simulator-version-min=" + configuration.getMinimumOs());
-    } else {
-      builder.add("-miphoneos-version-min=" + configuration.getMinimumOs());
-    }
-
-    if (configuration.generateDebugSymbols()) {
-      builder.add("-g");
-    }
-
-    return builder
-        .add("-arch", configuration.getIosCpu())
-        .add("-isysroot", sdkDir(configuration))
-        // TODO(bazel-team): Pass framework search paths to Xcodegen.
-        .add("-F", sdkDir(configuration) + "/Developer/Library/Frameworks")
-        // As of sdk8.1, XCTest is in a base Framework dir
-        .add("-F", frameworkDir(configuration))
-        // Add custom (non-SDK) framework search paths. For each framework foo/bar.framework,
-        // include "foo" as a search path.
-        .addAll(Interspersing.beforeEach(
-            "-F",
-            PathFragment.safePathStrings(uniqueParentDirectories(provider.get(FRAMEWORK_DIR)))))
-        .build();
-  }
-
-  public static Iterable<String> compileFlagsForClang(ObjcConfiguration configuration) {
-    return Iterables.concat(
-        DEFAULT_WARNINGS.values(),
-        platformSpecificCompileFlagsForClang(configuration),
-        DEFAULT_COMPILER_FLAGS
-    );
-  }
-
-  private static List<String> platformSpecificCompileFlagsForClang(
-      ObjcConfiguration configuration) {
-    switch (Platform.forArch(configuration.getIosCpu())) {
-      case DEVICE:
-        return ImmutableList.of();
-      case SIMULATOR:
-        // These are added by Xcode when building, because the simulator is built on OSX
-        // frameworks so we aim compile to match the OSX objc runtime.
-        return ImmutableList.of(
-          "-fexceptions",
-          "-fasm-blocks",
-          "-fobjc-abi-version=2",
-          "-fobjc-legacy-dispatch");
-      default:
-        throw new AssertionError();
-    }
-  }
-
-  public static Iterable<? extends XcodeprojBuildSetting> defaultWarningsForXcode() {
-    return Iterables.transform(DEFAULT_WARNINGS.keySet(),
-        new Function<String, XcodeprojBuildSetting>() {
-      @Override
-      public XcodeprojBuildSetting apply(String key) {
-        return XcodeprojBuildSetting.newBuilder().setName(key).setValue("YES").build();
-      }
-    });
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IosTest.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IosTest.java
deleted file mode 100644
index 7171706..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IosTest.java
+++ /dev/null
@@ -1,208 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.STORYBOARD;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XCDATAMODEL;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkArgs;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkInputs;
-import com.google.devtools.build.lib.rules.objc.ReleaseBundlingSupport.LinkedBinary;
-
-import java.util.ArrayList;
-import java.util.List;
-
-/**
- * Contains information needed to create a {@link RuleConfiguredTarget} and invoke test runners
- * for some instantiation of this rule.
- */
-// TODO(bazel-team): Extract a TestSupport class that takes on most of the logic in this class.
-public abstract class IosTest implements RuleConfiguredTargetFactory {
-  private static final ImmutableList<SdkFramework> AUTOMATIC_SDK_FRAMEWORKS_FOR_XCTEST =
-      ImmutableList.of(new SdkFramework("XCTest"));
-
-  public static final String TARGET_DEVICE = "target_device";
-  public static final String IS_XCTEST = "xctest";
-  public static final String XCTEST_APP = "xctest_app";
-  public static final String MEMLEAKS_DEP = "$memleaks_dep";
-
-  @VisibleForTesting
-  public static final String REQUIRES_SOURCE_ERROR =
-      "ios_test requires at least one source file in srcs or non_arc_srcs";
-  @VisibleForTesting
-  public static final String NO_MULTI_CPUS_ERROR =
-      "ios_test cannot be built for multiple CPUs at the same time";
-
-  /**
-   * Creates a target, including registering actions, just as {@link #create(RuleContext)} does.
-   * The difference between {@link #create(RuleContext)} and this method is that this method does
-   * only what is needed to support tests on the environment besides generate the Xcodeproj file
-   * and build the app and test {@code .ipa}s. The {@link #create(RuleContext)} method delegates
-   * to this method.
-   */
-  protected abstract ConfiguredTarget create(RuleContext ruleContext, ObjcCommon common,
-      XcodeProvider xcodeProvider, NestedSet<Artifact> filesToBuild) throws InterruptedException;
-
-  @Override
-  public final ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    ObjcCommon common = common(ruleContext);
-    OptionsProvider optionsProvider = optionsProvider(ruleContext);
-
-    if (!common.getCompilationArtifacts().get().getArchive().isPresent()) {
-      ruleContext.ruleError(REQUIRES_SOURCE_ERROR);
-    }
-
-    if (!ObjcRuleClasses.objcConfiguration(ruleContext).getIosMultiCpus().isEmpty()) {
-      ruleContext.ruleError(NO_MULTI_CPUS_ERROR);
-    }
-
-    XcodeProvider.Builder xcodeProviderBuilder = new XcodeProvider.Builder();
-    NestedSetBuilder<Artifact> filesToBuild = NestedSetBuilder.stableOrder();
-    addResourceFilesToBuild(ruleContext, common.getObjcProvider(), filesToBuild);
-
-    XcodeProductType productType;
-    ExtraLinkArgs extraLinkArgs;
-    ExtraLinkInputs extraLinkInputs;
-    if (!isXcTest(ruleContext)) {
-      productType = XcodeProductType.APPLICATION;
-      extraLinkArgs = new ExtraLinkArgs();
-      extraLinkInputs = new ExtraLinkInputs();
-    } else {
-      productType = XcodeProductType.UNIT_TEST;
-      XcodeProvider appIpaXcodeProvider =
-          ruleContext.getPrerequisite(XCTEST_APP, Mode.TARGET, XcodeProvider.class);
-      xcodeProviderBuilder
-          .setTestHost(appIpaXcodeProvider)
-          .setProductType(productType);
-
-      XcTestAppProvider testApp = xcTestAppProvider(ruleContext);
-      Artifact bundleLoader = testApp.getBundleLoader();
-
-      // -bundle causes this binary to be linked as a bundle and not require an entry point
-      // (i.e. main())
-      // -bundle_loader causes the code in this test to have access to the symbols in the test rig,
-      // or more specifically, the flag causes ld to consider the given binary when checking for
-      // missing symbols.
-      extraLinkArgs = new ExtraLinkArgs(
-          "-bundle",
-          "-bundle_loader", bundleLoader.getExecPathString());
-
-      extraLinkInputs = new ExtraLinkInputs(bundleLoader);
-
-      filesToBuild.add(testApp.getIpa());
-    }
-
-    if (ruleContext.getConfiguration().isCodeCoverageEnabled()) {
-      extraLinkArgs = extraLinkArgs.appendedWith(CompilationSupport.LINKER_COVERAGE_FLAGS);
-    }
-
-    new CompilationSupport(ruleContext)
-        .registerLinkActions(
-            common.getObjcProvider(), extraLinkArgs, extraLinkInputs)
-        .registerJ2ObjcCompileAndArchiveActions(optionsProvider, common.getObjcProvider())
-        .registerCompileAndArchiveActions(common, optionsProvider)
-        .addXcodeSettings(xcodeProviderBuilder, common, optionsProvider)
-        .validateAttributes();
-
-    ReleaseBundlingSupport releaseBundlingSupport = new ReleaseBundlingSupport(
-        ruleContext, common.getObjcProvider(), optionsProvider, LinkedBinary.LOCAL_AND_DEPENDENCIES,
-        ReleaseBundlingSupport.APP_BUNDLE_DIR_FORMAT);
-    releaseBundlingSupport
-        .registerActions()
-        .addXcodeSettings(xcodeProviderBuilder)
-        .addFilesToBuild(filesToBuild)
-        .validateResources()
-        .validateAttributes();
-
-    new ResourceSupport(ruleContext)
-        .validateAttributes()
-        .addXcodeSettings(xcodeProviderBuilder);
-
-    new XcodeSupport(ruleContext)
-        .addXcodeSettings(xcodeProviderBuilder, common.getObjcProvider(), productType)
-        .addDependencies(xcodeProviderBuilder, new Attribute("bundles", Mode.TARGET))
-        .addDependencies(xcodeProviderBuilder, new Attribute("deps", Mode.TARGET))
-        .addNonPropagatedDependencies(
-            xcodeProviderBuilder, new Attribute("non_propagated_deps", Mode.TARGET))
-        .addFilesToBuild(filesToBuild)
-        .registerActions(xcodeProviderBuilder.build());
-
-    return create(ruleContext, common, xcodeProviderBuilder.build(), filesToBuild.build());
-  }
-
-  private void addResourceFilesToBuild(
-      RuleContext ruleContext, ObjcProvider objcProvider, NestedSetBuilder<Artifact> filesToBuild) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-
-    Iterable<Xcdatamodel> xcdatamodels =
-        Xcdatamodels.xcdatamodels(intermediateArtifacts, objcProvider.get(XCDATAMODEL));
-    filesToBuild.addAll(Xcdatamodel.outputZips(xcdatamodels));
-
-    for (Artifact storyboard : objcProvider.get(STORYBOARD)) {
-      filesToBuild.add(intermediateArtifacts.compiledStoryboardZip(storyboard));
-    }
-  }
-
-  protected static boolean isXcTest(RuleContext ruleContext) {
-    return ruleContext.attributes().get(IS_XCTEST, Type.BOOLEAN);
-  }
-
-  private OptionsProvider optionsProvider(RuleContext ruleContext) {
-    return new OptionsProvider.Builder()
-        .addCopts(ruleContext.getTokenizedStringListAttr("copts"))
-        .addInfoplists(ruleContext.getPrerequisiteArtifacts("infoplist", Mode.TARGET).list())
-        .addTransitive(Optional.fromNullable(
-            ruleContext.getPrerequisite("options", Mode.TARGET, OptionsProvider.class)))
-        .build();
-  }
-
-  /** Returns the {@link XcTestAppProvider} of the {@code xctest_app} attribute. */
-  private static XcTestAppProvider xcTestAppProvider(RuleContext ruleContext) {
-    return ruleContext.getPrerequisite(XCTEST_APP, Mode.TARGET, XcTestAppProvider.class);
-  }
-
-  private ObjcCommon common(RuleContext ruleContext) {
-    ImmutableList<SdkFramework> extraSdkFrameworks = isXcTest(ruleContext)
-        ? AUTOMATIC_SDK_FRAMEWORKS_FOR_XCTEST : ImmutableList.<SdkFramework>of();
-    List<ObjcProvider> extraDepObjcProviders = new ArrayList<>();
-    if (isXcTest(ruleContext)) {
-      extraDepObjcProviders.add(xcTestAppProvider(ruleContext).getObjcProvider());
-    }
-
-    // Add the memleaks library if the --ios_memleaks flag is true.  The library pauses the test
-    // after all tests have been executed so that leaks can be run.
-    ObjcConfiguration config = ruleContext.getFragment(ObjcConfiguration.class);
-    if (config.runMemleaks()) {
-      extraDepObjcProviders
-          .add(ruleContext.getPrerequisite(MEMLEAKS_DEP, Mode.TARGET, ObjcProvider.class));
-    }
-    return ObjcLibrary.common(ruleContext, extraSdkFrameworks, /*alwayslink=*/false,
-        new ObjcLibrary.ExtraImportLibraries(ObjcRuleClasses.j2ObjcLibraries(ruleContext)),
-        extraDepObjcProviders);
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/IterableWrapper.java b/src/main/java/com/google/devtools/build/lib/rules/objc/IterableWrapper.java
deleted file mode 100644
index 4bd7b0c..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/IterableWrapper.java
+++ /dev/null
@@ -1,40 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-
-import java.util.Iterator;
-
-/**
- * Base class for tiny container types that encapsulate an iterable.
- */
-abstract class IterableWrapper<E> implements Iterable<E> {
-  private final Iterable<E> contents;
-
-  IterableWrapper(Iterable<E> contents) {
-    this.contents = Preconditions.checkNotNull(contents);
-  }
-
-  IterableWrapper(E... contents) {
-    this.contents = ImmutableList.copyOf(contents);
-  }
-
-  @Override
-  public Iterator<E> iterator() {
-    return contents.iterator();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcMappingFileProvider.java b/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcMappingFileProvider.java
deleted file mode 100644
index 7ee799e..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcMappingFileProvider.java
+++ /dev/null
@@ -1,55 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.TransitiveInfoProvider;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-
-/**
- * This provider is exported by java_library rules and proto_library rules with attribute
- * "j2objc_api_version=1" to support distributed J2ObjC translation and proto compilation.
- */
-@Immutable
-public final class J2ObjcMappingFileProvider implements TransitiveInfoProvider {
-
-  private final NestedSet<Artifact> headerMappingFiles;
-  private final NestedSet<Artifact> classMappingFiles;
-
-  public J2ObjcMappingFileProvider(NestedSet<Artifact> headerMappingFiles,
-      NestedSet<Artifact> classMappingFiles) {
-    this.headerMappingFiles = headerMappingFiles;
-    this.classMappingFiles = classMappingFiles;
-  }
-
-  /**
-   * Returns the ObjC header to Java type mapping files for J2ObjC translation. J2ObjC needs these
-   * mapping files to be able to output translated files with correct header import paths in the
-   * same directories of the Java source files.
-   */
-  public NestedSet<Artifact> getHeaderMappingFiles() {
-    return headerMappingFiles;
-  }
-
-  /**
-   * Returns the Java class name to ObjC class name mapping files. J2ObjC transpiler and J2ObjC
-   * proto plugin needs this mapping files to support "objc_class_prefix" proto option, which sets
-   * the ObjC class prefix on generated protos.
-   */
-  public NestedSet<Artifact> getClassMappingFiles() {
-    return classMappingFiles;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSource.java b/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSource.java
deleted file mode 100644
index 81ba292..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSource.java
+++ /dev/null
@@ -1,124 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Objects;
-import com.google.common.collect.Iterators;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.syntax.Label;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-/**
- * An object that captures information of ObjC files generated by J2ObjC in a single target.
- */
-public class J2ObjcSource {
-
-  /**
-   * Indicates the type of files from which the ObjC files included in {@link J2ObjcSource} are
-   * generated.
-   */
-  public enum SourceType {
-    /**
-     * Indicates the original file type is java source file.
-     */
-    JAVA,
-
-    /**
-     * Indicates the original file type is proto file.
-     */
-    PROTO;
-  }
-
-  private final Label targetLabel;
-  private final Iterable<Artifact> objcSrcs;
-  private final Iterable<Artifact> objcHdrs;
-  private final PathFragment objcFilePath;
-  private final SourceType sourceType;
-
-  /**
-   * Constructs a J2ObjcSource containing target information for j2objc transpilation.
-   *
-   * @param targetLabel the @{code Label} of the associated target.
-   * @param objcSrcs the {@code Iterable} containing objc source files generated by J2ObjC
-   * @param objcHdrs the {@code Iterable} containing objc header files generated by J2ObjC
-   * @param objcFilePath the {@code PathFragment} under which all the generated objc files are. It
-   *     can be used as header search path for objc compilations.
-   * @param sourceType the type of files from which the ObjC files are generated.
-   */
-  public J2ObjcSource(Label targetLabel, Iterable<Artifact> objcSrcs,
-      Iterable<Artifact> objcHdrs, PathFragment objcFilePath, SourceType sourceType) {
-    this.targetLabel = targetLabel;
-    this.objcSrcs = objcSrcs;
-    this.objcHdrs = objcHdrs;
-    this.objcFilePath = objcFilePath;
-    this.sourceType = sourceType;
-  }
-
-  /**
-   * Returns the label of the associated target.
-   */
-  public Label getTargetLabel() {
-    return targetLabel;
-  }
-
-  /**
-   * Returns the objc source files generated by J2ObjC.
-   */
-  public Iterable<Artifact> getObjcSrcs() {
-    return objcSrcs;
-  }
-
-  /*
-   * Returns the objc header files generated by J2ObjC
-   */
-  public Iterable<Artifact> getObjcHdrs() {
-    return objcHdrs;
-  }
-
-  /**
-   * Returns the {@code PathFragment} which represents a directory where the generated ObjC files
-   * reside and which can also be used as header search path in ObjC compilation.
-   */
-  public PathFragment getObjcFilePath() {
-    return objcFilePath;
-  }
-
-  /**
-   * Returns the type of files from which the ObjC files inside this object are generated.
-   */
-  public SourceType getSourceType() {
-    return sourceType;
-  }
-
-  @Override
-  public final boolean equals(Object other) {
-    if (!(other instanceof J2ObjcSource)) {
-      return false;
-    }
-
-    J2ObjcSource that = (J2ObjcSource) other;
-    return Objects.equal(this.targetLabel, that.targetLabel)
-        && Iterators.elementsEqual(this.objcSrcs.iterator(), that.objcSrcs.iterator())
-        && Iterators.elementsEqual(this.objcHdrs.iterator(), that.objcHdrs.iterator())
-        && Objects.equal(this.objcFilePath, that.objcFilePath)
-        && this.sourceType == that.sourceType;
-  }
-
-  @Override
-  public int hashCode() {
-    return Objects.hashCode(targetLabel, objcSrcs, objcHdrs, objcFilePath, sourceType);
-  }
-}
-
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSrcsProvider.java b/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSrcsProvider.java
deleted file mode 100644
index 1e577c5..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/J2ObjcSrcsProvider.java
+++ /dev/null
@@ -1,45 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.analysis.TransitiveInfoProvider;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-
-/**
- * This provider is exported by java_library rules to supply J2ObjC-translated ObjC sources to
- * objc_binary for compilation and linking.
- */
-@Immutable
-public final class J2ObjcSrcsProvider implements TransitiveInfoProvider {
-  private final NestedSet<J2ObjcSource> srcs;
-  private final boolean hasProtos;
-
-  public J2ObjcSrcsProvider(NestedSet<J2ObjcSource> srcs, boolean hasProtos) {
-    this.srcs = srcs;
-    this.hasProtos = hasProtos;
-  }
-
-  public NestedSet<J2ObjcSource> getSrcs() {
-    return srcs;
-  }
-
-  /**
-   * Returns whether the translated source files in the provider has proto files.
-   */
-  public boolean hasProtos() {
-    return hasProtos;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcActionsBuilder.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcActionsBuilder.java
deleted file mode 100644
index 9a0684f..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcActionsBuilder.java
+++ /dev/null
@@ -1,306 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FORCE_LOAD_LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FRAMEWORK_DIR;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FRAMEWORK_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.Flag.USES_CPP;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.IMPORTED_LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.SDK_DYLIB;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.SDK_FRAMEWORK;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.WEAK_SDK_FRAMEWORK;
-
-import com.google.common.base.Joiner;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.Iterables;
-import com.google.common.io.ByteSource;
-import com.google.devtools.build.lib.actions.Action;
-import com.google.devtools.build.lib.actions.ActionRegistry;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.actions.ActionConstructionContext;
-import com.google.devtools.build.lib.analysis.actions.BinaryFileWriteAction;
-import com.google.devtools.build.lib.analysis.actions.CommandLine;
-import com.google.devtools.build.lib.analysis.actions.SpawnAction;
-import com.google.devtools.build.lib.vfs.PathFragment;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos;
-
-import java.io.InputStream;
-import java.util.ArrayList;
-import java.util.List;
-
-import javax.annotation.CheckReturnValue;
-
-/**
- * Object that creates actions used by Objective-C rules.
- */
-final class ObjcActionsBuilder {
-
-  private static final Joiner COMMAND_JOINER = Joiner.on(' ');
-
-  private final ActionConstructionContext context;
-  private final IntermediateArtifacts intermediateArtifacts;
-  private final ObjcConfiguration objcConfiguration;
-  private final ActionRegistry actionRegistry;
-  private final PathFragment clang;
-  private final PathFragment clangPlusPlus;
-  private final PathFragment dsymutil;
-
-  /**
-   * @param context {@link ActionConstructionContext} of the rule
-   * @param intermediateArtifacts provides intermediate output paths for this rule
-   * @param objcConfiguration configuration for this rule
-   * @param actionRegistry registry with which to register new actions
-   * @param clang path to clang binary to use for compilation. This will soon be deprecated, and
-   *     replaced with an Artifact from an objc_toolchain.
-   * @param clangPlusPlus path to clang++ binary to use for compilation. This will soon be
-   *     deprecated and replaced with an Artifact from an objc_toolchain.
-   * @param dsymutil path to the dsymutil binary to use when generating debug symbols. This will
-   *     soon be deprecated and replaced with an Aritifact from an objc_toolchain.
-   */
-  ObjcActionsBuilder(
-      ActionConstructionContext context,
-      IntermediateArtifacts intermediateArtifacts,
-      ObjcConfiguration objcConfiguration,
-      ActionRegistry actionRegistry,
-      PathFragment clang,
-      PathFragment clangPlusPlus,
-      PathFragment dsymutil) {
-    this.context = Preconditions.checkNotNull(context);
-    this.intermediateArtifacts = Preconditions.checkNotNull(intermediateArtifacts);
-    this.objcConfiguration = Preconditions.checkNotNull(objcConfiguration);
-    this.actionRegistry = Preconditions.checkNotNull(actionRegistry);
-    this.clang = clang;
-    this.clangPlusPlus = clangPlusPlus;
-    this.dsymutil = dsymutil;
-  }
-
-  /**
-   * Creates a new spawn action builder that requires a darwin architecture to run.
-   */
-  // TODO(bazel-team): Use everywhere we currently set the execution info manually.
-  static SpawnAction.Builder spawnOnDarwinActionBuilder() {
-    return new SpawnAction.Builder()
-        .setExecutionInfo(ImmutableMap.of(ExecutionRequirements.REQUIRES_DARWIN, ""));
-  }
-
-  static final PathFragment JAVA = new PathFragment("/usr/bin/java");
-  static final PathFragment IBTOOL = new PathFragment(IosSdkCommands.IBTOOL_PATH);
-
-  // TODO(bazel-team): Reference a rule target rather than a jar file when Darwin runfiles work
-  // better.
-  static SpawnAction.Builder spawnJavaOnDarwinActionBuilder(Artifact deployJarArtifact) {
-    return spawnOnDarwinActionBuilder()
-        .setExecutable(JAVA)
-        .addExecutableArguments("-jar", deployJarArtifact.getExecPathString())
-        .addInput(deployJarArtifact);
-  }
-
-  private void register(Action... action) {
-    actionRegistry.registerAction(action);
-  }
-
-  private static ByteSource xcodegenControlFileBytes(
-      final Artifact pbxproj, final XcodeProvider.Project project, final String minimumOs) {
-    return new ByteSource() {
-      @Override
-      public InputStream openStream() {
-        return XcodeGenProtos.Control.newBuilder()
-            .setPbxproj(pbxproj.getExecPathString())
-            .addAllTarget(project.targets())
-            .addBuildSetting(XcodeGenProtos.XcodeprojBuildSetting.newBuilder()
-                .setName("IPHONEOS_DEPLOYMENT_TARGET")
-                .setValue(minimumOs)
-                .build())
-            .build()
-            .toByteString()
-            .newInput();
-      }
-    };
-  }
-
-  /**
-   * Generates actions needed to create an Xcode project file.
-   */
-  void registerXcodegenActions(
-      ObjcRuleClasses.Tools baseTools, Artifact pbxproj, XcodeProvider.Project project) {
-    Artifact controlFile = intermediateArtifacts.pbxprojControlArtifact();
-    register(new BinaryFileWriteAction(
-        context.getActionOwner(),
-        controlFile,
-        xcodegenControlFileBytes(pbxproj, project, objcConfiguration.getMinimumOs()),
-        /*makeExecutable=*/false));
-    register(new SpawnAction.Builder()
-        .setMnemonic("GenerateXcodeproj")
-        .setExecutable(baseTools.xcodegen())
-        .addArgument("--control")
-        .addInputArgument(controlFile)
-        .addOutput(pbxproj)
-        .addTransitiveInputs(project.getInputsToXcodegen())
-        .build(context));
-  }
-
-  static final class ExtraActoolArgs extends IterableWrapper<String> {
-    ExtraActoolArgs(Iterable<String> args) {
-      super(args);
-    }
-
-    ExtraActoolArgs(String... args) {
-      super(args);
-    }
-  }
-
-
-  private static final String FRAMEWORK_SUFFIX = ".framework";
-
-  /**
-   * All framework names to pass to the linker using {@code -framework} flags. For a framework in
-   * the directory foo/bar.framework, the name is "bar". Each framework is found without using the
-   * full path by means of the framework search paths. The search paths are added by
-   * {@link IosSdkCommands#commonLinkAndCompileFlagsForClang(ObjcProvider, ObjcConfiguration)}).
-   *
-   * <p>It's awful that we can't pass the full path to the framework and avoid framework search
-   * paths, but this is imposed on us by clang. clang does not support passing the full path to the
-   * framework, so Bazel cannot do it either.
-   */
-  private static Iterable<String> frameworkNames(ObjcProvider provider) {
-    List<String> names = new ArrayList<>();
-    Iterables.addAll(names, SdkFramework.names(provider.get(SDK_FRAMEWORK)));
-    for (PathFragment frameworkDir : provider.get(FRAMEWORK_DIR)) {
-      String segment = frameworkDir.getBaseName();
-      Preconditions.checkState(segment.endsWith(FRAMEWORK_SUFFIX),
-          "expect %s to end with %s, but it does not", segment, FRAMEWORK_SUFFIX);
-      names.add(segment.substring(0, segment.length() - FRAMEWORK_SUFFIX.length()));
-    }
-    return names;
-  }
-
-  static final class ExtraLinkArgs extends IterableWrapper<String> {
-    ExtraLinkArgs(Iterable<String> args) {
-      super(args);
-    }
-
-    ExtraLinkArgs(String... args) {
-      super(args);
-    }
-
-    /*
-     * Returns an ExtraLinkArgs with the parameter appended to this instance's contents. This
-     * function does not modify this instance.
-     */
-    @CheckReturnValue
-    public ExtraLinkArgs appendedWith(Iterable<String> extraLinkArgs) {
-      return new ExtraLinkArgs(Iterables.concat(this, extraLinkArgs));
-    }
-  }
-
-  static final class ExtraLinkInputs extends IterableWrapper<Artifact> {
-    ExtraLinkInputs(Artifact... inputs) {
-      super(inputs);
-    }
-  }
-
-  private final class LinkCommandLine extends CommandLine {
-    private final ObjcProvider objcProvider;
-    private final Artifact linkedBinary;
-    private final Optional<Artifact> dsymBundle;
-    private final ExtraLinkArgs extraLinkArgs;
-
-    LinkCommandLine(ExtraLinkArgs extraLinkArgs,
-        ObjcProvider objcProvider, Artifact linkedBinary, Optional<Artifact> dsymBundle) {
-      this.extraLinkArgs = Preconditions.checkNotNull(extraLinkArgs);
-      this.objcProvider = Preconditions.checkNotNull(objcProvider);
-      this.linkedBinary = Preconditions.checkNotNull(linkedBinary);
-      this.dsymBundle = Preconditions.checkNotNull(dsymBundle);
-    }
-
-    Iterable<String> dylibPaths() {
-      ImmutableList.Builder<String> args = new ImmutableList.Builder<>();
-      for (String dylib : objcProvider.get(SDK_DYLIB)) {
-        args.add(String.format(
-            "%s/usr/lib/%s.dylib", IosSdkCommands.sdkDir(objcConfiguration), dylib));
-      }
-      return args.build();
-    }
-
-    @Override
-    public Iterable<String> arguments() {
-      StringBuilder argumentStringBuilder = new StringBuilder();
-
-      Iterable<String> archiveExecPaths = Artifact.toExecPaths(
-          Iterables.concat(objcProvider.get(LIBRARY), objcProvider.get(IMPORTED_LIBRARY)));
-      COMMAND_JOINER.appendTo(argumentStringBuilder, new ImmutableList.Builder<String>()
-          .add(objcProvider.is(USES_CPP) ? clangPlusPlus.toString() : clang.toString())
-          .addAll(objcProvider.is(USES_CPP)
-              ? ImmutableList.of("-stdlib=libc++") : ImmutableList.<String>of())
-          .addAll(IosSdkCommands.commonLinkAndCompileFlagsForClang(objcProvider, objcConfiguration))
-          .add("-Xlinker", "-objc_abi_version")
-          .add("-Xlinker", "2")
-          .add("-fobjc-link-runtime")
-          .addAll(IosSdkCommands.DEFAULT_LINKER_FLAGS)
-          .addAll(Interspersing.beforeEach("-framework", frameworkNames(objcProvider)))
-          .addAll(Interspersing.beforeEach(
-              "-weak_framework", SdkFramework.names(objcProvider.get(WEAK_SDK_FRAMEWORK))))
-          .add("-o", linkedBinary.getExecPathString())
-          .addAll(archiveExecPaths)
-          .addAll(dylibPaths())
-          .addAll(extraLinkArgs)
-          .build());
-
-      // Call to dsymutil for debug symbol generation must happen in the link action.
-      // All debug symbol information is encoded in object files inside archive files. To generate
-      // the debug symbol bundle, dsymutil will look inside the linked binary for the encoded
-      // absolute paths to archive files, which are only valid in the link action.
-      for (Artifact justDsymBundle : dsymBundle.asSet()) {
-        argumentStringBuilder.append(" ");
-        COMMAND_JOINER.appendTo(argumentStringBuilder, new ImmutableList.Builder<String>()
-            .add("&&")
-            .add(dsymutil.toString())
-            .add(linkedBinary.getExecPathString())
-            .add("-o").add(justDsymBundle.getExecPathString())
-            .build());
-      }
-
-      return ImmutableList.of(argumentStringBuilder.toString());
-    }
-  }
-
-  /**
-   * Generates an action to link a binary.
-   */
-  void registerLinkAction(Artifact linkedBinary, ObjcProvider objcProvider,
-      ExtraLinkArgs extraLinkArgs, ExtraLinkInputs extraLinkInputs, Optional<Artifact> dsymBundle) {
-    extraLinkArgs = new ExtraLinkArgs(Iterables.concat(
-        Interspersing.beforeEach(
-            "-force_load", Artifact.toExecPaths(objcProvider.get(FORCE_LOAD_LIBRARY))),
-        extraLinkArgs));
-    register(spawnOnDarwinActionBuilder()
-        .setMnemonic("ObjcLink")
-        .setShellCommand(ImmutableList.of("/bin/bash", "-c"))
-        .setCommandLine(
-            new LinkCommandLine(extraLinkArgs, objcProvider, linkedBinary, dsymBundle))
-        .addOutput(linkedBinary)
-        .addOutputs(dsymBundle.asSet())
-        .addTransitiveInputs(objcProvider.get(LIBRARY))
-        .addTransitiveInputs(objcProvider.get(IMPORTED_LIBRARY))
-        .addTransitiveInputs(objcProvider.get(FRAMEWORK_FILE))
-        .addInputs(extraLinkInputs)
-        .build(context));
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinary.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinary.java
deleted file mode 100644
index 37b772b..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinary.java
+++ /dev/null
@@ -1,34 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraLinkArgs;
-
-/**
- * Implementation for the "objc_binary" rule.
- */
-public class ObjcBinary extends BinaryLinkingTargetFactory {
-  public ObjcBinary() {
-    super(
-        // TODO(bazel-team): Remove the enum and delete all code depending on YES case once all
-        // bundle users are migrated to ios_application.
-        HasReleaseBundlingSupport.YES,
-        new ExtraLinkArgs(),
-
-        // TODO(bazel-team): Use LIBRARY_STATIC as parameter instead of APPLICATION once objc_binary
-        // no longer creates an application bundle
-        XcodeProductType.APPLICATION);
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinaryRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinaryRule.java
deleted file mode 100644
index 1b1fb62..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBinaryRule.java
+++ /dev/null
@@ -1,86 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.ConfigurationTransition.HOST;
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.BOOLEAN;
-import static com.google.devtools.build.lib.packages.Type.LABEL;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.ImplicitOutputsFunction;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for objc_binary.
- */
-// TODO(bazel-team): Remove bundling functionality (dependency on ApplicationRule, IPA output).
-public class ObjcBinaryRule implements RuleDefinition {
-
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(objc_binary).IMPLICIT_OUTPUTS -->
-        <ul>
-         <li><code><var>name</var>.ipa</code>: the application bundle as an <code>.ipa</code>
-             file</li>
-         <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: An Xcode project file which
-             can be used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(
-            ImplicitOutputsFunction.fromFunctions(ReleaseBundlingSupport.IPA, XcodeSupport.PBXPROJ))
-        // TODO(bazel-team): Remove these when this rule no longer produces a bundle.
-        .add(attr("$runner_script_template", LABEL).cfg(HOST)
-            .value(env.getLabel("//tools/objc:ios_runner.sh.mac_template")))
-        .add(attr("$is_executable", BOOLEAN).value(true)
-            .nonconfigurable("Called from RunCommand.isExecutable, which takes a Target"))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_binary")
-        .factoryClass(ObjcBinary.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.LinkingRule.class,
-            ObjcRuleClasses.XcodegenRule.class, ObjcRuleClasses.ReleaseBundlingRule.class,
-            ObjcRuleClasses.SimulatorRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_binary, TYPE = BINARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule produces one or more Objective-C libraries for bundling in an
-<code>ios_application</code>.</p>
-
-<p>Any application-related attributes (infoplist, app_icon, ...) on this rule are deprecated and
-you should define them on <code>ios_application</code> instead. They will be removed from
-<code>objc_binary</code> soon.</p>
-
-<p>Until the migration to <code>ios_application</code> is complete, this rule requires at least one
-source file to be defined in either <code>srcs</code> or <code>non_arc_srcs</code></p>.
-
-${IMPLICIT_OUTPUTS}
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBuildInfoFactory.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBuildInfoFactory.java
deleted file mode 100644
index eaf7678..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBuildInfoFactory.java
+++ /dev/null
@@ -1,52 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Action;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.buildinfo.BuildInfoCollection;
-import com.google.devtools.build.lib.analysis.buildinfo.BuildInfoFactory;
-import com.google.devtools.build.lib.analysis.config.BuildConfiguration;
-
-/**
- * Objc build info creation - passes on BuildInfo output file for consumption from Objc rules.
- */
-public class ObjcBuildInfoFactory implements BuildInfoFactory {
-
-  public static final BuildInfoKey KEY = new BuildInfoKey("ObjC");
-
-  /**
-   * Returns no actions, exactly the one BuildInfo artifact, and no buildChangelist artifacts.
-   */
-  @Override
-  public BuildInfoCollection create(BuildInfoContext context, BuildConfiguration config,
-      Artifact buildInfo, Artifact buildChangelist) {
-    return new BuildInfoCollection(
-        ImmutableList.<Action>of(),
-        ImmutableList.of(buildInfo),
-        ImmutableList.of(buildInfo));
-  }
-
-  @Override
-  public BuildInfoKey getKey() {
-    return KEY;
-  }
-
-  @Override
-  public boolean isEnabled(BuildConfiguration config) {
-    return config.hasFragment(ObjcConfiguration.class);
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundle.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundle.java
deleted file mode 100644
index 6585cba..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundle.java
+++ /dev/null
@@ -1,51 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.collect.nestedset.Order.STABLE_ORDER;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-
-/**
- * Implementation for {@code objc_bundle}.
- */
-public class ObjcBundle implements RuleConfiguredTargetFactory {
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    ObjcCommon common = new ObjcCommon.Builder(ruleContext).build();
-
-    ImmutableList<Artifact> bundleImports = ruleContext
-        .getPrerequisiteArtifacts("bundle_imports", Mode.TARGET).list();
-    Iterable<String> bundleImportErrors =
-        ObjcCommon.notInContainerErrors(bundleImports, ObjcCommon.BUNDLE_CONTAINER_TYPE);
-    for (String error : bundleImportErrors) {
-      ruleContext.attributeError("bundle_imports", error);
-    }
-
-    return common.configuredTarget(
-        /*filesToBuild=*/NestedSetBuilder.<Artifact>emptySet(STABLE_ORDER),
-        Optional.<XcodeProvider>absent(),
-        Optional.of(common.getObjcProvider()),
-        Optional.<XcTestAppProvider>absent(),
-        Optional.<J2ObjcSrcsProvider>absent());
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibrary.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibrary.java
deleted file mode 100644
index 7e4c48c..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibrary.java
+++ /dev/null
@@ -1,105 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.NESTED_BUNDLE;
-import static com.google.devtools.build.lib.rules.objc.XcodeProductType.BUNDLE;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableSet;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.ResourceAttributes;
-
-/**
- * Implementation for {@code objc_bundle_library}.
- */
-public class ObjcBundleLibrary implements RuleConfiguredTargetFactory {
-
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    ObjcCommon common = common(ruleContext);
-    OptionsProvider optionsProvider = optionsProvider(ruleContext);
-
-    Bundling bundling = bundling(ruleContext, common, optionsProvider);
-
-    XcodeProvider.Builder xcodeProviderBuilder = new XcodeProvider.Builder();
-    NestedSetBuilder<Artifact> filesToBuild = NestedSetBuilder.stableOrder();
-    
-    // TODO(bazel-team): Figure out if the target device is important, and what to set it to. It may
-    // have to inherit this from the binary being built. As of this writing, this is only used for
-    // asset catalogs compilation (actool).
-    new BundleSupport(ruleContext, ImmutableSet.of(TargetDeviceFamily.IPHONE), bundling)
-        .registerActions(common.getObjcProvider())
-        .validateResources(common.getObjcProvider())
-        .addXcodeSettings(xcodeProviderBuilder);
-
-    new ResourceSupport(ruleContext)
-        .validateAttributes()
-        .addXcodeSettings(xcodeProviderBuilder);
-
-    new XcodeSupport(ruleContext)
-        .addFilesToBuild(filesToBuild)
-        .addXcodeSettings(xcodeProviderBuilder, common.getObjcProvider(), BUNDLE)
-        .addDependencies(xcodeProviderBuilder, new Attribute("bundles", Mode.TARGET))
-        .registerActions(xcodeProviderBuilder.build());
-
-    ObjcProvider nestedBundleProvider = new ObjcProvider.Builder()
-        .add(NESTED_BUNDLE, bundling)
-        .build();
-
-    return common.configuredTarget(
-        filesToBuild.build(),
-        Optional.of(xcodeProviderBuilder.build()),
-        Optional.of(nestedBundleProvider),
-        Optional.<XcTestAppProvider>absent(),
-        Optional.<J2ObjcSrcsProvider>absent());
-  }
-
-  private OptionsProvider optionsProvider(RuleContext ruleContext) {
-    return new OptionsProvider.Builder()
-        .addInfoplists(ruleContext.getPrerequisiteArtifacts("infoplist", Mode.TARGET).list())
-        .build();
-  }
-
-  private Bundling bundling(
-      RuleContext ruleContext, ObjcCommon common, OptionsProvider optionsProvider) {
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    return new Bundling.Builder()
-        .setName(ruleContext.getLabel().getName())
-        .setArchitecture(ObjcRuleClasses.objcConfiguration(ruleContext).getIosCpu())
-        .setBundleDirFormat("%s.bundle")
-        .setObjcProvider(common.getObjcProvider())
-        .setInfoplistMerging(
-            BundleSupport.infoPlistMerging(ruleContext, common.getObjcProvider(), optionsProvider,
-                new BundleSupport.ExtraMergePlists()))
-        .setIntermediateArtifacts(intermediateArtifacts)
-        .build();
-  }
-
-  private ObjcCommon common(RuleContext ruleContext) {
-    return new ObjcCommon.Builder(ruleContext)
-        .setResourceAttributes(new ResourceAttributes(ruleContext))
-        .addDepObjcProviders(
-            ruleContext.getPrerequisites("bundles", Mode.TARGET, ObjcProvider.class))
-        .setIntermediateArtifacts(ObjcRuleClasses.intermediateArtifacts(ruleContext))
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibraryRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibraryRule.java
deleted file mode 100644
index 48df49c..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleLibraryRule.java
+++ /dev/null
@@ -1,61 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for objc_bundle_library.
- */
-public class ObjcBundleLibraryRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(objc_bundle_library).IMPLICIT_OUTPUTS -->
-        <ul>
-         <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: An Xcode project file which
-         can be used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(XcodeSupport.PBXPROJ)
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_bundle_library")
-        .factoryClass(ObjcBundleLibrary.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.ResourcesRule.class,
-            ObjcRuleClasses.BundlingRule.class, ObjcRuleClasses.XcodegenRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_bundle_library, TYPE = LIBRARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule encapsulates a library which is provided to dependers as a bundle.
-A <code>objc_bundle_library</code>'s resources are put in a nested bundle in
-the final iOS application.
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleRule.java
deleted file mode 100644
index fffa2d8..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcBundleRule.java
+++ /dev/null
@@ -1,64 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.LABEL_LIST;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-import com.google.devtools.build.lib.util.FileTypeSet;
-
-/**
- * Rule definition for objc_bundle.
- */
-public class ObjcBundleRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment environment) {
-    return builder
-        /* <!-- #BLAZE_RULE(objc_bundle).ATTRIBUTE(bundle_imports) -->
-        The list of files under a <code>.bundle</code> directory which are
-        provided to Objective-C targets that depend on this target.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE --> */
-        .add(attr("bundle_imports", LABEL_LIST)
-            .allowedFileTypes(FileTypeSet.ANY_FILE)
-            .nonEmpty())
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_bundle")
-        .factoryClass(ObjcBundle.class)
-        .ancestors(BaseRuleClasses.BaseRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_bundle, TYPE = LIBRARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule encapsulates an already-built bundle. It is defined by a list of
-files in one or more <code>.bundle</code> directories.
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommandLineOptions.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommandLineOptions.java
deleted file mode 100644
index b835e7a..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommandLineOptions.java
+++ /dev/null
@@ -1,157 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Multimap;
-import com.google.devtools.build.lib.analysis.config.BuildConfiguration.LabelConverter;
-import com.google.devtools.build.lib.analysis.config.BuildOptions;
-import com.google.devtools.build.lib.analysis.config.FragmentOptions;
-import com.google.devtools.build.lib.packages.Attribute.SplitTransition;
-import com.google.devtools.build.lib.syntax.Label;
-import com.google.devtools.common.options.Converters.CommaSeparatedOptionListConverter;
-import com.google.devtools.common.options.Option;
-
-import java.util.List;
-
-/**
- * Command-line options for building Objective-C targets.
- */
-public class ObjcCommandLineOptions extends FragmentOptions {
-  @Option(name = "ios_sdk_version",
-      defaultValue = DEFAULT_SDK_VERSION,
-      category = "build",
-      help = "Specifies the version of the iOS SDK to use to build iOS applications."
-      )
-  public String iosSdkVersion;
-
-  @VisibleForTesting static final String DEFAULT_SDK_VERSION = "8.1";
-
-  @Option(name = "ios_simulator_version",
-      defaultValue = "7.1",
-      category = "run",
-      help = "The version of iOS to run on the simulator when running or testing. This is ignored "
-          + "for ios_test rules if a target device is specified in the rule.")
-  public String iosSimulatorVersion;
-
-  @Option(name = "ios_simulator_device",
-      defaultValue = "iPhone 5s",
-      category = "run",
-      help = "The device to simulate when running an iOS application in the simulator, e.g. "
-          + "'iPhone 6'. You can get a list of devices by running 'xcrun simctl list devicetypes' "
-          + "on the machine the simulator will be run on.")
-  public String iosSimulatorDevice;
-
-  @Option(name = "ios_cpu",
-      defaultValue = DEFAULT_IOS_CPU,
-      category = "build",
-      help = "Specifies to target CPU of iOS compilation.")
-  public String iosCpu;
-
-  @Option(name = "xcode_options",
-      defaultValue = "Debug",
-      category = "undocumented",
-      help = "Specifies the name of the build settings to use.")
-  // TODO(danielwh): Do literally anything with this flag. Ideally, pass it to xcodegen via a
-  // control proto.
-  public String xcodeOptions;
-
-  @Option(name = "objc_generate_debug_symbols",
-      defaultValue = "false",
-      category = "undocumented",
-      help = "Specifies whether to generate debug symbol(.dSYM) file.")
-  public boolean generateDebugSymbols;
-
-  @Option(name = "objccopt",
-      allowMultiple = true,
-      defaultValue = "",
-      category = "flags",
-      help = "Additional options to pass to Objective C compilation.")
-  public List<String> copts;
-
-  @Option(name = "ios_minimum_os",
-      defaultValue = DEFAULT_MINIMUM_IOS,
-      category = "flags",
-      help = "Minimum compatible iOS version for target simulators and devices.")
-  public String iosMinimumOs;
-
-  @Option(name = "ios_memleaks",
-      defaultValue =  "false",
-      category = "misc",
-      help = "Enable checking for memory leaks in ios_test targets.")
-  public boolean runMemleaks;
-
-  @Option(name = "ios_multi_cpus",
-      converter = CommaSeparatedOptionListConverter.class,
-      defaultValue = "",
-      category = "flags",
-      help = "Comma-separated list of architectures to build an ios_application with. The result "
-          + "is a universal binary containing all specified architectures.")
-  public List<String> iosMultiCpus;
-
-  @Option(name = "ios_split_cpu",
-      defaultValue = "",
-      category = "undocumented",
-      help =
-          "Don't set this value from the command line - it is derived from  ios_multi_cpus only.")
-  public String iosSplitCpu;
-
-  @Option(name = "objc_dump_syms_binary",
-      defaultValue = "//tools/objc:dump_syms",
-      category = "undocumented",
-      converter = LabelConverter.class)
-  public Label dumpSyms;
-
-  @Option(name = "default_ios_provisiong_profile",
-      defaultValue = "//tools/objc:default_provisioning_profile",
-      category = "undocumented",
-      converter = LabelConverter.class)
-  public Label defaultProvisioningProfile;
-
-  @Option(name = "objc_per_proto_includes",
-      defaultValue = "true",
-      category = "undocumented",
-      help = "Whether to add include path entries for every individual proto file.")
-  public boolean perProtoIncludes;
-
-  @VisibleForTesting static final String DEFAULT_MINIMUM_IOS = "7.0";
-  @VisibleForTesting static final String DEFAULT_IOS_CPU = "i386";
-
-  @Override
-  public void addAllLabels(Multimap<String, Label> labelMap) {
-    if (generateDebugSymbols) {
-      labelMap.put("dump_syms", dumpSyms);
-    }
-
-    if (getPlatform() == Platform.DEVICE) {
-      labelMap.put("default_provisioning_profile", defaultProvisioningProfile);
-    }
-  }
-
-  private Platform getPlatform() {
-    for (String architecture : iosMultiCpus) {
-      if (Platform.forArch(architecture) == Platform.DEVICE) {
-        return Platform.DEVICE;
-      }
-    }
-    return Platform.forArch(iosCpu);
-  }
-
-  @Override
-  public List<SplitTransition<BuildOptions>> getPotentialSplitTransitions() {
-    return ImmutableList.of(ReleaseBundlingSupport.SPLIT_ARCH_TRANSITION);
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommon.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommon.java
deleted file mode 100644
index c485cd6..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcCommon.java
+++ /dev/null
@@ -1,626 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.ASSET_CATALOG;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.BUNDLE_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.BUNDLE_IMPORT_DIR;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.DEFINE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FLAG;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FORCE_LOAD_FOR_XCODEGEN;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FORCE_LOAD_LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FRAMEWORK_DIR;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FRAMEWORK_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.Flag.USES_CPP;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.GCNO;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.GENERAL_RESOURCE_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.HEADER;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.IMPORTED_LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.INCLUDE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.INSTRUMENTED_SOURCE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.LINKED_BINARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.SDK_DYLIB;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.SDK_FRAMEWORK;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.SOURCE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.STORYBOARD;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.STRINGS;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.WEAK_SDK_FRAMEWORK;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XCASSETS_DIR;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XCDATAMODEL;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XIB;
-import static com.google.devtools.build.lib.vfs.PathFragment.TO_PATH_FRAGMENT;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.base.Predicates;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.Runfiles;
-import com.google.devtools.build.lib.analysis.RunfilesProvider;
-import com.google.devtools.build.lib.analysis.config.BuildConfiguration;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.rules.cpp.CcCommon;
-import com.google.devtools.build.lib.util.FileType;
-import com.google.devtools.build.lib.util.RegexFilter;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-import java.util.HashSet;
-import java.util.List;
-import java.util.Set;
-
-/**
- * Contains information common to multiple objc_* rules, and provides a unified API for extracting
- * and accessing it.
- */
-// TODO(bazel-team): Decompose and subsume area-specific logic and data into the various *Support
-// classes. Make sure to distinguish rule output (providers, runfiles, ...) from intermediate,
-// rule-internal information. Any provider created by a rule should not be read, only published.
-public final class ObjcCommon {
-  /**
-   * Provides a way to access attributes that are common to all compilation rules.
-   */
-  // TODO(bazel-team): Delete and move into support-specific attributes classes once ObjcCommon is
-  // gone.
-  static final class CompilationAttributes {
-    private final RuleContext ruleContext;
-    private final ObjcSdkFrameworks.Attributes sdkFrameworkAttributes;
-
-    CompilationAttributes(RuleContext ruleContext) {
-      this.ruleContext = Preconditions.checkNotNull(ruleContext);
-      this.sdkFrameworkAttributes = new ObjcSdkFrameworks.Attributes(ruleContext);
-    }
-
-    ImmutableList<Artifact> hdrs() {
-      return ImmutableList.copyOf(CcCommon.getHeaders(ruleContext));
-    }
-
-    Iterable<PathFragment> includes() {
-      return Iterables.transform(
-          ruleContext.attributes().get("includes", Type.STRING_LIST),
-          PathFragment.TO_PATH_FRAGMENT);
-    }
-
-    Iterable<PathFragment> sdkIncludes() {
-      return Iterables.transform(
-          ruleContext.attributes().get("sdk_includes", Type.STRING_LIST),
-          PathFragment.TO_PATH_FRAGMENT);
-    }
-
-    /**
-     * Returns the value of the sdk_frameworks attribute plus frameworks that are included
-     * automatically.
-     */
-    ImmutableSet<SdkFramework> sdkFrameworks() {
-      return sdkFrameworkAttributes.sdkFrameworks();
-    }
-
-    /**
-     * Returns the value of the weak_sdk_frameworks attribute.
-     */
-    ImmutableSet<SdkFramework> weakSdkFrameworks() {
-      return sdkFrameworkAttributes.weakSdkFrameworks();
-    }
-
-    /**
-     * Returns the value of the sdk_dylibs attribute.
-     */
-    ImmutableSet<String> sdkDylibs() {
-      return sdkFrameworkAttributes.sdkDylibs();
-    }
-
-    /**
-     * Returns the exec paths of all header search paths that should be added to this target and
-     * dependers on this target, obtained from the {@code includes} attribute.
-     */
-    ImmutableList<PathFragment> headerSearchPaths() {
-      ImmutableList.Builder<PathFragment> paths = new ImmutableList.Builder<>();
-      PathFragment packageFragment = ruleContext.getLabel().getPackageFragment();
-      List<PathFragment> rootFragments = ImmutableList.of(
-          packageFragment,
-          ruleContext.getConfiguration().getGenfilesFragment().getRelative(packageFragment));
-
-      Iterable<PathFragment> relativeIncludes =
-          Iterables.filter(includes(), Predicates.not(PathFragment.IS_ABSOLUTE));
-      for (PathFragment include : relativeIncludes) {
-        for (PathFragment rootFragment : rootFragments) {
-          paths.add(rootFragment.getRelative(include).normalize());
-        }
-      }
-      return paths.build();
-    }
-  }
-
-  /**
-   * Provides a way to access attributes that are common to all resources rules.
-   */
-  // TODO(bazel-team): Delete and move into support-specific attributes classes once ObjcCommon is
-  // gone.
-  static final class ResourceAttributes {
-    private final RuleContext ruleContext;
-
-    ResourceAttributes(RuleContext ruleContext) {
-      this.ruleContext = ruleContext;
-    }
-
-    ImmutableList<Artifact> strings() {
-      return ruleContext.getPrerequisiteArtifacts("strings", Mode.TARGET).list();
-    }
-
-    ImmutableList<Artifact> xibs() {
-      return ruleContext.getPrerequisiteArtifacts("xibs", Mode.TARGET)
-          .errorsForNonMatching(ObjcRuleClasses.XIB_TYPE)
-          .list();
-    }
-
-    ImmutableList<Artifact> storyboards() {
-      return ruleContext.getPrerequisiteArtifacts("storyboards", Mode.TARGET).list();
-    }
-
-    ImmutableList<Artifact> resources() {
-      return ruleContext.getPrerequisiteArtifacts("resources", Mode.TARGET).list();
-    }
-
-    ImmutableList<Artifact> structuredResources() {
-      return ruleContext.getPrerequisiteArtifacts("structured_resources", Mode.TARGET).list();
-    }
-
-    ImmutableList<Artifact> datamodels() {
-      return ruleContext.getPrerequisiteArtifacts("datamodels", Mode.TARGET).list();
-    }
-
-    ImmutableList<Artifact> assetCatalogs() {
-      return ruleContext.getPrerequisiteArtifacts("asset_catalogs", Mode.TARGET).list();
-    }
-  }
-
-  static class Builder {
-    private RuleContext context;
-    private Optional<CompilationAttributes> compilationAttributes = Optional.absent();
-    private Optional<ResourceAttributes> resourceAttributes = Optional.absent();
-    private Iterable<SdkFramework> extraSdkFrameworks = ImmutableList.of();
-    private Iterable<SdkFramework> extraWeakSdkFrameworks = ImmutableList.of();
-    private Iterable<String> extraSdkDylibs = ImmutableList.of();
-    private Iterable<Artifact> frameworkImports = ImmutableList.of();
-    private Optional<CompilationArtifacts> compilationArtifacts = Optional.absent();
-    private Iterable<ObjcProvider> depObjcProviders = ImmutableList.of();
-    private Iterable<ObjcProvider> directDepObjcProviders = ImmutableList.of();
-    private Iterable<String> defines = ImmutableList.of();
-    private Iterable<PathFragment> userHeaderSearchPaths = ImmutableList.of();
-    private Iterable<Artifact> headers = ImmutableList.of();
-    private IntermediateArtifacts intermediateArtifacts;
-    private boolean alwayslink;
-    private Iterable<Artifact> extraImportLibraries = ImmutableList.of();
-    private Optional<Artifact> linkedBinary = Optional.absent();
-
-    Builder(RuleContext context) {
-      this.context = Preconditions.checkNotNull(context);
-    }
-
-    public Builder setCompilationAttributes(CompilationAttributes baseCompilationAttributes) {
-      Preconditions.checkState(!this.compilationAttributes.isPresent(),
-          "compilationAttributes is already set to: %s", this.compilationAttributes);
-      this.compilationAttributes = Optional.of(baseCompilationAttributes);
-      return this;
-    }
-
-    public Builder setResourceAttributes(ResourceAttributes baseResourceAttributes) {
-      Preconditions.checkState(!this.resourceAttributes.isPresent(),
-          "resourceAttributes is already set to: %s", this.resourceAttributes);
-      this.resourceAttributes = Optional.of(baseResourceAttributes);
-      return this;
-    }
-
-    Builder addExtraSdkFrameworks(Iterable<SdkFramework> extraSdkFrameworks) {
-      this.extraSdkFrameworks = Iterables.concat(this.extraSdkFrameworks, extraSdkFrameworks);
-      return this;
-    }
-
-    Builder addExtraWeakSdkFrameworks(Iterable<SdkFramework> extraWeakSdkFrameworks) {
-      this.extraWeakSdkFrameworks =
-          Iterables.concat(this.extraWeakSdkFrameworks, extraWeakSdkFrameworks);
-      return this;
-    }
-
-    Builder addExtraSdkDylibs(Iterable<String> extraSdkDylibs) {
-      this.extraSdkDylibs = Iterables.concat(this.extraSdkDylibs, extraSdkDylibs);
-      return this;
-    }
-
-    Builder addFrameworkImports(Iterable<Artifact> frameworkImports) {
-      this.frameworkImports = Iterables.concat(this.frameworkImports, frameworkImports);
-      return this;
-    }
-
-    Builder setCompilationArtifacts(CompilationArtifacts compilationArtifacts) {
-      Preconditions.checkState(!this.compilationArtifacts.isPresent(),
-          "compilationArtifacts is already set to: %s", this.compilationArtifacts);
-      this.compilationArtifacts = Optional.of(compilationArtifacts);
-      return this;
-    }
-
-    /**
-     * Add providers which will be exposed both to the declaring rule and to any dependers on the
-     * declaring rule.
-     */
-    Builder addDepObjcProviders(Iterable<ObjcProvider> depObjcProviders) {
-      this.depObjcProviders = Iterables.concat(this.depObjcProviders, depObjcProviders);
-      return this;
-    }
-
-    /**
-     * Add providers which will only be used by the declaring rule, and won't be propagated to any
-     * dependers on the declaring rule.
-     */
-    Builder addNonPropagatedDepObjcProviders(Iterable<ObjcProvider> directDepObjcProviders) {
-      this.directDepObjcProviders = Iterables.concat(
-          this.directDepObjcProviders, directDepObjcProviders);
-      return this;
-    }
-
-    public Builder addUserHeaderSearchPaths(Iterable<PathFragment> userHeaderSearchPaths) {
-      this.userHeaderSearchPaths =
-          Iterables.concat(this.userHeaderSearchPaths, userHeaderSearchPaths);
-      return this;
-    }
-
-    public Builder addDefines(Iterable<String> defines) {
-      this.defines = Iterables.concat(this.defines, defines);
-      return this;
-    }
-
-    public Builder addHeaders(Iterable<Artifact> headers) {
-      this.headers = Iterables.concat(this.headers, headers);
-      return this;
-    }
-
-    Builder setIntermediateArtifacts(IntermediateArtifacts intermediateArtifacts) {
-      this.intermediateArtifacts = intermediateArtifacts;
-      return this;
-    }
-
-    Builder setAlwayslink(boolean alwayslink) {
-      this.alwayslink = alwayslink;
-      return this;
-    }
-
-    /**
-     * Adds additional static libraries to be linked into the final ObjC application bundle.
-     */
-    Builder addExtraImportLibraries(Iterable<Artifact> extraImportLibraries) {
-      this.extraImportLibraries = Iterables.concat(this.extraImportLibraries, extraImportLibraries);
-      return this;
-    }
-
-    /**
-     * Sets a linked binary generated by this rule to be propagated to dependers.
-     */
-    Builder setLinkedBinary(Artifact linkedBinary) {
-      this.linkedBinary = Optional.of(linkedBinary);
-      return this;
-    }
-
-    ObjcCommon build() {
-      Iterable<BundleableFile> bundleImports = BundleableFile.bundleImportsFromRule(context);
-
-      ObjcProvider.Builder objcProvider = new ObjcProvider.Builder()
-          .addAll(IMPORTED_LIBRARY, extraImportLibraries)
-          .addAll(BUNDLE_FILE, bundleImports)
-          .addAll(BUNDLE_IMPORT_DIR,
-              uniqueContainers(BundleableFile.toArtifacts(bundleImports), BUNDLE_CONTAINER_TYPE))
-          .addAll(SDK_FRAMEWORK, extraSdkFrameworks)
-          .addAll(WEAK_SDK_FRAMEWORK, extraWeakSdkFrameworks)
-          .addAll(SDK_DYLIB, extraSdkDylibs)
-          .addAll(FRAMEWORK_FILE, frameworkImports)
-          .addAll(FRAMEWORK_DIR, uniqueContainers(frameworkImports, FRAMEWORK_CONTAINER_TYPE))
-          .addAll(INCLUDE, userHeaderSearchPaths)
-          .addAll(DEFINE, defines)
-          .addAll(HEADER, headers)
-          .addTransitiveAndPropagate(depObjcProviders)
-          .addTransitiveWithoutPropagating(directDepObjcProviders);
-
-      if (compilationAttributes.isPresent()) {
-        CompilationAttributes attributes = compilationAttributes.get();
-        ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(context);
-        Iterable<PathFragment> sdkIncludes = Iterables.transform(
-            Interspersing.prependEach(
-                IosSdkCommands.sdkDir(objcConfiguration) + "/usr/include/",
-                PathFragment.safePathStrings(attributes.sdkIncludes())),
-            TO_PATH_FRAGMENT);
-        objcProvider
-            .addAll(HEADER, attributes.hdrs())
-            .addAll(INCLUDE, attributes.headerSearchPaths())
-            .addAll(INCLUDE, sdkIncludes)
-            .addAll(SDK_FRAMEWORK, attributes.sdkFrameworks())
-            .addAll(WEAK_SDK_FRAMEWORK, attributes.weakSdkFrameworks())
-            .addAll(SDK_DYLIB, attributes.sdkDylibs());
-      } 
-      
-      if (resourceAttributes.isPresent()) {
-        ResourceAttributes attributes = resourceAttributes.get();
-        objcProvider
-            .addAll(GENERAL_RESOURCE_FILE, attributes.storyboards())
-            .addAll(GENERAL_RESOURCE_FILE, attributes.resources())
-            .addAll(GENERAL_RESOURCE_FILE, attributes.strings())
-            .addAll(GENERAL_RESOURCE_FILE, attributes.xibs())
-            .addAll(BUNDLE_FILE, BundleableFile.flattenedRawResourceFiles(attributes.resources()))
-            .addAll(BUNDLE_FILE,
-                BundleableFile.structuredRawResourceFiles(attributes.structuredResources()))
-            .addAll(XCASSETS_DIR,
-                uniqueContainers(attributes.assetCatalogs(), ASSET_CATALOG_CONTAINER_TYPE))
-            .addAll(ASSET_CATALOG, attributes.assetCatalogs())
-            .addAll(XCDATAMODEL, attributes.datamodels())
-            .addAll(XIB, attributes.xibs())
-            .addAll(STRINGS, attributes.strings())
-            .addAll(STORYBOARD, attributes.storyboards());
-      }
-
-      for (CompilationArtifacts artifacts : compilationArtifacts.asSet()) {
-        Iterable<Artifact> allSources =
-            Iterables.concat(artifacts.getSrcs(), artifacts.getNonArcSrcs());
-        objcProvider.addAll(LIBRARY, artifacts.getArchive().asSet());
-        objcProvider.addAll(SOURCE, allSources);
-        BuildConfiguration configuration = context.getConfiguration();
-        RegexFilter filter = configuration.getInstrumentationFilter();
-        if (configuration.isCodeCoverageEnabled()
-            && filter.isIncluded(context.getLabel().toString())) {
-          for (Artifact source : allSources) {
-            objcProvider.add(INSTRUMENTED_SOURCE, source);
-            objcProvider.add(GCNO, intermediateArtifacts.gcnoFile(source));
-          }
-        }
-
-        boolean usesCpp = false;
-        for (Artifact sourceFile :
-            Iterables.concat(artifacts.getSrcs(), artifacts.getNonArcSrcs())) {
-          usesCpp = usesCpp || ObjcRuleClasses.CPP_SOURCES.matches(sourceFile.getExecPath());
-        }
-        if (usesCpp) {
-          objcProvider.add(FLAG, USES_CPP);
-        }
-      }
-
-      if (alwayslink) {
-        for (CompilationArtifacts artifacts : compilationArtifacts.asSet()) {
-          for (Artifact archive : artifacts.getArchive().asSet()) {
-            objcProvider.add(FORCE_LOAD_LIBRARY, archive);
-            objcProvider.add(FORCE_LOAD_FOR_XCODEGEN, String.format(
-                "$(BUILT_PRODUCTS_DIR)/lib%s.a",
-                XcodeProvider.xcodeTargetName(context.getLabel())));
-          }
-        }
-        for (Artifact archive : extraImportLibraries) {
-          objcProvider.add(FORCE_LOAD_LIBRARY, archive);
-          objcProvider.add(FORCE_LOAD_FOR_XCODEGEN,
-              "$(WORKSPACE_ROOT)/" + archive.getExecPath().getSafePathString());
-        }
-      }
-
-      objcProvider.addAll(LINKED_BINARY, linkedBinary.asSet());
-
-      return new ObjcCommon(context, objcProvider.build(), compilationArtifacts);
-    }
-
-  }
-
-  static final FileType BUNDLE_CONTAINER_TYPE = FileType.of(".bundle");
-
-  static final FileType ASSET_CATALOG_CONTAINER_TYPE = FileType.of(".xcassets");
-
-  static final FileType FRAMEWORK_CONTAINER_TYPE = FileType.of(".framework");
-  private final RuleContext context;
-  private final ObjcProvider objcProvider;
-
-  private final Optional<CompilationArtifacts> compilationArtifacts;
-
-  private ObjcCommon(
-      RuleContext context,
-      ObjcProvider objcProvider,
-      Optional<CompilationArtifacts> compilationArtifacts) {
-    this.context = Preconditions.checkNotNull(context);
-    this.objcProvider = Preconditions.checkNotNull(objcProvider);
-    this.compilationArtifacts = Preconditions.checkNotNull(compilationArtifacts);
-  }
-
-  public ObjcProvider getObjcProvider() {
-    return objcProvider;
-  }
-
-  public Optional<CompilationArtifacts> getCompilationArtifacts() {
-    return compilationArtifacts;
-  }
-
-  /**
-   * Returns an {@link Optional} containing the compiled {@code .a} file, or
-   * {@link Optional#absent()} if this object contains no {@link CompilationArtifacts} or the
-   * compilation information has no sources.
-   */
-  public Optional<Artifact> getCompiledArchive() {
-    for (CompilationArtifacts justCompilationArtifacts : compilationArtifacts.asSet()) {
-      return justCompilationArtifacts.getArchive();
-    }
-    return Optional.absent();
-  }
-
-  /**
-   * Reports any known errors to the {@link RuleContext}. This should be called exactly once for
-   * a target.
-   */
-  public void reportErrors() {
-
-    // TODO(bazel-team): Report errors for rules that are not actually useful (i.e. objc_library
-    // without sources or resources, empty objc_bundles)
-  }
-
-  static ImmutableList<PathFragment> userHeaderSearchPaths(BuildConfiguration configuration) {
-    return ImmutableList.of(
-        new PathFragment("."),
-        configuration.getGenfilesFragment());
-  }
-
-  /**
-   * Returns the first directory in the sequence of parents of the exec path of the given artifact
-   * that matches {@code type}. For instance, if {@code type} is FileType.of(".foo") and the exec
-   * path of {@code artifact} is {@code a/b/c/bar.foo/d/e}, then the return value is
-   * {@code a/b/c/bar.foo}.
-   */
-  static Optional<PathFragment> nearestContainerMatching(FileType type, Artifact artifact) {
-    PathFragment container = artifact.getExecPath();
-    do {
-      if (type.matches(container)) {
-        return Optional.of(container);
-      }
-      container = container.getParentDirectory();
-    } while (container != null);
-    return Optional.absent();
-  }
-
-  /**
-   * Similar to {@link #nearestContainerMatching(FileType, Artifact)}, but tries matching several
-   * file types in {@code types}, and returns a path for the first match in the sequence.
-   */
-  static Optional<PathFragment> nearestContainerMatching(
-      Iterable<FileType> types, Artifact artifact) {
-    for (FileType type : types) {
-      for (PathFragment container : nearestContainerMatching(type, artifact).asSet()) {
-        return Optional.of(container);
-      }
-    }
-    return Optional.absent();
-  }
-
-  /**
-   * Returns all directories matching {@code containerType} that contain the items in
-   * {@code artifacts}. This function ignores artifacts that are not in any directory matching
-   * {@code containerType}.
-   */
-  static Iterable<PathFragment> uniqueContainers(
-      Iterable<Artifact> artifacts, FileType containerType) {
-    ImmutableSet.Builder<PathFragment> containers = new ImmutableSet.Builder<>();
-    for (Artifact artifact : artifacts) {
-      containers.addAll(ObjcCommon.nearestContainerMatching(containerType, artifact).asSet());
-    }
-    return containers.build();
-  }
-
-  /**
-   * Similar to {@link #nearestContainerMatching(FileType, Artifact)}, but returns the container
-   * closest to the root that matches the given type.
-   */
-  static Optional<PathFragment> farthestContainerMatching(FileType type, Artifact artifact) {
-    PathFragment container = artifact.getExecPath();
-    Optional<PathFragment> lastMatch = Optional.absent();
-    do {
-      if (type.matches(container)) {
-        lastMatch = Optional.of(container);
-      }
-      container = container.getParentDirectory();
-    } while (container != null);
-    return lastMatch;
-  }
-
-  static Iterable<String> notInContainerErrors(
-      Iterable<Artifact> artifacts, FileType containerType) {
-    return notInContainerErrors(artifacts, ImmutableList.of(containerType));
-  }
-
-  @VisibleForTesting
-  static final String NOT_IN_CONTAINER_ERROR_FORMAT =
-      "File '%s' is not in a directory of one of these type(s): %s";
-
-  static Iterable<String> notInContainerErrors(
-      Iterable<Artifact> artifacts, Iterable<FileType> containerTypes) {
-    Set<String> errors = new HashSet<>();
-    for (Artifact artifact : artifacts) {
-      boolean inContainer = nearestContainerMatching(containerTypes, artifact).isPresent();
-      if (!inContainer) {
-        errors.add(String.format(NOT_IN_CONTAINER_ERROR_FORMAT,
-            artifact.getExecPath(), Iterables.toString(containerTypes)));
-      }
-    }
-    return errors;
-  }
-
-  /**
-   * Returns a {@link RuleConfiguredTargetBuilder}.
-   *
-   * @param filesToBuild files to build for this target. These also become the data runfiles. Note
-   *     that this method may add more files to create the complete list of files to build for this
-   *     target.
-   * @param maybeTargetProvider the provider for this target.
-   * @param maybeExportedProvider the {@link ObjcProvider} for this target. This should generally be
-   *     present whenever {@code objc_} rules may depend on this target.
-   * @param maybeJ2ObjcSrcsProvider the {@link J2ObjcSrcsProvider} for this target.
-   */
-  public RuleConfiguredTargetBuilder configuredTargetBuilder(NestedSet<Artifact> filesToBuild,
-      Optional<XcodeProvider> maybeTargetProvider, Optional<ObjcProvider> maybeExportedProvider,
-      Optional<XcTestAppProvider> maybeXcTestAppProvider,
-      Optional<J2ObjcSrcsProvider> maybeJ2ObjcSrcsProvider) {
-    NestedSet<Artifact> allFilesToBuild = NestedSetBuilder.<Artifact>stableOrder()
-        .addTransitive(filesToBuild)
-        .build();
-
-    RunfilesProvider runfilesProvider = RunfilesProvider.withData(
-        new Runfiles.Builder()
-            .addRunfiles(context, RunfilesProvider.DEFAULT_RUNFILES)
-            .build(),
-        new Runfiles.Builder().addTransitiveArtifacts(allFilesToBuild).build());
-
-    RuleConfiguredTargetBuilder target = new RuleConfiguredTargetBuilder(context)
-        .setFilesToBuild(allFilesToBuild)
-        .add(RunfilesProvider.class, runfilesProvider);
-    for (ObjcProvider exportedProvider : maybeExportedProvider.asSet()) {
-      target.addProvider(ObjcProvider.class, exportedProvider);
-    }
-    for (XcTestAppProvider xcTestAppProvider : maybeXcTestAppProvider.asSet()) {
-      target.addProvider(XcTestAppProvider.class, xcTestAppProvider);
-    }
-    for (XcodeProvider targetProvider : maybeTargetProvider.asSet()) {
-      target.addProvider(XcodeProvider.class, targetProvider);
-    }
-    for (J2ObjcSrcsProvider j2ObjcSrcsProvider : maybeJ2ObjcSrcsProvider.asSet()) {
-      target.addProvider(J2ObjcSrcsProvider.class, j2ObjcSrcsProvider);
-    }
-    return target;
-  }
-
-  /**
-   * Creates a {@link ConfiguredTarget}.
-   *
-   * @param filesToBuild files to build for this target. These also become the data runfiles. Note
-   *     that this method may add more files to create the complete list of files to build for this
-   *     target.
-   * @param maybeTargetProvider the provider for this target.
-   * @param maybeExportedProvider the {@link ObjcProvider} for this target. This should generally be
-   *     present whenever {@code objc_} rules may depend on this target.
-   * @param maybeJ2ObjcSrcsProvider the {@link J2ObjcSrcsProvider} for this target.
-   */
-  public ConfiguredTarget configuredTarget(NestedSet<Artifact> filesToBuild,
-      Optional<XcodeProvider> maybeTargetProvider, Optional<ObjcProvider> maybeExportedProvider,
-      Optional<XcTestAppProvider> maybeXcTestAppProvider,
-      Optional<J2ObjcSrcsProvider> maybeJ2ObjcSrcsProvider) {
-    return configuredTargetBuilder(filesToBuild, maybeTargetProvider, maybeExportedProvider,
-        maybeXcTestAppProvider, maybeJ2ObjcSrcsProvider).build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfiguration.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfiguration.java
deleted file mode 100644
index 6d4310d..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfiguration.java
+++ /dev/null
@@ -1,275 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.analysis.config.BuildConfiguration;
-import com.google.devtools.build.lib.analysis.config.BuildOptions;
-import com.google.devtools.build.lib.analysis.config.CompilationMode;
-import com.google.devtools.build.lib.events.Event;
-import com.google.devtools.build.lib.events.EventHandler;
-import com.google.devtools.build.lib.syntax.Label;
-
-import java.util.List;
-
-import javax.annotation.Nullable;
-
-/**
- * A compiler configuration containing flags required for Objective-C compilation.
- */
-public class ObjcConfiguration extends BuildConfiguration.Fragment {
-  @VisibleForTesting
-  static final ImmutableList<String> DBG_COPTS = ImmutableList.of("-O0", "-DDEBUG=1",
-      "-fstack-protector", "-fstack-protector-all", "-D_GLIBCXX_DEBUG_PEDANTIC", "-D_GLIBCXX_DEBUG",
-      "-D_GLIBCPP_CONCEPT_CHECKS");
-
-  // TODO(bazel-team): Add "-DDEBUG=1" to FASTBUILD_COPTS.
-  @VisibleForTesting
-  static final ImmutableList<String> FASTBUILD_COPTS = ImmutableList.of("-O0");
-
-  @VisibleForTesting
-  static final ImmutableList<String> OPT_COPTS =
-      ImmutableList.of("-Os", "-DNDEBUG=1", "-Wno-unused-variable", "-Winit-self", "-Wno-extra");
-
-  private final String iosSdkVersion;
-  private final String iosMinimumOs;
-  private final String iosSimulatorVersion;
-  private final String iosSimulatorDevice;
-  private final String iosCpu;
-  private final String xcodeOptions;
-  private final boolean generateDebugSymbols;
-  private final boolean runMemleaks;
-  private final List<String> copts;
-  private final CompilationMode compilationMode;
-  private final List<String> iosMultiCpus;
-  private final String iosSplitCpu;
-  private final boolean perProtoIncludes;
-
-  // We only load these labels if the mode which uses them is enabled. That is know as part of the
-  // BuildConfiguration. This label needs to be part of a configuration because only configurations
-  // can conditionally cause loading.
-  // They are referenced from late bound attributes, and if loading wasn't forced in a
-  // configuration, the late bound attribute will fail to be initialized because it hasn't been
-  // loaded.
-  @Nullable private final Label gcovLabel;
-  @Nullable private final Label dumpSymsLabel;
-  @Nullable private final Label defaultProvisioningProfileLabel;
-
-  ObjcConfiguration(ObjcCommandLineOptions objcOptions, BuildConfiguration.Options options) {
-    this.iosSdkVersion = Preconditions.checkNotNull(objcOptions.iosSdkVersion, "iosSdkVersion");
-    this.iosMinimumOs = Preconditions.checkNotNull(objcOptions.iosMinimumOs, "iosMinimumOs");
-    this.iosSimulatorDevice =
-        Preconditions.checkNotNull(objcOptions.iosSimulatorDevice, "iosSimulatorDevice");
-    this.iosSimulatorVersion =
-        Preconditions.checkNotNull(objcOptions.iosSimulatorVersion, "iosSimulatorVersion");
-    this.iosCpu = Preconditions.checkNotNull(objcOptions.iosCpu, "iosCpu");
-    this.xcodeOptions = Preconditions.checkNotNull(objcOptions.xcodeOptions, "xcodeOptions");
-    this.generateDebugSymbols = objcOptions.generateDebugSymbols;
-    this.runMemleaks = objcOptions.runMemleaks;
-    this.copts = ImmutableList.copyOf(objcOptions.copts);
-    this.compilationMode = Preconditions.checkNotNull(options.compilationMode, "compilationMode");
-    this.gcovLabel = options.objcGcovBinary;
-    this.dumpSymsLabel = objcOptions.dumpSyms;
-    this.defaultProvisioningProfileLabel = objcOptions.defaultProvisioningProfile;
-    this.iosMultiCpus = Preconditions.checkNotNull(objcOptions.iosMultiCpus, "iosMultiCpus");
-    this.iosSplitCpu = Preconditions.checkNotNull(objcOptions.iosSplitCpu, "iosSplitCpu");
-    this.perProtoIncludes = objcOptions.perProtoIncludes;
-  }
-
-  public String getIosSdkVersion() {
-    return iosSdkVersion;
-  }
-
-  /**
-   * Returns the minimum iOS version supported by binaries and libraries. Any dependencies on newer
-   * iOS version features or libraries will become weak dependencies which are only loaded if the
-   * runtime OS supports them.
-   */
-  public String getMinimumOs() {
-    return iosMinimumOs;
-  }
-
-  /**
-   * Returns the type of device (e.g. 'iPhone 6') to simulate when running on the simulator.
-   */
-  public String getIosSimulatorDevice() {
-    return iosSimulatorDevice;
-  }
-
-  public String getIosSimulatorVersion() {
-    return iosSimulatorVersion;
-  }
-
-  public String getIosCpu() {
-    return iosCpu;
-  }
-
-  /**
-   * Returns the platform of the configuration for the current bundle, based on configured
-   * architectures (for example, {@code i386} maps to {@link Platform#SIMULATOR}).
-   *
-   * <p>If {@link #getIosMultiCpus()} is set, returns {@link Platform#DEVICE} if any of the
-   * architectures matches it, otherwise returns the mapping for {@link #getIosCpu()}.
-   *
-   * <p>Note that this method should not be used to determine the platform for code compilation.
-   * Derive the platform from {@link #getIosCpu()} instead.
-   */
-  // TODO(bazel-team): This method should be enabled to return multiple values once all call sites
-  // (in particular actool, bundlemerge, momc) have been upgraded to support multiple values.
-  public Platform getBundlingPlatform() {
-    for (String architecture : getIosMultiCpus()) {
-      if (Platform.forArch(architecture) == Platform.DEVICE) {
-        return Platform.DEVICE;
-      }
-    }
-    return Platform.forArch(getIosCpu());
-  }
-
-  public String getXcodeOptions() {
-    return xcodeOptions;
-  }
-
-  public boolean generateDebugSymbols() {
-    return generateDebugSymbols;
-  }
-
-  public boolean runMemleaks() {
-    return runMemleaks;
-  }
-
-  /**
-   * Returns the current compilation mode.
-   */
-  public CompilationMode getCompilationMode() {
-    return compilationMode;
-  }
-
-  /**
-   * Returns the default set of clang options for the current compilation mode.
-   */
-  public List<String> getCoptsForCompilationMode() {
-    switch (compilationMode) {
-      case DBG:
-        return DBG_COPTS;
-      case FASTBUILD:
-        return FASTBUILD_COPTS;
-      case OPT:
-        return OPT_COPTS;
-      default:
-        throw new AssertionError();
-    }
-  }
-
-  /**
-   * Returns options passed to (Apple) clang when compiling Objective C. These options should be
-   * applied after any default options but before options specified in the attributes of the rule.
-   */
-  public List<String> getCopts() {
-    return copts;
-  }
-
-  /**
-   * Returns the label of the gcov binary, used to get test coverage data. Null iff not in coverage
-   * mode.
-   */
-  @Nullable public Label getGcovLabel() {
-    return gcovLabel;
-  }
-
-  /**
-   * Returns the label of the dump_syms binary, used to get debug symbols from a binary. Null iff
-   * !{@link #generateDebugSymbols}.
-   */
-  @Nullable public Label getDumpSymsLabel() {
-    return dumpSymsLabel;
-  }
-
-  /**
-   * Returns the label of the default provisioning profile to use when bundling/signing the
-   * application. Null iff iOS CPU indicates a simulator is being targeted.
-   */
-  @Nullable public Label getDefaultProvisioningProfileLabel() {
-    return defaultProvisioningProfileLabel;
-  }
-
-  /**
-   * List of all CPUs that this invocation is being built for. Different from {@link #getIosCpu()}
-   * which is the specific CPU <b>this target</b> is being built for.
-   */
-  public List<String> getIosMultiCpus() {
-    return iosMultiCpus;
-  }
-
-  /**
-   * Returns the architecture for which we keep dependencies that should be present only once (in a
-   * single architecture).
-   *
-   * <p>When building with multiple architectures there are some dependencies we want to avoid
-   * duplicating: they would show up more than once in the same location in the final application
-   * bundle which is illegal. Instead we pick one architecture for which to keep all dependencies
-   * and discard any others.
-   */
-  public String getDependencySingleArchitecture() {
-    if (!getIosMultiCpus().isEmpty()) {
-      return getIosMultiCpus().get(0);
-    }
-    return getIosCpu();
-  }
-
-  @Override
-  public String getName() {
-    return "Objective-C";
-  }
-
-  @Override
-  public String cacheKey() {
-    return iosSdkVersion;
-  }
-
-  @Nullable
-  @Override
-  public String getOutputDirectoryName() {
-    return !iosSplitCpu.isEmpty() ? "ios-" + iosSplitCpu : null;
-  }
-
-  @Override
-  public void reportInvalidOptions(EventHandler reporter, BuildOptions buildOptions) {
-    if (generateDebugSymbols && !iosMultiCpus.isEmpty()) {
-      reporter.handle(Event.error(
-          "--objc_generate_debug_symbols is not supported when --ios_multi_cpus is set"));
-    }
-
-    // TODO(bazel-team): Remove this constraint once getBundlingPlatform can return multiple values.
-    Platform platform = null;
-    for (String architecture : iosMultiCpus) {
-      if (platform == null) {
-        platform = Platform.forArch(architecture);
-      } else if (platform != Platform.forArch(architecture)) {
-        reporter.handle(Event.error(
-            String.format("--ios_multi_cpus does not currently allow values for both simulator and "
-                + "device builds but was %s", iosMultiCpus)));
-      }
-    }
-  }
-
-  /**
-   * @return whether to add include path entries for every proto file's containing directory.
-   */
-  public boolean perProtoIncludes() {
-    return this.perProtoIncludes;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfigurationLoader.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfigurationLoader.java
deleted file mode 100644
index e877aa6..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcConfigurationLoader.java
+++ /dev/null
@@ -1,42 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.analysis.config.BuildConfiguration;
-import com.google.devtools.build.lib.analysis.config.BuildConfiguration.Options;
-import com.google.devtools.build.lib.analysis.config.BuildOptions;
-import com.google.devtools.build.lib.analysis.config.ConfigurationEnvironment;
-import com.google.devtools.build.lib.analysis.config.ConfigurationFragmentFactory;
-import com.google.devtools.build.lib.analysis.config.InvalidConfigurationException;
-
-/**
- * A loader that creates ObjcConfiguration instances based on Objective-C configurations and
- * command-line options.
- */
-public class ObjcConfigurationLoader implements ConfigurationFragmentFactory {
-  @Override
-  public ObjcConfiguration create(ConfigurationEnvironment env, BuildOptions buildOptions)
-      throws InvalidConfigurationException {
-    Options options = buildOptions.get(BuildConfiguration.Options.class);
-    ObjcCommandLineOptions objcOptions = buildOptions.get(ObjcCommandLineOptions.class);
-
-    return new ObjcConfiguration(objcOptions, options);
-  }
-
-  @Override
-  public Class<? extends BuildConfiguration.Fragment> creates() {
-    return ObjcConfiguration.class;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFramework.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFramework.java
deleted file mode 100644
index c6a0037..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFramework.java
+++ /dev/null
@@ -1,60 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.collect.nestedset.Order.STABLE_ORDER;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.objc.ObjcSdkFrameworks.Attributes;
-
-/**
- * Implementation for the {@code objc_framework} rule.
- */
-public class ObjcFramework implements RuleConfiguredTargetFactory {
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    Attributes sdkFrameworkAttributes = new Attributes(ruleContext);
-
-    ImmutableList<Artifact> frameworkImports =
-        ruleContext.getPrerequisiteArtifacts("framework_imports", Mode.TARGET).list();
-    ObjcCommon common = new ObjcCommon.Builder(ruleContext)
-        .addFrameworkImports(
-            frameworkImports)
-        .addExtraSdkFrameworks(sdkFrameworkAttributes.sdkFrameworks())
-        .addExtraWeakSdkFrameworks(sdkFrameworkAttributes.weakSdkFrameworks())
-        .addExtraSdkDylibs(sdkFrameworkAttributes.sdkDylibs())
-        .build();
-
-    Iterable<String> containerErrors =
-        ObjcCommon.notInContainerErrors(frameworkImports, ObjcCommon.FRAMEWORK_CONTAINER_TYPE);
-    for (String error : containerErrors) {
-      ruleContext.attributeError("framework_imports", error);
-    }
-
-    return common.configuredTarget(
-        NestedSetBuilder.<Artifact>emptySet(STABLE_ORDER) /* filesToBuild */,
-        Optional.<XcodeProvider>absent(),
-        Optional.of(common.getObjcProvider()),
-        Optional.<XcTestAppProvider>absent(),
-        Optional.<J2ObjcSrcsProvider>absent());
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFrameworkRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFrameworkRule.java
deleted file mode 100644
index e3bc19a..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcFrameworkRule.java
+++ /dev/null
@@ -1,66 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.LABEL_LIST;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-import com.google.devtools.build.lib.util.FileTypeSet;
-
-/**
- * Rule definition for objc_framework.
- */
-public class ObjcFrameworkRule implements RuleDefinition {
-
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment environment) {
-    return builder
-        /* <!-- #BLAZE_RULE(objc_framework).ATTRIBUTE(framework_imports) -->
-        The list of files under a <code>.framework</code> directory which are
-        provided to Objective-C targets that depend on this target.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE --> */
-        .add(attr("framework_imports", LABEL_LIST)
-            .allowedFileTypes(FileTypeSet.ANY_FILE)
-            .mandatory()
-            .nonEmpty())
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_framework")
-        .factoryClass(ObjcFramework.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.SdkFrameworksDependerRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_framework, TYPE = LIBRARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule encapsulates an already-built framework. It is defined by a list
-of files in one or more <code>.framework</code> directories.
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImport.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImport.java
deleted file mode 100644
index 6c4bf22..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImport.java
+++ /dev/null
@@ -1,71 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.XcodeProductType.LIBRARY_STATIC;
-
-import com.google.common.base.Optional;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.CompilationAttributes;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.ResourceAttributes;
-
-/**
- * Implementation for {@code objc_import}.
- */
-public class ObjcImport implements RuleConfiguredTargetFactory {
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    ObjcCommon common = new ObjcCommon.Builder(ruleContext)
-        .setCompilationAttributes(new CompilationAttributes(ruleContext))
-        .setResourceAttributes(new ResourceAttributes(ruleContext))
-        .setIntermediateArtifacts(ObjcRuleClasses.intermediateArtifacts(ruleContext))
-        .setAlwayslink(ruleContext.attributes().get("alwayslink", Type.BOOLEAN))
-        .addExtraImportLibraries(
-            ruleContext.getPrerequisiteArtifacts("archives", Mode.TARGET).list())
-        .addDepObjcProviders(
-            ruleContext.getPrerequisites("bundles", Mode.TARGET, ObjcProvider.class))
-        .build();
-
-    XcodeProvider.Builder xcodeProviderBuilder = new XcodeProvider.Builder();
-    NestedSetBuilder<Artifact> filesToBuild = NestedSetBuilder.stableOrder();
-
-    new CompilationSupport(ruleContext)
-        .addXcodeSettings(xcodeProviderBuilder, common, OptionsProvider.DEFAULT)
-        .validateAttributes();
-
-    new ResourceSupport(ruleContext)
-        .validateAttributes()
-        .addXcodeSettings(xcodeProviderBuilder);
-
-    new XcodeSupport(ruleContext)
-        .addXcodeSettings(xcodeProviderBuilder, common.getObjcProvider(), LIBRARY_STATIC)
-        .addDependencies(xcodeProviderBuilder, new Attribute("bundles", Mode.TARGET))
-        .registerActions(xcodeProviderBuilder.build())
-        .addFilesToBuild(filesToBuild);
-
-    return common.configuredTarget(
-        filesToBuild.build(),
-        Optional.of(xcodeProviderBuilder.build()),
-        Optional.of(common.getObjcProvider()),
-        Optional.<XcTestAppProvider>absent(),
-        Optional.<J2ObjcSrcsProvider>absent());
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImportRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImportRule.java
deleted file mode 100644
index 43cdb23..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcImportRule.java
+++ /dev/null
@@ -1,74 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.LABEL_LIST;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-import com.google.devtools.build.lib.util.FileType;
-
-/**
- * Rule definition for {@code objc_import}.
- */
-public class ObjcImportRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment environment) {
-    return builder
-        /*<!-- #BLAZE_RULE(objc_import).IMPLICIT_OUTPUTS -->
-        <ul>
-         <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: An Xcode project file which
-             can be used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(XcodeSupport.PBXPROJ)
-        /* <!-- #BLAZE_RULE(objc_import).ATTRIBUTE(archives) -->
-        The list of <code>.a</code> files provided to Objective-C targets that
-        depend on this target.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE --> */
-        .add(attr("archives", LABEL_LIST)
-            .mandatory()
-            .nonEmpty()
-            .allowedFileTypes(FileType.of(".a")))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_import")
-        .factoryClass(ObjcImport.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.AlwaysLinkRule.class,
-            ObjcRuleClasses.XcodegenRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_import, TYPE = LIBRARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule encapsulates an already-compiled static library in the form of an
-<code>.a</code> file. It also allows exporting headers and resources using the same
-attributes supported by <code>objc_library</code>.</p>
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibrary.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibrary.java
deleted file mode 100644
index 7d62173..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibrary.java
+++ /dev/null
@@ -1,124 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.XcodeProductType.LIBRARY_STATIC;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.CompilationAttributes;
-import com.google.devtools.build.lib.rules.objc.ObjcCommon.ResourceAttributes;
-
-/**
- * Implementation for {@code objc_library}.
- */
-public class ObjcLibrary implements RuleConfiguredTargetFactory {
-
-  /**
-   * An {@link IterableWrapper} containing extra library {@link Artifact}s to be linked into the
-   * final ObjC application bundle.
-   */
-  static final class ExtraImportLibraries extends IterableWrapper<Artifact> {
-
-    ExtraImportLibraries(Artifact... extraImportLibraries) {
-      super(extraImportLibraries);
-    }
-
-    ExtraImportLibraries(Iterable<Artifact> extraImportLibraries) {
-      super(extraImportLibraries);
-    }
-  }
-
-  /**
-   * Constructs an {@link ObjcCommon} instance based on the attributes of the given rule. The rule
-   * should inherit from {@link ObjcLibraryRule}..
-   */
-  static ObjcCommon common(RuleContext ruleContext, Iterable<SdkFramework> extraSdkFrameworks,
-      boolean alwayslink, ExtraImportLibraries extraImportLibraries,
-      Iterable<ObjcProvider> extraDepObjcProviders) {
-    CompilationArtifacts compilationArtifacts =
-        CompilationSupport.compilationArtifacts(ruleContext);
-
-    return new ObjcCommon.Builder(ruleContext)
-        .setCompilationAttributes(new CompilationAttributes(ruleContext))
-        .setResourceAttributes(new ResourceAttributes(ruleContext))
-        .addExtraSdkFrameworks(extraSdkFrameworks)
-        .addDefines(ruleContext.getTokenizedStringListAttr("defines"))
-        .setCompilationArtifacts(compilationArtifacts)
-        .addDepObjcProviders(ruleContext.getPrerequisites("deps", Mode.TARGET, ObjcProvider.class))
-        .addDepObjcProviders(
-            ruleContext.getPrerequisites("bundles", Mode.TARGET, ObjcProvider.class))
-        .addNonPropagatedDepObjcProviders(ruleContext.getPrerequisites("non_propagated_deps",
-            Mode.TARGET, ObjcProvider.class))
-        .setIntermediateArtifacts(ObjcRuleClasses.intermediateArtifacts(ruleContext))
-        .setAlwayslink(alwayslink)
-        .addExtraImportLibraries(extraImportLibraries)
-        .addDepObjcProviders(extraDepObjcProviders)
-        .build();
-  }
-
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    ObjcCommon common = common(
-        ruleContext, ImmutableList.<SdkFramework>of(),
-        ruleContext.attributes().get("alwayslink", Type.BOOLEAN), new ExtraImportLibraries(),
-        ImmutableList.<ObjcProvider>of());
-    OptionsProvider optionsProvider = optionsProvider(ruleContext);
-
-    XcodeProvider.Builder xcodeProviderBuilder = new XcodeProvider.Builder();
-    NestedSetBuilder<Artifact> filesToBuild = NestedSetBuilder.<Artifact>stableOrder()
-        .addAll(common.getCompiledArchive().asSet());
-
-    new CompilationSupport(ruleContext)
-        .registerCompileAndArchiveActions(common, optionsProvider)
-        .addXcodeSettings(xcodeProviderBuilder, common, optionsProvider)
-        .validateAttributes();
-
-    new ResourceSupport(ruleContext)
-        .validateAttributes()
-        .addXcodeSettings(xcodeProviderBuilder);
-
-    new XcodeSupport(ruleContext)
-        .addFilesToBuild(filesToBuild)
-        .addXcodeSettings(xcodeProviderBuilder, common.getObjcProvider(), LIBRARY_STATIC)
-        .addDependencies(xcodeProviderBuilder, new Attribute("bundles", Mode.TARGET))
-        .addDependencies(xcodeProviderBuilder, new Attribute("deps", Mode.TARGET))
-        .addNonPropagatedDependencies(
-            xcodeProviderBuilder, new Attribute("non_propagated_deps", Mode.TARGET))
-        .registerActions(xcodeProviderBuilder.build());
-
-    return common.configuredTarget(
-        filesToBuild.build(),
-        Optional.of(xcodeProviderBuilder.build()),
-        Optional.of(common.getObjcProvider()),
-        Optional.<XcTestAppProvider>absent(),
-        Optional.of(ObjcRuleClasses.j2ObjcSrcsProvider(ruleContext)));
-  }
-
-  private OptionsProvider optionsProvider(RuleContext ruleContext) {
-    return new OptionsProvider.Builder()
-        .addCopts(ruleContext.getTokenizedStringListAttr("copts"))
-        .addTransitive(Optional.fromNullable(
-            ruleContext.getPrerequisite("options", Mode.TARGET, OptionsProvider.class)))
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibraryRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibraryRule.java
deleted file mode 100644
index 56f235b..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcLibraryRule.java
+++ /dev/null
@@ -1,62 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for objc_library.
- */
-public class ObjcLibraryRule implements RuleDefinition {
-
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(objc_library).IMPLICIT_OUTPUTS -->
-        <ul>
-         <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: An Xcode project file which
-             can be used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(XcodeSupport.PBXPROJ)
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_library")
-        .factoryClass(ObjcLibrary.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.CompilingRule.class,
-            ObjcRuleClasses.AlwaysLinkRule.class, ObjcRuleClasses.XcodegenRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_library, TYPE = LIBRARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule produces a static library from the given Objective-C source files.</p>
-
-${IMPLICIT_OUTPUTS}
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptions.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptions.java
deleted file mode 100644
index a7e2b8f..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptions.java
+++ /dev/null
@@ -1,40 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.RunfilesProvider;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-
-/**
- * Implementation for the {@code objc_options} rule.
- */
-public class ObjcOptions implements RuleConfiguredTargetFactory {
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) {
-    return new RuleConfiguredTargetBuilder(ruleContext)
-        .add(RunfilesProvider.class, RunfilesProvider.EMPTY)
-        .add(OptionsProvider.class,
-            new OptionsProvider.Builder()
-                .addCopts(ruleContext.getTokenizedStringListAttr("copts"))
-                .addInfoplists(
-                    ruleContext.getPrerequisiteArtifacts("infoplists", Mode.TARGET).list())
-                .build())
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptionsRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptionsRule.java
deleted file mode 100644
index 7f7fbb3..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcOptionsRule.java
+++ /dev/null
@@ -1,70 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.rules.objc.ObjcRuleClasses.PLIST_TYPE;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-import com.google.devtools.build.lib.packages.Type;
-
-/**
- * Rule definition for {@code objc_options}.
- */
-public class ObjcOptionsRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        // TODO(bazel-team): Delete this class and merge ObjcOptsRule with CompilingRule.
-        .setUndocumented()
-        /* <!-- #BLAZE_RULE(objc_options).ATTRIBUTE(xcode_name)[DEPRECATED] -->
-        This attribute is ignored and will be removed.
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("xcode_name", Type.STRING))
-        /* <!-- #BLAZE_RULE(objc_options).ATTRIBUTE(infoplists) -->
-        infoplist files to merge with the final binary's infoplist. This
-        corresponds to a single file <i>appname</i>-Info.plist in Xcode
-        projects.
-        <i>(List of <a href="build-ref.html#labels">labels</a>; optional)</i>
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("infoplists", Type.LABEL_LIST)
-            .allowedFileTypes(PLIST_TYPE))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_options")
-        .factoryClass(ObjcOptions.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.CoptsRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_options, TYPE = OTHER, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule provides a nameable set of build settings to use when building
-Objective-C targets.</p>
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibrary.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibrary.java
deleted file mode 100644
index 90483b4..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibrary.java
+++ /dev/null
@@ -1,249 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.common.base.CaseFormat.LOWER_UNDERSCORE;
-import static com.google.common.base.CaseFormat.UPPER_CAMEL;
-import static com.google.devtools.build.lib.rules.objc.XcodeProductType.LIBRARY_STATIC;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Function;
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.AnalysisUtils;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.actions.CustomCommandLine;
-import com.google.devtools.build.lib.analysis.actions.FileWriteAction;
-import com.google.devtools.build.lib.analysis.actions.SpawnAction;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.collect.nestedset.Order;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.proto.ProtoSourcesProvider;
-import com.google.devtools.build.lib.util.FileType;
-import com.google.devtools.build.lib.vfs.FileSystemUtils;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-import javax.annotation.Nullable;
-
-/**
- * Implementation for the "objc_proto_library" rule.
- */
-public class ObjcProtoLibrary implements RuleConfiguredTargetFactory {
-  private static final Function<Artifact, PathFragment> PARENT_PATHFRAGMENT =
-      new Function<Artifact, PathFragment>() {
-    @Override
-    public PathFragment apply(Artifact input) {
-      return input.getExecPath().getParentDirectory();
-    }
-  };
-
-  @VisibleForTesting
-  static final String NO_PROTOS_ERROR =
-      "no protos to compile - a non-empty deps attribute is required";
-
-  @Override
-  public ConfiguredTarget create(final RuleContext ruleContext) throws InterruptedException {
-    Artifact compileProtos = ruleContext.getPrerequisiteArtifact(
-        ObjcRuleClasses.ObjcProtoRule.COMPILE_PROTOS_ATTR, Mode.HOST);
-    Optional<Artifact> optionsFile = Optional.fromNullable(
-        ruleContext.getPrerequisiteArtifact(ObjcProtoLibraryRule.OPTIONS_FILE_ATTR, Mode.HOST));
-    NestedSet<Artifact> protos = NestedSetBuilder.<Artifact>stableOrder()
-        .addAll(ruleContext.getPrerequisiteArtifacts("deps", Mode.TARGET)
-            .filter(FileType.of(".proto"))
-            .list())
-        .addTransitive(maybeGetProtoSources(ruleContext))
-        .build();
-
-    if (Iterables.isEmpty(protos)) {
-      ruleContext.ruleError(NO_PROTOS_ERROR);
-    }
-
-    ImmutableList<Artifact> libProtobuf = ruleContext
-        .getPrerequisiteArtifacts(ObjcProtoLibraryRule.LIBPROTOBUF_ATTR, Mode.TARGET)
-        .list();
-    ImmutableList<Artifact> protoSupport = ruleContext
-        .getPrerequisiteArtifacts(ObjcRuleClasses.ObjcProtoRule.PROTO_SUPPORT_ATTR, Mode.HOST)
-        .list();
-
-    // Generate sources in a package-and-rule-scoped directory; adds both the
-    // package-and-rule-scoped directory and the header-containing-directory to the include path of
-    // dependers.
-    PathFragment rootRelativeOutputDir = new PathFragment(
-        ruleContext.getLabel().getPackageFragment(),
-        new PathFragment("_generated_protos_" + ruleContext.getLabel().getName()));
-    PathFragment workspaceRelativeOutputDir = new PathFragment(
-        ruleContext.getBinOrGenfilesDirectory().getExecPath(), rootRelativeOutputDir);
-    PathFragment generatedProtoDir =
-        new PathFragment(workspaceRelativeOutputDir, ruleContext.getLabel().getPackageFragment());
-
-    boolean outputCpp =
-        ruleContext.attributes().get(ObjcProtoLibraryRule.OUTPUT_CPP_ATTR, Type.BOOLEAN);
-
-    ImmutableList<Artifact> protoGeneratedSources = outputArtifacts(
-        ruleContext, rootRelativeOutputDir, protos, FileType.of(".pb." + (outputCpp ? "cc" : "m")),
-        outputCpp);
-    ImmutableList<Artifact> protoGeneratedHeaders = outputArtifacts(
-        ruleContext, rootRelativeOutputDir, protos, FileType.of(".pb.h"), outputCpp);
-
-    Artifact inputFileList = ruleContext.getAnalysisEnvironment().getDerivedArtifact(
-        AnalysisUtils.getUniqueDirectory(ruleContext.getLabel(), new PathFragment("_protos"))
-            .getRelative("_proto_input_files"),
-            ruleContext.getConfiguration().getGenfilesDirectory());
-
-    ruleContext.registerAction(new FileWriteAction(
-        ruleContext.getActionOwner(),
-        inputFileList,
-        Artifact.joinExecPaths("\n", protos),
-        false));
-
-    CustomCommandLine.Builder commandLineBuilder = new CustomCommandLine.Builder()
-        .add(compileProtos.getExecPathString())
-        .add("--input-file-list").add(inputFileList.getExecPathString())
-        .add("--output-dir").add(workspaceRelativeOutputDir.getSafePathString());
-    if (optionsFile.isPresent()) {
-        commandLineBuilder
-            .add("--compiler-options-path")
-            .add(optionsFile.get().getExecPathString());
-    }
-    if (outputCpp) {
-      commandLineBuilder.add("--generate-cpp");
-    }
-
-    if (!Iterables.isEmpty(protos)) {
-      ruleContext.registerAction(new SpawnAction.Builder()
-          .setMnemonic("GenObjcProtos")
-          .addInput(compileProtos)
-          .addInputs(optionsFile.asSet())
-          .addInputs(protos)
-          .addInput(inputFileList)
-          .addInputs(libProtobuf)
-          .addInputs(protoSupport)
-          .addOutputs(Iterables.concat(protoGeneratedSources, protoGeneratedHeaders))
-          .setExecutable(new PathFragment("/usr/bin/python"))
-          .setCommandLine(commandLineBuilder.build())
-          .setExecutionInfo(ImmutableMap.of(ExecutionRequirements.REQUIRES_DARWIN, ""))
-          .build(ruleContext));
-    }
-
-    IntermediateArtifacts intermediateArtifacts =
-        ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    CompilationArtifacts compilationArtifacts = new CompilationArtifacts.Builder()
-        .addNonArcSrcs(protoGeneratedSources)
-        .setIntermediateArtifacts(intermediateArtifacts)
-        .setPchFile(Optional.<Artifact>absent())
-        .build();
-
-    ImmutableSet.Builder<PathFragment> searchPathEntriesBuilder =
-        new ImmutableSet.Builder<PathFragment>()
-            .add(workspaceRelativeOutputDir);
-     if (ruleContext.getConfiguration().getFragment(ObjcConfiguration.class).perProtoIncludes()) {
-      searchPathEntriesBuilder
-          .add(generatedProtoDir)
-          .addAll(Iterables.transform(protoGeneratedHeaders, PARENT_PATHFRAGMENT));
-     }    
-    ImmutableSet<PathFragment> searchPathEntries = searchPathEntriesBuilder.build();
-
-    ObjcCommon common = new ObjcCommon.Builder(ruleContext)
-        .setCompilationArtifacts(compilationArtifacts)
-        .addUserHeaderSearchPaths(searchPathEntries)
-        .addDepObjcProviders(ruleContext.getPrerequisites(
-            ObjcProtoLibraryRule.LIBPROTOBUF_ATTR, Mode.TARGET, ObjcProvider.class))
-        .setIntermediateArtifacts(intermediateArtifacts)
-        .addHeaders(protoGeneratedHeaders)
-        .addHeaders(protoGeneratedSources)
-        .build();
-
-    ObjcConfiguration configuration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    Iterable<XcodeProvider> protoDeps = ruleContext.getPrerequisites(
-        ObjcProtoLibraryRule.LIBPROTOBUF_ATTR, Mode.TARGET, XcodeProvider.class);
-    XcodeProvider xcodeProvider = new XcodeProvider.Builder()
-        .setLabel(ruleContext.getLabel())
-        .setArchitecture(configuration.getIosCpu())
-        .addUserHeaderSearchPaths(searchPathEntries)
-        .addPropagatedDependencies(protoDeps, configuration)
-        .addCopts(configuration.getCopts())
-        .setProductType(LIBRARY_STATIC)
-        .addHeaders(protoGeneratedHeaders)
-        .setCompilationArtifacts(common.getCompilationArtifacts().get())
-        .setObjcProvider(common.getObjcProvider())
-        .build();
-
-    ObjcActionsBuilder actionsBuilder = ObjcRuleClasses.actionsBuilder(ruleContext);
-    new CompilationSupport(ruleContext)
-        .registerCompileAndArchiveActions(common, OptionsProvider.DEFAULT);
-    actionsBuilder.registerXcodegenActions(
-        new ObjcRuleClasses.Tools(ruleContext),
-        ruleContext.getImplicitOutputArtifact(XcodeSupport.PBXPROJ),
-        XcodeProvider.Project.fromTopLevelTarget(xcodeProvider));
-
-    return common.configuredTarget(
-        NestedSetBuilder.<Artifact>stableOrder()
-            .addAll(common.getCompiledArchive().asSet())
-            .addAll(protoGeneratedSources)
-            .addAll(protoGeneratedHeaders)
-            .add(ruleContext.getImplicitOutputArtifact(XcodeSupport.PBXPROJ))
-            .build(),
-        Optional.of(xcodeProvider),
-        Optional.of(common.getObjcProvider()),
-        Optional.<XcTestAppProvider>absent(),
-        Optional.<J2ObjcSrcsProvider>absent());
-  }
-
-  private NestedSet<Artifact> maybeGetProtoSources(RuleContext ruleContext) {
-    NestedSetBuilder<Artifact> artifacts = new NestedSetBuilder<>(Order.STABLE_ORDER);
-    Iterable<ProtoSourcesProvider> providers =
-        ruleContext.getPrerequisites("deps", Mode.TARGET, ProtoSourcesProvider.class);
-    for (ProtoSourcesProvider provider : providers) {
-      artifacts.addTransitive(provider.getTransitiveProtoSources());
-    }
-    return artifacts.build();
-  }
-
-  private ImmutableList<Artifact> outputArtifacts(RuleContext ruleContext,
-      PathFragment rootRelativeOutputDir, Iterable<Artifact> protos, FileType newFileType,
-      boolean outputCpp) {
-    ImmutableList.Builder<Artifact> builder = new ImmutableList.Builder<>();
-    for (Artifact proto : protos) {
-      String protoOutputName;
-      if (outputCpp) {
-        protoOutputName = proto.getFilename();
-      } else {
-        String lowerUnderscoreBaseName = proto.getFilename().replace('-', '_').toLowerCase();
-        protoOutputName = LOWER_UNDERSCORE.to(UPPER_CAMEL, lowerUnderscoreBaseName);
-      }
-      PathFragment rawFragment = new PathFragment(
-          rootRelativeOutputDir,
-          proto.getExecPath().getParentDirectory(),
-          new PathFragment(protoOutputName));
-      @Nullable PathFragment outputFile = FileSystemUtils.replaceExtension(
-          rawFragment,
-          newFileType.getExtensions().get(0),
-          ".proto");
-      if (outputFile != null) {
-        builder.add(ruleContext.getAnalysisEnvironment().getDerivedArtifact(
-            outputFile, ruleContext.getBinOrGenfilesDirectory()));
-      }
-    }
-    return builder.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibraryRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibraryRule.java
deleted file mode 100644
index e1878aa..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProtoLibraryRule.java
+++ /dev/null
@@ -1,96 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.ComputedDefault;
-import static com.google.devtools.build.lib.packages.Attribute.ConfigurationTransition.HOST;
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.BOOLEAN;
-import static com.google.devtools.build.lib.packages.Type.LABEL;
-import static com.google.devtools.build.lib.packages.Type.LABEL_LIST;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.AttributeMap;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-import com.google.devtools.build.lib.packages.Type;
-
-/**
- * Rule definition for objc_proto_library.
- *
- * This is a temporary rule until it is better known how to support proto_library rules.
- */
-public class ObjcProtoLibraryRule implements RuleDefinition {
-  static final String OPTIONS_FILE_ATTR = "options_file";
-  static final String OUTPUT_CPP_ATTR = "output_cpp";
-  static final String LIBPROTOBUF_ATTR = "$lib_protobuf";
-
-  @Override
-  public RuleClass build(Builder builder, final RuleDefinitionEnvironment env) {
-    return builder
-        /* <!-- #BLAZE_RULE(objc_proto_library).ATTRIBUTE(deps) -->
-        The directly depended upon proto_library rules.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("deps", LABEL_LIST)
-            .allowedRuleClasses("proto_library", "filegroup")
-            .legacyAllowAnyFileType())
-        /* <!-- #BLAZE_RULE(objc_proto_library).ATTRIBUTE(options_file) -->
-        Optional options file to apply to protos which affects compilation (e.g. class
-        whitelist/blacklist settings).
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr(OPTIONS_FILE_ATTR, LABEL).legacyAllowAnyFileType().singleArtifact().cfg(HOST))
-        /* <!-- #BLAZE_RULE(objc_proto_library).ATTRIBUTE(output_cpp) -->
-        If true, output C++ rather than ObjC.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr(OUTPUT_CPP_ATTR, BOOLEAN).value(false))
-        .add(attr(LIBPROTOBUF_ATTR, LABEL).allowedRuleClasses("objc_library")
-            .value(new ComputedDefault(OUTPUT_CPP_ATTR) {
-              @Override
-              public Object getDefault(AttributeMap rule) {
-                return rule.get(OUTPUT_CPP_ATTR, Type.BOOLEAN)
-                    ? env.getLabel("//external:objc_proto_cpp_lib")
-                    : env.getLabel("//external:objc_proto_lib");
-              }
-            }))
-        .add(attr("$xcodegen", LABEL).cfg(HOST).exec()
-            .value(env.getLabel("//tools/objc:xcodegen")))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_proto_library")
-        .factoryClass(ObjcProtoLibrary.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.ObjcProtoRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_proto_library, TYPE = LIBRARY, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule produces a static library from the given proto_library dependencies, after applying an
-options file.</p>
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProvider.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProvider.java
deleted file mode 100644
index 12692ba..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcProvider.java
+++ /dev/null
@@ -1,345 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.collect.nestedset.Order.LINK_ORDER;
-import static com.google.devtools.build.lib.collect.nestedset.Order.STABLE_ORDER;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.TransitiveInfoProvider;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.collect.nestedset.Order;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-import com.google.devtools.build.lib.vfs.PathFragment;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.TargetControl;
-
-import java.util.HashMap;
-import java.util.Map;
-
-/**
- * A provider that provides all compiling and linking information in the transitive closure of its
- * deps that are needed for building Objective-C rules.
- */
-@Immutable
-public final class ObjcProvider implements TransitiveInfoProvider {
-  /**
-   * Represents one of the things this provider can provide transitively. Things are provided as
-   * {@link NestedSet}s of type E.
-   */
-  public static class Key<E> {
-    private final Order order;
-
-    private Key(Order order) {
-      this.order = Preconditions.checkNotNull(order);
-    }
-  }
-
-  public static final Key<Artifact> LIBRARY = new Key<>(LINK_ORDER);
-  public static final Key<Artifact> IMPORTED_LIBRARY = new Key<>(LINK_ORDER);
-
-  /**
-   * Single-architecture linked binaries to be combined for the final multi-architecture binary.
-   */
-  public static final Key<Artifact> LINKED_BINARY = new Key<>(STABLE_ORDER);
-
-  /**
-   * Indicates which libraries to load with {@code -force_load}. This is a subset of the union of
-   * the {@link #LIBRARY} and {@link #IMPORTED_LIBRARY} sets.
-   */
-  public static final Key<Artifact> FORCE_LOAD_LIBRARY = new Key<>(LINK_ORDER);
-
-  /**
-   * Libraries to pass with -force_load flags when setting the linkopts in Xcodegen. This is needed
-   * in addition to {@link #FORCE_LOAD_LIBRARY} because that one, contains a mixture of import
-   * archives (which are not built by Xcode) and built-from-source library archives (which are built
-   * by Xcode). Archives that are built by Xcode are placed directly under
-   * {@code BUILT_PRODUCTS_DIR} while those not built by Xcode appear somewhere in the Bazel
-   * workspace under {@code WORKSPACE_ROOT}.
-   */
-  public static final Key<String> FORCE_LOAD_FOR_XCODEGEN = new Key<>(LINK_ORDER);
-
-  public static final Key<Artifact> HEADER = new Key<>(STABLE_ORDER);
-
-  /**
-   * Contains all source files.
-   */
-  public static final Key<Artifact> SOURCE = new Key<>(STABLE_ORDER);
-
-  /**
-   * Contains all coverage instrumented source files.
-   */
-  public static final Key<Artifact> INSTRUMENTED_SOURCE = new Key<>(STABLE_ORDER);
-
-  /**
-   * Contains all .gcno files one for every source file if in coverage mode.
-   * It contains information to reconstruct the basic block graphs and assign source line numbers 
-   * to blocks.
-   */
-  public static final Key<Artifact> GCNO = new Key<>(STABLE_ORDER);
-
-  /**
-   * Include search paths specified with {@code -I} on the command line. Also known as header search
-   * paths (and distinct from <em>user</em> header search paths).
-   */
-  public static final Key<PathFragment> INCLUDE = new Key<>(LINK_ORDER);
-
-  /**
-   * Key for values in {@code defines} attributes. These are passed as {@code -D} flags to all
-   * invocations of the compiler for this target and all depending targets.
-   */
-  public static final Key<String> DEFINE = new Key<>(STABLE_ORDER);
-
-  public static final Key<Artifact> ASSET_CATALOG = new Key<>(STABLE_ORDER);
-
-  /**
-   * Added to {@link TargetControl#getGeneralResourceFileList()} when running Xcodegen.
-   */
-  public static final Key<Artifact> GENERAL_RESOURCE_FILE = new Key<>(STABLE_ORDER);
-
-  /**
-   * Exec paths of {@code .bundle} directories corresponding to imported bundles to link.
-   * These are passed to Xcodegen.
-   */
-  public static final Key<PathFragment> BUNDLE_IMPORT_DIR = new Key<>(STABLE_ORDER);
-
-  /**
-   * Files that are plopped into the final bundle at some arbitrary bundle path. Note that these are
-   * not passed to Xcodegen, and these don't include information about where the file originated
-   * from.
-   */
-  public static final Key<BundleableFile> BUNDLE_FILE = new Key<>(STABLE_ORDER);
-
-  public static final Key<PathFragment> XCASSETS_DIR = new Key<>(STABLE_ORDER);
-  public static final Key<String> SDK_DYLIB = new Key<>(STABLE_ORDER);
-  public static final Key<SdkFramework> SDK_FRAMEWORK = new Key<>(STABLE_ORDER);
-  public static final Key<SdkFramework> WEAK_SDK_FRAMEWORK = new Key<>(STABLE_ORDER);
-  public static final Key<Artifact> XCDATAMODEL = new Key<>(STABLE_ORDER);
-  public static final Key<Flag> FLAG = new Key<>(STABLE_ORDER);
-
-  /**
-   * Merge zips to include in the bundle. The entries of these zip files are included in the final
-   * bundle with the same path. The entries in the merge zips should not include the bundle root
-   * path (e.g. {@code Foo.app}).
-   */
-  public static final Key<Artifact> MERGE_ZIP = new Key<>(STABLE_ORDER);
-
-  /**
-   * Exec paths of {@code .framework} directories corresponding to frameworks to link. These cause
-   * -F arguments (framework search paths) to be added to each compile action, and -framework (link
-   * framework) arguments to be added to each link action.
-   */
-  public static final Key<PathFragment> FRAMEWORK_DIR = new Key<>(LINK_ORDER);
-
-  /**
-   * Files in {@code .framework} directories that should be included as inputs when compiling and
-   * linking.
-   */
-  public static final Key<Artifact> FRAMEWORK_FILE = new Key<>(STABLE_ORDER);
-
-  /**
-   * Bundles which should be linked in as a nested bundle to the final application.
-   */
-  public static final Key<Bundling> NESTED_BUNDLE = new Key<>(STABLE_ORDER);
-
-  /**
-   * Artifact containing information on debug symbols
-   */
-  public static final Key<Artifact> DEBUG_SYMBOLS = new Key<>(STABLE_ORDER);
-
-  /**
-   * Artifacts for storyboard sources.
-   */
-  public static final Key<Artifact> STORYBOARD = new Key<>(STABLE_ORDER);
-
-  /**
-   * Artifacts for .xib file sources.
-   */
-  public static final Key<Artifact> XIB = new Key<>(STABLE_ORDER);
-
-  /**
-   * Artifacts for strings source files.
-   */
-  public static final Key<Artifact> STRINGS = new Key<>(STABLE_ORDER);
-
-  /**
-   * Flags that apply to a transitive build dependency tree. Each item in the enum corresponds to a
-   * flag. If the item is included in the key {@link #FLAG}, then the flag is considered set.
-   */
-  public enum Flag {
-    /**
-     * Indicates that C++ (or Objective-C++) is used in any source file. This affects how the linker
-     * is invoked.
-    */
-    USES_CPP;
-  }
-
-  private final ImmutableMap<Key<?>, NestedSet<?>> items;
-
-  // Items which should be passed to direct dependers, but not transitive dependers.
-  private final ImmutableMap<Key<?>, NestedSet<?>> nonPropagatedItems;
-
-  private ObjcProvider(
-      ImmutableMap<Key<?>, NestedSet<?>> items,
-      ImmutableMap<Key<?>, NestedSet<?>> nonPropagatedItems) {
-    this.items = Preconditions.checkNotNull(items);
-    this.nonPropagatedItems = Preconditions.checkNotNull(nonPropagatedItems);
-  }
-
-  /**
-   * All artifacts, bundleable files, etc. of the type specified by {@code key}.
-   */
-  @SuppressWarnings("unchecked")
-  public <E> NestedSet<E> get(Key<E> key) {
-    Preconditions.checkNotNull(key);
-    NestedSetBuilder<E> builder = new NestedSetBuilder<>(key.order);
-    if (nonPropagatedItems.containsKey(key)) {
-      builder.addTransitive((NestedSet<E>) nonPropagatedItems.get(key));
-    }
-    if (items.containsKey(key)) {
-      builder.addTransitive((NestedSet<E>) items.get(key));
-    }
-    return builder.build();
-  }
-
-  /**
-   * Indicates whether {@code flag} is set on this provider.
-   */
-  public boolean is(Flag flag) {
-    return Iterables.contains(get(FLAG), flag);
-  }
-
-  /**
-   * Indicates whether this provider has any asset catalogs. This is true whenever some target in
-   * its transitive dependency tree specifies a non-empty {@code asset_catalogs} attribute.
-   */
-  public boolean hasAssetCatalogs() {
-    return !get(XCASSETS_DIR).isEmpty();
-  }
-
-  /**
-   * A builder for this context with an API that is optimized for collecting information from
-   * several transitive dependencies.
-   */
-  public static final class Builder {
-    private final Map<Key<?>, NestedSetBuilder<?>> items = new HashMap<>();
-    private final Map<Key<?>, NestedSetBuilder<?>> nonPropagatedItems = new HashMap<>();
-
-    private static void maybeAddEmptyBuilder(Map<Key<?>, NestedSetBuilder<?>> set, Key<?> key) {
-      if (!set.containsKey(key)) {
-        set.put(key, new NestedSetBuilder<>(key.order));
-      }
-    }
-
-    @SuppressWarnings({"rawtypes", "unchecked"})
-    private void uncheckedAddAll(Key key, Iterable toAdd) {
-      maybeAddEmptyBuilder(items, key);
-      items.get(key).addAll(toAdd);
-    }
-
-    @SuppressWarnings({"rawtypes", "unchecked"})
-    private void uncheckedAddTransitive(Key key, NestedSet toAdd, boolean propagate) {
-      Map<Key<?>, NestedSetBuilder<?>> set = propagate ? items : nonPropagatedItems;
-      maybeAddEmptyBuilder(set, key);
-      set.get(key).addTransitive(toAdd);
-    }
-
-    /**
-     * Adds elements in items, and propagate them to any (transitive) dependers on this
-     * ObjcProvider.
-     */
-    public <E> Builder addTransitiveAndPropagate(Key<E> key, NestedSet<E> items) {
-      uncheckedAddTransitive(key, items, true);
-      return this;
-    }
-
-    /**
-     * Add all elements from provider, and propagate them to any (transitive) dependers on this
-     * ObjcProvider.
-     */
-    public Builder addTransitiveAndPropagate(ObjcProvider provider) {
-      for (Map.Entry<Key<?>, NestedSet<?>> typeEntry : provider.items.entrySet()) {
-        uncheckedAddTransitive(typeEntry.getKey(), typeEntry.getValue(), true);
-      }
-      return this;
-    }
-
-    /**
-     * Add all elements from a single key of the given provider, and propagate them to any
-     * (transitive) dependers on this ObjcProvider.
-     */
-    public <E> Builder addTransitiveAndPropagate(Key<E> key, ObjcProvider provider) {
-      addTransitiveAndPropagate(key, provider.get(key));
-      return this;
-    }
-
-    /**
-     * Add all elements from providers, and propagate them to any (transitive) dependers on this
-     * ObjcProvider.
-     */
-    public Builder addTransitiveAndPropagate(Iterable<ObjcProvider> providers) {
-      for (ObjcProvider provider : providers) {
-        addTransitiveAndPropagate(provider);
-      }
-      return this;
-    }
-
-    /**
-     * Add elements from providers, but don't propagate them to any dependers on this ObjcProvider.
-     * These elements will be exposed to {@link #get(Key)} calls, but not to any ObjcProviders
-     * which add this provider to themself.
-     */
-    public Builder addTransitiveWithoutPropagating(Iterable<ObjcProvider> providers) {
-      for (ObjcProvider provider : providers) {
-        for (Map.Entry<Key<?>, NestedSet<?>> typeEntry : provider.items.entrySet()) {
-          uncheckedAddTransitive(typeEntry.getKey(), typeEntry.getValue(), false);
-        }
-      }
-      return this;
-    }
-
-    /**
-     * Add element, and propagate it to any (transitive) dependers on this ObjcProvider.
-     */
-    public <E> Builder add(Key<E> key, E toAdd) {
-      uncheckedAddAll(key, ImmutableList.of(toAdd));
-      return this;
-    }
-
-    /**
-     * Add elements in toAdd, and propagate them to any (transitive) dependers on this ObjcProvider.
-     */
-    public <E> Builder addAll(Key<E> key, Iterable<? extends E> toAdd) {
-      uncheckedAddAll(key, toAdd);
-      return this;
-    }
-
-    public ObjcProvider build() {
-      ImmutableMap.Builder<Key<?>, NestedSet<?>> propagated = new ImmutableMap.Builder<>();
-      for (Map.Entry<Key<?>, NestedSetBuilder<?>> typeEntry : items.entrySet()) {
-        propagated.put(typeEntry.getKey(), typeEntry.getValue().build());
-      }
-      ImmutableMap.Builder<Key<?>, NestedSet<?>> nonPropagated = new ImmutableMap.Builder<>();
-      for (Map.Entry<Key<?>, NestedSetBuilder<?>> typeEntry : nonPropagatedItems.entrySet()) {
-        nonPropagated.put(typeEntry.getKey(), typeEntry.getValue().build());
-      }
-      return new ObjcProvider(propagated.build(), nonPropagated.build());
-    }
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcRuleClasses.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcRuleClasses.java
deleted file mode 100644
index beb0fdc..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcRuleClasses.java
+++ /dev/null
@@ -1,979 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.ConfigurationTransition.HOST;
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.BOOLEAN;
-import static com.google.devtools.build.lib.packages.Type.LABEL;
-import static com.google.devtools.build.lib.packages.Type.LABEL_LIST;
-import static com.google.devtools.build.lib.packages.Type.STRING;
-import static com.google.devtools.build.lib.packages.Type.STRING_LIST;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.base.Predicate;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.FilesToRunProvider;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.analysis.config.BuildConfiguration;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.packages.Attribute;
-import com.google.devtools.build.lib.packages.Attribute.LateBoundLabel;
-import com.google.devtools.build.lib.packages.AttributeMap;
-import com.google.devtools.build.lib.packages.Rule;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-import com.google.devtools.build.lib.packages.RuleClass.Builder.RuleClassType;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.syntax.Label;
-import com.google.devtools.build.lib.util.FileType;
-import com.google.devtools.build.lib.util.FileTypeSet;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-/**
- * Shared rule classes and associated utility code for Objective-C rules.
- */
-public class ObjcRuleClasses {
-
-  // TODO(danielwh): Replace these with actual Artifact references
-  private static final String BIN_DIR =
-      IosSdkCommands.DEVELOPER_DIR + "/Toolchains/XcodeDefault.xctoolchain/usr/bin";
-  static final PathFragment CLANG = new PathFragment(BIN_DIR + "/clang");
-  static final PathFragment CLANG_PLUSPLUS = new PathFragment(BIN_DIR + "/clang++");
-  static final PathFragment LIBTOOL = new PathFragment(BIN_DIR + "/libtool");
-  static final PathFragment DSYMUTIL = new PathFragment(BIN_DIR + "/dsymutil");
-  static final PathFragment LIPO = new PathFragment(BIN_DIR + "/lipo");
-
-  private ObjcRuleClasses() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  /**
-   * Returns a derived Artifact by appending a String to a root-relative path. This is similar to
-   * {@link RuleContext#getRelatedArtifact(PathFragment, String)}, except the existing extension is
-   * not removed.
-   */
-  static Artifact artifactByAppendingToRootRelativePath(
-      RuleContext ruleContext, PathFragment path, String suffix) {
-    return ruleContext.getAnalysisEnvironment().getDerivedArtifact(
-        path.replaceName(path.getBaseName() + suffix),
-        ruleContext.getBinOrGenfilesDirectory());
-  }
-
-  static IntermediateArtifacts intermediateArtifacts(RuleContext ruleContext) {
-    return new IntermediateArtifacts(
-        ruleContext.getAnalysisEnvironment(), ruleContext.getBinOrGenfilesDirectory(),
-        ruleContext.getLabel(), /*archiveFileNameSuffix=*/"");
-  }
-
-  /**
-   * Returns a {@link IntermediateArtifacts} to be used to compile and link the ObjC source files
-   * in {@code j2ObjcSource}.
-   */
-  static IntermediateArtifacts j2objcIntermediateArtifacts(RuleContext ruleContext,
-      J2ObjcSource j2ObjcSource) {
-    // We need to append "_j2objc" to the name of the generated archive file to distinguish it from
-    // the C/C++ archive file created by proto_library targets with attribute cc_api_version
-    // specified.
-    return new IntermediateArtifacts(
-        ruleContext.getAnalysisEnvironment(),
-        ruleContext.getConfiguration().getBinDirectory(),
-        ruleContext.getLabel(),
-        j2ObjcSource.getTargetLabel(),
-        /*archiveFileNameSuffix=*/"_j2objc");
-  }
-
-  /**
-   * Returns an {@link Iterable} of {@link Artifact}s containing all the j2objc archives from the
-   * transitive closure of the rule through the "deps" attribute. This is useful for ensuring that
-   * the j2objc archives are present for linking.
-   *
-   * @param ruleContext the {@link RuleContext} of the current rule
-   * @return an {@link Iterable} of j2objc library archive artifacts.
-   */
-  static Iterable<Artifact> j2ObjcLibraries(RuleContext ruleContext) {
-    ImmutableList.Builder<Artifact> j2objcLibraries = new ImmutableList.Builder<>();
-
-    // TODO(bazel-team): Refactor the code to stop flattening the nested set here.
-    for (J2ObjcSource j2ObjcSource : j2ObjcSrcsProvider(ruleContext).getSrcs()) {
-      j2objcLibraries.add(j2objcIntermediateArtifacts(ruleContext, j2ObjcSource).archive());
-    }
-
-    return j2objcLibraries.build();
-  }
-
-  /**
-   * Returns a {@link J2ObjcSrcsProvider} with J2ObjC-generated ObjC file information from the
-   * current rule, and from rules that can be reached transitively through the "deps" attribute.
-   *
-   * @param ruleContext the rule context of the current rule
-   * @param currentSource J2ObjC-generated ObjC file information from the current rule to contribute
-   *     to the returned provider
-   * @return a {@link J2ObjcSrcsProvider} containing {@code currentSources} and source information
-   *         from the transitive closure.
-   */
-  public static J2ObjcSrcsProvider j2ObjcSrcsProvider(RuleContext ruleContext,
-      J2ObjcSource currentSource) {
-    return j2ObjcSrcsProvider(ruleContext, Optional.of(currentSource));
-  }
-
-  /**
-   * Returns a {@link J2ObjcSrcsProvider} with J2ObjC-generated ObjC file information from rules
-   * that can be reached transitively through the "deps" attribute.
-   *
-   * @param ruleContext the rule context of the current rule
-   * @return a {@link J2ObjcSrcsProvider} containing source information from the transitive closure.
-   */
-  public static J2ObjcSrcsProvider j2ObjcSrcsProvider(RuleContext ruleContext) {
-    return j2ObjcSrcsProvider(ruleContext, Optional.<J2ObjcSource>absent());
-  }
-
-  private static J2ObjcSrcsProvider j2ObjcSrcsProvider(RuleContext ruleContext,
-      Optional<J2ObjcSource> currentSource) {
-    NestedSetBuilder<J2ObjcSource> builder = NestedSetBuilder.stableOrder();
-    builder.addAll(currentSource.asSet());
-    boolean hasProtos = currentSource.isPresent()
-        && currentSource.get().getSourceType() == J2ObjcSource.SourceType.PROTO;
-
-    if (ruleContext.attributes().has("deps", Type.LABEL_LIST)) {
-      for (J2ObjcSrcsProvider provider :
-          ruleContext.getPrerequisites("deps", Mode.TARGET, J2ObjcSrcsProvider.class)) {
-        builder.addTransitive(provider.getSrcs());
-        hasProtos |= provider.hasProtos();
-      }
-    }
-
-    if (ruleContext.attributes().has("exports", Type.LABEL_LIST)) {
-      for (J2ObjcSrcsProvider provider :
-          ruleContext.getPrerequisites("exports", Mode.TARGET, J2ObjcSrcsProvider.class)) {
-        builder.addTransitive(provider.getSrcs());
-        hasProtos |= provider.hasProtos();
-      }
-    }
-
-    return new J2ObjcSrcsProvider(builder.build(), hasProtos);
-  }
-
-  public static Artifact artifactByAppendingToBaseName(RuleContext context, String suffix) {
-    return artifactByAppendingToRootRelativePath(
-        context, context.getLabel().toPathFragment(), suffix);
-  }
-
-  static ObjcActionsBuilder actionsBuilder(RuleContext ruleContext) {
-    return new ObjcActionsBuilder(
-        ruleContext,
-        intermediateArtifacts(ruleContext),
-        ObjcRuleClasses.objcConfiguration(ruleContext),
-        ruleContext,
-        CLANG,
-        CLANG_PLUSPLUS,
-        DSYMUTIL);
-  }
-
-  public static ObjcConfiguration objcConfiguration(RuleContext ruleContext) {
-    return ruleContext.getFragment(ObjcConfiguration.class);
-  }
-
-  @VisibleForTesting
-  static final Iterable<SdkFramework> AUTOMATIC_SDK_FRAMEWORKS = ImmutableList.of(
-      new SdkFramework("Foundation"), new SdkFramework("UIKit"));
-
-  /**
-   * Attributes for {@code objc_*} rules that have compiler options.
-   */
-  public static class CoptsRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment environment) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_opts_rule).ATTRIBUTE(copts) -->
-          Extra flags to pass to the compiler.
-          ${SYNOPSIS}
-          Subject to <a href="#make_variables">"Make variable"</a> substitution and
-          <a href="#sh-tokenization">Bourne shell tokenization</a>.
-          These flags will only apply to this target, and not those upon which
-          it depends, or those which depend on it.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("copts", STRING_LIST))
-          .build();
-    }
-
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_opts_rule")
-          .type(RuleClassType.ABSTRACT)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that use plists or copts.
-   */
-  public static class OptionsRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          // TODO(bazel-team): Remove options and replace with: (a) a plists attribute (instead of
-          // the current infoplist, defined on all rules and propagated to the next bundling rule)
-          // and (b) a way to share copts e.g. by being able to include constants across package
-          // boundaries in bazel.
-          //
-          // For now the semantics of this attribute are: any copts in the options will be used if
-          // defined on a compiling/linking rule, otherwise ignored. Infoplists are merged in if
-          // defined on a bundling rule, otherwise ignored.
-          .add(attr("options", LABEL)
-              .undocumented("objc_options will be removed")
-              .allowedFileTypes()
-              .allowedRuleClasses("objc_options"))
-          .build();
-    }
-
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_options_rule")
-          .type(RuleClassType.ABSTRACT)
-          .build();
-    }
-  }
-
-  /**
-   * Attributes for {@code objc_*} rules that can link in SDK frameworks.
-   */
-  public static class SdkFrameworksDependerRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment environment) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_sdk_frameworks_depender_rule).ATTRIBUTE(sdk_frameworks) -->
-          Names of SDK frameworks to link with.
-          ${SYNOPSIS}
-          For instance, "XCTest" or "Cocoa". "UIKit" and "Foundation" are always
-          included and do not mean anything if you include them.
-
-          <p>When linking a library, only those frameworks named in that library's
-          sdk_frameworks attribute are linked in. When linking a binary, all
-          SDK frameworks named in that binary's transitive dependency graph are
-          used.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("sdk_frameworks", STRING_LIST))
-          /* <!-- #BLAZE_RULE($objc_sdk_frameworks_depender_rule).ATTRIBUTE(weak_sdk_frameworks) -->
-          Names of SDK frameworks to weakly link with. For instance,
-          "MediaAccessibility".
-          ${SYNOPSIS}
-
-          In difference to regularly linked SDK frameworks, symbols
-          from weakly linked frameworks do not cause an error if they
-          are not present at runtime.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("weak_sdk_frameworks", STRING_LIST))
-          /* <!-- #BLAZE_RULE($objc_sdk_frameworks_depender_rule).ATTRIBUTE(sdk_dylibs) -->
-          Names of SDK .dylib libraries to link with. For instance, "libz" or
-          "libarchive".
-           ${SYNOPSIS}
-
-          "libc++" is included automatically if the binary has any C++ or
-          Objective-C++ sources in its dependency tree. When linking a binary,
-          all libraries named in that binary's transitive dependency graph are
-          used.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("sdk_dylibs", STRING_LIST))
-          .build();
-    }
-
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_sdk_frameworks_depender_rule")
-          .type(RuleClassType.ABSTRACT)
-          .build();
-    }
-  }
-
-  /**
-   * Iff a file matches this type, it is considered to use C++.
-   */
-  static final FileType CPP_SOURCES = FileType.of(".cc", ".cpp", ".mm", ".cxx", ".C");
-
-  private static final FileType NON_CPP_SOURCES = FileType.of(".m", ".c");
-
-  static final FileTypeSet SRCS_TYPE = FileTypeSet.of(NON_CPP_SOURCES, CPP_SOURCES);
-
-  static final FileTypeSet NON_ARC_SRCS_TYPE = FileTypeSet.of(FileType.of(".m", ".mm"));
-
-  static final FileTypeSet PLIST_TYPE = FileTypeSet.of(FileType.of(".plist"));
-
-  static final FileTypeSet STORYBOARD_TYPE = FileTypeSet.of(FileType.of(".storyboard"));
-
-  static final FileType XIB_TYPE = FileType.of(".xib");
-
-  /**
-   * Common attributes for {@code objc_*} rules that allow the definition of resources such as
-   * storyboards. These resources are used during compilation of the declaring rule as well as when
-   * bundling a dependent bundle (application, extension, etc.).
-   */
-  public static class ResourcesRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(strings) -->
-          Files which are plists of strings, often localizable.
-          ${SYNOPSIS}
-
-          These files are converted to binary plists (if they are not already)
-          and placed in the bundle root of the final package. If this file's
-          immediate containing directory is named *.lproj (e.g. en.lproj,
-          Base.lproj), it will be placed under a directory of that name in the
-          final bundle. This allows for localizable strings.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("strings", LABEL_LIST).legacyAllowAnyFileType()
-              .direct_compile_time_input())
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(xibs) -->
-          Files which are .xib resources, possibly localizable.
-          ${SYNOPSIS}
-
-          These files are compiled to .nib files and placed the bundle root of
-          the final package. If this file's immediate containing directory is
-          named *.lproj (e.g. en.lproj, Base.lproj), it will be placed under a
-          directory of that name in the final bundle. This allows for
-          localizable UI.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("xibs", LABEL_LIST)
-              .direct_compile_time_input()
-              .allowedFileTypes(XIB_TYPE))
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(storyboards) -->
-          Files which are .storyboard resources, possibly localizable.
-          ${SYNOPSIS}
-
-          These files are compiled to .storyboardc directories, which are
-          placed in the bundle root of the final package. If the storyboards's
-          immediate containing directory is named *.lproj (e.g. en.lproj,
-          Base.lproj), it will be placed under a directory of that name in the
-          final bundle. This allows for localizable UI.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("storyboards", LABEL_LIST)
-              .allowedFileTypes(STORYBOARD_TYPE))
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(resources) -->
-          Files to include in the final application bundle.
-          ${SYNOPSIS}
-
-          They are not processed or compiled in any way besides the processing
-          done by the rules that actually generate them. These files are placed
-          in the root of the bundle (e.g. Payload/foo.app/...) in most cases.
-          However, if they appear to be localized (i.e. are contained in a
-          directory called *.lproj), they will be placed in a directory of the
-          same name in the app bundle.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("resources", LABEL_LIST).legacyAllowAnyFileType().direct_compile_time_input())
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(structured_resources) -->
-          Files to include in the final application bundle.
-          ${SYNOPSIS}
-
-          They are not processed or compiled in any way besides the processing
-          done by the rules that actually generate them. In differences to
-          <code>resources</code> these files are placed in the bundle root in
-          the same structure passed to this argument, so
-          <code>["res/foo.png"]</code> will end up in
-          <code>Payload/foo.app/res/foo.png</code>.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("structured_resources", LABEL_LIST)
-              .legacyAllowAnyFileType()
-              .direct_compile_time_input())
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(datamodels) -->
-          Files that comprise the data models of the final linked binary.
-          ${SYNOPSIS}
-
-          Each file must have a containing directory named *.xcdatamodel, which
-          is usually contained by another *.xcdatamodeld (note the added d)
-          directory.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("datamodels", LABEL_LIST).legacyAllowAnyFileType()
-              .direct_compile_time_input())
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(asset_catalogs) -->
-          Files that comprise the asset catalogs of the final linked binary.
-          ${SYNOPSIS}
-
-          Each file must have a containing directory named *.xcassets. This
-          containing directory becomes the root of one of the asset catalogs
-          linked with any binary that depends directly or indirectly on this
-          target.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("asset_catalogs", LABEL_LIST).legacyAllowAnyFileType()
-              .direct_compile_time_input())
-          /* <!-- #BLAZE_RULE($objc_resources_rule).ATTRIBUTE(bundles) -->
-          The list of bundle targets that this target requires to be included
-          in the final bundle.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("bundles", LABEL_LIST)
-              .direct_compile_time_input()
-              .allowedRuleClasses("objc_bundle", "objc_bundle_library")
-              .allowedFileTypes())
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_resources_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(ResourceToolsRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that process resources (by defining or consuming
-   * them).
-   */
-  public static class ResourceToolsRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          .add(attr("$plmerge", LABEL).cfg(HOST).exec()
-              .value(env.getLabel("//tools/objc:plmerge")))
-          .add(attr("$actoolzip_deploy", LABEL).cfg(HOST)
-              .value(env.getLabel("//tools/objc:actoolzip_deploy.jar")))
-          .add(attr("$ibtoolzip_deploy", LABEL).cfg(HOST)
-              .value(env.getLabel("//tools/objc:ibtoolzip_deploy.jar")))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_resource_tools_rule")
-          .type(RuleClassType.ABSTRACT)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that export an xcode project.
-   */
-  public static class XcodegenRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          .add(attr("$xcodegen", LABEL).cfg(HOST).exec()
-              .value(env.getLabel("//tools/objc:xcodegen")))
-          .add(attr("$dummy_source", LABEL)
-              .value(env.getLabel("//tools/objc:dummy.c")))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_xcodegen_rule")
-          .type(RuleClassType.ABSTRACT)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that can be input to compilation (i.e. can be
-   * dependencies of other compiling rules).
-   */
-  public static class CompileDependencyRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_compile_dependency_rule).ATTRIBUTE(hdrs) -->
-          The list of Objective-C files that are included as headers by source
-          files in this rule or by users of this library.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("hdrs", LABEL_LIST)
-              .direct_compile_time_input()
-              .allowedFileTypes(FileTypeSet.ANY_FILE))
-          /* <!-- #BLAZE_RULE($objc_compile_dependency_rule).ATTRIBUTE(includes) -->
-          List of <code>#include/#import</code> search paths to add to this target
-          and all depending targets.
-          ${SYNOPSIS}
-
-          This is to support third party and open-sourced libraries that do not
-          specify the entire workspace path in their
-          <code>#import/#include</code> statements.
-          <p>
-          The paths are interpreted relative to the package directory, and the
-          genfiles and bin roots (e.g. <code>blaze-genfiles/pkg/includedir</code>
-          and <code>blaze-out/pkg/includedir</code>) are included in addition to the
-          actual client root.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("includes", Type.STRING_LIST))
-          /* <!-- #BLAZE_RULE($objc_compile_dependency_rule).ATTRIBUTE(sdk_includes) -->
-          List of <code>#include/#import</code> search paths to add to this target
-          and all depending targets, where each path is relative to
-          <code>$(SDKROOT)/usr/include</code>.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("sdk_includes", Type.STRING_LIST))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_compile_dependency_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(ResourcesRule.class, SdkFrameworksDependerRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that contain compilable content.
-   */
-  public static class CompilingRule implements RuleDefinition {
-    private static final Iterable<String> ALLOWED_DEPS_RULE_CLASSES = ImmutableSet.of(
-        "objc_library",
-        "objc_import",
-        "objc_framework",
-        "objc_proto_library",
-        "j2objc_library");
-
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_compiling_rule).ATTRIBUTE(srcs) -->
-          The list of C, C++, Objective-C, and Objective-C++ files that are
-          processed to create the library target.
-          ${SYNOPSIS}
-          These are your checked-in source files, plus any generated files.
-          These are compiled into .o files with Clang, so headers should not go
-          here (see the hdrs attribute).
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("srcs", LABEL_LIST)
-              .direct_compile_time_input()
-              .allowedFileTypes(SRCS_TYPE))
-          /* <!-- #BLAZE_RULE($objc_compiling_rule).ATTRIBUTE(non_arc_srcs) -->
-          The list of Objective-C files that are processed to create the
-          library target that DO NOT use ARC.
-          ${SYNOPSIS}
-          The files in this attribute are treated very similar to those in the
-          srcs attribute, but are compiled without ARC enabled.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("non_arc_srcs", LABEL_LIST)
-              .direct_compile_time_input()
-              .allowedFileTypes(NON_ARC_SRCS_TYPE))
-          /* <!-- #BLAZE_RULE($objc_compiling_rule).ATTRIBUTE(pch) -->
-          Header file to prepend to every source file being compiled (both arc
-          and non-arc).
-          ${SYNOPSIS}
-          Note that the file will not be precompiled - this is simply a
-          convenience, not a build-speed enhancement.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("pch", LABEL)
-              .direct_compile_time_input()
-              .allowedFileTypes(FileType.of(".pch")))
-          /* <!-- #BLAZE_RULE($objc_compiling_rule).ATTRIBUTE(deps) -->
-          The list of targets that are linked together to form the final bundle.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("deps", LABEL_LIST)
-              .direct_compile_time_input()
-              .allowedRuleClasses(ALLOWED_DEPS_RULE_CLASSES)
-              .allowedFileTypes())
-          /* <!-- #BLAZE_RULE($objc_compiling_rule).ATTRIBUTE(non_propagated_deps) -->
-          The list of targets that are required in order to build this target,
-          but which are not included in the final bundle.
-          ${SYNOPSIS}
-          This attribute should only rarely be used, and probably only for proto
-          dependencies.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("non_propagated_deps", LABEL_LIST)
-              .direct_compile_time_input()
-              .allowedRuleClasses(ALLOWED_DEPS_RULE_CLASSES)
-              .allowedFileTypes())
-          /* <!-- #BLAZE_RULE($objc_compiling_rule).ATTRIBUTE(defines) -->
-          Extra <code>-D</code> flags to pass to the compiler. They should be in
-          the form <code>KEY=VALUE</code> or simply <code>KEY</code> and are
-          passed not only the compiler for this target (as <code>copts</code>
-          are) but also to all <code>objc_</code> dependers of this target.
-          ${SYNOPSIS}
-          Subject to <a href="#make_variables">"Make variable"</a> substitution and
-          <a href="#sh-tokenization">Bourne shell tokenization</a>.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("defines", STRING_LIST))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_compiling_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(CompileDependencyRule.class, OptionsRule.class, CoptsRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that can optionally be set to {@code alwayslink}.
-   */
-  public static class AlwaysLinkRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_alwayslink_rule).ATTRIBUTE(alwayslink) -->
-          If 1, any bundle or binary that depends (directly or indirectly) on this
-          library will link in all the object files for the files listed in
-          <code>srcs</code> and <code>non_arc_srcs</code>, even if some contain no
-          symbols referenced by the binary.
-          ${SYNOPSIS}
-          This is useful if your code isn't explicitly called by code in
-          the binary, e.g., if your code registers to receive some callback
-          provided by some service.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("alwayslink", BOOLEAN))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_alwayslink_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(CompileDependencyRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that link sources and dependencies.
-   */
-  public static class LinkingRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          .add(attr(":dumpsyms", LABEL)
-          .cfg(HOST)
-          .singleArtifact()
-          .value(new LateBoundLabel<BuildConfiguration>() {
-            @Override
-            public Label getDefault(Rule rule, BuildConfiguration configuration) {
-              if (!configuration.getFragment(ObjcConfiguration.class).generateDebugSymbols()) {
-                return null;
-              }
-              return configuration.getFragment(ObjcConfiguration.class).getDumpSymsLabel();
-            }
-          }))
-        .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_linking_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(CompilingRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for rules that uses ObjC proto compiler.
-   */
-  public static class ObjcProtoRule implements RuleDefinition {
-    /**
-     * A Predicate that returns true if the ObjC proto compiler and its support deps are needed by
-     * the current rule.
-     *
-     * <p>For proto_library rules, this will return true if they have a j2objc_api_version
-     * attribute, and it is greater than 0. For other rules, this will return true by default.
-     */
-    public static final Predicate<AttributeMap> USE_PROTO_COMPILER = new Predicate<AttributeMap>() {
-      @Override
-      public boolean apply(AttributeMap rule) {
-        return rule.getAttributeDefinition("j2objc_api_version") == null
-            || rule.get("j2objc_api_version", Type.INTEGER) != 0;
-      }
-    };
-
-    public static final String COMPILE_PROTOS_ATTR = "$googlemac_proto_compiler";
-    public static final String PROTO_SUPPORT_ATTR = "$googlemac_proto_compiler_support";
-
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          .add(attr(COMPILE_PROTOS_ATTR, LABEL)
-              .allowedFileTypes(FileType.of(".py"))
-              .cfg(HOST)
-              .singleArtifact()
-              .condition(USE_PROTO_COMPILER)
-              .value(env.getLabel("//tools/objc:compile_protos")))
-          .add(attr(PROTO_SUPPORT_ATTR, LABEL)
-              .legacyAllowAnyFileType()
-              .cfg(HOST)
-              .condition(USE_PROTO_COMPILER)
-              .value(env.getLabel("//tools/objc:proto_support")))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_proto_rule")
-          .type(RuleClassType.ABSTRACT)
-          .build();
-    }
-  }
-
-  /**
-   * Base rule definition for iOS test rules.
-   */
-  public static class IosTestBaseRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, final RuleDefinitionEnvironment env) {
-      return builder
-          /* <!-- #BLAZE_RULE($ios_test_base_rule).ATTRIBUTE(target_device) -->
-          The device against which to run the test.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr(IosTest.TARGET_DEVICE, LABEL)
-              .allowedFileTypes()
-              .allowedRuleClasses("ios_device"))
-          /* <!-- #BLAZE_RULE($ios_test_base_rule).ATTRIBUTE(xctest) -->
-          Whether this target contains tests using the XCTest testing framework.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr(IosTest.IS_XCTEST, BOOLEAN))
-          /* <!-- #BLAZE_RULE($ios_test_base_rule).ATTRIBUTE(xctest_app) -->
-          A <code>objc_binary</code> target that contains the app bundle to test against in XCTest.
-          This attribute is only valid if <code>xctest</code> is true.
-          ${SYNOPSIS}
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr(IosTest.XCTEST_APP, LABEL)
-              .value(new Attribute.ComputedDefault(IosTest.IS_XCTEST) {
-                @Override
-                public Object getDefault(AttributeMap rule) {
-                  return rule.get(IosTest.IS_XCTEST, Type.BOOLEAN)
-                      ? env.getLabel("//tools/objc:xctest_app")
-                      : null;
-                }
-              })
-              .allowedFileTypes()
-              // TODO(bazel-team): Remove objc_binary once it stops exporting XcTestAppProvider.
-              .allowedRuleClasses("objc_binary", "ios_application"))
-          .override(attr("infoplist", LABEL)
-              .value(new Attribute.ComputedDefault(IosTest.IS_XCTEST) {
-                @Override
-                public Object getDefault(AttributeMap rule) {
-                  return rule.get(IosTest.IS_XCTEST, Type.BOOLEAN)
-                      ? env.getLabel("//tools/objc:xctest_infoplist")
-                      : null;
-                }
-              })
-              .allowedFileTypes(PLIST_TYPE))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$ios_test_base_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(
-              ReleaseBundlingRule.class, LinkingRule.class, XcodegenRule.class, SimulatorRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that create a bundle.
-   */
-  public static class BundlingRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_bundling_rule).ATTRIBUTE(infoplist) -->
-          The infoplist file. This corresponds to <i>appname</i>-Info.plist in Xcode projects.
-          ${SYNOPSIS}
-          Blaze will perform variable substitution on the plist file for the following values:
-          <ul>
-            <li><code>${EXECUTABLE_NAME}</code>: The name of the executable generated and included
-               in the bundle by blaze, which can be used as the value for
-               <code>CFBundleExecutable</code> within the plist.
-            <li><code>${BUNDLE_NAME}</code>: This target's name and bundle suffix (.bundle or .app)
-               in the form<code><var>name</var></code>.<code>suffix</code>.
-            <li><code>${PRODUCT_NAME}</code>: This target's name.
-         </ul>
-         <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("infoplist", LABEL)
-            .allowedFileTypes(PLIST_TYPE))
-        .add(attr("$momczip_deploy", LABEL).cfg(HOST)
-            .value(env.getLabel("//tools/objc:momczip_deploy.jar")))
-        .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_bundling_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(OptionsRule.class, ResourceToolsRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that create a bundle meant for release (e.g.
-   * application or extension).
-   */
-  public static class ReleaseBundlingRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          /* <!-- #BLAZE_RULE($objc_release_bundling_rule).ATTRIBUTE(entitlements) -->
-          The entitlements file required for device builds of this application.
-          ${SYNOPSIS}
-
-          See
-          <a href="https://developer.apple.com/library/mac/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/AboutEntitlements.html">the apple documentation</a>
-          for more information. If absent, the default entitlements from the
-          provisioning profile will be used.
-          <p>
-          The following variables are substituted as per
-          <a href="https://developer.apple.com/library/ios/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html">their definitions in Apple's documentation</a>:
-          $(AppIdentifierPrefix) and $(CFBundleIdentifier).
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("entitlements", LABEL).legacyAllowAnyFileType())
-          /* <!-- #BLAZE_RULE($objc_release_bundling_rule).ATTRIBUTE(provisioning_profile) -->
-          The provisioning profile (.mobileprovision file) to use when bundling
-          the application.
-          ${SYNOPSIS}
-
-          This is only used for non-simulator builds.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("provisioning_profile", LABEL)
-              .singleArtifact().allowedFileTypes(FileType.of(".mobileprovision")))
-          // Will be used if provisioning_profile is null.
-          .add(attr(":default_provisioning_profile", LABEL)
-              .singleArtifact()
-              .allowedFileTypes(FileType.of(".mobileprovision"))
-              .value(new LateBoundLabel<BuildConfiguration>() {
-                @Override
-                public Label getDefault(Rule rule, BuildConfiguration configuration) {
-                  ObjcConfiguration objcConfiguration =
-                      configuration.getFragment(ObjcConfiguration.class);
-                  if (objcConfiguration.getBundlingPlatform() != Platform.DEVICE) {
-                    return null;
-                  }
-                  if (rule.isAttributeValueExplicitlySpecified("provisioning_profile")) {
-                    return null;
-                  }
-                  return objcConfiguration.getDefaultProvisioningProfileLabel();
-                }
-              }))
-          /* <!-- #BLAZE_RULE($objc_release_bundling_rule).ATTRIBUTE(app_icon) -->
-          The name of the application icon.
-          ${SYNOPSIS}
-
-          The icon should be in one of the asset catalogs of this target or
-          a (transitive) dependency. In a new project, this is initialized
-          to "AppIcon" by Xcode.
-          <p>
-          If the application icon is not in an asset catalog, do not use this
-          attribute. Instead, add a CFBundleIcons entry to the Info.plist file.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("app_icon", STRING))
-          /* <!-- #BLAZE_RULE($objc_release_bundling_rule).ATTRIBUTE(launch_image) -->
-          The name of the launch image.
-          ${SYNOPSIS}
-
-          The icon should be in one of the asset catalogs of this target or
-          a (transitive) dependency. In a new project, this is initialized
-          to "LaunchImage" by Xcode.
-          <p>
-          If the launch image is not in an asset catalog, do not use this
-          attribute. Instead, add an appropriately-named image resource to the
-          bundle.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("launch_image", STRING))
-          /* <!-- #BLAZE_RULE($objc_release_bundling_rule).ATTRIBUTE(bundle_id) -->
-          The bundle ID (reverse-DNS path followed by app name) of the binary.
-          ${SYNOPSIS}
-
-          If none is specified, a junk value will be used.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("bundle_id", STRING)
-              .value(new Attribute.ComputedDefault() {
-                @Override
-                public Object getDefault(AttributeMap rule) {
-                  // For tests and similar, we don't want to force people to explicitly specify
-                  // throw-away data.
-                  return "example." + rule.getName();
-                }
-              }))
-          /* <!-- #BLAZE_RULE($objc_release_bundling_rule).ATTRIBUTE(families) -->
-          The device families to which this binary is targeted.
-          ${SYNOPSIS}
-
-          This is known as the <code>TARGETED_DEVICE_FAMILY</code> build setting
-          in Xcode project files. It is a list of one or more of the strings
-          <code>"iphone"</code> and <code>"ipad"</code>.
-          <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-          .add(attr("families", STRING_LIST)
-              .value(ImmutableList.of(TargetDeviceFamily.IPHONE.getNameInRule())))
-          .add(attr("$bundlemerge", LABEL).cfg(HOST).exec()
-              .value(env.getLabel("//tools/objc:bundlemerge")))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_release_bundling_rule")
-          .type(RuleClassType.ABSTRACT)
-          .ancestors(BundlingRule.class)
-          .build();
-    }
-  }
-
-  /**
-   * Common attributes for {@code objc_*} rules that use the iOS simulator.
-   */
-  public static class SimulatorRule implements RuleDefinition {
-    @Override
-    public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-      return builder
-          // Needed to run the binary in the simulator.
-          .add(attr("$iossim", LABEL).cfg(HOST).exec()
-              .value(env.getLabel("//third_party/iossim:iossim")))
-          .build();
-    }
-    @Override
-    public Metadata getMetadata() {
-      return RuleDefinition.Metadata.builder()
-          .name("$objc_simulator_rule")
-          .type(RuleClassType.ABSTRACT)
-          .build();
-    }
-  }
-
-  /**
-   * Object that supplies tools used by all rules which have the helper tools common to most rule
-   * implementations.
-   */
-  static final class Tools {
-    private final RuleContext ruleContext;
-
-    Tools(RuleContext ruleContext) {
-      this.ruleContext = Preconditions.checkNotNull(ruleContext);
-    }
-
-    FilesToRunProvider xcodegen() {
-      return ruleContext.getExecutablePrerequisite("$xcodegen", Mode.HOST);
-    }
-  }
-}
-
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcSdkFrameworks.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcSdkFrameworks.java
deleted file mode 100644
index adaae20..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcSdkFrameworks.java
+++ /dev/null
@@ -1,71 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.collect.ImmutableSet;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.rules.objc.ObjcRuleClasses.SdkFrameworksDependerRule;
-
-/**
- * Common logic for rules that inherit from {@link SdkFrameworksDependerRule}.
- */
-public class ObjcSdkFrameworks {
-
-  /**
-   * Class that handles extraction and processing of attributes common to inheritors of {@link
-   * SdkFrameworksDependerRule}.
-   */
-  public static class Attributes {
-
-    private final RuleContext ruleContext;
-
-    public Attributes(RuleContext ruleContext) {
-      this.ruleContext = ruleContext;
-    }
-
-    /**
-     * Returns the SDK frameworks defined on the rule's {@code sdk_frameworks} attribute as well as
-     * base frameworks defined in {@link ObjcRuleClasses#AUTOMATIC_SDK_FRAMEWORKS}.
-     */
-    ImmutableSet<SdkFramework> sdkFrameworks() {
-      ImmutableSet.Builder<SdkFramework> result = new ImmutableSet.Builder<>();
-      result.addAll(ObjcRuleClasses.AUTOMATIC_SDK_FRAMEWORKS);
-      for (String explicit : ruleContext.attributes().get("sdk_frameworks", Type.STRING_LIST)) {
-        result.add(new SdkFramework(explicit));
-      }
-      return result.build();
-    }
-
-    /**
-     * Returns all SDK frameworks defined on the rule's {@code weak_sdk_frameworks} attribute.
-     */
-    ImmutableSet<SdkFramework> weakSdkFrameworks() {
-      ImmutableSet.Builder<SdkFramework> result = new ImmutableSet.Builder<>();
-      for (String frameworkName :
-          ruleContext.attributes().get("weak_sdk_frameworks", Type.STRING_LIST)) {
-        result.add(new SdkFramework(frameworkName));
-      }
-      return result.build();
-    }
-
-    /**
-     * Returns all SDK dylibs defined on the rule's {@code sdk_dylibs} attribute.
-     */
-    ImmutableSet<String> sdkDylibs() {
-      return ImmutableSet.copyOf(ruleContext.attributes().get("sdk_dylibs", Type.STRING_LIST));
-    }
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeproj.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeproj.java
deleted file mode 100644
index e167f89..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeproj.java
+++ /dev/null
@@ -1,47 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.RunfilesProvider;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.collect.nestedset.Order;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-
-/**
- * Implementation for {@code objc_xcodeproj}.
- */
-public class ObjcXcodeproj implements RuleConfiguredTargetFactory {
-
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    XcodeProvider.Project project = XcodeProvider.Project.fromTopLevelTargets(
-        ruleContext.getPrerequisites("deps", Mode.TARGET, XcodeProvider.class));
-    Artifact pbxproj = ruleContext.getImplicitOutputArtifact(XcodeSupport.PBXPROJ);
-
-    ObjcActionsBuilder actionsBuilder = ObjcRuleClasses.actionsBuilder(ruleContext);
-    actionsBuilder.registerXcodegenActions(
-        new ObjcRuleClasses.Tools(ruleContext), pbxproj, project);
-
-    return new RuleConfiguredTargetBuilder(ruleContext)
-        .setFilesToBuild(NestedSetBuilder.create(Order.STABLE_ORDER, pbxproj))
-        .addProvider(RunfilesProvider.class, RunfilesProvider.EMPTY)
-        .build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeprojRule.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeprojRule.java
deleted file mode 100644
index 8814b23..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ObjcXcodeprojRule.java
+++ /dev/null
@@ -1,82 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.Attribute.attr;
-import static com.google.devtools.build.lib.packages.Type.BOOLEAN;
-import static com.google.devtools.build.lib.packages.Type.LABEL_LIST;
-
-import com.google.devtools.build.lib.analysis.BaseRuleClasses;
-import com.google.devtools.build.lib.analysis.RuleDefinition;
-import com.google.devtools.build.lib.analysis.RuleDefinitionEnvironment;
-import com.google.devtools.build.lib.packages.RuleClass;
-import com.google.devtools.build.lib.packages.RuleClass.Builder;
-
-/**
- * Rule definition for {@code objc_xcodeproj}.
- */
-public class ObjcXcodeprojRule implements RuleDefinition {
-  @Override
-  public RuleClass build(Builder builder, RuleDefinitionEnvironment env) {
-    return builder
-        /*<!-- #BLAZE_RULE(objc_xcodeproj).IMPLICIT_OUTPUTS -->
-        <ul>
-        <li><code><var>name</var>.xcodeproj/project.pbxproj</code>: A combined Xcode project file
-            containing all the included targets which can be used to develop or build on a Mac.</li>
-        </ul>
-        <!-- #END_BLAZE_RULE.IMPLICIT_OUTPUTS -->*/
-        .setImplicitOutputsFunction(XcodeSupport.PBXPROJ)
-        /* <!-- #BLAZE_RULE(objc_xcodeproj).ATTRIBUTE(deps) -->
-        The list of targets to include in the combined Xcode project file.
-        ${SYNOPSIS}
-        <!-- #END_BLAZE_RULE.ATTRIBUTE -->*/
-        .add(attr("deps", LABEL_LIST)
-            .nonEmpty()
-            .allowedRuleClasses(
-                "objc_binary",
-                "ios_application",
-                "ios_extension_binary",
-                "ios_extension",
-                "ios_test",                
-                "objc_bundle_library",
-                "objc_import",
-                "objc_library")
-            .allowedFileTypes())
-        .override(attr("testonly", BOOLEAN)
-            .nonconfigurable("Must support test deps.")
-            .value(true))
-        .build();
-  }
-
-  @Override
-  public Metadata getMetadata() {
-    return RuleDefinition.Metadata.builder()
-        .name("objc_xcodeproj")
-        .factoryClass(ObjcXcodeproj.class)
-        .ancestors(BaseRuleClasses.BaseRule.class, ObjcRuleClasses.XcodegenRule.class)
-        .build();
-  }
-}
-
-/*<!-- #BLAZE_RULE (NAME = objc_xcodeproj, TYPE = OTHER, FAMILY = Objective-C) -->
-
-${ATTRIBUTE_SIGNATURE}
-
-<p>This rule combines build information about several objc targets (and all their transitive
-dependencies) into a single Xcode project file, for use in developing on a Mac.</p>
-
-${ATTRIBUTE_DEFINITION}
-
-<!-- #END_BLAZE_RULE -->*/
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/OptionsProvider.java b/src/main/java/com/google/devtools/build/lib/rules/objc/OptionsProvider.java
deleted file mode 100644
index 84a2ee5..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/OptionsProvider.java
+++ /dev/null
@@ -1,86 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.TransitiveInfoProvider;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-
-/**
- * Provides information contained in a {@code objc_options} target.
- */
-@Immutable
-final class OptionsProvider
-    extends Value<OptionsProvider>
-    implements TransitiveInfoProvider {
-  static final class Builder {
-    private Iterable<String> copts = ImmutableList.of();
-    private final NestedSetBuilder<Artifact> infoplists = NestedSetBuilder.stableOrder();
-
-    /**
-     * Adds copts to the end of the copts sequence.
-     */
-    public Builder addCopts(Iterable<String> copts) {
-      this.copts = Iterables.concat(this.copts, copts);
-      return this;
-    }
-
-    public Builder addInfoplists(Iterable<Artifact> infoplists) {
-      this.infoplists.addAll(infoplists);
-      return this;
-    }
-
-    /**
-     * Adds infoplists and copts from the given provider, if present. copts are added to the end of
-     * the sequence.
-     */
-    public Builder addTransitive(Optional<OptionsProvider> maybeProvider) {
-      for (OptionsProvider provider : maybeProvider.asSet()) {
-        this.copts = Iterables.concat(this.copts, provider.copts);
-        this.infoplists.addTransitive(provider.infoplists);
-      }
-      return this;
-    }
-
-    public OptionsProvider build() {
-      return new OptionsProvider(ImmutableList.copyOf(copts), infoplists.build());
-    }
-  }
-
-  public static final OptionsProvider DEFAULT = new Builder().build();
-
-  private final ImmutableList<String> copts;
-  private final NestedSet<Artifact> infoplists;
-
-  private OptionsProvider(ImmutableList<String> copts, NestedSet<Artifact> infoplists) {
-    super(copts, infoplists);
-    this.copts = Preconditions.checkNotNull(copts);
-    this.infoplists = Preconditions.checkNotNull(infoplists);
-  }
-
-  public ImmutableList<String> getCopts() {
-    return copts;
-  }
-
-  public NestedSet<Artifact> getInfoplists() {
-    return infoplists;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Platform.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Platform.java
deleted file mode 100644
index 2fbe1b7..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Platform.java
+++ /dev/null
@@ -1,58 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableSet;
-
-import java.util.Locale;
-import java.util.Set;
-
-/**
- * An enum that can be used to distinguish between an iOS simulator and device.
- */
-public enum Platform {
-  DEVICE("iPhoneOS"), SIMULATOR("iPhoneSimulator");
-
-  private static final Set<String> SIMULATOR_ARCHS = ImmutableSet.of("i386", "x86_64");
-
-  private final String nameInPlist;
-
-  Platform(String nameInPlist) {
-    this.nameInPlist = Preconditions.checkNotNull(nameInPlist);
-  }
-
-  /**
-   * Returns the name of the "platform" as it appears in the CFBundleSupportedPlatforms plist
-   * setting.
-   */
-  public String getNameInPlist() {
-    return nameInPlist;
-  }
-
-  /**
-   * Returns the name of the "platform" as it appears in the plist when it appears in all-lowercase.
-   */
-  public String getLowerCaseNameInPlist() {
-    return nameInPlist.toLowerCase(Locale.US);
-  }
-
-  /**
-   * Returns the platform for the arch.
-   */
-  public static Platform forArch(String arch) {
-    return SIMULATOR_ARCHS.contains(arch) ? SIMULATOR : DEVICE;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingSupport.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingSupport.java
deleted file mode 100644
index 56567e5..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingSupport.java
+++ /dev/null
@@ -1,755 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.common.base.Preconditions.checkNotNull;
-import static com.google.devtools.build.lib.packages.ImplicitOutputsFunction.fromTemplates;
-import static com.google.devtools.build.lib.rules.objc.TargetDeviceFamily.UI_DEVICE_FAMILY_VALUES;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Joiner;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.BuildInfo;
-import com.google.devtools.build.lib.analysis.FilesToRunProvider;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.analysis.Runfiles;
-import com.google.devtools.build.lib.analysis.RunfilesSupport;
-import com.google.devtools.build.lib.analysis.actions.BinaryFileWriteAction;
-import com.google.devtools.build.lib.analysis.actions.CustomCommandLine;
-import com.google.devtools.build.lib.analysis.actions.SpawnAction;
-import com.google.devtools.build.lib.analysis.actions.TemplateExpansionAction;
-import com.google.devtools.build.lib.analysis.actions.TemplateExpansionAction.Substitution;
-import com.google.devtools.build.lib.analysis.config.BuildOptions;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.collect.nestedset.Order;
-import com.google.devtools.build.lib.packages.Attribute.SplitTransition;
-import com.google.devtools.build.lib.packages.ImplicitOutputsFunction.SafeImplicitOutputsFunction;
-import com.google.devtools.build.lib.packages.Type;
-import com.google.devtools.build.lib.rules.objc.ObjcActionsBuilder.ExtraActoolArgs;
-import com.google.devtools.build.lib.rules.objc.TargetDeviceFamily.InvalidFamilyNameException;
-import com.google.devtools.build.lib.rules.objc.TargetDeviceFamily.RepeatedFamilyNameException;
-import com.google.devtools.build.lib.shell.ShellUtils;
-import com.google.devtools.build.lib.vfs.PathFragment;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.XcodeprojBuildSetting;
-
-import java.util.List;
-import java.util.Set;
-
-import javax.annotation.Nullable;
-
-/**
- * Support for released bundles, such as an application or extension. Such a bundle is generally
- * composed of a top-level {@link BundleSupport bundle}, potentially signed, as well as some debug
- * information, if {@link ObjcConfiguration#generateDebugSymbols() requested}.
- *
- * <p>Contains actions, validation logic and provider value generation.
- *
- * <p>Methods on this class can be called in any order without impacting the result.
- */
-public final class ReleaseBundlingSupport {
-
-  /**
-   * Template for the containing application folder.
-   */
-  public static final SafeImplicitOutputsFunction IPA = fromTemplates("%{name}.ipa");
-
-  /**
-   * Transition that when applied to a target generates a configured target for each value in
-   * {@code --ios_multi_cpus}, such that {@code --ios_cpu} is set to a different one of those values
-   * in the configured targets.
-   */
-  public static final SplitTransition<BuildOptions> SPLIT_ARCH_TRANSITION =
-      new SplitTransition<BuildOptions>() {
-        @Override
-        public List<BuildOptions> split(BuildOptions buildOptions) {
-          List<String> iosMultiCpus = buildOptions.get(ObjcCommandLineOptions.class).iosMultiCpus;
-          if (iosMultiCpus.isEmpty()) {
-            return ImmutableList.of();
-          }
-
-          ImmutableList.Builder<BuildOptions> splitBuildOptions = ImmutableList.builder();
-          for (String iosCpu : iosMultiCpus) {
-            BuildOptions splitOptions = buildOptions.clone();
-            splitOptions.get(ObjcCommandLineOptions.class).iosSplitCpu = iosCpu;
-            splitOptions.get(ObjcCommandLineOptions.class).iosCpu = iosCpu;
-            splitBuildOptions.add(splitOptions);
-          }
-          return splitBuildOptions.build();
-        }
-
-        @Override
-        public boolean defaultsToSelf() {
-          return true;
-        }
-      };
-
-  @VisibleForTesting
-  static final String NO_ASSET_CATALOG_ERROR_FORMAT =
-      "a value was specified (%s), but this app does not have any asset catalogs";
-  @VisibleForTesting
-  static final String INVALID_FAMILIES_ERROR =
-      "Expected one or two strings from the list 'iphone', 'ipad'";
-  @VisibleForTesting
-  static final String DEVICE_NO_PROVISIONING_PROFILE =
-      "Provisioning profile must be set for device build";
-
-  @VisibleForTesting
-  static final String PROVISIONING_PROFILE_BUNDLE_FILE = "embedded.mobileprovision";
-  @VisibleForTesting
-  static final String APP_BUNDLE_DIR_FORMAT = "Payload/%s.app";
-  @VisibleForTesting
-  static final String EXTENSION_BUNDLE_DIR_FORMAT = "PlugIns/%s.appex";
-
-  private final Attributes attributes;
-  private final BundleSupport bundleSupport;
-  private final RuleContext ruleContext;
-  private final Bundling bundling;
-  private final ObjcProvider objcProvider;
-  private final LinkedBinary linkedBinary;
-  private final ImmutableSet<TargetDeviceFamily> families;
-  private final IntermediateArtifacts intermediateArtifacts;
-
-  /**
-   * Indicator as to whether this rule generates a binary directly or whether only dependencies
-   * should be considered.
-   */
-  enum LinkedBinary {
-    /**
-     * This rule generates its own binary which should be included as well as dependency-generated
-     * binaries.
-     */
-    LOCAL_AND_DEPENDENCIES,
-
-    /**
-     * This rule does not generate its own binary, only consider binaries from dependencies.
-     */
-    DEPENDENCIES_ONLY
-  }
-
-  /**
-   * Creates a new application support within the given rule context.
-   *
-   * @param ruleContext context for the application-generating rule
-   * @param objcProvider provider containing all dependencies' information as well as some of this
-   *    rule's
-   * @param optionsProvider provider containing options and plist settings for this rule and its
-   *    dependencies
-   * @param linkedBinary whether to look for a linked binary from this rule and dependencies or just
-   *    the latter
-   * @param bundleDirFormat format string representing the bundle's directory with a single
-   *     placeholder for the target name (e.g. {@code "Payload/%s.app"})
-   */
-  ReleaseBundlingSupport(
-      RuleContext ruleContext, ObjcProvider objcProvider, OptionsProvider optionsProvider,
-      LinkedBinary linkedBinary, String bundleDirFormat) {
-    this.linkedBinary = linkedBinary;
-    this.attributes = new Attributes(ruleContext);
-    this.ruleContext = ruleContext;
-    this.objcProvider = objcProvider;
-    this.families = ImmutableSet.copyOf(attributes.families());
-    this.intermediateArtifacts = ObjcRuleClasses.intermediateArtifacts(ruleContext);
-    bundling = bundling(ruleContext, objcProvider, optionsProvider, bundleDirFormat);
-    bundleSupport = new BundleSupport(ruleContext, families, bundling, extraActoolArgs());
-  }
-
-  /**
-   * Validates application-related attributes set on this rule and registers any errors with the
-   * rule context.
-   *
-   * @return this application support
-   */
-  ReleaseBundlingSupport validateAttributes() {
-    // No asset catalogs. That means you cannot specify app_icon or
-    // launch_image attributes, since they must not exist. However, we don't
-    // run actool in this case, which means it does not do validity checks,
-    // and we MUST raise our own error somehow...
-    if (!objcProvider.hasAssetCatalogs()) {
-      if (attributes.appIcon() != null) {
-        ruleContext.attributeError("app_icon",
-            String.format(NO_ASSET_CATALOG_ERROR_FORMAT, attributes.appIcon()));
-      }
-      if (attributes.launchImage() != null) {
-        ruleContext.attributeError("launch_image",
-            String.format(NO_ASSET_CATALOG_ERROR_FORMAT, attributes.launchImage()));
-      }
-    }
-
-    if (families.isEmpty()) {
-      ruleContext.attributeError("families", INVALID_FAMILIES_ERROR);
-    }
-
-    return this;
-  }
-
-  /**
-   * Validates that resources defined in this rule and its dependencies and written to this bundle
-   * are legal.
-   *
-   * @return this release bundling support
-   */
-  ReleaseBundlingSupport validateResources() {
-    bundleSupport.validateResources(objcProvider);
-    return this;
-  }
-
-  /**
-   * Registers actions required to build an application. This includes any
-   * {@link BundleSupport#registerActions(ObjcProvider) bundle} and bundle merge actions, signing
-   * this application if appropriate and combining several single-architecture binaries into one
-   * multi-architecture binary.
-   *
-   * @return this application support
-   */
-  ReleaseBundlingSupport registerActions() {
-    bundleSupport.registerActions(objcProvider);
-
-    registerCombineArchitecturesAction();
-
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    Artifact ipaOutput = ruleContext.getImplicitOutputArtifact(IPA);
-
-    Artifact maybeSignedIpa;
-    if (objcConfiguration.getBundlingPlatform() == Platform.SIMULATOR) {
-      maybeSignedIpa = ipaOutput;
-    } else if (attributes.provisioningProfile() == null) {
-      throw new IllegalStateException(DEVICE_NO_PROVISIONING_PROFILE);
-    } else {
-      maybeSignedIpa = registerBundleSigningActions(ipaOutput);
-    }
-    
-    registerEmbedLabelPlistAction();
-
-    BundleMergeControlBytes bundleMergeControlBytes = new BundleMergeControlBytes(
-        bundling, maybeSignedIpa, objcConfiguration, families);
-    registerBundleMergeActions(
-        maybeSignedIpa, bundling.getBundleContentArtifacts(), bundleMergeControlBytes);
-
-    return this;
-  }
-
-  private void registerEmbedLabelPlistAction() {
-    Artifact buildInfo = Iterables.getOnlyElement(
-        ruleContext.getAnalysisEnvironment().getBuildInfo(ruleContext, ObjcBuildInfoFactory.KEY));
-    ruleContext.registerAction(new SpawnAction.Builder()
-        .setMnemonic("ObjcVersionPlist")
-        .setExecutable(new PathFragment("/bin/bash"))
-        .setCommandLine(new CustomCommandLine.Builder()
-            .add("-c")
-            .add(
-                "VERSION=\"$("
-                + "grep \"^" + BuildInfo.BUILD_EMBED_LABEL + "\" " + buildInfo.getExecPathString()
-                + " | cut -d' ' -f2- | sed -e 's#\"#\\\"#g')\" && "
-                + "cat >" + getGeneratedVersionPlist().getExecPathString() + " <<EOF\n"
-                + "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n"
-                + "<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" "
-                + "\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n"
-                + "<plist version=\"1.0\">\n"
-                + "<dict>\n"
-                + "EOF\n"
-
-                + "if [[ -n \"${VERSION}\" ]]; then\n"
-                + "  for KEY in CFBundleVersion CFBundleShortVersionString; do\n"
-                + "    echo \"  <key>${KEY}</key>\n\" >> "
-                + getGeneratedVersionPlist().getExecPathString() + "\n"
-                + "    echo \"  <string>${VERSION}</string>\n\" >> "
-                + getGeneratedVersionPlist().getExecPathString() + "\n"
-                + "  done\n"
-                + "fi\n"
-
-                + "cat >>" + getGeneratedVersionPlist().getExecPathString() + " <<EOF\n"
-                + "</dict>\n"
-                + "</plist>\n"
-                + "EOF\n"
-            )
-            .build())
-        .addInput(buildInfo)
-        .addOutput(getGeneratedVersionPlist())
-        .build(ruleContext));
-  }
-
-  private Artifact registerBundleSigningActions(Artifact ipaOutput) {
-    PathFragment entitlementsDirectory = ruleContext.getUniqueDirectory("entitlements");
-    Artifact teamPrefixFile =
-        ruleContext.getRelatedArtifact(entitlementsDirectory, ".team_prefix_file");
-    registerExtractTeamPrefixAction(teamPrefixFile);
-
-    Artifact entitlementsNeedingSubstitution = attributes.entitlements();
-    if (entitlementsNeedingSubstitution == null) {
-      entitlementsNeedingSubstitution = ruleContext.getRelatedArtifact(
-          entitlementsDirectory, ".entitlements_with_variables");
-      registerExtractEntitlementsAction(entitlementsNeedingSubstitution);
-    }
-    Artifact entitlements =
-        ruleContext.getRelatedArtifact(entitlementsDirectory, ".entitlements");
-    registerEntitlementsVariableSubstitutionAction(
-        entitlementsNeedingSubstitution, entitlements, teamPrefixFile);
-    Artifact ipaUnsigned = ObjcRuleClasses.artifactByAppendingToRootRelativePath(
-        ruleContext, ipaOutput.getExecPath(), ".unsigned");
-    registerSignBundleAction(entitlements, ipaOutput, ipaUnsigned);
-    return ipaUnsigned;
-  }
-
-  /**
-   * Adds bundle- and application-related settings to the given Xcode provider builder.
-   *
-   * @return this application support
-   */
-  ReleaseBundlingSupport addXcodeSettings(XcodeProvider.Builder xcodeProviderBuilder) {
-    bundleSupport.addXcodeSettings(xcodeProviderBuilder);
-    xcodeProviderBuilder.addXcodeprojBuildSettings(buildSettings());
-
-    return this;
-  }
-
-  /**
-   * Adds any files to the given nested set builder that should be built if this application is the
-   * top level target in a blaze invocation.
-   *
-   * @return this application support
-   */
-  ReleaseBundlingSupport addFilesToBuild(NestedSetBuilder<Artifact> filesToBuild) {
-    NestedSetBuilder<Artifact> debugSymbolBuilder = NestedSetBuilder.<Artifact>stableOrder()
-        .addTransitive(objcProvider.get(ObjcProvider.DEBUG_SYMBOLS));
-
-    if (linkedBinary == LinkedBinary.LOCAL_AND_DEPENDENCIES
-        && ObjcRuleClasses.objcConfiguration(ruleContext).generateDebugSymbols()) {
-      IntermediateArtifacts intermediateArtifacts =
-          ObjcRuleClasses.intermediateArtifacts(ruleContext);
-      debugSymbolBuilder.add(intermediateArtifacts.dsymPlist())
-          .add(intermediateArtifacts.dsymSymbol())
-          .add(intermediateArtifacts.breakpadSym());
-    }
-
-    filesToBuild.add(ruleContext.getImplicitOutputArtifact(ReleaseBundlingSupport.IPA))
-        // TODO(bazel-team): Fat binaries may require some merging of these file rather than just
-        // making them available.
-        .addTransitive(debugSymbolBuilder.build());
-    return this;
-  }
-
-  /**
-   * Creates the {@link XcTestAppProvider} that can be used if this application is used as an
-   * {@code xctest_app}.
-   */
-  XcTestAppProvider xcTestAppProvider() {
-    // We want access to #import-able things from our test rig's dependency graph, but we don't
-    // want to link anything since that stuff is shared automatically by way of the
-    // -bundle_loader linker flag.
-    ObjcProvider partialObjcProvider = new ObjcProvider.Builder()
-        .addTransitiveAndPropagate(ObjcProvider.HEADER, objcProvider)
-        .addTransitiveAndPropagate(ObjcProvider.INCLUDE, objcProvider)
-        .addTransitiveAndPropagate(ObjcProvider.SDK_DYLIB, objcProvider)
-        .addTransitiveAndPropagate(ObjcProvider.SDK_FRAMEWORK, objcProvider)
-        .addTransitiveAndPropagate(ObjcProvider.WEAK_SDK_FRAMEWORK, objcProvider)
-        .addTransitiveAndPropagate(ObjcProvider.FRAMEWORK_DIR, objcProvider)
-        .addTransitiveAndPropagate(ObjcProvider.FRAMEWORK_FILE, objcProvider)
-        .build();
-    // TODO(bazel-team): Handle the FRAMEWORK_DIR key properly. We probably want to add it to
-    // framework search paths, but not actually link it with the -framework flag.
-    return new XcTestAppProvider(intermediateArtifacts.combinedArchitectureBinary(),
-        ruleContext.getImplicitOutputArtifact(IPA), partialObjcProvider);
-  }
-
-  /**
-   * Registers an action to generate a runner script based on a template.
-   */
-  ReleaseBundlingSupport registerGenerateRunnerScriptAction(Artifact runnerScript,
-      Artifact ipaInput) {
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    String escapedSimDevice = ShellUtils.shellEscape(objcConfiguration.getIosSimulatorDevice());
-    String escapedSdkVersion = ShellUtils.shellEscape(objcConfiguration.getIosSimulatorVersion());
-    ImmutableList<Substitution> substitutions = ImmutableList.of(
-        Substitution.of("%app_name%", ruleContext.getLabel().getName()),
-        Substitution.of("%ipa_file%", ipaInput.getRootRelativePath().getPathString()),
-        Substitution.of("%sim_device%", escapedSimDevice),
-        Substitution.of("%sdk_version%", escapedSdkVersion),
-        Substitution.of("%iossim%", attributes.iossim().getRootRelativePath().getPathString()));
-
-    ruleContext.registerAction(
-        new TemplateExpansionAction(ruleContext.getActionOwner(), attributes.runnerScriptTemplate(),
-            runnerScript, substitutions, true));
-    return this;
-  }
-
-  /**
-   * Returns a {@link RunfilesSupport} that uses the provided runner script as the executable.
-   */
-  RunfilesSupport runfilesSupport(Artifact runnerScript) {
-    Artifact ipaFile = ruleContext.getImplicitOutputArtifact(ReleaseBundlingSupport.IPA);
-    Runfiles runfiles = new Runfiles.Builder()
-        .addArtifact(ipaFile)
-        .addArtifact(runnerScript)
-        .addArtifact(attributes.iossim())
-        .build();
-    return RunfilesSupport.withExecutable(ruleContext, runfiles, runnerScript);
-  }
-
-  private ExtraActoolArgs extraActoolArgs() {
-    ImmutableList.Builder<String> extraArgs = ImmutableList.builder();
-    if (attributes.appIcon() != null) {
-      extraArgs.add("--app-icon", attributes.appIcon());
-    }
-    if (attributes.launchImage() != null) {
-      extraArgs.add("--launch-image", attributes.launchImage());
-    }
-    return new ExtraActoolArgs(extraArgs.build());
-  }
-
-  private Bundling bundling(
-      RuleContext ruleContext, ObjcProvider objcProvider, OptionsProvider optionsProvider,
-      String bundleDirFormat) {
-    ImmutableList<BundleableFile> extraBundleFiles;
-    ObjcConfiguration objcConfiguration = ObjcRuleClasses.objcConfiguration(ruleContext);
-    if (objcConfiguration.getBundlingPlatform() == Platform.DEVICE) {
-      extraBundleFiles = ImmutableList.of(new BundleableFile(
-          new Attributes(ruleContext).provisioningProfile(),
-          PROVISIONING_PROFILE_BUNDLE_FILE));
-    } else {
-      extraBundleFiles = ImmutableList.of();
-    }
-    
-    String primaryBundleId = null; 
-    String fallbackBundleId = null;
-
-    if (ruleContext.attributes().isAttributeValueExplicitlySpecified("bundle_id")) {
-      primaryBundleId = ruleContext.attributes().get("bundle_id", Type.STRING);
-    } else {
-      fallbackBundleId = ruleContext.attributes().get("bundle_id", Type.STRING);
-    }
-
-    return new Bundling.Builder()
-        .setName(ruleContext.getLabel().getName())
-        // Architecture that determines which nested bundles are kept.
-        .setArchitecture(objcConfiguration.getDependencySingleArchitecture())
-        .setBundleDirFormat(bundleDirFormat)
-        .addExtraBundleFiles(extraBundleFiles)
-        .setObjcProvider(objcProvider)
-        .setInfoplistMerging(
-            BundleSupport.infoPlistMerging(ruleContext, objcProvider, optionsProvider,
-                new BundleSupport.ExtraMergePlists(getGeneratedVersionPlist())))
-        .setIntermediateArtifacts(ObjcRuleClasses.intermediateArtifacts(ruleContext))
-        .setPrimaryBundleId(primaryBundleId)
-        .setFallbackBundleId(fallbackBundleId)
-        .build();
-  }
-
-  private void registerCombineArchitecturesAction() {
-    Artifact resultingLinkedBinary = intermediateArtifacts.combinedArchitectureBinary();
-    NestedSet<Artifact> linkedBinaries = linkedBinaries();
-
-    ruleContext.registerAction(ObjcActionsBuilder.spawnOnDarwinActionBuilder()
-        .setMnemonic("ObjcCombiningArchitectures")
-        .addTransitiveInputs(linkedBinaries)
-        .addOutput(resultingLinkedBinary)
-        .setExecutable(ObjcRuleClasses.LIPO)
-        .setCommandLine(CustomCommandLine.builder()
-            .addExecPaths("-create", linkedBinaries)
-            .addExecPath("-o", resultingLinkedBinary)
-            .build())
-        .build(ruleContext));
-  }
-
-  private NestedSet<Artifact> linkedBinaries() {
-    NestedSetBuilder<Artifact> linkedBinariesBuilder = NestedSetBuilder.<Artifact>stableOrder()
-        .addTransitive(attributes.dependentLinkedBinaries());
-    if (linkedBinary == LinkedBinary.LOCAL_AND_DEPENDENCIES) {
-      linkedBinariesBuilder.add(intermediateArtifacts.singleArchitectureBinary());
-    }
-    return linkedBinariesBuilder.build();
-  }
-
-  /** Returns this target's Xcode build settings. */
-  private Iterable<XcodeprojBuildSetting> buildSettings() {
-    ImmutableList.Builder<XcodeprojBuildSetting> buildSettings = new ImmutableList.Builder<>();
-    if (attributes.appIcon() != null) {
-      buildSettings.add(XcodeprojBuildSetting.newBuilder()
-          .setName("ASSETCATALOG_COMPILER_APPICON_NAME")
-          .setValue(attributes.appIcon())
-          .build());
-    }
-    if (attributes.launchImage() != null) {
-      buildSettings.add(XcodeprojBuildSetting.newBuilder()
-          .setName("ASSETCATALOG_COMPILER_LAUNCHIMAGE_NAME")
-          .setValue(attributes.launchImage())
-          .build());
-    }
-
-    // Convert names to a sequence containing "1" and/or "2" for iPhone and iPad, respectively.
-    Iterable<Integer> familyIndexes =
-        families.isEmpty() ? ImmutableList.<Integer>of() : UI_DEVICE_FAMILY_VALUES.get(families);
-    buildSettings.add(XcodeprojBuildSetting.newBuilder()
-        .setName("TARGETED_DEVICE_FAMILY")
-        .setValue(Joiner.on(',').join(familyIndexes))
-        .build());
-
-    Artifact entitlements = attributes.entitlements();
-    if (entitlements != null) {
-      buildSettings.add(XcodeprojBuildSetting.newBuilder()
-          .setName("CODE_SIGN_ENTITLEMENTS")
-          .setValue("$(WORKSPACE_ROOT)/" + entitlements.getExecPathString())
-          .build());
-    }
-
-    return buildSettings.build();
-  }
-
-  private ReleaseBundlingSupport registerSignBundleAction(
-      Artifact entitlements, Artifact ipaOutput, Artifact ipaUnsigned) {
-    // TODO(bazel-team): Support variable substitution
-    ruleContext.registerAction(ObjcActionsBuilder.spawnOnDarwinActionBuilder()
-        .setMnemonic("IosSignBundle")
-        .setProgressMessage("Signing iOS bundle: " + ruleContext.getLabel())
-        .setExecutable(new PathFragment("/bin/bash"))
-        .addArgument("-c")
-        // TODO(bazel-team): Support --resource-rules for resources
-        .addArgument("set -e && "
-            + "t=$(mktemp -d -t signing_intermediate) && "
-            // Get an absolute path since we need to cd into the temp directory for zip.
-            + "signed_ipa=${PWD}/" + ipaOutput.getExecPathString() + " && "
-            + "unzip -qq " + ipaUnsigned.getExecPathString() + " -d ${t} && "
-            + codesignCommand(
-                attributes.provisioningProfile(),
-                entitlements,
-                "${t}/" + bundling.getBundleDir())
-            // Using zip since we need to preserve permissions
-            + " && cd \"${t}\" && /usr/bin/zip -q -r \"${signed_ipa}\" .")
-        .addInput(ipaUnsigned)
-        .addInput(attributes.provisioningProfile())
-        .addInput(entitlements)
-        .addOutput(ipaOutput)
-        .build(ruleContext));
-
-    return this;
-  }
-
-  private void registerBundleMergeActions(Artifact ipaUnsigned,
-      NestedSet<Artifact> bundleContentArtifacts, BundleMergeControlBytes controlBytes) {
-    Artifact bundleMergeControlArtifact =
-        ObjcRuleClasses.artifactByAppendingToBaseName(ruleContext, ".ipa-control");
-
-    ruleContext.registerAction(
-        new BinaryFileWriteAction(
-            ruleContext.getActionOwner(), bundleMergeControlArtifact, controlBytes,
-            /*makeExecutable=*/false));
-
-    ruleContext.registerAction(new SpawnAction.Builder()
-        .setMnemonic("IosBundle")
-        .setProgressMessage("Bundling iOS application: " + ruleContext.getLabel())
-        .setExecutable(attributes.bundleMergeExecutable())
-        .addInputArgument(bundleMergeControlArtifact)
-        .addTransitiveInputs(bundleContentArtifacts)
-        .addOutput(ipaUnsigned)
-        .build(ruleContext));
-  }
-
-  private void registerExtractTeamPrefixAction(Artifact teamPrefixFile) {
-    ruleContext.registerAction(ObjcActionsBuilder.spawnOnDarwinActionBuilder()
-        .setMnemonic("ExtractIosTeamPrefix")
-        .setExecutable(new PathFragment("/bin/bash"))
-        .addArgument("-c")
-        .addArgument("set -e &&"
-            + " PLIST=$(" + extractPlistCommand(attributes.provisioningProfile()) + ") && "
-
-            // We think PlistBuddy uses PRead internally to seek through the file. Or possibly
-            // mmaps the file. Or something similar.
-            //
-            // Pipe FDs do not support PRead or mmap, though.
-            //
-            // <<< however does something magical like write to a temporary file or something
-            // like that internally, which means that this Just Works.
-            + " PREFIX=$(/usr/libexec/PlistBuddy -c 'Print ApplicationIdentifierPrefix:0'"
-            + " /dev/stdin <<< \"${PLIST}\") && "
-            + " echo ${PREFIX} > " + teamPrefixFile.getExecPathString())
-        .addInput(attributes.provisioningProfile())
-        .addOutput(teamPrefixFile)
-        .build(ruleContext));
-  }
-
-  private ReleaseBundlingSupport registerExtractEntitlementsAction(Artifact entitlements) {
-    // See Apple Glossary (http://goo.gl/EkhXOb)
-    // An Application Identifier is constructed as: TeamID.BundleID
-    // TeamID is extracted from the provisioning profile.
-    // BundleID consists of a reverse-DNS string to identify the app, where the last component
-    // is the application name, and is specified as an attribute.
-
-    ruleContext.registerAction(ObjcActionsBuilder.spawnOnDarwinActionBuilder()
-        .setMnemonic("ExtractIosEntitlements")
-        .setProgressMessage("Extracting entitlements: " + ruleContext.getLabel())
-        .setExecutable(new PathFragment("/bin/bash"))
-        .addArgument("-c")
-        .addArgument("set -e && "
-            + "PLIST=$("
-            + extractPlistCommand(attributes.provisioningProfile()) + ") && "
-
-            // We think PlistBuddy uses PRead internally to seek through the file. Or possibly
-            // mmaps the file. Or something similar.
-            //
-            // Pipe FDs do not support PRead or mmap, though.
-            //
-            // <<< however does something magical like write to a temporary file or something
-            // like that internally, which means that this Just Works.
-
-            + "/usr/libexec/PlistBuddy -x -c 'Print Entitlements' /dev/stdin <<< \"${PLIST}\" "
-            + "> " + entitlements.getExecPathString())
-        .addInput(attributes.provisioningProfile())
-        .addOutput(entitlements)
-        .build(ruleContext));
-
-    return this;
-  }
-
-  private void registerEntitlementsVariableSubstitutionAction(Artifact in, Artifact out,
-      Artifact prefix) {
-    String escapedBundleId = ShellUtils.shellEscape(attributes.bundleId());
-    ruleContext.registerAction(new SpawnAction.Builder()
-        .setMnemonic("SubstituteIosEntitlements")
-        .setExecutable(new PathFragment("/bin/bash"))
-        .addArgument("-c")
-        .addArgument("set -e && "
-            + "PREFIX=\"$(cat " + prefix.getExecPathString() + ")\" && "
-            + "sed "
-            // Replace .* from default entitlements file with bundle ID where suitable.
-            + "-e \"s#${PREFIX}\\.\\*#${PREFIX}." + escapedBundleId + "#g\" "
-
-            // Replace some variables that people put in their own entitlements files
-            + "-e \"s#\\$(AppIdentifierPrefix)#${PREFIX}.#g\" "
-            + "-e \"s#\\$(CFBundleIdentifier)#" + escapedBundleId + "#g\" "
-
-            + in.getExecPathString() + " "
-            + "> " + out.getExecPathString())
-        .addInput(in)
-        .addInput(prefix)
-        .addOutput(out)
-        .build(ruleContext));
-  }
-
-
-  private String extractPlistCommand(Artifact provisioningProfile) {
-    return "security cms -D -i " + ShellUtils.shellEscape(provisioningProfile.getExecPathString());
-  }
-
-  private String codesignCommand(
-      Artifact provisioningProfile, Artifact entitlements, String appDir) {
-    String fingerprintCommand =
-        "/usr/libexec/PlistBuddy -c 'Print DeveloperCertificates:0' /dev/stdin <<< "
-            + "$(" + extractPlistCommand(provisioningProfile) + ") | "
-            + "openssl x509 -inform DER -noout -fingerprint | "
-            + "cut -d= -f2 | sed -e 's#:##g'";
-    return String.format(
-        "/usr/bin/codesign --force --sign $(%s) --entitlements %s %s",
-        fingerprintCommand,
-        entitlements.getExecPathString(),
-        appDir);
-  }
-
-  private Artifact getGeneratedVersionPlist() {
-    return ruleContext.getRelatedArtifact(
-        ruleContext.getUniqueDirectory("plists"), "-version.plist");
-  }
-
-  /**
-   * Logic to access attributes required by application support. Attributes are required and
-   * guaranteed to return a value or throw unless they are annotated with {@link Nullable} in which
-   * case they can return {@code null} if no value is defined.
-   */
-  private static class Attributes {
-    private final RuleContext ruleContext;
-
-    private Attributes(RuleContext ruleContext) {
-      this.ruleContext = ruleContext;
-    }
-
-    @Nullable
-    String appIcon() {
-      return stringAttribute("app_icon");
-    }
-
-    @Nullable
-    String launchImage() {
-      return stringAttribute("launch_image");
-    }
-
-    @Nullable
-    Artifact provisioningProfile() {
-      Artifact explicitProvisioningProfile =
-          ruleContext.getPrerequisiteArtifact("provisioning_profile", Mode.TARGET);
-      if (explicitProvisioningProfile != null) {
-        return explicitProvisioningProfile;
-      }
-      return ruleContext.getPrerequisiteArtifact(":default_provisioning_profile", Mode.TARGET);
-    }
-
-    /**
-     * Returns the value of the {@code families} attribute in a form that is more useful than a list
-     * of strings. Returns an empty set for any invalid {@code families} attribute value, including
-     * an empty list.
-     */
-    Set<TargetDeviceFamily> families() {
-      List<String> rawFamilies = ruleContext.attributes().get("families", Type.STRING_LIST);
-      try {
-        return TargetDeviceFamily.fromNamesInRule(rawFamilies);
-      } catch (InvalidFamilyNameException | RepeatedFamilyNameException e) {
-        return ImmutableSet.of();
-      }
-    }
-
-    @Nullable
-    Artifact entitlements() {
-      return ruleContext.getPrerequisiteArtifact("entitlements", Mode.TARGET);
-    }
-
-    NestedSet<? extends Artifact> dependentLinkedBinaries() {
-      if (ruleContext.attributes().getAttributeDefinition("binary") == null) {
-        return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
-      }
-
-      NestedSetBuilder<Artifact> linkedBinaries = NestedSetBuilder.stableOrder();
-      for (ObjcProvider provider
-          : ruleContext.getPrerequisites("binary", Mode.DONT_CHECK, ObjcProvider.class)) {
-        linkedBinaries.addTransitive(provider.get(ObjcProvider.LINKED_BINARY));
-      }
-
-      return linkedBinaries.build();
-    }
-
-    FilesToRunProvider bundleMergeExecutable() {
-      return checkNotNull(ruleContext.getExecutablePrerequisite("$bundlemerge", Mode.HOST));
-    }
-
-    Artifact iossim() {
-      return checkNotNull(ruleContext.getPrerequisiteArtifact("$iossim", Mode.HOST));
-    }
-
-    Artifact runnerScriptTemplate() {
-      return checkNotNull(
-          ruleContext.getPrerequisiteArtifact("$runner_script_template", Mode.HOST));
-    }
-
-    String bundleId() {
-      return checkNotNull(stringAttribute("bundle_id"));
-    }
-
-    @Nullable
-    private String stringAttribute(String attribute) {
-      String value = ruleContext.attributes().get(attribute, Type.STRING);
-      return value.isEmpty() ? null : value;
-    }
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingTargetFactory.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingTargetFactory.java
deleted file mode 100644
index af98af5..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ReleaseBundlingTargetFactory.java
+++ /dev/null
@@ -1,130 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.MERGE_ZIP;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableSet;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.ConfiguredTarget;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTargetBuilder;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.rules.RuleConfiguredTargetFactory;
-import com.google.devtools.build.lib.rules.objc.ReleaseBundlingSupport.LinkedBinary;
-
-/**
- * Base class for rules that bundle releases.
- */
-public abstract class ReleaseBundlingTargetFactory implements RuleConfiguredTargetFactory {
-
-  /**
-   * Indicates whether a target factory should export an {@link ObjcProvider} containing itself as
-   * a nested bundle.
-   */
-  protected enum ExposeAsNestedBundle { YES, NO }
-
-  private final String bundleDirFormat;
-  private final XcodeProductType xcodeProductType;
-  private final ExposeAsNestedBundle exposeAsNestedBundle;
-  private final ImmutableSet<Attribute> dependencyAttributes;
-
-  /**
-   * @param bundleDirFormat format string representing the bundle's directory with a single
-   *     placeholder for the target name (e.g. {@code "Payload/%s.app"})
-   * @param exposeAsNestedBundle whether to export an {@link ObjcProvider} with this target as a
-   * @param dependencyAttributes all attributes that contain dependencies of this rule. Any
-   *    dependency so listed must expose {@link XcodeProvider} and {@link ObjcProvider}.
-   */
-  public ReleaseBundlingTargetFactory(String bundleDirFormat,
-      XcodeProductType xcodeProductType,
-      ExposeAsNestedBundle exposeAsNestedBundle, ImmutableSet<Attribute> dependencyAttributes) {
-    this.bundleDirFormat = bundleDirFormat;
-    this.xcodeProductType = xcodeProductType;
-    this.exposeAsNestedBundle = exposeAsNestedBundle;
-    this.dependencyAttributes = dependencyAttributes;
-  }
-
-  @Override
-  public ConfiguredTarget create(RuleContext ruleContext) throws InterruptedException {
-    ObjcCommon common = common(ruleContext);
-
-    XcodeProvider.Builder xcodeProviderBuilder = new XcodeProvider.Builder();
-    NestedSetBuilder<Artifact> filesToBuild = NestedSetBuilder.stableOrder();
-
-    ReleaseBundlingSupport releaseBundlingSupport = new ReleaseBundlingSupport(
-        ruleContext, common.getObjcProvider(), optionsProvider(ruleContext),
-        LinkedBinary.DEPENDENCIES_ONLY, bundleDirFormat);
-    releaseBundlingSupport
-        .registerActions()
-        .addXcodeSettings(xcodeProviderBuilder)
-        .addFilesToBuild(filesToBuild)
-        .validateResources()
-        .validateAttributes();
-
-    XcodeSupport xcodeSupport = new XcodeSupport(ruleContext)
-        .addFilesToBuild(filesToBuild)
-        .addXcodeSettings(xcodeProviderBuilder, common.getObjcProvider(), xcodeProductType)
-        .addDummySource(xcodeProviderBuilder);
-
-    for (Attribute attribute : dependencyAttributes) {
-      xcodeSupport.addDependencies(xcodeProviderBuilder, attribute);
-    }
-
-    xcodeSupport.registerActions(xcodeProviderBuilder.build());
-
-    Optional<ObjcProvider> exposedObjcProvider;
-    if (exposeAsNestedBundle == ExposeAsNestedBundle.YES) {
-      exposedObjcProvider = Optional.of(new ObjcProvider.Builder()
-          .add(MERGE_ZIP, ruleContext.getImplicitOutputArtifact(ReleaseBundlingSupport.IPA))
-          .build());
-    } else {
-      exposedObjcProvider = Optional.absent();
-    }
-
-    RuleConfiguredTargetBuilder target = common.configuredTargetBuilder(
-        filesToBuild.build(),
-        Optional.of(xcodeProviderBuilder.build()),
-        exposedObjcProvider,
-        Optional.of(releaseBundlingSupport.xcTestAppProvider()),
-        Optional.<J2ObjcSrcsProvider>absent());
-    configureTarget(target, ruleContext, releaseBundlingSupport);
-    return target.build();
-  }
-
-  /**
-   * Returns a provider based on this rule's options and those of its option-providing dependencies.
-   */
-  protected abstract OptionsProvider optionsProvider(RuleContext ruleContext);
-
-  /**
-   * Performs additional configuration of the target. The default implementation does nothing, but
-   * subclasses may override it to add logic.
-   */
-  protected void configureTarget(RuleConfiguredTargetBuilder target, RuleContext ruleContext,
-      ReleaseBundlingSupport releaseBundlingSupport) {}
-
-  private ObjcCommon common(RuleContext ruleContext) {
-    ObjcCommon.Builder builder = new ObjcCommon.Builder(ruleContext)
-        .setIntermediateArtifacts(ObjcRuleClasses.intermediateArtifacts(ruleContext));
-    for (Attribute attribute : dependencyAttributes) {
-      builder.addDepObjcProviders(
-          ruleContext.getPrerequisites(
-              attribute.getName(), attribute.getAccessMode(), ObjcProvider.class));
-    }
-    return builder.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/ResourceSupport.java b/src/main/java/com/google/devtools/build/lib/rules/objc/ResourceSupport.java
deleted file mode 100644
index d3614a5..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/ResourceSupport.java
+++ /dev/null
@@ -1,86 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-
-/**
- * Support for resource processing on Objc rules.
- *
- * <p>Methods on this class can be called in any order without impacting the result.
- */
-final class ResourceSupport {
-  private final RuleContext ruleContext;
-  private final Attributes attributes;
-
-  /**
-   * Creates a new resource support for the given context.
-   */
-  ResourceSupport(RuleContext ruleContext) {
-    this.ruleContext = ruleContext;
-    this.attributes = new Attributes(ruleContext);
-  }
-
-  /**
-   * Adds common xcode settings to the given provider builder.
-   *
-   * @return this resource support
-   */
-  ResourceSupport addXcodeSettings(XcodeProvider.Builder xcodeProviderBuilder) {
-    xcodeProviderBuilder.addInputsToXcodegen(Xcdatamodel.inputsToXcodegen(attributes.datamodels()));
-    xcodeProviderBuilder.addDatamodelDirs(Xcdatamodels.datamodelDirs(attributes.datamodels()));
-    return this;
-  }
-
-  /**
-   * Validates resource attributes on this rule.
-   *
-   * @return this resource support
-   */
-  ResourceSupport validateAttributes() {
-    Iterable<String> assetCatalogErrors = ObjcCommon.notInContainerErrors(
-        attributes.assetCatalogs(), ObjcCommon.ASSET_CATALOG_CONTAINER_TYPE);
-    for (String error : assetCatalogErrors) {
-      ruleContext.attributeError("asset_catalogs", error);
-    }
-
-    Iterable<String> dataModelErrors =
-        ObjcCommon.notInContainerErrors(attributes.datamodels(), Xcdatamodels.CONTAINER_TYPES);
-    for (String error : dataModelErrors) {
-      ruleContext.attributeError("datamodels", error);
-    }
-
-    return this;
-  }
-
-  private static class Attributes {
-    private final RuleContext ruleContext;
-
-    Attributes(RuleContext ruleContext) {
-      this.ruleContext = ruleContext;
-    }
-
-    ImmutableList<Artifact> datamodels() {
-      return ruleContext.getPrerequisiteArtifacts("datamodels", Mode.TARGET).list();
-    }
-
-    ImmutableList<Artifact> assetCatalogs() {
-      return ruleContext.getPrerequisiteArtifacts("asset_catalogs", Mode.TARGET).list();
-    }
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/SdkFramework.java b/src/main/java/com/google/devtools/build/lib/rules/objc/SdkFramework.java
deleted file mode 100644
index f6aa107..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/SdkFramework.java
+++ /dev/null
@@ -1,47 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.collect.ImmutableList;
-
-/**
- * Represents the name of an SDK framework.
- * <p>
- * Besides being a glorified String, this class prevents you from adding framework names to an
- * argument list without explicitly specifying how to prefix them.
- */
-final class SdkFramework extends Value<SdkFramework> {
-  private final String name;
-
-  public SdkFramework(String name) {
-    super(name);
-    this.name = name;
-  }
-
-  public String getName() {
-    return name;
-  }
-
-  /**
-   * Returns an iterable which contains the name of each given framework in the same order.
-   */
-  static Iterable<String> names(Iterable<SdkFramework> frameworks) {
-    ImmutableList.Builder<String> result = new ImmutableList.Builder<>();
-    for (SdkFramework framework : frameworks) {
-      result.add(framework.getName());
-    }
-    return result.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Storyboards.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Storyboards.java
deleted file mode 100644
index 204c22d..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Storyboards.java
+++ /dev/null
@@ -1,76 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.collect.nestedset.Order;
-
-/**
- * Contains information about storyboards for a single target. This does not include information
- * about the transitive closure. A storyboard:
- * <ul>
- *   <li>Is a single file with an extension of {@code .storyboard} in its uncompiled, checked-in
- *       form.
- *   <li>Can be in a localized {@code .lproj} directory, including {@code Base.lproj}.
- *   <li>Compiles with {@code ibtool} to a directory with extension {@code .storyboardc} (note the
- *       added "c")
- * </ul>
- *
- * <p>The {@link NestedSet}s stored in this class are only one level deep, and do not include the
- * storyboards in the transitive closure. This is to facilitate structural sharing between copies
- * of the sequences - the output zips can be added transitively to the inputs of the merge bundle
- * action, as well as to the files to build set, and only one instance of the sequence exists for
- * each set.
- */
-final class Storyboards {
-  private final NestedSet<Artifact> outputZips;
-  private final NestedSet<Artifact> inputs;
-
-  private Storyboards(NestedSet<Artifact> outputZips, NestedSet<Artifact> inputs) {
-    this.outputZips = outputZips;
-    this.inputs = inputs;
-  }
-
-  public NestedSet<Artifact> getOutputZips() {
-    return outputZips;
-  }
-
-  public NestedSet<Artifact> getInputs() {
-    return inputs;
-  }
-
-  static Storyboards empty() {
-    return new Storyboards(
-        NestedSetBuilder.<Artifact>emptySet(Order.STABLE_ORDER),
-        NestedSetBuilder.<Artifact>emptySet(Order.STABLE_ORDER));
-  }
-
-  /**
-   * Generates a set of new instances given the raw storyboard inputs.
-   * @param inputs the {@code .storyboard} files.
-   * @param intermediateArtifacts the object used to determine the output zip {@link Artifact}s.
-   */
-  static Storyboards fromInputs(
-      Iterable<Artifact> inputs, IntermediateArtifacts intermediateArtifacts) {
-    NestedSetBuilder<Artifact> outputZips = NestedSetBuilder.stableOrder();
-    for (Artifact input : inputs) {
-      outputZips.add(intermediateArtifacts.compiledStoryboardZip(input));
-    }
-    return new Storyboards(outputZips.build(), NestedSetBuilder.wrap(Order.STABLE_ORDER, inputs));
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/TargetDeviceFamily.java b/src/main/java/com/google/devtools/build/lib/rules/objc/TargetDeviceFamily.java
deleted file mode 100644
index 2233f96..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/TargetDeviceFamily.java
+++ /dev/null
@@ -1,123 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Splitter;
-import com.google.common.collect.ImmutableBiMap;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableSet;
-
-import java.util.EnumSet;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-
-/**
- * Possible values in the {@code TARGETED_DEVICE_FAMILY} build setting.
- */
-public enum TargetDeviceFamily {
-  IPAD, IPHONE;
-
-  /**
-   * An exception that indicates the name of a device family was not recognized or is somehow
-   * invalid.
-   */
-  public static class InvalidFamilyNameException extends IllegalArgumentException {
-    public InvalidFamilyNameException(String message) {
-      super(message);
-    }
-  }
-
-  /**
-   * An exception that indicates a family name appeared twice in a sequence when only one is
-   * expected.
-   */
-  public static class RepeatedFamilyNameException extends IllegalArgumentException {
-    public RepeatedFamilyNameException(String message) {
-      super(message);
-    }
-  }
-
-  /**
-   * Contains the values of the UIDeviceFamily plist info setting for each valid set of
-   * TargetDeviceFamilies.
-   */
-  public static final Map<Set<TargetDeviceFamily>, List<Integer>> UI_DEVICE_FAMILY_VALUES =
-      ImmutableMap.<Set<TargetDeviceFamily>, List<Integer>>builder()
-          .put(ImmutableSet.of(TargetDeviceFamily.IPHONE), ImmutableList.of(1))
-          .put(ImmutableSet.of(TargetDeviceFamily.IPAD), ImmutableList.of(2))
-          .put(ImmutableSet.of(TargetDeviceFamily.IPHONE, TargetDeviceFamily.IPAD),
-              ImmutableList.of(1, 2))
-          .build();
-
-  /**
-   * Returns the name of the family as it appears in build rules.
-   */
-  public String getNameInRule() {
-    return BY_NAME_IN_RULE.get(this);
-  }
-
-  private static final ImmutableBiMap<TargetDeviceFamily, String> BY_NAME_IN_RULE =
-      ImmutableBiMap.of(IPAD, "ipad", IPHONE, "iphone");
-
-  /**
-   * Converts a sequence containing the strings returned by {@link #getNameInRule()} to a set of
-   * instances of this enum.
-   *
-   * <p>If there are multiple items in the returned set, they are in enumeration order.
-   *
-   * @param names the names of the families
-   * @throws InvalidFamilyNameException if some family name in the sequence was not recognized
-   * @throws RepeatedFamilyNameException if some family name appeared in the sequence twice
-   */
-  public static Set<TargetDeviceFamily> fromNamesInRule(Iterable<String> names) {
-    Set<TargetDeviceFamily> families = EnumSet.noneOf(TargetDeviceFamily.class);
-    for (String name : names) {
-      TargetDeviceFamily family = BY_NAME_IN_RULE.inverse().get(name);
-      if (family == null) {
-        throw new InvalidFamilyNameException(name);
-      }
-      if (!families.add(family)) {
-        throw new RepeatedFamilyNameException(name);
-      }
-    }
-    return families;
-  }
-
-  /**
-   * Converts the {@code TARGETED_DEVICE_FAMILY} setting in build settings to a set of
-   * {@code TargetedDevice}s.
-   */
-  public static Set<TargetDeviceFamily> fromBuildSetting(String targetedDevice) {
-    ImmutableSet.Builder<TargetDeviceFamily> result = ImmutableSet.builder();
-    for (String numericSetting : Splitter.on(",").split(targetedDevice)) {
-      numericSetting = numericSetting.trim();
-      switch (numericSetting) {
-        case "1":
-          result.add(IPHONE);
-          break;
-        case "2":
-          result.add(IPAD);
-          break;
-        default:
-          throw new IllegalArgumentException(
-              "Expect comma-separated list containing only '1' and/or '2' for "
-              + "TARGETED_DEVICE_FAMILY: " + targetedDevice);
-      }
-    }
-    return result.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Value.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Value.java
deleted file mode 100644
index 6974d6b..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Value.java
+++ /dev/null
@@ -1,70 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-
-/**
- * Represents a type whose equality, hash code, and string representation are defined by a single
- * immutable array. This class is designed to be extended by a final class, and to pass the member
- * data to this class's constructor.
- *
- * @param <V> the base class that extends {@code Value}
- */
-// TODO(bazel-team): Replace with AutoValue once that is supported in bazel.
-public class Value<V extends Value<V>> {
-  private final Object memberData;
-
-  /**
-   * Constructs a new instance with the given member data. Generally, all member data should be
-   * reflected in final fields in the child class.
-   * @throws NullPointerException if any element in {@code memberData} is null
-   */
-  public Value(Object... memberData) {
-    Preconditions.checkArgument(memberData.length > 0);
-    this.memberData = (memberData.length == 1)
-        ? Preconditions.checkNotNull(memberData[0]) : ImmutableList.copyOf(memberData);
-  }
-
-  /**
-   * A type-safe alternative to calling {@code a.equals(b)}. When using {@code a.equals(b)},
-   * {@code b} may accidentally be a different class from {@code a}, in which case there will be no
-   * compiler warning and the result will always be false. This method requires both values to have
-   * compatible types and to be non-null.
-   */
-  public boolean equalsOther(V other) {
-    return equals(Preconditions.checkNotNull(other));
-  }
-
-  @Override
-  public boolean equals(Object o) {
-    if ((o == null) || (o.getClass() != getClass())) {
-      return false;
-    }
-    Value<?> other = (Value<?>) o;
-    return memberData.equals(other.memberData);
-  }
-
-  @Override
-  public int hashCode() {
-    return memberData.hashCode();
-  }
-
-  @Override
-  public String toString() {
-    return getClass().getSimpleName() + ":" + memberData.toString();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/XcTestAppProvider.java b/src/main/java/com/google/devtools/build/lib/rules/objc/XcTestAppProvider.java
deleted file mode 100644
index 1fc5d5d..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/XcTestAppProvider.java
+++ /dev/null
@@ -1,57 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Preconditions;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.TransitiveInfoProvider;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-
-/**
- * Supplies information needed when a dependency serves as an {@code xctest_app}.
- */
-@Immutable
-final class XcTestAppProvider implements TransitiveInfoProvider {
-  private final Artifact bundleLoader;
-  private final Artifact ipa;
-  private final ObjcProvider objcProvider;
-
-  XcTestAppProvider(Artifact bundleLoader, Artifact ipa, ObjcProvider objcProvider) {
-    this.bundleLoader = Preconditions.checkNotNull(bundleLoader);
-    this.ipa = Preconditions.checkNotNull(ipa);
-    this.objcProvider = Preconditions.checkNotNull(objcProvider);
-  }
-
-  /**
-   * The bundle loader, which corresponds to the test app's binary.
-   */
-  public Artifact getBundleLoader() {
-    return bundleLoader;
-  }
-
-  public Artifact getIpa() {
-    return ipa;
-  }
-
-  /**
-   * An {@link ObjcProvider} that should be included by any test target that uses this app as its
-   * {@code xctest_app}. This is <strong>not</strong> a typical {@link ObjcProvider} - it has
-   * certain linker-releated keys omitted, such as {@link ObjcProvider#LIBRARY}, since XcTests have
-   * access to symbols in their test rig without linking them into the main test binary.
-   */
-  public ObjcProvider getObjcProvider() {
-    return objcProvider;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodel.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodel.java
deleted file mode 100644
index ff8601c..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodel.java
+++ /dev/null
@@ -1,133 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.base.Function;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.util.FileType;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-/**
- * Represents an .xcdatamodel[d] directory - knowing all {@code Artifact}s contained therein - and
- * the .zip file that it is compiled to which should be merged with the final application bundle.
- * <p>
- * An .xcdatamodel (here and below note that lack or presence of a d) directory contains the schema
- * for a managed object, or a managed object model. It typically has two files: {@code layout} and
- * {@code contents}, although this detail isn't addressed in Bazel code. Directories of this
- * sort are compiled into a single .mom file. If the .xcdatamodel directory is inside a
- * .xcdatamodeld directory, then the .mom file is placed inside a .momd directory. The .momd
- * directory or .mom file is placed in the bundle root of the final bundle.
- * <p>
- * An .xcdatamodeld directory contains several .xcdatamodel directories, each corresponding to a
- * different version. In addition the .xcdatamodeld directory contains a {@code .xccurrentversion}
- * file which identifies the current version. (this file is also not handled explicitly by Bazel
- * code).
- * <p>
- * When processing artifacts referenced by a {@code datamodels} attribute, we must determine if it
- * is in a .xcdatamodeld directory or only a .xcdatamodel directory. We also must group the
- * artifacts by their container, the container being an .xcdatamodeld directory if possible, and a
- * .xcdatamodel directory otherwise. Every container is compiled with a single invocation of the
- * Managed Object Model Compiler (momc) and corresponds to exactly one instance of this class. We
- * invoke momc indirectly through the momczip tool (part of Bazel) which runs momc and zips the
- * output. The files in this zip are placed in the bundle root of the final application, not unlike
- * the zips generated by {@code actooloribtoolzip}.
- */
-class Xcdatamodel extends Value<Xcdatamodel> {
-  private final Artifact outputZip;
-  private final ImmutableSet<Artifact> inputs;
-  private final PathFragment container;
-
-  Xcdatamodel(Artifact outputZip, ImmutableSet<Artifact> inputs, PathFragment container) {
-    super(ImmutableMap.of(
-        "outputZip", outputZip,
-        "inputs", inputs,
-        "container", container));
-    this.outputZip = outputZip;
-    this.inputs = inputs;
-    this.container = container;
-  }
-
-  /**
-   * Returns the files that should be supplied to Xcodegen when generating a project that includes
-   * all of the given xcdatamodel source files.
-   */
-  public static Iterable<Artifact> inputsToXcodegen(Iterable<Artifact> datamodelFiles) {
-    ImmutableSet.Builder<Artifact> inputs = new ImmutableSet.Builder<>();
-    for (Artifact generalInput : datamodelFiles) {
-      if (generalInput.getExecPath().getBaseName().equals(".xccurrentversion")) {
-        inputs.add(generalInput);
-      }
-    }
-    return inputs.build();
-  }
-
-  public Artifact getOutputZip() {
-    return outputZip;
-  }
-
-  /**
-   * Returns every known file in the container. This is every input file that is processed by momc.
-   */
-  public ImmutableSet<Artifact> getInputs() {
-    return inputs;
-  }
-
-  public PathFragment getContainer() {
-    return container;
-  }
-
-  /**
-   * The ARCHIVE_ROOT passed to momczip. The archive root is the name of the .mom file 
-   * unversioned object models, and the name of the .momd directory for versioned object models.
-   */
-  public String archiveRootForMomczip() {
-    return name() + (container.getBaseName().endsWith(".xcdatamodeld") ? ".momd" : ".mom");
-  }
-
-  /**
-   * The name of the data model. This is the name of the container without the extension. For
-   * instance, if the container is "foo/Information.xcdatamodel" or "bar/Information.xcdatamodeld",
-   * then the name is "Information".
-   */
-  public String name() {
-    String baseContainerName = container.getBaseName();
-    int lastDot = baseContainerName.lastIndexOf('.');
-    return baseContainerName.substring(0, lastDot);
-  }
-
-  public static Iterable<Artifact> outputZips(Iterable<Xcdatamodel> models) {
-    return Iterables.transform(models, new Function<Xcdatamodel, Artifact>() {
-      @Override
-      public Artifact apply(Xcdatamodel model) {
-        return model.getOutputZip();
-      }
-    });
-  }
-
-  /**
-   * Returns a sequence of all unique *.xcdatamodel directories that contain all the artifacts of
-   * the given models. Note that this does not return any *.xcdatamodeld directories.
-   */
-  static Iterable<PathFragment> xcdatamodelDirs(Iterable<Xcdatamodel> models) {
-    ImmutableSet.Builder<PathFragment> result = new ImmutableSet.Builder<>();
-    for (Xcdatamodel model : models) {
-      result.addAll(ObjcCommon.uniqueContainers(model.getInputs(), FileType.of(".xcdatamodel")));
-    }
-    return result.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodels.java b/src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodels.java
deleted file mode 100644
index 340c775..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/Xcdatamodels.java
+++ /dev/null
@@ -1,79 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.ImmutableSetMultimap;
-import com.google.common.collect.Multimap;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.util.FileType;
-import com.google.devtools.build.lib.vfs.PathFragment;
-
-import java.util.Collection;
-import java.util.Map;
-
-/**
- * Utility code for getting information specific to xcdatamodels for a single rule.
- */
-class Xcdatamodels {
-  private Xcdatamodels() {}
-
-  static final ImmutableList<FileType> CONTAINER_TYPES =
-      ImmutableList.of(FileType.of(".xcdatamodeld"), FileType.of(".xcdatamodel"));
-
-  static Iterable<PathFragment> datamodelDirs(Iterable<Artifact> xcdatamodels) {
-    ImmutableSet.Builder<PathFragment> result = new ImmutableSet.Builder<>();
-    for (Collection<Artifact> artifacts : byContainer(xcdatamodels).asMap().values()) {
-      result.addAll(ObjcCommon.uniqueContainers(artifacts, FileType.of(".xcdatamodel")));
-    }
-    return result.build();
-  }
-
-  static Iterable<Xcdatamodel> xcdatamodels(
-      IntermediateArtifacts intermediateArtifacts, Iterable<Artifact> xcdatamodels) {
-    ImmutableSet.Builder<Xcdatamodel> result = new ImmutableSet.Builder<>();
-    Multimap<PathFragment, Artifact> artifactsByContainer = byContainer(xcdatamodels);
-
-    for (Map.Entry<PathFragment, Collection<Artifact>> modelDirEntry :
-        artifactsByContainer.asMap().entrySet()) {
-      PathFragment container = modelDirEntry.getKey();
-      Artifact outputZip = intermediateArtifacts.compiledMomZipArtifact(container);
-      result.add(
-          new Xcdatamodel(outputZip, ImmutableSet.copyOf(modelDirEntry.getValue()), container));
-    }
-
-    return result.build();
-  }
-
-
-  /**
-   * Arrange a sequence of artifacts into entries of a multimap by their nearest container
-   * directory, preferring {@code .xcdatamodeld} over {@code .xcdatamodel}.
-   * If an artifact is not inside any containing directory, then it is not present in the returned
-   * map.
-   */
-  static Multimap<PathFragment, Artifact> byContainer(Iterable<Artifact> artifacts) {
-    ImmutableSetMultimap.Builder<PathFragment, Artifact> result =
-        new ImmutableSetMultimap.Builder<>();
-    for (Artifact artifact : artifacts) {
-      for (PathFragment modelDir :
-          ObjcCommon.nearestContainerMatching(CONTAINER_TYPES, artifact).asSet()) {
-        result.put(modelDir, artifact);
-      }
-    }
-    return result.build();
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProductType.java b/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProductType.java
deleted file mode 100644
index 1a68206..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProductType.java
+++ /dev/null
@@ -1,41 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-/**
- * Possible values that {@code objc_*} rules care about for what Xcode project files refer to as
- * "product type."
- */
-enum XcodeProductType {
-  LIBRARY_STATIC("com.apple.product-type.library.static"),
-  BUNDLE("com.apple.product-type.bundle"),
-  APPLICATION("com.apple.product-type.application"),
-  UNIT_TEST("com.apple.product-type.bundle.unit-test"),
-  EXTENSION("com.apple.product-type.app-extension");
-
-  private final String identifier;
-
-  XcodeProductType(String identifier) {
-    this.identifier = identifier;
-  }
-
-  /**
-   * Returns the string used to identify this product type in the {@code productType} field of
-   * {@code PBXNativeTarget} objects in Xcode project files.
-   */
-  public String getIdentifier() {
-    return identifier;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProvider.java b/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProvider.java
deleted file mode 100644
index 6426866..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeProvider.java
+++ /dev/null
@@ -1,552 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.BUNDLE_IMPORT_DIR;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.DEFINE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FORCE_LOAD_FOR_XCODEGEN;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.FRAMEWORK_DIR;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.GENERAL_RESOURCE_FILE;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.IMPORTED_LIBRARY;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.SDK_DYLIB;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.SDK_FRAMEWORK;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.WEAK_SDK_FRAMEWORK;
-import static com.google.devtools.build.lib.rules.objc.ObjcProvider.XCASSETS_DIR;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Function;
-import com.google.common.base.Joiner;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.base.Splitter;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Iterables;
-import com.google.common.collect.Lists;
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.TransitiveInfoProvider;
-import com.google.devtools.build.lib.collect.nestedset.NestedSet;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
-import com.google.devtools.build.lib.rules.objc.ObjcProvider.Flag;
-import com.google.devtools.build.lib.syntax.Label;
-import com.google.devtools.build.lib.vfs.PathFragment;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.DependencyControl;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.TargetControl;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.XcodeprojBuildSetting;
-
-import java.util.Arrays;
-import java.util.EnumSet;
-import java.util.LinkedHashSet;
-import java.util.List;
-import java.util.Set;
-
-/**
- * Provider which provides transitive dependency information that is specific to Xcodegen. In
- * particular, it provides a sequence of targets which can be used to create a self-contained
- * {@code .xcodeproj} file.
- */
-@Immutable
-public final class XcodeProvider implements TransitiveInfoProvider {
-  /**
-   * A builder for instances of {@link XcodeProvider}.
-   */
-  public static final class Builder {
-    private Label label;
-    private final NestedSetBuilder<String> propagatedUserHeaderSearchPaths =
-        NestedSetBuilder.stableOrder();
-    private final NestedSetBuilder<String> nonPropagatedUserHeaderSearchPaths =
-        NestedSetBuilder.stableOrder();
-    private final NestedSetBuilder<String> propagatedHeaderSearchPaths =
-        NestedSetBuilder.stableOrder();
-    private final NestedSetBuilder<String> nonPropagatedHeaderSearchPaths =
-        NestedSetBuilder.stableOrder();
-    private Optional<InfoplistMerging> infoplistMerging = Optional.absent();
-    private final NestedSetBuilder<XcodeProvider> propagatedDependencies =
-        NestedSetBuilder.stableOrder();
-    private final NestedSetBuilder<XcodeProvider> nonPropagatedDependencies =
-        NestedSetBuilder.stableOrder();
-    private final ImmutableList.Builder<XcodeprojBuildSetting> xcodeprojBuildSettings =
-        new ImmutableList.Builder<>();
-    private final ImmutableList.Builder<String> copts = new ImmutableList.Builder<>();
-    private final ImmutableList.Builder<String> compilationModeCopts =
-        new ImmutableList.Builder<>();
-    private XcodeProductType productType;
-    private final ImmutableList.Builder<Artifact> headers = new ImmutableList.Builder<>();
-    private Optional<CompilationArtifacts> compilationArtifacts = Optional.absent();
-    private ObjcProvider objcProvider;
-    private Optional<XcodeProvider> testHost = Optional.absent();
-    private final NestedSetBuilder<Artifact> inputsToXcodegen = NestedSetBuilder.stableOrder();
-    private final NestedSetBuilder<Artifact> additionalSources = NestedSetBuilder.stableOrder();
-    private final ImmutableList.Builder<XcodeProvider> extensions = new ImmutableList.Builder<>();
-    private String architecture;
-    private ImmutableList.Builder<PathFragment> datamodelDirs = new ImmutableList.Builder<>();
-
-    /**
-     * Sets the label of the build target which corresponds to this Xcode target.
-     */
-    public Builder setLabel(Label label) {
-      this.label = label;
-      return this;
-    }
-
-    /**
-     * Adds user header search paths for this target.
-     */
-    public Builder addUserHeaderSearchPaths(Iterable<PathFragment> userHeaderSearchPaths) {
-      this.propagatedUserHeaderSearchPaths
-          .addAll(rootEach("$(WORKSPACE_ROOT)", userHeaderSearchPaths));
-      return this;
-    }
-
-    /**
-     * Adds header search paths for this target. Each path is interpreted relative to the given
-     * root, such as {@code "$(WORKSPACE_ROOT)"}.
-     */
-    public Builder addHeaderSearchPaths(String root, Iterable<PathFragment> paths) {
-      this.propagatedHeaderSearchPaths.addAll(rootEach(root, paths));
-      return this;
-    }
-
-    /**
-     * Sets the Info.plist merging information. Used for applications. May be
-     * absent for other bundles.
-     */
-    public Builder setInfoplistMerging(InfoplistMerging infoplistMerging) {
-      this.infoplistMerging = Optional.of(infoplistMerging);
-      return this;
-    }
-
-    /**
-     * Adds items in the {@link NestedSet}s of the given target to the corresponding sets in this
-     * builder. This is useful if the given target is a dependency or like a dependency
-     * (e.g. a test host). The given provider is not registered as a dependency with this provider.
-     */
-    private void addTransitiveSets(XcodeProvider dependencyish) {
-      inputsToXcodegen.addTransitive(dependencyish.inputsToXcodegen);
-      propagatedUserHeaderSearchPaths.addTransitive(dependencyish.propagatedUserHeaderSearchPaths);
-      propagatedHeaderSearchPaths.addTransitive(dependencyish.propagatedHeaderSearchPaths);
-    }
-
-   /**
-     * Adds {@link XcodeProvider}s corresponding to direct dependencies of this target which should
-     * be added in the {@code .xcodeproj} file and propagated up the dependency chain.
-     */
-    public Builder addPropagatedDependencies(Iterable<XcodeProvider> dependencies,
-        ObjcConfiguration configuration) {
-      return addDependencies(dependencies, configuration, /*doPropagate=*/true);
-    }
-
-   /**
-     * Adds {@link XcodeProvider}s corresponding to direct dependencies of this target which should
-     * be added in the {@code .xcodeproj} file and not propagated up the dependency chain.
-     */
-    public Builder addNonPropagatedDependencies(Iterable<XcodeProvider> dependencies,
-        ObjcConfiguration configuration) {
-      return addDependencies(dependencies, configuration, /*doPropagate=*/false);
-    }
-
-    private Builder addDependencies(Iterable<XcodeProvider> dependencies,
-        ObjcConfiguration configuration, boolean doPropagate) {
-      String architecture = configuration.getDependencySingleArchitecture();
-      for (XcodeProvider dependency : dependencies) {
-        // TODO(bazel-team): This is messy. Maybe we should make XcodeProvider be able to specify
-        // how to depend on it rather than require this method to choose based on the dependency's
-        // type.
-        if (dependency.productType == XcodeProductType.EXTENSION) {
-          this.extensions.add(dependency);
-          this.inputsToXcodegen.addTransitive(dependency.inputsToXcodegen);
-        } else if (dependency.architecture.equals(architecture)) {
-          if (doPropagate) {
-            this.propagatedDependencies.add(dependency);
-            this.propagatedDependencies.addTransitive(dependency.propagatedDependencies);
-            this.addTransitiveSets(dependency);
-          } else {
-            this.nonPropagatedDependencies.add(dependency);
-            this.nonPropagatedDependencies.addTransitive(dependency.propagatedDependencies);
-            this.nonPropagatedUserHeaderSearchPaths
-                .addTransitive(dependency.propagatedUserHeaderSearchPaths);
-            this.nonPropagatedHeaderSearchPaths
-                .addTransitive(dependency.propagatedHeaderSearchPaths);
-            this.inputsToXcodegen.addTransitive(dependency.inputsToXcodegen);
-          }
-        }
-      }
-      return this;
-    }
-
-    /**
-     * Adds additional build settings of this target.
-     */
-    public Builder addXcodeprojBuildSettings(
-        Iterable<XcodeprojBuildSetting> xcodeprojBuildSettings) {
-      this.xcodeprojBuildSettings.addAll(xcodeprojBuildSettings);
-      return this;
-    }
-
-    /**
-     * Sets the copts to use when compiling the Xcode target.
-     */
-    public Builder addCopts(Iterable<String> copts) {
-      this.copts.addAll(copts);
-      return this;
-    }
-
-    /**
-     * Sets the copts derived from compilation mode to use when compiling the Xcode target. These
-     * will be included before the DEFINE options.
-     */
-    public Builder addCompilationModeCopts(Iterable<String> copts) {
-      this.compilationModeCopts.addAll(copts);
-      return this;
-    }
-
-    /**
-     * Sets the product type for the PBXTarget in the .xcodeproj file.
-     */
-    public Builder setProductType(XcodeProductType productType) {
-      this.productType = productType;
-      return this;
-    }
-
-    /**
-     * Adds to the header files of this target. It needs not to include the header files of
-     * dependencies.
-     */
-    public Builder addHeaders(Iterable<Artifact> headers) {
-      this.headers.addAll(headers);
-      return this;
-    }
-
-    /**
-     * The compilation artifacts for this target.
-     */
-    public Builder setCompilationArtifacts(CompilationArtifacts compilationArtifacts) {
-      this.compilationArtifacts = Optional.of(compilationArtifacts);
-      return this;
-    }
-
-    /**
-     * Any additional sources not included in {@link #setCompilationArtifacts}.
-     */
-    public Builder addAdditionalSources(Artifact... artifacts) {
-      this.additionalSources.addAll(Arrays.asList(artifacts));
-      return this;
-    }
-
-    /**
-     * Sets the {@link ObjcProvider} corresponding to this target.
-     */
-    public Builder setObjcProvider(ObjcProvider objcProvider) {
-      this.objcProvider = objcProvider;
-      return this;
-    }
-
-    /**
-     * Sets the test host. This is used for xctest targets.
-     */
-    public Builder setTestHost(XcodeProvider testHost) {
-      Preconditions.checkState(!this.testHost.isPresent());
-      this.testHost = Optional.of(testHost);
-      this.addTransitiveSets(testHost);
-      return this;
-    }
-
-    /**
-     * Adds inputs that are passed to Xcodegen when generating the project file.
-     */
-    public Builder addInputsToXcodegen(Iterable<Artifact> inputsToXcodegen) {
-      this.inputsToXcodegen.addAll(inputsToXcodegen);
-      return this;
-    }
-
-    /**
-     * Sets the CPU architecture this xcode target was constructed for, derived from
-     * {@link ObjcConfiguration#getIosCpu()}.
-     */
-    public Builder setArchitecture(String architecture) {
-      this.architecture = architecture;
-      return this;
-    }
-
-    public Builder addDatamodelDirs(Iterable<PathFragment> datamodelDirs) {
-      this.datamodelDirs.addAll(datamodelDirs);
-      return this;
-    }
-
-    public XcodeProvider build() {
-      Preconditions.checkState(
-          !testHost.isPresent() || (productType == XcodeProductType.UNIT_TEST),
-          "%s product types cannot have a test host (test host: %s).", productType, testHost);
-      return new XcodeProvider(this);
-    }
-  }
-
-  /**
-   * A collection of top-level targets that can be used to create a complete project.
-   */
-  public static final class Project {
-    private final NestedSet<Artifact> inputsToXcodegen;
-    private final ImmutableList<XcodeProvider> topLevelTargets;
-
-    private Project(
-        NestedSet<Artifact> inputsToXcodegen, ImmutableList<XcodeProvider> topLevelTargets) {
-      this.inputsToXcodegen = inputsToXcodegen;
-      this.topLevelTargets = topLevelTargets;
-    }
-
-    public static Project fromTopLevelTarget(XcodeProvider topLevelTarget) {
-      return fromTopLevelTargets(ImmutableList.of(topLevelTarget));
-    }
-
-    public static Project fromTopLevelTargets(Iterable<XcodeProvider> topLevelTargets) {
-      NestedSetBuilder<Artifact> inputsToXcodegen = NestedSetBuilder.stableOrder();
-      for (XcodeProvider target : topLevelTargets) {
-        inputsToXcodegen.addTransitive(target.inputsToXcodegen);
-      }
-      return new Project(inputsToXcodegen.build(), ImmutableList.copyOf(topLevelTargets));
-    }
-
-    /**
-     * Returns artifacts that are passed to the Xcodegen action when generating a project file that
-     * contains all of the given targets.
-     */
-    public NestedSet<Artifact> getInputsToXcodegen() {
-      return inputsToXcodegen;
-    }
-
-    /**
-     * Returns all the target controls that must be added to the xcodegen control. No other target
-     * controls are needed to generate a functional project file. This method creates a new list
-     * whenever it is called.
-     */
-    public ImmutableList<TargetControl> targets() {
-      // Collect all the dependencies of all the providers, filtering out duplicates.
-      Set<XcodeProvider> providerSet = new LinkedHashSet<>();
-      for (XcodeProvider target : topLevelTargets) {
-        target.collectProviders(providerSet);
-      }
-
-      ImmutableList.Builder<TargetControl> controls = new ImmutableList.Builder<>();
-      for (XcodeProvider provider : providerSet) {
-        controls.add(provider.targetControl());
-      }
-      return controls.build();
-    }
-  }
-
-  private final Label label;
-  private final NestedSet<String> propagatedUserHeaderSearchPaths;
-  private final NestedSet<String> nonPropagatedUserHeaderSearchPaths;
-  private final NestedSet<String> propagatedHeaderSearchPaths;
-  private final NestedSet<String> nonPropagatedHeaderSearchPaths;
-  private final Optional<InfoplistMerging> infoplistMerging;
-  private final NestedSet<XcodeProvider> propagatedDependencies;
-  private final NestedSet<XcodeProvider> nonPropagatedDependencies;
-  private final ImmutableList<XcodeprojBuildSetting> xcodeprojBuildSettings;
-  private final ImmutableList<String> copts;
-  private final ImmutableList<String> compilationModeCopts;
-  private final XcodeProductType productType;
-  private final ImmutableList<Artifact> headers;
-  private final Optional<CompilationArtifacts> compilationArtifacts;
-  private final ObjcProvider objcProvider;
-  private final Optional<XcodeProvider> testHost;
-  private final NestedSet<Artifact> inputsToXcodegen;
-  private final NestedSet<Artifact> additionalSources;
-  private final ImmutableList<XcodeProvider> extensions;
-  private final String architecture;
-  private final ImmutableList<PathFragment> datamodelDirs;
-
-  private XcodeProvider(Builder builder) {
-    this.label = Preconditions.checkNotNull(builder.label);
-    this.propagatedUserHeaderSearchPaths = builder.propagatedUserHeaderSearchPaths.build();
-    this.nonPropagatedUserHeaderSearchPaths = builder.nonPropagatedUserHeaderSearchPaths.build();
-    this.propagatedHeaderSearchPaths = builder.propagatedHeaderSearchPaths.build();
-    this.nonPropagatedHeaderSearchPaths = builder.nonPropagatedHeaderSearchPaths.build();
-    this.infoplistMerging = builder.infoplistMerging;
-    this.propagatedDependencies = builder.propagatedDependencies.build();
-    this.nonPropagatedDependencies = builder.nonPropagatedDependencies.build();
-    this.xcodeprojBuildSettings = builder.xcodeprojBuildSettings.build();
-    this.copts = builder.copts.build();
-    this.compilationModeCopts = builder.compilationModeCopts.build();
-    this.productType = Preconditions.checkNotNull(builder.productType);
-    this.headers = builder.headers.build();
-    this.compilationArtifacts = builder.compilationArtifacts;
-    this.objcProvider = Preconditions.checkNotNull(builder.objcProvider);
-    this.testHost = Preconditions.checkNotNull(builder.testHost);
-    this.inputsToXcodegen = builder.inputsToXcodegen.build();
-    this.additionalSources = builder.additionalSources.build();
-    this.extensions = builder.extensions.build();
-    this.architecture = Preconditions.checkNotNull(builder.architecture);
-    this.datamodelDirs = builder.datamodelDirs.build();
-  }
-
-  private void collectProviders(Set<XcodeProvider> allProviders) {
-    if (allProviders.add(this)) {
-      for (XcodeProvider dependency : Iterables.concat(propagatedDependencies,
-          nonPropagatedDependencies)) {
-        dependency.collectProviders(allProviders);
-      }
-      for (XcodeProvider justTestHost : testHost.asSet()) {
-        justTestHost.collectProviders(allProviders);
-      }
-      for (XcodeProvider extension : extensions) {
-        extension.collectProviders(allProviders);
-      }
-    }
-  }
-
-  @VisibleForTesting
-  static final EnumSet<XcodeProductType> CAN_LINK_PRODUCT_TYPES = EnumSet.of(
-      XcodeProductType.APPLICATION, XcodeProductType.BUNDLE, XcodeProductType.UNIT_TEST,
-      XcodeProductType.EXTENSION);
-
-  /**
-   * Returns the name of the Xcode target that corresponds to a build target with the given name.
-   * This changes the label to make it a legal Xcode target name (which means removing slashes and
-   * the colon). It also makes the label more readable in the Xcode UI by putting the target name
-   * first and the package elements in reverse. This means the "important" part is visible even if
-   * the project navigator is too narrow to show the entire name.
-   */
-  static String xcodeTargetName(Label label) {
-    String pathFromWorkspaceRoot =  label.toString().replace("//", "").replace(':', '/');
-    List<String> components = Splitter.on('/').splitToList(pathFromWorkspaceRoot);
-    return Joiner.on('_').join(Lists.reverse(components));
-  }
-
-  private TargetControl targetControl() {
-    String buildFilePath = label.getPackageFragment().getSafePathString() + "/BUILD";
-    NestedSet<String> userHeaderSearchPaths = NestedSetBuilder.<String>stableOrder()
-        .addTransitive(propagatedUserHeaderSearchPaths)
-        .addTransitive(nonPropagatedUserHeaderSearchPaths)
-        .build();
-    NestedSet<String> headerSearchPaths = NestedSetBuilder.<String>stableOrder()
-        .addTransitive(propagatedHeaderSearchPaths)
-        .addTransitive(nonPropagatedHeaderSearchPaths)
-        .build();
-
-    // TODO(bazel-team): Add provisioning profile information when Xcodegen supports it.
-    TargetControl.Builder targetControl = TargetControl.newBuilder()
-        .setName(label.getName())
-        .setLabel(xcodeTargetName(label))
-        .setProductType(productType.getIdentifier())
-        .addAllImportedLibrary(Artifact.toExecPaths(objcProvider.get(IMPORTED_LIBRARY)))
-        .addAllUserHeaderSearchPath(userHeaderSearchPaths)
-        .addAllHeaderSearchPath(headerSearchPaths)
-        .addAllSupportFile(Artifact.toExecPaths(headers))
-        .addAllCopt(compilationModeCopts)
-        .addAllCopt(IosSdkCommands.DEFAULT_COMPILER_FLAGS)
-        .addAllCopt(Interspersing.prependEach("-D", objcProvider.get(DEFINE)))
-        .addAllCopt(copts)
-        .addAllLinkopt(
-            Interspersing.beforeEach("-force_load", objcProvider.get(FORCE_LOAD_FOR_XCODEGEN)))
-        .addAllLinkopt(IosSdkCommands.DEFAULT_LINKER_FLAGS)
-        .addAllLinkopt(Interspersing.beforeEach(
-            "-weak_framework", SdkFramework.names(objcProvider.get(WEAK_SDK_FRAMEWORK))))
-        .addAllBuildSetting(xcodeprojBuildSettings)
-        .addAllBuildSetting(IosSdkCommands.defaultWarningsForXcode())
-        .addAllSdkFramework(SdkFramework.names(objcProvider.get(SDK_FRAMEWORK)))
-        .addAllFramework(PathFragment.safePathStrings(objcProvider.get(FRAMEWORK_DIR)))
-        .addAllXcassetsDir(PathFragment.safePathStrings(objcProvider.get(XCASSETS_DIR)))
-        .addAllXcdatamodel(PathFragment.safePathStrings(datamodelDirs))
-        .addAllBundleImport(PathFragment.safePathStrings(objcProvider.get(BUNDLE_IMPORT_DIR)))
-        .addAllSdkDylib(objcProvider.get(SDK_DYLIB))
-        .addAllGeneralResourceFile(Artifact.toExecPaths(objcProvider.get(GENERAL_RESOURCE_FILE)))
-        .addSupportFile(buildFilePath);
-
-    if (CAN_LINK_PRODUCT_TYPES.contains(productType)) {
-      for (XcodeProvider dependency : propagatedDependencies) {
-        // Only add a library target to a binary's dependencies if it has source files to compile
-        // and it is not from the "non_propagated_deps" attribute. Xcode cannot build targets
-        // without a source file in the PBXSourceFilesBuildPhase, so if such a target is present in
-        // the control file, it is only to get Xcodegen to put headers and resources not used by the
-        // final binary in the Project Navigator.
-        //
-        // The exceptions to this rule are objc_bundle_library and ios_extension targets. Bundles
-        // are generally used for resources and can lack a PBXSourceFilesBuildPhase in the project
-        // file and still be considered valid by Xcode.
-        //
-        // ios_extension targets are an exception because they have no CompilationArtifact object
-        // but do have a dummy source file to make Xcode happy.
-        boolean hasSources = dependency.compilationArtifacts.isPresent()
-            && dependency.compilationArtifacts.get().getArchive().isPresent();
-        if (hasSources || (dependency.productType == XcodeProductType.BUNDLE)) {
-            targetControl.addDependency(DependencyControl.newBuilder()
-                .setTargetLabel(xcodeTargetName(dependency.label))
-                .build());
-        }
-      }
-    }
-    for (XcodeProvider justTestHost : testHost.asSet()) {
-      targetControl.addDependency(DependencyControl.newBuilder()
-          .setTargetLabel(xcodeTargetName(justTestHost.label))
-          .setTestHost(true)
-          .build());
-    }
-    for (XcodeProvider extension : extensions) {
-      targetControl.addDependency(DependencyControl.newBuilder()
-          .setTargetLabel(xcodeTargetName(extension.label))
-          .build());
-    }
-
-    for (InfoplistMerging merging : infoplistMerging.asSet()) {
-      for (Artifact infoplist : merging.getPlistWithEverything().asSet()) {
-        targetControl.setInfoplist(infoplist.getExecPathString());
-      }
-    }
-    for (CompilationArtifacts artifacts : compilationArtifacts.asSet()) {
-      targetControl
-          .addAllSourceFile(Artifact.toExecPaths(artifacts.getSrcs()))
-          .addAllNonArcSourceFile(Artifact.toExecPaths(artifacts.getNonArcSrcs()));
-
-      for (Artifact pchFile : artifacts.getPchFile().asSet()) {
-        targetControl
-            .setPchPath(pchFile.getExecPathString())
-            .addSupportFile(pchFile.getExecPathString());
-      }
-    }
-
-    for (Artifact artifact : additionalSources) {
-      targetControl.addSourceFile(artifact.getExecPathString());
-    }
-
-    if (objcProvider.is(Flag.USES_CPP)) {
-      targetControl.addSdkDylib("libc++");
-    }
-
-    return targetControl.build();
-  }
-
-  /**
-   * Prepends the given path to each path in {@code paths}. Empty paths are
-   * transformed to the value of {@code variable} rather than {@code variable + "/."}
-   */
-  @VisibleForTesting
-  static Iterable<String> rootEach(final String prefix, Iterable<PathFragment> paths) {
-    Preconditions.checkArgument(prefix.startsWith("$"),
-        "prefix should start with a build setting variable like '$(NAME)': %s", prefix);
-    Preconditions.checkArgument(!prefix.endsWith("/"),
-        "prefix should not end with '/': %s", prefix);
-    return Iterables.transform(paths, new Function<PathFragment, String>() {
-      @Override
-      public String apply(PathFragment input) {
-        if (input.getSafePathString().equals(".")) {
-          return prefix;
-        } else {
-          return prefix + "/" + input.getSafePathString();
-        }
-      }
-    });
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeSupport.java b/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeSupport.java
deleted file mode 100644
index db59f01..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/XcodeSupport.java
+++ /dev/null
@@ -1,132 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-import static com.google.devtools.build.lib.packages.ImplicitOutputsFunction.fromTemplates;
-
-import com.google.devtools.build.lib.actions.Artifact;
-import com.google.devtools.build.lib.analysis.RuleConfiguredTarget.Mode;
-import com.google.devtools.build.lib.analysis.RuleContext;
-import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
-import com.google.devtools.build.lib.packages.ImplicitOutputsFunction.SafeImplicitOutputsFunction;
-import com.google.devtools.build.lib.rules.objc.XcodeProvider.Builder;
-
-/**
- * Support for Objc rule types that export an Xcode provider or generate xcode project files.
- *
- * <p>Methods on this class can be called in any order without impacting the result.
- */
-public final class XcodeSupport {
-
-  /**
-   * Template for a target's xcode project.
-   */
-  public static final SafeImplicitOutputsFunction PBXPROJ =
-      fromTemplates("%{name}.xcodeproj/project.pbxproj");
-
-  private final RuleContext ruleContext;
-
-  /**
-   * Creates a new xcode support for the given context.
-   */
-  XcodeSupport(RuleContext ruleContext) {
-    this.ruleContext = ruleContext;
-  }
-
-  /**
-   * Adds xcode project files to the given builder.
-   *
-   * @return this xcode support
-   */
-  XcodeSupport addFilesToBuild(NestedSetBuilder<Artifact> filesToBuild) {
-    filesToBuild.add(ruleContext.getImplicitOutputArtifact(PBXPROJ));
-    return this;
-  }
-
-  /**
-   * Adds a dummy source file to the Xcode target. This is needed if the target does not have any
-   * source files but Xcode requires one.
-   *
-   * @return this xcode support
-   */
-  XcodeSupport addDummySource(XcodeProvider.Builder xcodeProviderBuilder) {
-    xcodeProviderBuilder.addAdditionalSources(
-        ruleContext.getPrerequisiteArtifact("$dummy_source", Mode.TARGET));
-    return this;
-  }
-
-  /**
-   * Registers actions that generate the rule's Xcode project.
-   *
-   * @param xcodeProvider information about this rule's xcode settings and that of its dependencies
-   * @return this xcode support
-   */
-  XcodeSupport registerActions(XcodeProvider xcodeProvider) {
-    ObjcActionsBuilder actionsBuilder = ObjcRuleClasses.actionsBuilder(ruleContext);
-    actionsBuilder.registerXcodegenActions(
-        new ObjcRuleClasses.Tools(ruleContext),
-        ruleContext.getImplicitOutputArtifact(XcodeSupport.PBXPROJ),
-        XcodeProvider.Project.fromTopLevelTarget(xcodeProvider));
-    return this;
-  }
-
-  /**
-   * Adds common xcode settings to the given provider builder.
-   *
-   * @param objcProvider provider containing all dependencies' information as well as some of this
-   *    rule's
-   * @param productType type of this rule's Xcode target
-   *
-   * @return this xcode support
-   */
-  XcodeSupport addXcodeSettings(XcodeProvider.Builder xcodeProviderBuilder,
-      ObjcProvider objcProvider, XcodeProductType productType) {
-    xcodeProviderBuilder
-        .setLabel(ruleContext.getLabel())
-        .setArchitecture(ObjcRuleClasses.objcConfiguration(ruleContext).getIosCpu())
-        .setObjcProvider(objcProvider)
-        .setProductType(productType);
-    return this;
-  }
-
-  /**
-   * Adds dependencies to the given provider builder from the given attribute.
-   *
-   * @return this xcode support
-   */
-  XcodeSupport addDependencies(Builder xcodeProviderBuilder, Attribute attribute) {
-    xcodeProviderBuilder.addPropagatedDependencies(
-        ruleContext.getPrerequisites(
-            attribute.getName(), attribute.getAccessMode(), XcodeProvider.class),
-        ObjcRuleClasses.objcConfiguration(ruleContext));
-    return this;
-  }
-
-  /**
-   * Adds non-propagated dependencies to the given provider builder from the given attribute.
-   *
-   * <p>A non-propagated dependency will not be linked into the final app bundle and can only serve
-   * as a compile-only dependency for its direct dependent.
-   *
-   * @return this xcode support
-   */
-  XcodeSupport addNonPropagatedDependencies(Builder xcodeProviderBuilder, Attribute attribute) {
-    xcodeProviderBuilder.addNonPropagatedDependencies(
-        ruleContext.getPrerequisites(
-            attribute.getName(), attribute.getAccessMode(), XcodeProvider.class),
-        ObjcRuleClasses.objcConfiguration(ruleContext));
-    return this;
-  }
-}
diff --git a/src/main/java/com/google/devtools/build/lib/rules/objc/XibFiles.java b/src/main/java/com/google/devtools/build/lib/rules/objc/XibFiles.java
deleted file mode 100644
index 9be1d06..0000000
--- a/src/main/java/com/google/devtools/build/lib/rules/objc/XibFiles.java
+++ /dev/null
@@ -1,42 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.lib.rules.objc;
-
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.lib.actions.Artifact;
-
-/**
- * A sequence of xib source files. Each {@code .xib} file can be compiled to a {@code .nib} file or
- * directory. Because it might be a directory, we always use zip files to store the output and use
- * the {@code actooloribtoolzip} utility to run ibtool and zip the output.
- */
-public final class XibFiles extends IterableWrapper<Artifact> {
-  public XibFiles(Iterable<Artifact> artifacts) {
-    super(artifacts);
-  }
-
-  /**
-   * Returns a sequence where each element of this sequence is converted to the file which contains
-   * the compiled contents of the xib.
-   */
-  public ImmutableList<Artifact> compiledZips(IntermediateArtifacts intermediateArtifacts) {
-    ImmutableList.Builder<Artifact> zips = new ImmutableList.Builder<>();
-    for (Artifact xib : this) {
-      zips.add(intermediateArtifacts.compiledXibFileZip(xib));
-    }
-    return zips.build();
-  }
-}
diff --git a/src/main/protobuf/BUILD b/src/main/protobuf/BUILD
index 717d9bf..363ad3d 100644
--- a/src/main/protobuf/BUILD
+++ b/src/main/protobuf/BUILD
@@ -11,8 +11,6 @@ load("/tools/build_rules/genproto", "genproto")
     "crosstool_config",
     "extra_actions_base",
     "test_status",
-    "bundlemerge",
-    "xcodegen",
 ]]
 
 filegroup(
diff --git a/src/main/protobuf/bundlemerge.proto b/src/main/protobuf/bundlemerge.proto
deleted file mode 100644
index 18154a2..0000000
--- a/src/main/protobuf/bundlemerge.proto
+++ /dev/null
@@ -1,118 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-syntax = "proto2";
-
-package devtools.xcode;
-option java_outer_classname = "BundleMergeProtos";
-option java_package = "com.google.devtools.build.xcode.bundlemerge.proto";
-
-// Contains all the arguments necessary to drive the BundleMerge tool,
-// including the path to the output file and extra files to include in the
-// bundle.
-message Control {
-  // Paths to the plist files to merge into the final Plist.info file. These
-  // can be binary, XML, or ASCII format.
-  repeated string source_plist_file = 1;
-
-  // Path to the .ipa file to write. This is the final application bundle. Note
-  // this is ignored for nested bundles.
-  optional string out_file = 2;
-
-  // Which devices the app targets, which corresponds to the UIDeviceFamily
-  // setting. Should be one or more of the symbols in the
-  // com.google.devtools.build.xcode.common.TargetDeviceFamily enum (e.g.
-  // "IPAD", "IPHONE").
-  repeated string target_device_family = 3;
-
-  // One of the symbols in the com.google.devtools.build.xcode.common.Platform
-  // (e.g. "DEVICE", "SIMULATOR").
-  optional string platform = 4;
-
-  // The version of the SDK used to build the app.
-  optional string sdk_version = 5;
-
-  // Earliest iOS version on which the app will run.
-  optional string minimum_os_version = 6;
-
-  // The directory inside which all files are placed in the final bundle.
-  // For the top-most bundle, this is generally "Payload/{app_name}.app". If
-  // this bundle is nested, then this bundle_root is relative to to the parent's
-  // bundle_root.
-  optional string bundle_root = 7;
-
-  // All files to put in the bundle besides automatically-generated files such
-  // as Info.plist and PkgInfo. This should include the application binary.
-  repeated BundleFile bundle_file = 8;
-
-  repeated string merge_without_name_prefix_zip = 9 [deprecated=true];
-
-  // Zip files to merge with the final zip. Note that bundle_root is ignored
-  // when merging zips, so to place items in the bundle root, you should do one
-  // of the following:
-  // 1. make the merge_zips have entries that are named "{bundle_root}/foo"
-  //    rather than just "foo"
-  // 2. set the root property on the MergeZip protobuf to {bundle_root}
-  // Note that the paths of these zips are always relative to the zip file root
-  // - they are not relative to the containing bundle.
-  repeated MergeZip merge_zip = 10;
-
-  // Variable substitutions to perform on property values in the merged
-  // .plist file.
-  repeated VariableSubstitution variable_substitution = 11;
-
-  // Bundles that are nested within this one. bundle_root in these bundles is
-  // relative to the containing bundle's bundle_root.
-  repeated Control nested_bundle = 12;
-
-  // Name of the executable for this bundle or unset if no such executable
-  // exists.
-  optional string executable_name = 13;
-
-  // A reverse-DNS string identifier for this bundle.
-  optional string primary_bundle_identifier = 14;
-
-  // A fallback bundle identifier used when primary is not filled.
-  optional string fallback_bundle_identifier = 15;
-}
-
-// Represents a zip file to merge with the final zip.
-message MergeZip {
-  // The prefix to prepend to every entry name before putting it in the final
-  // zip. For instance, "Payload/Foo.app/" (notice the final slash).
-  optional string entry_name_prefix = 1 [default = ""];
-
-  // The path to the source file to merge.
-  optional string source_path = 2;
-}
-
-message BundleFile {
-  // The path of the file to put in the bundle.
-  optional string source_file = 1;
-
-  // The path of the file in the bundle, relative to the bundle root.
-  optional string bundle_path = 2;
-
-  // The external file attribute field in the central directory record in the
-  // .zip file. If omitted, the ZipInputEntry.DEFAULT_EXTERNAL_FILE_ATTRIBUTE
-  // constant is used.
-  optional int32 external_file_attribute = 3;
-}
-
-message VariableSubstitution {
-  // The name of the varaible to substitute.
-  required string name = 1;
-
-  // The substitution value.
-  required string value = 2;
-}
diff --git a/src/main/protobuf/xcodegen.proto b/src/main/protobuf/xcodegen.proto
deleted file mode 100644
index 6a19555..0000000
--- a/src/main/protobuf/xcodegen.proto
+++ /dev/null
@@ -1,179 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-syntax = "proto2";
-
-package build.xcode;
-option java_outer_classname = "XcodeGenProtos";
-option java_package = "com.google.devtools.build.xcode.xcodegen.proto";
-
-// Protos named "*Control" are protos that can be used to tell Xcodegen what to
-// do.
-
-// Contains all information needed to pass to Xcodegen for it to generate a
-// project file.
-message Control {
-  // Relative path to the project.pbxproj file. This value is used to construct
-  // relative paths in the xcodeproj file, as well as to specify where to write
-  // the resulting project file.
-  optional string pbxproj = 1;
-
-  // The targets to generate.
-  repeated TargetControl target = 2;
-
-  // Project-level build settings. These are shared with every target, unless
-  // an individual target overrides any of them.
-  repeated XcodeprojBuildSetting build_setting = 3;
-}
-
-// Information about dependency on a separate target.
-message DependencyControl {
-  // Label of the target in the project file that is depended upon.
-  optional string target_label = 1;
-
-  // Set to true if this dependency is that of a xctest target on its TEST_HOST.
-  // Considered 'false' if omitted.
-  optional bool test_host = 2;
-}
-
-// Contains information specific to a single target in the project file.
-// Next ID: 23
-message TargetControl {
-  // A short name for the target that need not be unique. For instance, for
-  // binary targets this corresponds to the product name.
-  optional string name = 1;
-
-  // Relative paths to source files to compile. Each source file is added to
-  // the sources build phase of the target, so any file accepted by Xcode is
-  // valid.
-  repeated string source_file = 2;
-
-  // Identical to source_file, but only Objective-C[++] source files are
-  // valid. These sources are compiled without ARC.
-  repeated string non_arc_source_file = 6;
-
-  // Relative paths to support files, such as BUILD, header, and non-compiled
-  // source files. These are included in the project so they can be opened in
-  // the project explorer view, but are not compiled into object files.
-  repeated string support_file = 3;
-
-  // Dependencies this target has on other targets.
-  repeated DependencyControl dependency = 4;
-
-  // (Used for objc_binary and objc_bundle_library targets) path to the
-  // -Info.plist file for the application.
-  optional string infoplist = 5;
-
-  // Label corresponding to the target. This is needed to determine a
-  // unique name for the target in the project. This is similar to the name
-  // field, but is globally unique and may be long.
-  optional string label = 7;
-
-  // Additional flags to pass to the [objective] c[++] compiler.
-  repeated string copt = 8;
-
-  // Additional flags to pass to the linker.
-  repeated string linkopt = 22;
-
-  // Paths to *.xcassets directories to include in the target as asset
-  // catalogs. For all targets, this causes the .xcassets directory to be
-  // included in the Project Navigator. For targets that can include them (e.g.
-  // objc_binary), this causes them to be included in the resources build
-  // phase.
-  repeated string xcassets_dir = 9;
-
-  // Miscellaneous build settings. Each setting is applied to all build
-  // configurations.
-  repeated XcodeprojBuildSetting build_setting = 10;
-
-  // Paths to strings or xib files. Xcodegen will determine automatically if
-  // they are localized (i.e. are in a directory named *.lproj) or not.
-  // TODO(bazel-team): Introduce a more powerful resource file protobuf, a
-  // list of which can be used to specify all resources.
-  repeated string general_resource_file = 11;
-
-  // SDK frameworks to link with this target. This should be every framework
-  // required by the targets in the transitive dependency tree. Xcodegen does
-  // not find these transitive dependencies automatically; they must be added
-  // to this repeated field.
-  repeated string sdk_framework = 12;
-
-  // Paths to non-SDK frameworks to link with this target, relative to the
-  // same path as every other path in the control file. This should be every
-  // framework required by the targets in the transitive dependency tree.
-  repeated string framework = 21;
-
-  // Path to all .xcdatamodel directories required. All directories inside
-  // a .xcdatamodeld directory are grouped into XCVersionGroups by the path of
-  // the .xcdatamodeld directory.
-  repeated string xcdatamodel = 13;
-
-  // Path to all .a libraries to link with this target. When used on static
-  // library targets, the library is not actually linked, but it will appear
-  // in the Xcode Project Navigator. These are considered to be pre-built
-  // libraries. In other words, they are NOT built by Xcode as a dependency
-  // before this target is built.
-  repeated string imported_library = 14;
-
-  // Path to directories to include as user header search paths. These are non-
-  // recursive. These should be specified here rather than in the build_setting
-  // field because the build_setting field requires paths to be specified
-  // relative to the container of the .xcodeproj directory, while this
-  // attribute is relative to the same path as every other path in the control
-  // file. These paths correspond to the "-iquote" arguments passed to the
-  // compiler.
-  repeated string user_header_search_path = 15;
-
-  // Path to directories to include as header search paths. These are non-
-  // recursive. These should be specified here rather than in the build_setting
-  // field because the build_setting field requires paths to be specified
-  // relative to the container of the .xcodeproj directory, while this
-  // attribute is relative to the same path as every other path in the control
-  // file. These paths correspond to the "-I" arguments passed to the
-  // compiler.
-  repeated string header_search_path = 16;
-
-  // GCC_PREFIX_HEADER path. Needs to be be specified here rather than in the
-  // build_setting field because the build_setting field requires paths to be
-  // specified relative to the container of the .xcodeproj directory, while
-  // this attribute is relative to the same path as every other path in the
-  // control file.
-  optional string pch_path = 20;
-
-  // Path to .bundle directories this target depends on. For static library
-  // targets, this only causes the bundle to appear in the Project Navigator.
-  // For application target, this also causes the bundle to be linked with the
-  // application.
-  repeated string bundle_import = 17;
-
-  // The product type, for instance "com.apple.product-type.bundle". If
-  // omitted, the presence of the infoplist field indicates the type:
-  // has infoplist: "com.apple.product-type.application"
-  // does not have infoplist: "com.apple.product-type.library.static"
-  optional string product_type = 18;
-
-  // SDK .dylib files to link with this target. Each name should not include the
-  // the path or the .dylib extension, e.g. "libz" to link in
-  // "SDKROOT/usr/lib/libz.dylib". For all targets, this causes the library to
-  // appear in the Project Navigator. For binary targets, this causes the
-  // library to be linked with the final binary.
-  repeated string sdk_dylib = 19;
-}
-
-// Represents the mapping of a build setting recognized by Xcode project files,
-// for instance ASSETCATALOG_COMPILER_APPICON_NAME.
-message XcodeprojBuildSetting {
-  optional string name = 1;
-  optional string value = 2;
-}
diff --git a/src/objc_tools/bundlemerge/README b/src/objc_tools/bundlemerge/README
deleted file mode 100644
index 1701f81..0000000
--- a/src/objc_tools/bundlemerge/README
+++ /dev/null
@@ -1,2 +0,0 @@
-bundlemerge merges the assorted files making up an iOS application into a final
-IPA bundle.
diff --git a/src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerge.java b/src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerge.java
deleted file mode 100644
index daa93a4..0000000
--- a/src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerge.java
+++ /dev/null
@@ -1,54 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.bundlemerge;
-
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.Control;
-import com.google.devtools.build.xcode.plmerge.PlistMerging.ValidationException;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.nio.file.FileSystem;
-import java.nio.file.FileSystems;
-import java.nio.file.Files;
-
-/**
- * Command-line entry point for {@link BundleMerging}. functionality. The only argument passed to
- * this command-line utility should be a control file which contains a binary serialization of the
- * {@link Control} protocol buffer.
- */
-public class BundleMerge {
-  private BundleMerge() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  public static void main(String[] args) throws IOException {
-    if (args.length != 1) {
-      System.err.println("Expect exactly one argument: path to control file");
-      System.exit(1);
-    }
-    FileSystem fileSystem = FileSystems.getDefault();
-    Control control;
-    try (InputStream in = Files.newInputStream(fileSystem.getPath(args[0]))) {
-      control = Control.parseFrom(in);
-    }
-    try {
-      BundleMerging.merge(fileSystem, control);
-    } catch (ValidationException e) {
-      // Don't print stack traces for validation errors.
-      System.err.print("\nBundle merge failed: " + e.getMessage() + "\n");
-      System.exit(1);
-    }
-  }
-}
diff --git a/src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerging.java b/src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerging.java
deleted file mode 100644
index 3d3ceaa..0000000
--- a/src/objc_tools/bundlemerge/java/com/google/devtools/build/xcode/bundlemerge/BundleMerging.java
+++ /dev/null
@@ -1,227 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.bundlemerge;
-
-import static com.google.devtools.build.singlejar.ZipCombiner.DOS_EPOCH;
-import static com.google.devtools.build.singlejar.ZipCombiner.OutputMode.FORCE_DEFLATE;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.devtools.build.singlejar.ZipCombiner;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.BundleFile;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.Control;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.MergeZip;
-import com.google.devtools.build.xcode.bundlemerge.proto.BundleMergeProtos.VariableSubstitution;
-import com.google.devtools.build.xcode.common.Platform;
-import com.google.devtools.build.xcode.plmerge.KeysToRemoveIfEmptyString;
-import com.google.devtools.build.xcode.plmerge.PlistMerging;
-import com.google.devtools.build.xcode.zip.ZipFiles;
-import com.google.devtools.build.xcode.zip.ZipInputEntry;
-
-import java.io.IOException;
-import java.io.OutputStream;
-import java.nio.file.FileSystem;
-import java.nio.file.Files;
-import java.nio.file.Path;
-import java.util.Map;
-import java.util.zip.ZipEntry;
-import java.util.zip.ZipInputStream;
-
-import javax.annotation.CheckReturnValue;
-
-/**
- * Implementation of the final steps to create an iOS application bundle.
- *
- * TODO(bazel-team): Add asset catalog compilation and bundling to this logic.
- */
-public final class BundleMerging {
-  @VisibleForTesting final FileSystem fileSystem;
-  @VisibleForTesting final Path outputZip;
-  @VisibleForTesting final ImmutableList<ZipInputEntry> inputs;
-  @VisibleForTesting final ImmutableList<MergeZip> mergeZips;
-
-  /**
-   * We can instantiate this class for testing purposes. For typical uses, just use
-   * {@link #merge(FileSystem, Control)}.
-   */
-  private BundleMerging(FileSystem fileSystem,
-      Path outputZip, ImmutableList<ZipInputEntry> inputs, ImmutableList<MergeZip> mergeZips) {
-    this.fileSystem = Preconditions.checkNotNull(fileSystem);
-    this.outputZip = Preconditions.checkNotNull(outputZip);
-    this.inputs = Preconditions.checkNotNull(inputs);
-    this.mergeZips = Preconditions.checkNotNull(mergeZips);
-  }
-
-  /**
-   * Joins two paths to be used in a zip file. The {@code right} part of the path must be relative.
-   * The {@code left} part could or could not have a trailing slash. These paths are used in .ipa
-   * (.zip) files, which must use forward slashes, so they are hard-coded here.
-   * <p>
-   * TODO(bazel-team): This is messy. See if we can use some common joining function that handles
-   * empty paths and doesn't automatically inherit the path conventions of the host platform.
-   */
-  private static String joinPath(String left, String right) {
-    Preconditions.checkArgument(!right.startsWith("/"), "'right' must be relative: %s", right);
-    if (left.isEmpty() || right.isEmpty() || left.endsWith("/")) {
-      return left + right;
-    } else {
-      return left + "/" + right;
-    }
-  }
-
-  private static final String INFOPLIST_FILENAME = "Info.plist";
-  private static final String PKGINFO_FILENAME = "PkgInfo";
-
-  /**
-   * Adds merge artifacts from the given {@code control} into builders that collect merge zips and
-   * individual files. {@code bundleRoot} is prepended to each path, except the paths in the merge
-   * zips.
-   */
-  private static void mergeInto(
-      Path tempDir, FileSystem fileSystem, Control control, String bundleRoot,
-      ImmutableList.Builder<ZipInputEntry> packagedFilesBuilder,
-      ImmutableList.Builder<MergeZip> mergeZipsBuilder, boolean includePkgInfo) throws IOException {
-    Path tempMergedPlist = Files.createTempFile(tempDir, null, INFOPLIST_FILENAME);
-    Path tempPkgInfo = Files.createTempFile(tempDir, null, PKGINFO_FILENAME);
-
-    // Generate the Info.plist and PkgInfo files to include in the app bundle.
-    ImmutableList.Builder<Path> sourcePlistFilesBuilder = new ImmutableList.Builder<>();
-    for (String sourcePlist : control.getSourcePlistFileList()) {
-      sourcePlistFilesBuilder.add(fileSystem.getPath(sourcePlist));
-    }
-    ImmutableList<Path> sourcePlistFiles = sourcePlistFilesBuilder.build();
-    ImmutableMap.Builder<String, String> substitutionMap = ImmutableMap.builder();
-    for (VariableSubstitution substitution : control.getVariableSubstitutionList()) {
-      substitutionMap.put(substitution.getName(), substitution.getValue());
-    }
-    PlistMerging plistMerging = PlistMerging.from(
-        sourcePlistFiles,
-        PlistMerging.automaticEntries(
-            control.getTargetDeviceFamilyList(),
-            Platform.valueOf(control.getPlatform()),
-            control.getSdkVersion(),
-            control.getMinimumOsVersion()),
-        substitutionMap.build(),
-        new KeysToRemoveIfEmptyString("CFBundleIconFile", "NSPrincipalClass"));
-    if (control.hasExecutableName()) {
-      plistMerging.setExecutableName(control.getExecutableName());
-    }
-    
-    plistMerging.setBundleIdentifier(
-        control.hasPrimaryBundleIdentifier() ? control.getPrimaryBundleIdentifier() : null,
-        control.hasFallbackBundleIdentifier() ? control.getFallbackBundleIdentifier() : null);
-   
-    plistMerging.write(tempMergedPlist, tempPkgInfo);
-
-
-    bundleRoot = joinPath(bundleRoot, control.getBundleRoot());
-
-    // Add files to zip configuration which creates the final application bundle.
-    packagedFilesBuilder
-        .add(new ZipInputEntry(tempMergedPlist, joinPath(bundleRoot, INFOPLIST_FILENAME)));
-    if (includePkgInfo) {
-      packagedFilesBuilder
-          .add(new ZipInputEntry(tempPkgInfo, joinPath(bundleRoot, PKGINFO_FILENAME)));
-    }
-    for (BundleFile bundleFile : control.getBundleFileList()) {
-      int externalFileAttribute = bundleFile.hasExternalFileAttribute()
-          ? bundleFile.getExternalFileAttribute() : ZipInputEntry.DEFAULT_EXTERNAL_FILE_ATTRIBUTE;
-      packagedFilesBuilder.add(
-          new ZipInputEntry(
-              fileSystem.getPath(bundleFile.getSourceFile()),
-              joinPath(bundleRoot, bundleFile.getBundlePath()),
-              externalFileAttribute));
-    }
-
-    for (String mergeZip : control.getMergeWithoutNamePrefixZipList()) {
-      mergeZipsBuilder.add(MergeZip.newBuilder()
-          .setSourcePath(mergeZip)
-          .build());
-    }
-    mergeZipsBuilder.addAll(control.getMergeZipList());
-
-    for (Control nestedControl : control.getNestedBundleList()) {
-      mergeInto(tempDir, fileSystem, nestedControl, bundleRoot, packagedFilesBuilder,
-          mergeZipsBuilder, /*includePkgInfo=*/false);
-    }
-  }
-
-  /**
-   * Returns a zipper configuration that can be executed to create the application bundle.
-   */
-  @CheckReturnValue
-  @VisibleForTesting
-  static BundleMerging merging(Path tempDir, FileSystem fileSystem, Control control)
-      throws IOException {
-    ImmutableList.Builder<MergeZip> mergeZipsBuilder = new ImmutableList.Builder<>();
-    ImmutableList.Builder<ZipInputEntry> packagedFilesBuilder =
-        new ImmutableList.Builder<ZipInputEntry>();
-
-    mergeInto(tempDir, fileSystem, control, /*bundleRoot=*/"", packagedFilesBuilder,
-        mergeZipsBuilder, /*includePkgInfo=*/true);
-
-    return new BundleMerging(fileSystem, fileSystem.getPath(control.getOutFile()),
-        packagedFilesBuilder.build(), mergeZipsBuilder.build());
-  }
-
-  /**
-   * Copies all entries from the source zip into a destination zip using the given combiner. The
-   * contents of the source zip can appear to be in a sub-directory of the destination zip by
-   * passing a non-empty string for the entry names prefix with a trailing '/'.
-   */
-  private void addEntriesFromOtherZip(ZipCombiner combiner, Path sourceZip, String entryNamesPrefix)
-      throws IOException {
-    Map<String, Integer> externalFileAttributes = ZipFiles.unixExternalFileAttributes(sourceZip);
-    try (ZipInputStream zipIn = new ZipInputStream(Files.newInputStream(sourceZip))) {
-      while (true) {
-        ZipEntry zipInEntry = zipIn.getNextEntry();
-        if (zipInEntry == null) {
-          break;
-        }
-        Integer externalFileAttr = externalFileAttributes.get(zipInEntry.getName());
-        if (externalFileAttr == null) {
-          externalFileAttr = ZipInputEntry.DEFAULT_EXTERNAL_FILE_ATTRIBUTE;
-        }
-        combiner.addFile(
-            entryNamesPrefix + zipInEntry.getName(), DOS_EPOCH, zipIn,
-            ZipInputEntry.DEFAULT_DIRECTORY_ENTRY_INFO.withExternalFileAttribute(externalFileAttr));
-      }
-    }
-  }
-
-  @VisibleForTesting
-  void execute() throws IOException {
-    try (OutputStream out = Files.newOutputStream(outputZip);
-        ZipCombiner combiner = new ZipCombiner(FORCE_DEFLATE, out)) {
-      ZipInputEntry.addAll(combiner, inputs);
-      for (MergeZip mergeZip : mergeZips) {
-        addEntriesFromOtherZip(
-            combiner, fileSystem.getPath(mergeZip.getSourcePath()), mergeZip.getEntryNamePrefix());
-      }
-    }
-  }
-
-  /**
-   * Creates an {@code .ipa} file for an iOS application.
-   * @param fileSystem used to resolve paths specified in {@code control} 
-   * @param control specifies the locations of input and output files and other parameters used to
-   *     create the final {@code .ipa} file.
-   */
-  public static void merge(FileSystem fileSystem, Control control) throws IOException {
-    merging(Files.createTempDirectory("mergebundle"), fileSystem, control).execute();
-  }
-}
diff --git a/src/objc_tools/momczip/README b/src/objc_tools/momczip/README
deleted file mode 100644
index 1c87f43..0000000
--- a/src/objc_tools/momczip/README
+++ /dev/null
@@ -1,2 +0,0 @@
-momczip invokes momc ("Managed object model compiler") and zips up the output,
-as the number of output files is unpredictable.
diff --git a/src/objc_tools/momczip/java/com/google/devtools/build/xcode/momczip/MomcZip.java b/src/objc_tools/momczip/java/com/google/devtools/build/xcode/momczip/MomcZip.java
deleted file mode 100644
index 2134440..0000000
--- a/src/objc_tools/momczip/java/com/google/devtools/build/xcode/momczip/MomcZip.java
+++ /dev/null
@@ -1,56 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.momczip;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.xcode.zippingoutput.Arguments;
-import com.google.devtools.build.xcode.zippingoutput.Wrapper;
-import com.google.devtools.build.xcode.zippingoutput.Wrappers;
-
-import java.io.IOException;
-
-/**
- * A tool which wraps momc, by running momc and zipping its output. See the JavaDoc for
- * {@link Wrapper} for more information.
- */
-public class MomcZip implements Wrapper {
-  @Override
-  public String name() {
-    return "MomcZip";
-  }
-
-  @Override
-  public String subtoolName() {
-    return "momc";
-  }
-
-  @Override
-  public Iterable<String> subCommand(Arguments args, String outputDirectory) {
-    return new ImmutableList.Builder<String>()
-        .add(args.subtoolCmd())
-        .addAll(args.subtoolExtraArgs())
-        .add(outputDirectory)
-        .build();
-  }
-
-  public static void main(String[] args) throws IOException, InterruptedException {
-    Wrappers.executePipingOutput(args, new MomcZip());
-  }
-
-  @Override
-  public boolean outputDirectoryMustExist() {
-    return false;
-  }
-}
diff --git a/src/objc_tools/plmerge/README b/src/objc_tools/plmerge/README
deleted file mode 100644
index 972409f..0000000
--- a/src/objc_tools/plmerge/README
+++ /dev/null
@@ -1,2 +0,0 @@
-plmerge merges plist files into one. It is similar to Xcode's built in
-builtin-infoPlistUtility.
diff --git a/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/KeysToRemoveIfEmptyString.java b/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/KeysToRemoveIfEmptyString.java
deleted file mode 100644
index 5f4662f..0000000
--- a/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/KeysToRemoveIfEmptyString.java
+++ /dev/null
@@ -1,37 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.plmerge;
-
-import com.google.common.collect.ImmutableList;
-
-import java.util.Iterator;
-
-/**
- * A glorified {@link Iterable} which contains keys which should be automatically removed from the
- * final plist if they are empty strings.
- */
-public final class KeysToRemoveIfEmptyString implements Iterable<String> {
-  private final Iterable<String> keyNames;
-
-  public KeysToRemoveIfEmptyString(String... keyNames) {
-    this.keyNames = ImmutableList.copyOf(keyNames);
-  }
-
-  @Override
-  public Iterator<String> iterator() {
-    return keyNames.iterator();
-  }
-}
-
diff --git a/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlMerge.java b/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlMerge.java
deleted file mode 100644
index e61f2b9..0000000
--- a/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlMerge.java
+++ /dev/null
@@ -1,84 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.plmerge;
-
-import com.google.common.collect.ImmutableMap;
-import com.google.devtools.common.options.Option;
-import com.google.devtools.common.options.Options;
-import com.google.devtools.common.options.OptionsBase;
-import com.google.devtools.common.options.OptionsParser;
-import com.google.devtools.common.options.OptionsParsingException;
-
-import com.dd.plist.NSObject;
-
-import java.io.IOException;
-import java.nio.file.FileSystem;
-import java.nio.file.FileSystems;
-import java.nio.file.Path;
-import java.util.ArrayList;
-import java.util.List;
-
-/**
- * Entry point for the {@code plmerge} tool, which merges the data from one or more plists into a
- * single binary plist. This tool's functionality is similar to that of the
- * {@code builtin-infoPlistUtility} in Xcode.
- */
-public class PlMerge {
-  /**
-   * Options for {@link PlMerge}.
-   */
-  public static class PlMergeOptions extends OptionsBase {
-    @Option(
-        name = "source_file",
-        help = "Paths to the plist files to merge. These can be binary, XML, or ASCII format. "
-            + "Repeat this flag to specify multiple files. Required.",
-        allowMultiple = true,
-        defaultValue = "null")
-    public List<String> sourceFiles;
-
-    @Option(
-        name = "out_file",
-        help = "Path to the output file. Required.",
-        defaultValue = "null")
-    public String outFile;
-  }
-
-  public static void main(String[] args) throws IOException, OptionsParsingException {
-    OptionsParser parser = OptionsParser.newOptionsParser(PlMergeOptions.class);
-    parser.parse(args);
-    PlMergeOptions options = parser.getOptions(PlMergeOptions.class);
-    if (options.sourceFiles.isEmpty()) {
-      missingArg("At least one --source_file");
-    }
-    if (options.outFile == null) {
-      missingArg("--out_file");
-    }
-    FileSystem fileSystem = FileSystems.getDefault();
-
-    List<Path> sourceFilePaths = new ArrayList<>();
-    for (String sourceFile : options.sourceFiles) {
-      sourceFilePaths.add(fileSystem.getPath(sourceFile));
-    }
-
-    PlistMerging merging = PlistMerging.from(sourceFilePaths, ImmutableMap.<String, NSObject>of(),
-        ImmutableMap.<String, String>of(), new KeysToRemoveIfEmptyString());
-    merging.writePlist(fileSystem.getPath(options.outFile));
-  }
-
-  private static void missingArg(String flag) {
-    throw new IllegalArgumentException(flag + " is required:\n"
-        + Options.getUsage(PlMergeOptions.class));
-  }
-}
diff --git a/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlistMerging.java b/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlistMerging.java
deleted file mode 100644
index 558cf46..0000000
--- a/src/objc_tools/plmerge/java/com/google/devtools/build/xcode/plmerge/PlistMerging.java
+++ /dev/null
@@ -1,318 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.plmerge;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.FluentIterable;
-import com.google.common.collect.ImmutableBiMap;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Maps;
-import com.google.common.collect.Ordering;
-import com.google.common.collect.Sets;
-import com.google.common.io.ByteSource;
-import com.google.devtools.build.xcode.common.Platform;
-import com.google.devtools.build.xcode.util.Equaling;
-import com.google.devtools.build.xcode.util.Mapping;
-import com.google.devtools.build.xcode.util.Value;
-
-import com.dd.plist.BinaryPropertyListWriter;
-import com.dd.plist.NSArray;
-import com.dd.plist.NSDictionary;
-import com.dd.plist.NSObject;
-import com.dd.plist.NSString;
-import com.dd.plist.PropertyListFormatException;
-import com.dd.plist.PropertyListParser;
-
-import org.xml.sax.SAXException;
-
-import java.io.BufferedInputStream;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.OutputStream;
-import java.nio.charset.StandardCharsets;
-import java.nio.file.Files;
-import java.nio.file.Path;
-import java.text.ParseException;
-import java.util.Arrays;
-import java.util.Collection;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-
-import javax.xml.parsers.ParserConfigurationException;
-
-/**
- * Utility code for merging project files.
- */
-public class PlistMerging extends Value<PlistMerging> {
-  private static final String BUNDLE_IDENTIFIER_PLIST_KEY = "CFBundleIdentifier";
-
-  private static final ImmutableBiMap<String, Integer> DEVICE_FAMILIES =
-      ImmutableBiMap.of("IPHONE", 1, "IPAD", 2);
-
-  /**
-   * Exception type thrown when validation of the plist file fails.
-   */
-  public static class ValidationException extends RuntimeException {
-    ValidationException(String message) {
-      super(message);
-    }
-  }
-
-  private final NSDictionary merged;
-
-  @VisibleForTesting
-  PlistMerging(NSDictionary merged) {
-    super(merged);
-    this.merged = merged;
-  }
-
-  /**
-   * Merges several plist files into a single {@code NSDictionary}. Each file should be a plist (of
-   * one of these formats: ASCII, Binary, or XML) that contains an NSDictionary.
-   */
-  @VisibleForTesting
-  static NSDictionary merge(Iterable<? extends Path> sourceFilePaths) throws IOException {
-    NSDictionary result = new NSDictionary();
-    for (Path sourceFilePath : sourceFilePaths) {
-      result.putAll(readPlistFile(sourceFilePath));
-    }
-    return result;
-  }
-
-  public static NSDictionary readPlistFile(final Path sourceFilePath) throws IOException {
-    ByteSource rawBytes = new Utf8BomSkippingByteSource(sourceFilePath);
-
-    try {
-      try (InputStream in = rawBytes.openStream()) {
-        return (NSDictionary) PropertyListParser.parse(in);
-      } catch (PropertyListFormatException | ParseException e) {
-        // If we failed to parse, the plist may implicitly be a map. To handle this, wrap the plist
-        // with {}.
-        // TODO(bazel-team): Do this in a cleaner way.
-        ByteSource concatenated = ByteSource.concat(
-            ByteSource.wrap(new byte[] {'{'}),
-            rawBytes,
-            ByteSource.wrap(new byte[] {'}'}));
-        try (InputStream in = concatenated.openStream()) {
-          return (NSDictionary) PropertyListParser.parse(in);
-        }
-      }
-    } catch (PropertyListFormatException | ParseException | ParserConfigurationException
-        | SAXException e) {
-      throw new IOException(e);
-    }
-  }
-
-  /**
-   * Writes the results of a merge operation to a plist file.
-   * @param plistPath the path of the plist to write in binary format
-   */
-  public void writePlist(Path plistPath) throws IOException {
-    try (OutputStream out = Files.newOutputStream(plistPath)) {
-      BinaryPropertyListWriter.write(out, merged);
-    }
-  }
-
-  /**
-   * Writes a PkgInfo file based on certain keys in the merged plist.
-   * @param pkgInfoPath the path of the PkgInfo file to write. In many iOS apps, this file just
-   *     contains the raw string {@code APPL????}.
-   */
-  public void writePkgInfo(Path pkgInfoPath) throws IOException {
-    String pkgInfo =
-        Mapping.of(merged, "CFBundlePackageType").or(NSObject.wrap("APPL")).toString()
-        + Mapping.of(merged, "CFBundleSignature").or(NSObject.wrap("????")).toString();
-    Files.write(pkgInfoPath, pkgInfo.getBytes(StandardCharsets.UTF_8));
-  }
-
-  /** Invokes {@link #writePlist(Path)} and {@link #writePkgInfo(Path)}. */
-  public void write(Path plistPath, Path pkgInfoPath) throws IOException {
-    writePlist(plistPath);
-    writePkgInfo(pkgInfoPath);
-  }
-
-  /**
-   * Returns a map containing entries that should be added to the merged plist. These are usually
-   * generated by Xcode automatically during the build process.
-   */
-  public static Map<String, NSObject> automaticEntries(
-      Collection<String> targetedDeviceFamily, Platform platform, String sdkVersion,
-      String minimumOsVersion) {
-    ImmutableMap.Builder<String, NSObject> result = new ImmutableMap.Builder<>();
-    List<Integer> uiDeviceFamily = FluentIterable.from(targetedDeviceFamily)
-        .transform(Maps.asConverter(DEVICE_FAMILIES))
-        .toSortedList(Ordering.natural());
-
-    result.put("UIDeviceFamily", NSObject.wrap(uiDeviceFamily.toArray()));
-    result.put("DTPlatformName", NSObject.wrap(platform.getLowerCaseNameInPlist()));
-    result.put("DTSDKName", NSObject.wrap(platform.getLowerCaseNameInPlist() + sdkVersion));
-    result.put("CFBundleSupportedPlatforms", new NSArray(NSObject.wrap(platform.getNameInPlist())));
-
-    if (platform == Platform.DEVICE) {
-      // TODO(bazel-team): Figure out if there are more appropriate values to put here, or if any
-      // can be omitted. These have been copied from a plist file generated by Xcode for a device
-      // build.
-      result.put("DTCompiler", NSObject.wrap("com.apple.compilers.llvm.clang.1_0"));
-      result.put("BuildMachineOSBuild", NSObject.wrap("13D65"));
-      result.put("DTPlatformBuild", NSObject.wrap("11B508"));
-      result.put("DTSDKBuild", NSObject.wrap("11B508"));
-      result.put("DTXcode", NSObject.wrap("0502"));
-      result.put("DTXcodeBuild", NSObject.wrap("5A3005"));
-      result.put("DTPlatformVersion", NSObject.wrap(sdkVersion));
-      result.put("MinimumOSVersion", NSObject.wrap(minimumOsVersion));
-    }
-    return result.build();
-  }
-
-  /**
-   * Generates final merged Plist file and PkgInfo file in the specified locations, and includes the
-   * "automatic" entries in the Plist.
-   */
-  public static PlistMerging from(List<Path> sourceFiles, Map<String, NSObject> automaticEntries,
-      Map<String, String> substitutions, KeysToRemoveIfEmptyString keysToRemoveIfEmptyString)
-          throws IOException {
-    NSDictionary merged = PlistMerging.merge(sourceFiles);
-
-    Set<String> conflictingEntries = Sets.intersection(automaticEntries.keySet(), merged.keySet());
-    Preconditions.checkArgument(conflictingEntries.isEmpty(),
-        "The following plist entries are generated automatically, but are present in more than one "
-            + "of the input lists: %s", conflictingEntries);
-    merged.putAll(automaticEntries);
-
-    for (Map.Entry<String, NSObject> entry : merged.entrySet()) {
-      if (entry.getValue().toJavaObject() instanceof String) {
-        String newValue = substituteEnvironmentVariable(
-            substitutions, (String) entry.getValue().toJavaObject());
-        merged.put(entry.getKey(), newValue);
-      }
-    }
-
-    for (String key : keysToRemoveIfEmptyString) {
-      if (Equaling.of(Mapping.of(merged, key), Optional.<NSObject>of(new NSString("")))) {
-        merged.remove(key);
-      }
-    }
-
-    return new PlistMerging(merged);
-  }
-
-  // Assume that if an RFC 1034 format string is specified, the value is RFC 1034 compliant.
-  private static String substituteEnvironmentVariable(
-      Map<String, String> substitutions, String string) {
-    // The substitution is *not* performed recursively.
-    for (Map.Entry<String, String> variable : substitutions.entrySet()) {
-      for (String variableNameWithFormatString : withFormatStrings(variable.getKey())) {
-        string = string
-            .replace("${" + variableNameWithFormatString + "}", variable.getValue())
-            .replace("$(" + variableNameWithFormatString + ")", variable.getValue());
-      }
-    }
-
-    return string;
-  }
-
-  private static ImmutableSet<String> withFormatStrings(String variableName) {
-    return ImmutableSet.of(variableName, variableName + ":rfc1034identifier");
-  }
-
-  @VisibleForTesting
-  NSDictionary asDictionary() {
-    return merged;
-  }
-
-  /**
-   * Sets the given executable name on this merged plist in the {@code CFBundleExecutable}
-   * attribute.
-   *
-   * @param executableName name of the bundle executable
-   * @return this plist merging
-   * @throws ValidationException if the plist already contains an incompatible
-   *    {@code CFBundleExecutable} entry
-   */
-  public PlistMerging setExecutableName(String executableName) {
-    NSString bundleExecutable = (NSString) merged.get("CFBundleExecutable");
-
-    if (bundleExecutable == null) {
-      merged.put("CFBundleExecutable", executableName);
-    } else if (!executableName.equals(bundleExecutable.getContent())) {
-      throw new ValidationException(String.format(
-          "Blaze generated the executable %s but the Plist CFBundleExecutable is %s",
-          executableName, bundleExecutable));
-    }
-
-    return this;
-  }
-  
-  /**
-   * Sets the given identifier on this merged plist in the {@code CFBundleIdentifier}
-   * attribute.
-   *
-   * @param primaryIdentifier used if the bundle doesn't have an identifier already, can be null
-   * @param fallbackIdentifier used if neither bundle, nor primary identifier is set, can be null
-   * @return this plist merging
-   * @throws ValidationException if both plist and control contain bundle identifiers and they
-   *     don't match
-   */
-  public PlistMerging setBundleIdentifier(String primaryIdentifier, String fallbackIdentifier) {
-    NSString bundleIdentifier = (NSString) merged.get(BUNDLE_IDENTIFIER_PLIST_KEY);
-        
-    if (bundleIdentifier == null) {
-      if (primaryIdentifier != null) {
-        merged.put(BUNDLE_IDENTIFIER_PLIST_KEY, primaryIdentifier);
-      } else if (fallbackIdentifier != null) {
-        merged.put(BUNDLE_IDENTIFIER_PLIST_KEY, fallbackIdentifier);
-      }
-    } else if (primaryIdentifier != null 
-        && !primaryIdentifier.equals(bundleIdentifier.getContent())) {
-      throw new ValidationException(String.format(
-          "Blaze generated bundle_id is %s but the Plist %s is %s",
-          primaryIdentifier, BUNDLE_IDENTIFIER_PLIST_KEY, bundleIdentifier));
-    }
-    
-    return this;
-  }
-
-  private static class Utf8BomSkippingByteSource extends ByteSource {
-
-    private static final byte[] UTF8_BOM =
-        new byte[] { (byte) 0xEF, (byte) 0xBB, (byte) 0xBF };
-
-    private final Path path;
-
-    public Utf8BomSkippingByteSource(Path path) {
-      this.path = path;
-    }
-
-    @Override
-    public InputStream openStream() throws IOException {
-      InputStream stream = new BufferedInputStream(Files.newInputStream(path));
-      stream.mark(UTF8_BOM.length);
-      byte[] buffer = new byte[UTF8_BOM.length];
-      int read = stream.read(buffer);
-      stream.reset();
-      buffer = Arrays.copyOf(buffer, read);
-
-      if (UTF8_BOM.length == read && Arrays.equals(buffer, UTF8_BOM)) {
-        stream.skip(UTF8_BOM.length);
-      }
-
-      return stream;
-    }
-  }
-}
diff --git a/src/objc_tools/xcodegen/README b/src/objc_tools/xcodegen/README
deleted file mode 100644
index c91dea7..0000000
--- a/src/objc_tools/xcodegen/README
+++ /dev/null
@@ -1,2 +0,0 @@
-xcodegen generates xcode project files for metadata about a given set of
-targets.
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateKey.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateKey.java
deleted file mode 100644
index d4e2e24..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateKey.java
+++ /dev/null
@@ -1,62 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Optional;
-import com.google.devtools.build.xcode.util.Value;
-
-import java.nio.file.Path;
-
-/**
- * Data used to as a key when assigning items to aggregate references
- * (see {@link AggregateReferenceType}). All items sharing a single key value should belong to the
- * same group.
- * <p>
- * Note that the information in the grouping key is also the information that is used to create a
- * new group, minus the actual list of files in the group. See
- * {@link AggregateReferenceType#create(AggregateKey, Iterable)}.
- */
-public class AggregateKey extends Value<AggregateKey> {
-  private final Optional<String> name;
-  private final Optional<Path> path;
-
-  public AggregateKey(Optional<String> name, Optional<Path> path) {
-    super(name, path);
-    this.name = name;
-    this.path = path;
-  }
-
-  public Optional<String> name() {
-    return name;
-  }
-
-  public Optional<Path> path() {
-    return path;
-  }
-
-  /**
-   * Returns an instance that indicates any item assigned to it should not belong to a group.
-   */
-  public static AggregateKey standalone() {
-    return new AggregateKey(Optional.<String>absent(), Optional.<Path>absent());
-  }
-
-  /**
-   * Indicates that this grouping key means an item should not belong to any group.
-   */
-  public boolean isStandalone() {
-    return !path().isPresent() && !name().isPresent();
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateReferenceType.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateReferenceType.java
deleted file mode 100644
index 3dc9787..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/AggregateReferenceType.java
+++ /dev/null
@@ -1,129 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableSetMultimap;
-import com.google.common.collect.Iterables;
-import com.google.common.collect.SetMultimap;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXVariantGroup;
-import com.facebook.buck.apple.xcode.xcodeproj.XCVersionGroup;
-
-import java.nio.file.Path;
-
-/**
- * An aggregate reference is a kind of PBXReference that contains one or more files, grouped by some
- * criteria, and appearing as a group in the Xcode project navigator, and often handled as a single
- * file during the build phase and in other situations.
- */
-public enum AggregateReferenceType {
-  /**
-   * A group which contains multiple .xcdatamodel directories where each is a different version of
-   * the same schema. We may have to support other files besides .xcdatamodel in the future.
-   * Instances of this group are represented by {@link XCVersionGroup} and are grouped by the
-   * relative path of the containing .xcdatamodeld directory.
-   */
-  XCVersionGroup {
-    @Override
-    public PBXReference create(AggregateKey key, Iterable<PBXFileReference> children) {
-      XCVersionGroup result = new XCVersionGroup(
-          key.name().orNull(),
-          key.path().isPresent() ? key.path().get().toString() : null,
-          SourceTree.GROUP);
-      Iterables.addAll(result.getChildren(), children);
-      return result;
-    }
-
-    @Override
-    public AggregateKey aggregateKey(Path path) {
-      Path parent = path.getParent();
-      if (parent.getFileName().toString().endsWith(".xcdatamodeld")) {
-        return new AggregateKey(
-            Optional.of(parent.getFileName().toString()), Optional.of(parent));
-      } else {
-        return AggregateKey.standalone();
-      }
-    }
-
-    @Override
-    public Path pathInAggregate(Path path) {
-      return path.getFileName();
-    }
-  },
-
-  /**
-   * A group which contains the same content in multiple languages, each language belonging to a
-   * different file. Instances of this group are represented by {@link PBXVariantGroup} and are
-   * grouped by the base name of the file (e.g. "foo" in "/usr/bar/foo").
-   */
-  PBXVariantGroup {
-    @Override
-    public PBXReference create(AggregateKey key, Iterable<PBXFileReference> children) {
-      PBXVariantGroup result = new PBXVariantGroup(
-          key.name().orNull(),
-          key.path().isPresent() ? key.path().get().toString() : null,
-          SourceTree.GROUP);
-      Iterables.addAll(result.getChildren(), children);
-      return result;
-    }
-
-    @Override
-    public AggregateKey aggregateKey(Path path) {
-      if (Resources.languageOfLprojDir(path).isPresent()) {
-        return new AggregateKey(
-            Optional.of(path.getFileName().toString()), Optional.<Path>absent());
-      } else {
-        return AggregateKey.standalone();
-      }
-    }
-
-    @Override
-    public Path pathInAggregate(Path path) {
-      return path;
-    }
-  };
-
-  /**
-   * Creates a new instance of this group with the group information and children.
-   */
-  public abstract PBXReference create(AggregateKey key, Iterable<PBXFileReference> children);
-
-  /**
-   * Returns the value by which this item should be grouped. All items sharing the same key should
-   * belong to the same group. An {@link AggregateKey#standalone()} return here indicates that the
-   * item should not belong to a group and should be built and treated as a standalone file.
-   */
-  public abstract AggregateKey aggregateKey(Path path);
-
-  public abstract Path pathInAggregate(Path path);
-
-  /**
-   * Groups a sequence of items according to their {@link #aggregateKey(Path)}.
-   */
-  public SetMultimap<AggregateKey, Path> aggregates(Iterable<Path> paths) {
-    ImmutableSetMultimap.Builder<AggregateKey, Path> result =
-        new ImmutableSetMultimap.Builder<>();
-    for (Path path : paths) {
-      AggregateKey key = aggregateKey(path);
-      Path referencePath = key.isStandalone() ? path : pathInAggregate(path);
-      result.put(key, referencePath);
-    }
-    return result.build();
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/CurrentVersionSetter.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/CurrentVersionSetter.java
deleted file mode 100644
index ca463ce..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/CurrentVersionSetter.java
+++ /dev/null
@@ -1,92 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.devtools.build.xcode.plmerge.PlistMerging;
-
-import com.dd.plist.NSDictionary;
-import com.dd.plist.NSString;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-import com.facebook.buck.apple.xcode.xcodeproj.XCVersionGroup;
-
-import java.io.IOException;
-import java.nio.file.Files;
-import java.nio.file.Path;
-
-/**
- * Processes the {@link XCVersionGroup} instances in a sequence of {@link PBXReference}s to have
- * the {@code currentVersion} field set properly according to the {@code .xccurrentversion} file, if
- * available.
- * 
- * <p>This will NOT set the current version for any group where one of the following is true:
- * <ul>
- *   <li>the sourceTree of the group is not GROUP (meaning it is not relative to the workspace root)
- *   <li>the {@code .xccurrentversion} file does not exist or is not accessible
- *   <li>the plist in the file does not contain the correct entry
- *   <li>the {@link XCVersionGroup} does not have a child that matches the version in the
- *       {@code .xccurrentversion} file
- * </ul>
- */
-public final class CurrentVersionSetter implements PbxReferencesProcessor {
-  private final Path workspaceRoot;
-
-  public CurrentVersionSetter(Path workspaceRoot) {
-    this.workspaceRoot = Preconditions.checkNotNull(workspaceRoot);
-  }
-
-  @Override
-  public Iterable<PBXReference> process(Iterable<PBXReference> references) {
-    for (PBXReference reference : references) {
-      if ((reference instanceof XCVersionGroup) && (reference.getPath() != null)) {
-        trySetCurrentVersion((XCVersionGroup) reference);
-      }
-    }
-    return references;
-  }
-
-  private void trySetCurrentVersion(XCVersionGroup group) {
-    if (group.getSourceTree() != SourceTree.GROUP) {
-      return;
-    }
-
-    Path groupPath = workspaceRoot.resolve(group.getPath());
-    Path currentVersionPlist = groupPath.resolve(".xccurrentversion");
-    if (!Files.isReadable(currentVersionPlist)) {
-      return;
-    }
-
-    NSDictionary plist;
-    try {
-      plist = PlistMerging.readPlistFile(currentVersionPlist);
-    } catch (IOException e) {
-      return;
-    }
-    NSString currentVersion = (NSString) plist.get("_XCCurrentVersionName");
-    if (currentVersion == null) {
-      return;
-    }
-
-    for (PBXFileReference child : group.getChildren()) {
-      child.setExplicitFileType(Optional.of("wrapper.xcdatamodel"));
-      if (child.getName().equals(currentVersion.getContent())) {
-        group.setCurrentVersion(Optional.of(child));
-      }
-    }
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/FileReference.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/FileReference.java
deleted file mode 100644
index 99522a7..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/FileReference.java
+++ /dev/null
@@ -1,98 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.devtools.build.xcode.util.Value;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-
-import java.io.File;
-
-/**
- * Contains data similar to {@link PBXFileReference}, but is actually a value type, with working
- * {@link #equals(Object)} and {@link #hashCode()} methods.
- * <p>
- * TODO(bazel-team): Consider just adding equals and hashCode methods to PBXFileReference. This may
- * not be as straight-forward as it sounds, since the Xcodeproj serialization logic and all related
- * classes are based on identity equality semantics.
- */
-public class FileReference extends Value<FileReference> {
-  private final String name;
-  private final Optional<String> path;
-  private final SourceTree sourceTree;
-  private final Optional<String> explicitFileType;
-
-  @VisibleForTesting
-  FileReference(
-      String name,
-      Optional<String> path,
-      SourceTree sourceTree,
-      Optional<String> explicitFileType) {
-    super(name, path, sourceTree, explicitFileType);
-    this.name = name;
-    this.path = path;
-    this.sourceTree = sourceTree;
-    this.explicitFileType = explicitFileType;
-  }
-
-  public String name() {
-    return name;
-  }
-
-  public Optional<String> path() {
-    return path;
-  }
-
-  public SourceTree sourceTree() {
-    return sourceTree;
-  }
-
-  public Optional<String> explicitFileType() {
-    return explicitFileType;
-  }
-
-  /**
-   * Returns an instance whose name is the base name of the path.
-   */
-  public static FileReference of(String path, SourceTree sourceTree) {
-    return new FileReference(
-        new File(path).getName(),
-        Optional.of(path),
-        sourceTree,
-        Optional.<String>absent());
-  }
-
-  /**
-   * Returns an instance with a path and without an {@link #explicitFileType()}.
-   */
-  public static FileReference of(String name, String path, SourceTree sourceTree) {
-    return new FileReference(
-        name, Optional.of(path), sourceTree, Optional.<String>absent());
-  }
-
-  /**
-   * Returns an instance equivalent to this one, but with {@link #explicitFileType()} set to the
-   * given value. This instance should not already have a value set for {@link #explicitFileType()}.
-   */
-  public FileReference withExplicitFileType(String explicitFileType) {
-    Preconditions.checkState(!explicitFileType().isPresent(),
-        "should not already have explicitFileType: %s", this);
-    return new FileReference(name(), path(), sourceTree(), Optional.of(explicitFileType));
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/HasProjectNavigatorFiles.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/HasProjectNavigatorFiles.java
deleted file mode 100644
index 0f2a4bf..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/HasProjectNavigatorFiles.java
+++ /dev/null
@@ -1,28 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-
-/**
- * An object that knows some references that should be added to the main group so they appear in the
- * project navigator view in Xcode.
- */
-public interface HasProjectNavigatorFiles {
-  /**
-   * Returns all references known by this object that should be added to the main group.
-   */
-  public Iterable<PBXReference> mainGroupReferences();
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LibraryObjects.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LibraryObjects.java
deleted file mode 100644
index f751d9d..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LibraryObjects.java
+++ /dev/null
@@ -1,133 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import static com.google.common.base.Preconditions.checkNotNull;
-
-import com.google.common.annotations.VisibleForTesting;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXBuildFile;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFrameworksBuildPhase;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-
-import java.util.LinkedHashMap;
-import java.util.LinkedHashSet;
-
-/**
- * Collector that gathers references to libraries and frameworks when generating {@linkplain
- * PBXFrameworksBuildPhase framework build phases} for later display in XCode.
- *
- * <p>Use this class to {@link #newBuildPhase() generate} a framework build phase for each target,
- * by adding things that are linked with the final binary:
- * {@link BuildPhaseBuilder#addFramework frameworks} ("v1_6/GoogleMaps.framework"),
- * {@link BuildPhaseBuilder#addSdkFramework SDK frameworks} ("XCTest.framework",
- * "Foundation.framework") or {@link BuildPhaseBuilder#addDylib dylibs} ("libz.dylib"). Anything
- * added here will also be returned by {@link #mainGroupReferences}.
- *
- * <p>File references used by this class are de-duplicated against a global cache.
- */
-public final class LibraryObjects implements HasProjectNavigatorFiles {
-
-  @VisibleForTesting static final String FRAMEWORK_FILE_TYPE = "wrapper.framework";
-  @VisibleForTesting static final String DYLIB_FILE_TYPE = "compiled.mach-o.dylib";
-
-  private final LinkedHashMap<FileReference, PBXReference> fileToMainGroupReferences =
-      new LinkedHashMap<>();
-  private final PBXFileReferences fileReferenceCache;
-
-  /**
-   * @param fileReferenceCache global file reference repository used to avoid creating the same
-   *    file reference twice
-   */
-  public LibraryObjects(PBXFileReferences fileReferenceCache) {
-    this.fileReferenceCache = checkNotNull(fileReferenceCache);
-  }
-
-  /**
-   * Builder that assembles information required to generate a {@link PBXFrameworksBuildPhase}.
-   */
-  public final class BuildPhaseBuilder {
-
-    private final LinkedHashSet<FileReference> fileReferences = new LinkedHashSet<>();
-
-    private BuildPhaseBuilder() {} // Don't allow instantiation from outside the enclosing class.
-
-    /**
-     * Creates a new dylib library based on the passed name.
-     *
-     * @param name simple dylib without ".dylib" suffix, e.g. "libz"
-     */
-    public BuildPhaseBuilder addDylib(String name) {
-      FileReference reference =
-          FileReference.of(String.format("usr/lib/%s.dylib", name), SourceTree.SDKROOT)
-              .withExplicitFileType(DYLIB_FILE_TYPE);
-      fileReferences.add(reference);
-      return this;
-    }
-
-    /**
-     * Creates a new SDK framework based on the passed name.
-     *
-     * @param name simple framework name without ".framework" suffix, e.g. "Foundation"
-     */
-    public BuildPhaseBuilder addSdkFramework(String name) {
-      String location = String.format("System/Library/Frameworks/%s.framework", name);
-      FileReference reference =
-          FileReference.of(location, SourceTree.SDKROOT).withExplicitFileType(FRAMEWORK_FILE_TYPE);
-      fileReferences.add(reference);
-      return this;
-    }
-
-    /**
-     * Creates a new (non-SDK) framework based on the given path.
-     *
-     * @param execPath path to the framework's folder, relative to the xcodeproject's path root,
-     *    e.g. "v1_6/GoogleMaps.framework"
-     */
-    public BuildPhaseBuilder addFramework(String execPath) {
-      FileReference reference =
-          FileReference.of(execPath, SourceTree.GROUP).withExplicitFileType(FRAMEWORK_FILE_TYPE);
-      fileReferences.add(reference);
-      return this;
-    }
-
-    /**
-     * Returns a new build phase containing the added libraries.
-     */
-    public PBXFrameworksBuildPhase build() {
-      PBXFrameworksBuildPhase buildPhase = new PBXFrameworksBuildPhase();
-      for (FileReference reference : fileReferences) {
-        PBXFileReference fileRef = fileReferenceCache.get(reference);
-        buildPhase.getFiles().add(new PBXBuildFile(fileRef));
-        fileToMainGroupReferences.put(reference, fileRef);
-      }
-      return buildPhase;
-    }
-  }
-
-  /**
-   * Returns a builder for a new build phase.
-   */
-  public BuildPhaseBuilder newBuildPhase() {
-    return new BuildPhaseBuilder();
-  }
-
-  @Override
-  public Iterable<PBXReference> mainGroupReferences() {
-    return fileToMainGroupReferences.values();
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXContainerItemProxy.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXContainerItemProxy.java
deleted file mode 100644
index 5089942..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXContainerItemProxy.java
+++ /dev/null
@@ -1,62 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Preconditions;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXContainerItemProxy;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXObject;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXProject;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-
-/**
- * Represents a PBXContainerItemProxy object that does not reference a remote (other project file)
- * object.
- * <p>
- * TODO(bazel-team): Upstream this to Buck.
- */
-public class LocalPBXContainerItemProxy extends PBXContainerItemProxy {
-  private static final PBXFileReference DUMMY_FILE_REFERENCE =
-      new PBXFileReference("", "", SourceTree.ABSOLUTE);
-
-  private final PBXProject containerPortalAsProject;
-  private final PBXObject remoteGlobalIdHolder;
-
-  public LocalPBXContainerItemProxy(
-      PBXProject containerPortalAsProject, PBXObject remoteGlobalIdHolder, ProxyType proxyType) {
-    super(DUMMY_FILE_REFERENCE, "" /* remoteGlobalIDString */, proxyType);
-    this.containerPortalAsProject = Preconditions.checkNotNull(containerPortalAsProject);
-    this.remoteGlobalIdHolder = Preconditions.checkNotNull(remoteGlobalIdHolder);
-  }
-
-  public PBXProject getContainerPortalAsProject() {
-    return containerPortalAsProject;
-  }
-
-  public PBXObject getRemoteGlobalIdHolder() {
-    return remoteGlobalIdHolder;
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    // Note we don't call super.serializeInto because we don't want the DUMMY_FILE_REFERENCE to
-    // get saved to the project file (even though it is probably harmless).
-    s.addField("containerPortal", containerPortalAsProject.getGlobalID());
-    s.addField("remoteGlobalIDString", remoteGlobalIdHolder);
-    s.addField("proxyType", getProxyType().getIntValue());
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXTargetDependency.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXTargetDependency.java
deleted file mode 100644
index deb9817..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/LocalPBXTargetDependency.java
+++ /dev/null
@@ -1,36 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXTargetDependency;
-
-/**
- * A target dependency that is not remote, which is similar to the normal Buck PBXTargetDependency,
- * but includes a {@code target} field.
- * <p>
- * TODO(bazel-team): Upstream this to Buck.
- */
-public class LocalPBXTargetDependency extends PBXTargetDependency {
-  public LocalPBXTargetDependency(LocalPBXContainerItemProxy targetProxy) {
-    super(targetProxy);
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-    s.addField("target", getTargetProxy().getRemoteGlobalIDString());
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXBuildFiles.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXBuildFiles.java
deleted file mode 100644
index ff4e718..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXBuildFiles.java
+++ /dev/null
@@ -1,175 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.SetMultimap;
-import com.google.devtools.build.xcode.util.Mapping;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXBuildFile;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXVariantGroup;
-import com.facebook.buck.apple.xcode.xcodeproj.XCVersionGroup;
-
-import java.nio.file.Path;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-
-/**
- * A kind of cache which makes it easier to collect and manage PBXBuildFile and PBXReference
- * objects. It knows how to create new PBXBuildFile, PBXVariantGroup, and PBXFileReference objects
- * from {@link Path} objects and sequences thereof.
- * <p>
- * A PBXFileReference specifies a path to a file and its <em>name</em>. The name is confusingly
- * defined as the real file name for non-localized files (e.g. "foo" in "bar/foo"), and the language
- * name for localized files (e.g. "en" in "bar/en.lproj/foo").
- * <p>
- * A PBXVariantGroup is a set of PBXFileReferences with the same file name (the virtual name). Each
- * file is in some directory named *.lproj. For instance, the following files would belong to the
- * same PBXVariantGroup:
- *
- * <ul>
- *   <li>foo1/en.lproj/file.strings
- *   <li>foo2/ru.lproj/file.strings
- * </ul>
- *
- * Where the virtual name is "file.strings". Note that because of the way PBXVariantGroups are named
- * and specified in .xcodeproj files, it is possible Xcode does or will use it for groups not
- * defined by localization, but we currently ignore that possibility.
- * <p>
- * A PBXBuildFile is the simplest object - it is simply a reference to a PBXReference, which can be
- * either a PBXFileReference or PBXVariantGroup. The fact that PBXFileReference and PBXVariantGroup
- * are considered kinds of PBXReference is reflected in the Java inheritance hierarchy for the
- * classes that model these Xcode objects.
- * <p>
- * The PBXBuildFile is the object referred to in the build phases of targets, so it is seen as a
- * buildable or compilable unit. The PBXFileReference and PBXVariantGroup objects are referred to
- * by the PBXGroups, which define what is visible in the Project Navigator view in Xcode.
- * <p>
- * This class assumes that all paths given through the public API are specified relative to the
- * Xcodegen root, and creates PBXFileReferences that should be added to a group whose path is the
- * root.
- * TODO(bazel-team): Make this an immutable type, of which multiple instances are created as new
- * references and build files are added. The current API is side-effect-based and confusing.
- */
-final class PBXBuildFiles implements HasProjectNavigatorFiles {
-  /**
-   * Map from Paths to the PBXBuildFile that encompasses all and only those Paths. Because the
-   * {@link PBXBuildFile}s in this map encompass multiple files, their
-   * {@link PBXBuildFile#getFileRef()} value is a {@link PBXVariantGroup} or {@link XCVersionGroup}.
-   * <p>
-   * Note that this Map reflects the intention of the API, namely that {"a"} does not map to the
-   * same thing as {"a", "b"}, and you cannot get a build file with only one of the corresponding
-   * files - you need the whole set.
-   */
-  private Map<ImmutableSet<Path>, PBXBuildFile> aggregateBuildFiles;
-
-  private Map<FileReference, PBXBuildFile> standaloneBuildFiles;
-  private PBXFileReferences pbxReferences;
-  private List<PBXReference> mainGroupReferences;
-
-  public PBXBuildFiles(PBXFileReferences pbxFileReferences) {
-    this.aggregateBuildFiles = new HashMap<>();
-    this.standaloneBuildFiles = new HashMap<>();
-    this.pbxReferences = Preconditions.checkNotNull(pbxFileReferences);
-    this.mainGroupReferences = new ArrayList<>();
-  }
-
-  private PBXBuildFile aggregateBuildFile(ImmutableSet<Path> paths, PBXReference reference) {
-    Preconditions.checkArgument(!paths.isEmpty(), "paths must be non-empty");
-    for (PBXBuildFile cached : Mapping.of(aggregateBuildFiles, paths).asSet()) {
-      return cached;
-    }
-    PBXBuildFile buildFile = new PBXBuildFile(reference);
-    mainGroupReferences.add(reference);
-    aggregateBuildFiles.put(paths, buildFile);
-    return buildFile;
-  }
-
-  /**
-   * Returns new or cached instances of PBXBuildFiles corresponding to files that may or may not
-   * belong to an aggregate reference (see {@link AggregateReferenceType}). Files specified by the
-   * {@code paths} argument are grouped into individual PBXBuildFiles using the given
-   * {@link AggregateReferenceType}. Files that are standalone are not put in an aggregate
-   * reference, but are put in a standalone PBXBuildFile in the returned sequence.
-   */
-  public Iterable<PBXBuildFile> get(AggregateReferenceType type, Iterable<Path> paths) {
-    ImmutableList.Builder<PBXBuildFile> result = new ImmutableList.Builder<>();
-    SetMultimap<AggregateKey, Path> keyedPaths = type.aggregates(paths);
-    for (Map.Entry<AggregateKey, Collection<Path>> aggregation : keyedPaths.asMap().entrySet()) {
-      if (!aggregation.getKey().isStandalone()) {
-        ImmutableSet<Path> itemPaths = ImmutableSet.copyOf(aggregation.getValue());
-        result.add(aggregateBuildFile(
-            itemPaths, type.create(aggregation.getKey(), fileReferences(itemPaths))));
-      }
-    }
-    for (Path generalResource : keyedPaths.get(AggregateKey.standalone())) {
-      result.add(getStandalone(FileReference.of(generalResource.toString(), SourceTree.GROUP)));
-    }
-
-    return result.build();
-  }
-
-  /**
-   * Returns a new or cached instance of a PBXBuildFile for a file that is not part of a variant
-   * group.
-   */
-  public PBXBuildFile getStandalone(FileReference file) {
-    for (PBXBuildFile cached : Mapping.of(standaloneBuildFiles, file).asSet()) {
-      return cached;
-    }
-    PBXBuildFile buildFile = new PBXBuildFile(pbxReferences.get(file));
-    mainGroupReferences.add(pbxReferences.get(file));
-    standaloneBuildFiles.put(file, buildFile);
-    return buildFile;
-  }
-
-  /**
-   * Applies {@link #fileReference(Path)} to each item in the sequence.
-   */
-  private final Iterable<PBXFileReference> fileReferences(Iterable<Path> paths) {
-    ImmutableList.Builder<PBXFileReference> result = new ImmutableList.Builder<>();
-    for (Path path : paths) {
-      result.add(fileReference(path));
-    }
-    return result.build();
-  }
-
-  /**
-   * Returns a new or cached PBXFileReference for the given file. The name of the reference depends
-   * on whether the file is in a localized (*.lproj) directory. If it is localized, then the name
-   * of the reference is the name of the language (the text before ".lproj"). Otherwise, the name is
-   * the same as the file name (e.g. Localizable.strings). This is confusing, but it is how Xcode
-   * creates PBXFileReferences.
-   */
-  private PBXFileReference fileReference(Path path) {
-    Optional<String> language = Resources.languageOfLprojDir(path);
-    String name = language.isPresent() ? language.get() : path.getFileName().toString();
-    return pbxReferences.get(FileReference.of(name, path.toString(), SourceTree.GROUP));
-  }
-
-  @Override
-  public Iterable<PBXReference> mainGroupReferences() {
-    return mainGroupReferences;
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXFileReferences.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXFileReferences.java
deleted file mode 100644
index afc306b..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PBXFileReferences.java
+++ /dev/null
@@ -1,48 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.devtools.build.xcode.util.Mapping;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-
-import java.util.HashMap;
-import java.util.Map;
-
-/**
- * A factory for {@link PBXFileReference}s. {@link PBXFileReference}s are inherently non-value
- * types, in that each created instance appears in the serialized Xcodeproj file, even if some of
- * the instances are equivalent. This serves as a cache so that a value type ({@link FileReference})
- * can be converted to a canonical, cached {@link PBXFileReference} which is equivalent to it.
- */
-final class PBXFileReferences {
-  private final Map<FileReference, PBXFileReference> cache = new HashMap<>();
-
-  /**
-   * Supplies a reference, containing values for fields specified in {@code reference}.
-   */
-  public PBXFileReference get(FileReference reference) {
-    for (PBXFileReference existing : Mapping.of(cache, reference).asSet()) {
-      return existing;
-    }
-
-    PBXFileReference result = new PBXFileReference(
-        reference.name(), reference.path().orNull(), reference.sourceTree());
-    result.setExplicitFileType(reference.explicitFileType());
-
-    cache.put(reference, result);
-    return result;
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesGrouper.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesGrouper.java
deleted file mode 100644
index 9190133..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesGrouper.java
+++ /dev/null
@@ -1,173 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableMap;
-import com.google.devtools.build.xcode.util.Containing;
-import com.google.devtools.build.xcode.util.Equaling;
-import com.google.devtools.build.xcode.util.Mapping;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXGroup;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXVariantGroup;
-
-import java.nio.file.FileSystem;
-import java.nio.file.Path;
-import java.nio.file.Paths;
-import java.util.HashMap;
-import java.util.Map;
-
-/**
- * A {@link PBXReference} processor to group self-contained PBXReferences into PBXGroups. Grouping
- * is done to make it easier to navigate the files of the project in Xcode's Project Navigator.
- *
- * <p>A <em>self-contained</em> reference is one that is not a member of a PBXVariantGroup or other
- * aggregate group, although a self-contained reference may contain such a reference as a child.
- *
- * <p>This implementation arranges the {@code PBXFileReference}s into a hierarchy of
- * {@code PBXGroup}s that mirrors the actual location of the files on disk.
- *
- * <p>When using this grouper, the top-level items are the following:
- * <ul>
- *   <li>BUILT_PRODUCTS_DIR - a group containing items in the SourceRoot of this name
- *   <li>SDKROOT - a group containing items that are part of the Xcode install, such as SDK
- *       frameworks
- *   <li>workspace_root - a group containing items within the root of the workspace of the client
- *   <li>miscellaneous - anything that does not belong in one of the above groups is placed directly
- *       in the main group.
- * </ul>
- */
-public class PbxReferencesGrouper implements PbxReferencesProcessor {
-  private final FileSystem fileSystem;
-
-  public PbxReferencesGrouper(FileSystem fileSystem) {
-    this.fileSystem = Preconditions.checkNotNull(fileSystem, "fileSystem");
-  }
-
-  /**
-   * Converts a {@code String} to a {@code Path} using this instance's file system.
-   */
-  private Path path(String pathString) {
-    return RelativePaths.fromString(fileSystem, pathString);
-  }
-
-  /**
-   * Returns the deepest directory that contains both paths.
-   */
-  private Path deepestCommonContainer(Path path1, Path path2) {
-    Path container = path("");
-    int nameIndex = 0;
-    while ((nameIndex < Math.min(path1.getNameCount(), path2.getNameCount()))
-        && Equaling.of(path1.getName(nameIndex), path2.getName(nameIndex))) {
-      container = container.resolve(path1.getName(nameIndex));
-      nameIndex++;
-    }
-    return container;
-  }
-
-  /**
-   * Returns the parent of the given path. This is similar to {@link Path#getParent()}, but is
-   * nullable-phobic. {@link Path#getParent()} considers the root of the filesystem to be the null
-   * Path. This method uses {@code path("")} for the root. This is also how the implementation of
-   * {@link PbxReferencesGrouper} expresses <em>root</em> in general.
-   */
-  private Path parent(Path path) {
-    return (path.getNameCount() == 1) ? path("") : path.getParent();
-  }
-
-  /**
-   * The directory of the PBXGroup that will contain the given reference. For most references, this
-   * is just the actual parent directory. For {@code PBXVariantGroup}s, whose children are not
-   * guaranteed to be in any common directory except the client root, this returns the deepest
-   * common container of each child in the group.
-   */
-  private Path dirOfContainingPbxGroup(PBXReference reference) {
-    if (reference instanceof PBXVariantGroup) {
-      PBXVariantGroup variantGroup = (PBXVariantGroup) reference;
-      Path path = Paths.get(variantGroup.getChildren().get(0).getPath());
-      for (PBXReference child : variantGroup.getChildren()) {
-        path = deepestCommonContainer(path, path(child.getPath()));
-      }
-      return path;
-    } else {
-      return parent(path(reference.getPath()));
-    }
-  }
-
-  /**
-   * Contains the populated PBXGroups for a certain source tree.
-   */
-  private class Groups {
-    /**
-     * Map of paths to the PBXGroup that is used to contain all files and groups in that path.
-     */
-    final Map<Path, PBXGroup> groupCache;
-
-    Groups(String rootGroupName, SourceTree sourceTree) {
-      groupCache = new HashMap<>();
-      groupCache.put(path(""), new PBXGroup(rootGroupName, "" /* path */, sourceTree));
-    }
-
-    PBXGroup rootGroup() {
-      return Mapping.of(groupCache, path("")).get();
-    }
-
-    void add(Path dirOfContainingPbxGroup, PBXReference reference) {
-      for (PBXGroup container : Mapping.of(groupCache, dirOfContainingPbxGroup).asSet()) {
-        container.getChildren().add(reference);
-        return;
-      }
-      PBXGroup newGroup = new PBXGroup(dirOfContainingPbxGroup.getFileName().toString(),
-          null /* path */, SourceTree.GROUP);
-      newGroup.getChildren().add(reference);
-      add(parent(dirOfContainingPbxGroup), newGroup);
-      groupCache.put(dirOfContainingPbxGroup, newGroup);
-    }
-  }
-
-  @Override
-  public Iterable<PBXReference> process(Iterable<PBXReference> references) {
-    Map<SourceTree, Groups> groupsBySourceTree = ImmutableMap.of(
-        SourceTree.GROUP, new Groups("workspace_root", SourceTree.GROUP),
-        SourceTree.SDKROOT, new Groups("SDKROOT", SourceTree.SDKROOT),
-        SourceTree.BUILT_PRODUCTS_DIR,
-            new Groups("BUILT_PRODUCTS_DIR", SourceTree.BUILT_PRODUCTS_DIR));
-    ImmutableList.Builder<PBXReference> result = new ImmutableList.Builder<>();
-
-    for (PBXReference reference : references) {
-      if (Containing.key(groupsBySourceTree, reference.getSourceTree())) {
-        Path containingDir = dirOfContainingPbxGroup(reference);
-        Mapping.of(groupsBySourceTree, reference.getSourceTree())
-            .get()
-            .add(containingDir, reference);
-      } else {
-        // The reference is not inside any expected source tree, so don't try anything clever. Just
-        // add it to the main group directly (not in a nested PBXGroup).
-        result.add(reference);
-      }
-    }
-
-    for (Groups groupsRoot : groupsBySourceTree.values()) {
-      if (!groupsRoot.rootGroup().getChildren().isEmpty()) {
-        result.add(groupsRoot.rootGroup());
-      }
-    }
-
-    return result.build();
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesProcessor.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesProcessor.java
deleted file mode 100644
index 6632237..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/PbxReferencesProcessor.java
+++ /dev/null
@@ -1,37 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-
-/**
- * Processes a sequence of self-contained references in some manner before they are added to a
- * project.
- *
- * <p>A <em>self-contained</em> reference is one that is not a member of a PBXVariantGroup or other
- * aggregate group, although a self-contained reference may contain such a reference as a child.
- */
-public interface PbxReferencesProcessor {
-  /**
-   * Processes the references of the main group to generate another sequence of references, which
-   * may or may not reuse the input references.
-   *
-   * <p>The on-disk path of the main group is assumed to point to workspace root. This is important
-   * when the {@code sourceRoot} property of the references in the input or output arguments are
-   * {@link SourceTree#GROUP}.
-   */
-  Iterable<PBXReference> process(Iterable<PBXReference> references);
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/RelativePaths.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/RelativePaths.java
deleted file mode 100644
index 2c42c9b..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/RelativePaths.java
+++ /dev/null
@@ -1,52 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import static com.google.common.base.Preconditions.checkArgument;
-
-import com.google.common.collect.ImmutableList;
-
-import java.nio.file.FileSystem;
-import java.nio.file.Path;
-import java.util.List;
-
-/**
- * Utility methods for working with relative {@link Path} objects.
- */
-class RelativePaths {
-  private RelativePaths() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  /**
-   * Converts the given string to a {@code Path}, confirming it is relative.
-   */
-  static Path fromString(FileSystem fileSystem, String pathString) {
-    Path path = fileSystem.getPath(pathString);
-    checkArgument(!path.isAbsolute(), "Expected relative path but got: %s", path);
-    return path;
-  }
-
-  /**
-   * Converts each item in {@code pathStrings} using {@link #fromString(FileSystem, String)}.
-   */
-  static List<Path> fromStrings(FileSystem fileSystem, Iterable<String> pathStrings) {
-    ImmutableList.Builder<Path> result = new ImmutableList.Builder<>();
-    for (String pathString : pathStrings) {
-      result.add(fromString(fileSystem, pathString));
-    }
-    return result.build();
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Resources.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Resources.java
deleted file mode 100644
index 170d39e..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Resources.java
+++ /dev/null
@@ -1,113 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableSetMultimap;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.xcode.util.Equaling;
-import com.google.devtools.build.xcode.util.Value;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.TargetControl;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXBuildFile;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXResourcesBuildPhase;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXTarget.ProductType;
-
-import java.nio.file.FileSystem;
-import java.nio.file.Path;
-import java.util.ArrayList;
-import java.util.List;
-
-/**
- * Contains information about resources in an Xcode project.
- */
-public class Resources extends Value<Resources> {
-
-  private final ImmutableSetMultimap<TargetControl, PBXBuildFile> buildFiles;
-
-  private Resources(ImmutableSetMultimap<TargetControl, PBXBuildFile> buildFiles) {
-    super(buildFiles);
-    this.buildFiles = buildFiles;
-  }
-
-  /**
-   * Build files that should be added to the PBXResourcesBuildPhase for the given target.
-   */
-  public ImmutableSetMultimap<TargetControl, PBXBuildFile> buildFiles() {
-    return buildFiles;
-  }
-
-  /**
-   * Returns the PBXResourcesBuildPhase for the given target, if applicable. It will return an
-   * absent {@code Optional} if the target is a library or there are no resources to compile.
-   */
-  public PBXResourcesBuildPhase resourcesBuildPhase(TargetControl targetControl) {
-    PBXResourcesBuildPhase resourcesPhase = new PBXResourcesBuildPhase();
-    resourcesPhase.getFiles().addAll(buildFiles().get(targetControl));
-    return resourcesPhase;
-  }
-
-  public static Optional<String> languageOfLprojDir(Path child) {
-    Path parent = child.getParent();
-    if (parent == null) {
-      return Optional.absent();
-    }
-    String dirName = parent.getFileName().toString();
-    String lprojSuffix = ".lproj";
-    if (dirName.endsWith(lprojSuffix)) {
-      return Optional.of(dirName.substring(0, dirName.length() - lprojSuffix.length()));
-    } else {
-      return Optional.absent();
-    }
-  }
-
-  public static Resources fromTargetControls(
-      FileSystem fileSystem, PBXBuildFiles pbxBuildFiles, Iterable<TargetControl> targetControls) {
-    ImmutableSetMultimap.Builder<TargetControl, PBXBuildFile> buildFiles =
-        new ImmutableSetMultimap.Builder<>();
-
-    for (TargetControl targetControl : targetControls) {
-      List<PBXBuildFile> targetBuildFiles = new ArrayList<>();
-
-      Iterable<String> simpleImports =
-          Iterables.concat(targetControl.getXcassetsDirList(), targetControl.getBundleImportList());
-      // Add .bundle, .xcassets directories to the Project Navigator so they are visible from within
-      // Xcode.
-      // Bundle imports are handled very similarly to asset catalogs, so we just add them with the
-      // same logic. Xcode's automatic file type detection logic is smart enough to see it is a
-      // bundle and link it properly, and add the {@code lastKnownFileType} property.
-      for (String simpleImport : simpleImports) {
-        targetBuildFiles.add(
-            pbxBuildFiles.getStandalone(FileReference.of(simpleImport, SourceTree.GROUP)));
-      }
-
-      Iterables.addAll(
-          targetBuildFiles,
-          pbxBuildFiles.get(
-              AggregateReferenceType.PBXVariantGroup,
-              RelativePaths.fromStrings(fileSystem, targetControl.getGeneralResourceFileList())));
-
-      // If this target is a binary, save the build files. Otherwise, we don't need them. The file
-      // references we generated with fileObjects will be added to the main group later.
-      if (!Equaling.of(
-          ProductType.STATIC_LIBRARY, XcodeprojGeneration.productType(targetControl))) {
-        buildFiles.putAll(targetControl, targetBuildFiles);
-      }
-    }
-
-    return new Resources(buildFiles.build());
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/SourceFile.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/SourceFile.java
deleted file mode 100644
index c89427c..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/SourceFile.java
+++ /dev/null
@@ -1,77 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.xcode.util.Value;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.TargetControl;
-
-import java.nio.file.FileSystem;
-import java.nio.file.Path;
-
-/**
- * Source file path with information on how to build it.
- */
-public class SourceFile extends Value<SourceFile> {
-  /** Indicates how a source file is built or not built. */
-  public enum BuildType {
-    NO_BUILD, BUILD, NON_ARC_BUILD;
-  }
-
-  private final BuildType buildType;
-  private final Path path;
-
-  private SourceFile(BuildType buildType, Path path) {
-    super(buildType, path);
-    this.buildType = buildType;
-    this.path = path;
-  }
-
-  public BuildType buildType() {
-    return buildType;
-  }
-
-  public Path path() {
-    return path;
-  }
-
-  /**
-   * Returns information on all source files in a target. In particular, this includes:
-   * <ul>
-   *   <li>arc-compiled source files
-   *   <li>non-arc-compiled source files
-   *   <li>support files, such as BUILD and header files
-   *   <li>Info.plist file
-   * </ul>
-   */
-  public static Iterable<SourceFile> allSourceFiles(FileSystem fileSystem, TargetControl control) {
-    ImmutableList.Builder<SourceFile> result = new ImmutableList.Builder<>();
-    for (Path plainSource : RelativePaths.fromStrings(fileSystem, control.getSourceFileList())) {
-      result.add(new SourceFile(BuildType.BUILD, plainSource));
-    }
-    for (Path nonArcSource
-        : RelativePaths.fromStrings(fileSystem, control.getNonArcSourceFileList())) {
-      result.add(new SourceFile(BuildType.NON_ARC_BUILD, nonArcSource));
-    }
-    for (Path supportSource : RelativePaths.fromStrings(fileSystem, control.getSupportFileList())) {
-      result.add(new SourceFile(BuildType.NO_BUILD, supportSource));
-    }
-    if (control.hasInfoplist()) {
-      result.add(new SourceFile(
-          BuildType.NO_BUILD, RelativePaths.fromString(fileSystem, control.getInfoplist())));
-    }
-    return result.build();
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Xcdatamodels.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Xcdatamodels.java
deleted file mode 100644
index a18f3dd..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/Xcdatamodels.java
+++ /dev/null
@@ -1,67 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.collect.ImmutableSetMultimap;
-import com.google.devtools.build.xcode.util.Equaling;
-import com.google.devtools.build.xcode.util.Value;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.TargetControl;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXBuildFile;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXTarget.ProductType;
-
-import java.nio.file.FileSystem;
-
-/**
- * Contains information about .xcdatamodel directories in an Xcode project.
- */
-public class Xcdatamodels extends Value<Xcdatamodels> {
-
-  private final ImmutableSetMultimap<TargetControl, PBXBuildFile> buildFiles;
-
-  private Xcdatamodels(ImmutableSetMultimap<TargetControl, PBXBuildFile> buildFiles) {
-    super(buildFiles);
-    this.buildFiles = buildFiles;
-  }
-
-  /**
-   * Map of each build file that should be added to the sources build phase for each target, given
-   * the target's control data.
-   */
-  public ImmutableSetMultimap<TargetControl, PBXBuildFile> buildFiles() {
-    return buildFiles;
-  }
-
-  public static Xcdatamodels fromTargetControls(
-      FileSystem fileSystem, PBXBuildFiles pbxBuildFiles, Iterable<TargetControl> targetControls) {
-    ImmutableSetMultimap.Builder<TargetControl, PBXBuildFile> targetLabelToBuildFiles =
-        new ImmutableSetMultimap.Builder<>();
-    for (TargetControl targetControl : targetControls) {
-      Iterable<PBXBuildFile> targetBuildFiles =
-          pbxBuildFiles.get(
-              AggregateReferenceType.XCVersionGroup,
-              RelativePaths.fromStrings(fileSystem, targetControl.getXcdatamodelList()));
-
-      // If this target is not a static library, save the build files. If it's a static lib, we
-      // don't need them. The file references we generated with fileObjects will be added to the
-      // main group later.
-      if (!Equaling.of(
-          ProductType.STATIC_LIBRARY, XcodeprojGeneration.productType(targetControl))) {
-        targetLabelToBuildFiles.putAll(targetControl, targetBuildFiles);
-      }
-    }
-    return new Xcdatamodels(targetLabelToBuildFiles.build());
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeGen.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeGen.java
deleted file mode 100644
index 31d18d4..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeGen.java
+++ /dev/null
@@ -1,117 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import com.google.common.base.Function;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.Control;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.TargetControl;
-import com.google.devtools.common.options.Option;
-import com.google.devtools.common.options.Options;
-import com.google.devtools.common.options.OptionsBase;
-import com.google.devtools.common.options.OptionsParser;
-import com.google.devtools.common.options.OptionsParsingException;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXProject;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.OutputStream;
-import java.nio.file.FileSystem;
-import java.nio.file.FileSystems;
-import java.nio.file.Files;
-import java.nio.file.Path;
-import java.util.Iterator;
-import java.util.List;
-
-/**
- * Entry-point for the command-line Xcode project generator.
- */
-public class XcodeGen {
-  /**
-   * Options for {@link XcodeGen}.
-   */
-  public static class XcodeGenOptions extends OptionsBase {
-    @Option(
-        name = "control",
-        help = "Path to a control file, which contains only a binary serialized instance of "
-            + "the Control protocol buffer. Required.",
-        defaultValue = "null")
-    public String control;
-  }
-
-  public static void main(String[] args) throws IOException, OptionsParsingException {
-    OptionsParser parser = OptionsParser.newOptionsParser(XcodeGenOptions.class);
-    parser.parse(args);
-    XcodeGenOptions options = parser.getOptions(XcodeGenOptions.class);
-    if (options.control == null) {
-      throw new IllegalArgumentException("--control must be specified\n"
-          + Options.getUsage(XcodeGenOptions.class));
-    }
-    FileSystem fileSystem = FileSystems.getDefault();
-
-    Control controlPb;
-    try (InputStream in = Files.newInputStream(fileSystem.getPath(options.control))) {
-      controlPb = Control.parseFrom(in);
-    }
-    Path pbxprojPath = fileSystem.getPath(controlPb.getPbxproj());
-
-    Iterator<String> srcList = allSourceFilePaths(controlPb).iterator();
-    Path workspaceRoot;
-    if (!srcList.hasNext()) {
-      workspaceRoot = XcodeprojGeneration.relativeWorkspaceRoot(pbxprojPath);
-    } else {
-      // Get the absolute path to the workspace root.
-
-      // TODO(bazel-team): Remove this hack, possibly by converting Xcodegen to be run with
-      // "bazel run" and using RUNFILES to get the workspace root. For now, this is needed to work
-      // around Xcode's handling of symlinks not playing nicely with how Bazel stores output
-      // artifacts in /private/var/tmp. This means a relative path from .xcodeproj in bazel-out to
-      // the workspace root in .xcodeproj will not work properly at certain times during
-      // Xcode/xcodebuild execution. Walking up the path of a known source file prevents having
-      // to reason about a file that might only be accessible through a symlink, like a tools jar.
-      Path relSourceFilePath = fileSystem.getPath(srcList.next());
-      Path absSourceFilePath = relSourceFilePath.toAbsolutePath();
-      workspaceRoot = absSourceFilePath;
-      for (int i = 0; i < relSourceFilePath.getNameCount(); i++) {
-        workspaceRoot = workspaceRoot.getParent();
-      }
-    }
-
-    try (OutputStream out = Files.newOutputStream(pbxprojPath)) {
-      // This workspace root here is relative to the PWD, so that the .xccurrentversion
-      // files can actually be read. The other workspaceRoot is relative to the .xcodeproj
-      // root or is absolute.
-      Path relativeWorkspaceRoot = fileSystem.getPath(".");
-      PBXProject project = XcodeprojGeneration.xcodeproj(
-          workspaceRoot, controlPb,
-          ImmutableList.of(
-              new CurrentVersionSetter(relativeWorkspaceRoot),
-              new PbxReferencesGrouper(fileSystem)));
-      XcodeprojGeneration.write(out, project);
-    }
-  }
-
-  private static Iterable<String> allSourceFilePaths(Control control) {
-    return Iterables.concat(
-        Iterables.transform(control.getTargetList(),
-                            new Function<TargetControl, List<String>>() {
-                              public List<String> apply(TargetControl tc) {
-                                return tc.getSourceFileList();
-                              }
-                            }));
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeprojGeneration.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeprojGeneration.java
deleted file mode 100644
index 8d685a2..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/XcodeprojGeneration.java
+++ /dev/null
@@ -1,539 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen;
-
-import static com.google.common.base.Preconditions.checkArgument;
-import static com.google.common.base.Preconditions.checkState;
-
-import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Joiner;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-import com.google.common.base.Splitter;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.common.collect.Lists;
-import com.google.devtools.build.xcode.common.XcodeprojPath;
-import com.google.devtools.build.xcode.util.Containing;
-import com.google.devtools.build.xcode.util.Equaling;
-import com.google.devtools.build.xcode.util.Mapping;
-import com.google.devtools.build.xcode.xcodegen.LibraryObjects.BuildPhaseBuilder;
-import com.google.devtools.build.xcode.xcodegen.SourceFile.BuildType;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.Control;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.DependencyControl;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.TargetControl;
-import com.google.devtools.build.xcode.xcodegen.proto.XcodeGenProtos.XcodeprojBuildSetting;
-
-import com.dd.plist.NSArray;
-import com.dd.plist.NSDictionary;
-import com.dd.plist.NSObject;
-import com.dd.plist.NSString;
-import com.facebook.buck.apple.xcode.GidGenerator;
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXBuildFile;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXContainerItemProxy.ProxyType;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXCopyFilesBuildPhase;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFrameworksBuildPhase;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXNativeTarget;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXProject;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference.SourceTree;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXResourcesBuildPhase;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXSourcesBuildPhase;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXTarget.ProductType;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXTargetDependency;
-
-import java.io.IOException;
-import java.io.OutputStream;
-import java.io.OutputStreamWriter;
-import java.io.Writer;
-import java.nio.charset.StandardCharsets;
-import java.nio.file.FileSystem;
-import java.nio.file.Path;
-import java.nio.file.Paths;
-import java.util.Collections;
-import java.util.EnumSet;
-import java.util.HashMap;
-import java.util.LinkedHashSet;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-import java.util.concurrent.ExecutionException;
-
-/**
- * Utility code for generating Xcode project files.
- */
-public class XcodeprojGeneration {
-  public static final String FILE_TYPE_ARCHIVE_LIBRARY = "archive.ar";
-  public static final String FILE_TYPE_WRAPPER_APPLICATION = "wrapper.application";
-  public static final String FILE_TYPE_WRAPPER_BUNDLE = "wrapper.cfbundle";
-  public static final String FILE_TYPE_APP_EXTENSION = "wrapper.app-extension";
-  private static final String DEFAULT_OPTIONS_NAME = "Debug";
-
-  @VisibleForTesting
-  static final String APP_NEEDS_SOURCE_ERROR =
-      "Due to limitations in Xcode, application projects must have at least one source file.";
-
-  private XcodeprojGeneration() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  /**
-   * Determines the relative path to the workspace root from the path of the project.pbxproj output
-   * file. An absolute path is preferred if available.
-   */
-  static Path relativeWorkspaceRoot(Path pbxproj) {
-    int levelsToExecRoot = pbxproj.getParent().getParent().getNameCount();
-    return pbxproj.getFileSystem().getPath(Joiner
-        .on('/')
-        .join(Collections.nCopies(levelsToExecRoot, "..")));
-  }
-
-  /**
-   * Writes a project to an {@code OutputStream} in the correct encoding.
-   */
-  public static void write(OutputStream out, PBXProject project) throws IOException {
-    XcodeprojSerializer ser = new XcodeprojSerializer(
-        new GidGenerator(ImmutableSet.<String>of()), project);
-    Writer outWriter = new OutputStreamWriter(out, StandardCharsets.UTF_8);
-    // toXMLPropertyList includes an XML encoding specification (UTF-8), which we specify above.
-    // Standard Xcodeproj files use the toASCIIPropertyList format, but Xcode will rewrite
-    // XML-encoded project files automatically when first opening them. We use XML to prevent
-    // encoding issues, since toASCIIPropertyList does not include the UTF-8 encoding comment, and
-    // Xcode by default apparently uses MacRoman.
-    // This encoding concern is probably why Buck also generates XML project files as well.
-    outWriter.write(ser.toPlist().toXMLPropertyList());
-    outWriter.flush();
-  }
-
-  private static final EnumSet<ProductType> SUPPORTED_PRODUCT_TYPES = EnumSet.of(
-      ProductType.STATIC_LIBRARY,
-      ProductType.APPLICATION,
-      ProductType.BUNDLE,
-      ProductType.UNIT_TEST,
-      ProductType.APP_EXTENSION);
-
-  private static final EnumSet<ProductType> PRODUCT_TYPES_THAT_HAVE_A_BINARY = EnumSet.of(
-      ProductType.APPLICATION,
-      ProductType.BUNDLE,
-      ProductType.UNIT_TEST,
-      ProductType.APP_EXTENSION);
-
-  /**
-   * Detects the product type of the given target based on multiple fields in {@code targetControl}.
-   * {@code productType} is set as a field on {@code PBXNativeTarget} objects in Xcode project
-   * files, and we support three values: {@link ProductType#APPLICATION},
-   * {@link ProductType#STATIC_LIBRARY}, and {@link ProductType#BUNDLE}. The product type is not
-   * only what xcodegen sets the {@code productType} field to - it also dictates what can be built
-   * with this target (e.g. a library cannot be built with resources), what build phase it should be
-   * added to of its dependers, and the name and shape of its build output.
-   */
-  public static ProductType productType(TargetControl targetControl) {
-    if (targetControl.hasProductType()) {
-      for (ProductType supportedType : SUPPORTED_PRODUCT_TYPES) {
-        if (targetControl.getProductType().equals(supportedType.identifier)) {
-          return supportedType;
-        }
-      }
-      throw new IllegalArgumentException(
-          "Unsupported product type: " + targetControl.getProductType());
-    }
-
-    return targetControl.hasInfoplist() ? ProductType.APPLICATION : ProductType.STATIC_LIBRARY;
-  }
-
-  private static String productName(TargetControl targetControl) {
-    if (Equaling.of(ProductType.STATIC_LIBRARY, productType(targetControl))) {
-      // The product names for static libraries must be unique since the final
-      // binary is linked with "clang -l${LIBRARY_PRODUCT_NAME}" for each static library.
-      // Unlike other product types, a full application may have dozens of static libraries,
-      // so rather than just use the target name, we use the full label to generate the product
-      // name.
-      return labelToXcodeTargetName(targetControl.getLabel());
-    } else {
-      return targetControl.getName();
-    }
-  }
-
-  /**
-   * Returns the file reference corresponding to the {@code productReference} of the given target.
-   * The {@code productReference} is the build output of a target, and its name and file type
-   * (stored in the {@link FileReference}) change based on the product type.
-   */
-  private static FileReference productReference(TargetControl targetControl) {
-    ProductType type = productType(targetControl);
-    String productName = productName(targetControl);
-
-    switch (type) {
-      case APPLICATION:
-        return FileReference.of(String.format("%s.app", productName), SourceTree.BUILT_PRODUCTS_DIR)
-            .withExplicitFileType(FILE_TYPE_WRAPPER_APPLICATION);
-      case STATIC_LIBRARY:
-        return FileReference.of(
-            String.format("lib%s.a", productName), SourceTree.BUILT_PRODUCTS_DIR)
-                .withExplicitFileType(FILE_TYPE_ARCHIVE_LIBRARY);
-      case BUNDLE:
-        return FileReference.of(
-            String.format("%s.bundle", productName), SourceTree.BUILT_PRODUCTS_DIR)
-                .withExplicitFileType(FILE_TYPE_WRAPPER_BUNDLE);
-      case UNIT_TEST:
-        return FileReference.of(
-            String.format("%s.xctest", productName), SourceTree.BUILT_PRODUCTS_DIR)
-                .withExplicitFileType(FILE_TYPE_WRAPPER_BUNDLE);
-      case APP_EXTENSION:
-        return FileReference.of(
-            String.format("%s.appex", productName), SourceTree.BUILT_PRODUCTS_DIR)
-                .withExplicitFileType(FILE_TYPE_APP_EXTENSION);
-      default:
-        throw new IllegalArgumentException("unknown: " + type);
-    }
-  }
-
-  private static class TargetInfo {
-    final TargetControl control;
-    final PBXNativeTarget nativeTarget;
-    final PBXFrameworksBuildPhase frameworksPhase;
-    final PBXResourcesBuildPhase resourcesPhase;
-    final PBXBuildFile productBuildFile;
-    final PBXTargetDependency targetDependency;
-    final NSDictionary buildConfig;
-
-    TargetInfo(TargetControl control,
-        PBXNativeTarget nativeTarget,
-        PBXFrameworksBuildPhase frameworksPhase,
-        PBXResourcesBuildPhase resourcesPhase,
-        PBXBuildFile productBuildFile,
-        PBXTargetDependency targetDependency,
-        NSDictionary buildConfig) {
-      this.control = control;
-      this.nativeTarget = nativeTarget;
-      this.frameworksPhase = frameworksPhase;
-      this.resourcesPhase = resourcesPhase;
-      this.productBuildFile = productBuildFile;
-      this.targetDependency = targetDependency;
-      this.buildConfig = buildConfig;
-    }
-
-    /**
-     * Returns the path to the built, statically-linked binary for this target. The path contains
-     * build-setting variables and may be used in a build setting such as {@code TEST_HOST}.
-     *
-     * <p>One example return value is {@code $(BUILT_PRODUCTS_DIR)/Foo.app/Foo}.
-     */
-    String staticallyLinkedBinary() {
-      ProductType type = productType(control);
-      Preconditions.checkArgument(
-          Containing.item(PRODUCT_TYPES_THAT_HAVE_A_BINARY, type),
-          "This product type (%s) is not known to have a binary.", type);
-      FileReference productReference = productReference(control);
-      return String.format("$(%s)/%s/%s",
-          productReference.sourceTree().name(),
-          productReference.path().or(productReference.name()),
-          control.getName());
-    }
-
-    /**
-     * Adds the given dependency to the list of dependencies, the
-     * appropriate build phase if applicable, and the appropriate build setting values if
-     * applicable, of this target.
-     */
-    void addDependencyInfo(
-        DependencyControl dependencyControl, Map<String, TargetInfo> targetInfoByLabel) {
-      TargetInfo dependencyInfo =
-          Mapping.of(targetInfoByLabel, dependencyControl.getTargetLabel()).get();
-      if (dependencyControl.getTestHost()) {
-        buildConfig.put("TEST_HOST", dependencyInfo.staticallyLinkedBinary());
-        buildConfig.put("BUNDLE_LOADER", dependencyInfo.staticallyLinkedBinary());
-      } else if (productType(dependencyInfo.control) == ProductType.BUNDLE) {
-        resourcesPhase.getFiles().add(dependencyInfo.productBuildFile);
-      } else if (productType(dependencyInfo.control) == ProductType.APP_EXTENSION) {
-        PBXCopyFilesBuildPhase copyFilesPhase = new PBXCopyFilesBuildPhase(
-            PBXCopyFilesBuildPhase.Destination.PLUGINS, /*path=*/"");
-        copyFilesPhase.getFiles().add(dependencyInfo.productBuildFile);
-        nativeTarget.getBuildPhases().add(copyFilesPhase);
-      } else {
-        frameworksPhase.getFiles().add(dependencyInfo.productBuildFile);
-      }
-      nativeTarget.getDependencies().add(dependencyInfo.targetDependency);
-    }
-  }
-
-  // TODO(bazel-team): Make this a no-op once the released version of Bazel sends the label to
-  // xcodegen pre-processed.
-  private static String labelToXcodeTargetName(String label) {
-    String pathFromWorkspaceRoot =  label.replace("//", "").replace(':', '/');
-    List<String> components = Splitter.on('/').splitToList(pathFromWorkspaceRoot);
-    return Joiner.on('_').join(Lists.reverse(components));
-  }
-
-  private static NSDictionary nonArcCompileSettings() {
-    NSDictionary result = new NSDictionary();
-    result.put("COMPILER_FLAGS", "-fno-objc-arc");
-    return result;
-  }
-
-  private static boolean hasAtLeastOneCompilableSource(TargetControl control) {
-    return (control.getSourceFileCount() != 0) || (control.getNonArcSourceFileCount() != 0);
-  }
-
-  private static <E> Iterable<E> plus(Iterable<E> before, E... rest) {
-    return Iterables.concat(before, ImmutableList.copyOf(rest));
-  }
-
-  /**
-   * Returns the final header search paths to be placed in a build configuration.
-   */
-  private static NSArray headerSearchPaths(Iterable<String> paths) {
-    ImmutableList.Builder<String> result = new ImmutableList.Builder<>();
-    for (String path : paths) {
-      // TODO(bazel-team): Remove this hack once the released version of Bazel is prepending
-      // "$(WORKSPACE_ROOT)/" to every "source rooted" path.
-      if (!path.startsWith("$")) {
-        path = "$(WORKSPACE_ROOT)/" + path;
-      }
-      result.add(path);
-    }
-    return (NSArray) NSObject.wrap(result.build());
-  }
-
-  /**
-   * Returns the {@code FRAMEWORK_SEARCH_PATHS} array for a target's build config given the list of
-   * {@code .framework} directory paths.
-   */
-  private static NSArray frameworkSearchPaths(Iterable<String> frameworks) {
-    ImmutableSet.Builder<NSString> result = new ImmutableSet.Builder<>();
-    for (String framework : frameworks) {
-      result.add(new NSString("$(WORKSPACE_ROOT)/" + Paths.get(framework).getParent()));
-    }
-    // This is needed by XcTest targets (and others, just in case) for SenTestingKit.framework.
-    result.add(new NSString("$(SDKROOT)/Developer/Library/Frameworks"));
-    // This is needed by non-XcTest targets that use XcTest.framework, for instance for test
-    // utility libraries packaged as an objc_library.
-    result.add(new NSString("$(PLATFORM_DIR)/Developer/Library/Frameworks"));
-
-    return (NSArray) NSObject.wrap(result.build().asList());
-  }
-
-  private static PBXFrameworksBuildPhase buildLibraryInfo(
-      LibraryObjects libraryObjects, TargetControl target) {
-    BuildPhaseBuilder builder = libraryObjects.newBuildPhase();
-    if (Containing.item(PRODUCT_TYPES_THAT_HAVE_A_BINARY, productType(target))) {
-      for (String dylib : target.getSdkDylibList()) {
-        builder.addDylib(dylib);
-      }
-    }
-    for (String sdkFramework : target.getSdkFrameworkList()) {
-      builder.addSdkFramework(sdkFramework);
-    }
-    for (String framework : target.getFrameworkList()) {
-      builder.addFramework(framework);
-    }
-    return builder.build();
-  }
-
-  private static ImmutableList<String> otherLdflags(TargetControl targetControl) {
-    Iterable<String> givenFlags = targetControl.getLinkoptList();
-    ImmutableList.Builder<String> flags = new ImmutableList.Builder<>();
-    flags.addAll(givenFlags);
-    if (!Equaling.of(ProductType.STATIC_LIBRARY, productType(targetControl))) {
-      for (String importedLibrary : targetControl.getImportedLibraryList()) {
-        flags.add("$(WORKSPACE_ROOT)/" + importedLibrary);
-      }
-    }
-    return flags.build();
-  }
-
-  /** Generates a project file. */
-  public static PBXProject xcodeproj(Path workspaceRoot, Control control,
-      Iterable<PbxReferencesProcessor> postProcessors) {
-    checkArgument(control.hasPbxproj(), "Must set pbxproj field on control proto.");
-    FileSystem fileSystem = workspaceRoot.getFileSystem();
-
-    XcodeprojPath<Path> outputPath = XcodeprojPath.converter().fromPath(
-        RelativePaths.fromString(fileSystem, control.getPbxproj()));
-
-    NSDictionary projBuildConfigMap = new NSDictionary();
-    projBuildConfigMap.put("ARCHS", new NSArray(
-        new NSString("armv7"), new NSString("armv7s"), new NSString("arm64")));
-    projBuildConfigMap.put("CLANG_ENABLE_OBJC_ARC", "YES");
-    projBuildConfigMap.put("SDKROOT", "iphoneos");
-    projBuildConfigMap.put("IPHONEOS_DEPLOYMENT_TARGET", "7.0");
-    projBuildConfigMap.put("GCC_VERSION", "com.apple.compilers.llvm.clang.1_0");
-    projBuildConfigMap.put("CODE_SIGN_IDENTITY[sdk=iphoneos*]", "iPhone Developer");
-
-    for (XcodeprojBuildSetting projectSetting : control.getBuildSettingList()) {
-      projBuildConfigMap.put(projectSetting.getName(), projectSetting.getValue());
-    }
-
-    PBXProject project = new PBXProject(outputPath.getProjectName());
-    project.getMainGroup().setPath("$(WORKSPACE_ROOT)");
-    try {
-      project
-          .getBuildConfigurationList()
-          .getBuildConfigurationsByName()
-          .get(DEFAULT_OPTIONS_NAME)
-          .setBuildSettings(projBuildConfigMap);
-    } catch (ExecutionException e) {
-      throw new RuntimeException(e);
-    }
-
-    Map<String, TargetInfo> targetInfoByLabel = new HashMap<>();
-
-    PBXFileReferences fileReferences = new PBXFileReferences();
-    LibraryObjects libraryObjects = new LibraryObjects(fileReferences);
-    PBXBuildFiles pbxBuildFiles = new PBXBuildFiles(fileReferences);
-    Resources resources =
-        Resources.fromTargetControls(fileSystem, pbxBuildFiles, control.getTargetList());
-    Xcdatamodels xcdatamodels =
-        Xcdatamodels.fromTargetControls(fileSystem, pbxBuildFiles, control.getTargetList());
-    // We use a hash set for the Project Navigator files so that the same PBXFileReference does not
-    // get added twice. Because PBXFileReference uses equality-by-identity semantics, this requires
-    // the PBXFileReferences cache to properly return the same reference for functionally-equivalent
-    // files.
-    Set<PBXReference> projectNavigatorFiles = new LinkedHashSet<>();
-    for (TargetControl targetControl : control.getTargetList()) {
-      checkArgument(targetControl.hasName(), "TargetControl requires a name: %s", targetControl);
-      checkArgument(targetControl.hasLabel(), "TargetControl requires a label: %s", targetControl);
-
-      ProductType productType = productType(targetControl);
-      Preconditions.checkArgument(
-          (productType != ProductType.APPLICATION) || hasAtLeastOneCompilableSource(targetControl),
-          APP_NEEDS_SOURCE_ERROR);
-      PBXSourcesBuildPhase sourcesBuildPhase = new PBXSourcesBuildPhase();
-
-      for (SourceFile source : SourceFile.allSourceFiles(fileSystem, targetControl)) {
-        PBXFileReference fileRef =
-            fileReferences.get(FileReference.of(source.path().toString(), SourceTree.GROUP));
-        projectNavigatorFiles.add(fileRef);
-        if (Equaling.of(source.buildType(), BuildType.NO_BUILD)) {
-          continue;
-        }
-        PBXBuildFile buildFile = new PBXBuildFile(fileRef);
-        if (Equaling.of(source.buildType(), BuildType.NON_ARC_BUILD)) {
-          buildFile.setSettings(Optional.of(nonArcCompileSettings()));
-        }
-        sourcesBuildPhase.getFiles().add(buildFile);
-      }
-      sourcesBuildPhase.getFiles().addAll(xcdatamodels.buildFiles().get(targetControl));
-
-      PBXFileReference productReference = fileReferences.get(productReference(targetControl));
-      projectNavigatorFiles.add(productReference);
-
-      NSDictionary targetBuildConfigMap = new NSDictionary();
-      // TODO(bazel-team): Stop adding the workspace root automatically once the
-      // released version of Bazel starts passing it.
-      targetBuildConfigMap.put("USER_HEADER_SEARCH_PATHS",
-          headerSearchPaths(
-              plus(targetControl.getUserHeaderSearchPathList(), "$(WORKSPACE_ROOT)")));
-      targetBuildConfigMap.put("HEADER_SEARCH_PATHS",
-          headerSearchPaths(
-              plus(targetControl.getHeaderSearchPathList(), "$(inherited)")));
-      targetBuildConfigMap.put("FRAMEWORK_SEARCH_PATHS",
-          frameworkSearchPaths(targetControl.getFrameworkList()));
-
-      targetBuildConfigMap.put("WORKSPACE_ROOT", workspaceRoot.toString());
-
-      if (targetControl.hasPchPath()) {
-        targetBuildConfigMap.put(
-            "GCC_PREFIX_HEADER", "$(WORKSPACE_ROOT)/" + targetControl.getPchPath());
-      }
-
-      targetBuildConfigMap.put("PRODUCT_NAME", productName(targetControl));
-      if (targetControl.hasInfoplist()) {
-        targetBuildConfigMap.put(
-            "INFOPLIST_FILE", "$(WORKSPACE_ROOT)/" + targetControl.getInfoplist());
-      }
-
-      if (targetControl.getCoptCount() > 0) {
-        targetBuildConfigMap.put("OTHER_CFLAGS", NSObject.wrap(targetControl.getCoptList()));
-      }
-      targetBuildConfigMap.put("OTHER_LDFLAGS", NSObject.wrap(otherLdflags(targetControl)));
-      for (XcodeprojBuildSetting setting : targetControl.getBuildSettingList()) {
-        String name = setting.getName();
-        String value = setting.getValue();
-        // TODO(bazel-team): Remove this hack after next Bazel release.
-        if (name.equals("CODE_SIGN_ENTITLEMENTS") && !value.startsWith("$")) {
-          value = "$(WORKSPACE_ROOT)/" + value;
-        }
-        targetBuildConfigMap.put(name, value);
-      }
-
-      PBXNativeTarget target = new PBXNativeTarget(
-          labelToXcodeTargetName(targetControl.getLabel()), productType);
-      try {
-        target
-            .getBuildConfigurationList()
-            .getBuildConfigurationsByName()
-            .get(DEFAULT_OPTIONS_NAME)
-            .setBuildSettings(targetBuildConfigMap);
-      } catch (ExecutionException e) {
-        throw new RuntimeException(e);
-      }
-      target.setProductReference(productReference);
-
-      PBXFrameworksBuildPhase frameworksPhase = buildLibraryInfo(libraryObjects, targetControl);
-      PBXResourcesBuildPhase resourcesPhase = resources.resourcesBuildPhase(targetControl);
-
-      for (String importedArchive : targetControl.getImportedLibraryList()) {
-        PBXFileReference fileReference = fileReferences.get(
-            FileReference.of(importedArchive, SourceTree.GROUP)
-                .withExplicitFileType(FILE_TYPE_ARCHIVE_LIBRARY));
-        projectNavigatorFiles.add(fileReference);
-      }
-
-      project.getTargets().add(target);
-
-      target.getBuildPhases().add(frameworksPhase);
-      target.getBuildPhases().add(sourcesBuildPhase);
-      target.getBuildPhases().add(resourcesPhase);
-
-      checkState(!Mapping.of(targetInfoByLabel, targetControl.getLabel()).isPresent(),
-          "Mapping already exists for target with label %s in map: %s",
-          targetControl.getLabel(), targetInfoByLabel);
-      targetInfoByLabel.put(
-          targetControl.getLabel(),
-          new TargetInfo(
-              targetControl,
-              target,
-              frameworksPhase,
-              resourcesPhase,
-              new PBXBuildFile(productReference),
-              new LocalPBXTargetDependency(
-                  new LocalPBXContainerItemProxy(
-                      project, target, ProxyType.TARGET_REFERENCE)),
-              targetBuildConfigMap));
-    }
-
-    for (HasProjectNavigatorFiles references : ImmutableList.of(pbxBuildFiles, libraryObjects)) {
-      Iterables.addAll(projectNavigatorFiles, references.mainGroupReferences());
-    }
-
-    Iterable<PBXReference> processedProjectFiles = projectNavigatorFiles;
-    for (PbxReferencesProcessor postProcessor : postProcessors) {
-      processedProjectFiles = postProcessor.process(processedProjectFiles);
-    }
-
-    Iterables.addAll(project.getMainGroup().getChildren(), processedProjectFiles);
-    for (TargetInfo targetInfo : targetInfoByLabel.values()) {
-      for (DependencyControl dependency : targetInfo.control.getDependencyList()) {
-        targetInfo.addDependencyInfo(dependency, targetInfoByLabel);
-      }
-    }
-
-    return project;
-  }
-}
diff --git a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/testing/PbxTypes.java b/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/testing/PbxTypes.java
deleted file mode 100644
index 8d0a2ee..0000000
--- a/src/objc_tools/xcodegen/java/com/google/devtools/build/xcode/xcodegen/testing/PbxTypes.java
+++ /dev/null
@@ -1,100 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.xcodegen.testing;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.xcode.xcodegen.FileReference;
-
-import com.facebook.buck.apple.xcode.xcodeproj.PBXBuildFile;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFileReference;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXFrameworksBuildPhase;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXReference;
-
-/**
- * Collection of static utility methods for PBX type transformations, either to other
- * representations of the same or our domain objects.
- */
-public class PbxTypes {
-
-  private PbxTypes() {}
-
-  /**
-   * Returns all file references the {@code phase} depends on in
-   * {@link PBXFrameworksBuildPhase#getFiles()}.
-   */
-  public static ImmutableList<FileReference> fileReferences(PBXFrameworksBuildPhase phase) {
-    return fileReferences(pbxFileReferences(phase));
-  }
-
-  /**
-   * Transforms the given list of PBX references to file references.
-   */
-  public static ImmutableList<FileReference> fileReferences(
-      Iterable<? extends PBXReference> references) {
-    ImmutableList.Builder<FileReference> fileReferences = ImmutableList.builder();
-    for (PBXReference reference : references) {
-      fileReferences.add(fileReference(reference));
-    }
-    return fileReferences.build();
-  }
-
-  /**
-   * Extracts the list of PBX references {@code phase} depends on through
-   * {@link PBXFrameworksBuildPhase#getFiles()}.
-   */
-  public static ImmutableList<PBXReference> pbxFileReferences(PBXFrameworksBuildPhase phase) {
-    ImmutableList.Builder<PBXReference> phaseFileReferences = ImmutableList.builder();
-    for (PBXBuildFile buildFile : phase.getFiles()) {
-      phaseFileReferences.add(buildFile.getFileRef());
-    }
-    return phaseFileReferences.build();
-  }
-
-  /**
-   * Converts a PBX file reference to its domain equivalent.
-   */
-  public static FileReference fileReference(PBXReference reference) {
-    FileReference fileReference =
-        FileReference.of(reference.getName(), reference.getPath(), reference.getSourceTree());
-    if (reference instanceof PBXFileReference) {
-      Optional<String> explicitFileType = ((PBXFileReference) reference).getExplicitFileType();
-      if (explicitFileType.isPresent()) {
-        return fileReference.withExplicitFileType(explicitFileType.get());
-      }
-    }
-    return fileReference;
-  }
-
-  /**
-   * Returns the string representation of all references the {@code phase} depends on in
-   * {@link PBXFrameworksBuildPhase#getFiles()}.
-   *
-   */
-  public static ImmutableList<String> referencePaths(PBXFrameworksBuildPhase phase) {
-    return paths(pbxFileReferences(phase));
-  }
-
-  /**
-   * Transforms the given list of references into their string path representations.
-   */
-  public static ImmutableList<String> paths(Iterable<? extends PBXReference> references) {
-    ImmutableList.Builder<String> paths = ImmutableList.builder();
-    for (PBXReference reference : references) {
-      paths.add(reference.getPath());
-    }
-    return paths.build();
-  }
-}
diff --git a/src/test/java/com/google/devtools/build/lib/analysis/BazelAnalysisMock.java b/src/test/java/com/google/devtools/build/lib/analysis/BazelAnalysisMock.java
index b428a2a..e56fecc 100644
--- a/src/test/java/com/google/devtools/build/lib/analysis/BazelAnalysisMock.java
+++ b/src/test/java/com/google/devtools/build/lib/analysis/BazelAnalysisMock.java
@@ -26,7 +26,6 @@ import com.google.devtools.build.lib.packages.util.MockToolsConfig;
 import com.google.devtools.build.lib.rules.cpp.CppConfigurationLoader;
 import com.google.devtools.build.lib.rules.java.JavaConfigurationLoader;
 import com.google.devtools.build.lib.rules.java.JvmConfigurationLoader;
-import com.google.devtools.build.lib.rules.objc.ObjcConfigurationLoader;
 import com.google.devtools.build.lib.vfs.FileSystemUtils;
 import com.google.devtools.build.lib.vfs.Path;
 
@@ -96,8 +95,7 @@ public class BazelAnalysisMock extends AnalysisMock {
         new BazelConfiguration.Loader(),
         new CppConfigurationLoader(Functions.<String>identity()),
         new JvmConfigurationLoader(BazelRuleClassProvider.JAVA_CPU_SUPPLIER),
-        new JavaConfigurationLoader(BazelRuleClassProvider.JAVA_CPU_SUPPLIER),
-        new ObjcConfigurationLoader());
+        new JavaConfigurationLoader(BazelRuleClassProvider.JAVA_CPU_SUPPLIER));
   }
 
   @Override
diff --git a/src/test/shell/bazel/BUILD b/src/test/shell/bazel/BUILD
index 875207a..b5615a6 100644
--- a/src/test/shell/bazel/BUILD
+++ b/src/test/shell/bazel/BUILD
@@ -53,7 +53,6 @@ genrule(
     srcs = [
         "//src/main/protobuf:srcs",
         "//src/main/java:srcs",
-        "//src/tools/xcode-common:srcs",
         "//third_party:srcs",
     ],
     outs = ["doc-srcs.zip"],
diff --git a/src/tools/xcode-common/BUILD b/src/tools/xcode-common/BUILD
deleted file mode 100644
index ddbd5f9..0000000
--- a/src/tools/xcode-common/BUILD
+++ /dev/null
@@ -1,20 +0,0 @@
-package(default_visibility = ["//src/main/java:__subpackages__"])
-
-# TODO(bazel-team): Split this into multiple rules.
-java_library(
-    name = "xcode-common",
-    srcs = glob([
-        "java/com/google/devtools/build/xcode/util/*.java",
-        "java/com/google/devtools/build/xcode/common/*.java",
-    ]),
-    deps = [
-        "//third_party:guava",
-        "//third_party:jsr305",
-    ],
-)
-
-filegroup(
-    name = "srcs",
-    srcs = glob(["**"]),
-    visibility = ["//src/test:__subpackages__"],
-)
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/ActoolZip.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/ActoolZip.java
deleted file mode 100644
index b028ae5..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/ActoolZip.java
+++ /dev/null
@@ -1,128 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.actoolzip;
-
-import com.google.common.base.Function;
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.devtools.build.xcode.zippingoutput.Arguments;
-import com.google.devtools.build.xcode.zippingoutput.Wrapper;
-import com.google.devtools.build.xcode.zippingoutput.Wrappers;
-import com.google.devtools.build.xcode.zippingoutput.Wrappers.CommandFailedException;
-import com.google.devtools.build.xcode.zippingoutput.Wrappers.OutErr;
-
-import java.io.File;
-import java.io.IOException;
-import java.util.Set;
-
-/**
- * A tool which wraps actool by running actool and zipping its output. See the JavaDoc for
- * {@link Wrapper} for more information.
- */
-public class ActoolZip implements Wrapper {
-
-  private static final Function<String, String> CANONICAL_PATH =
-      new Function<String, String>() {
-        @Override
-        public String apply(String path) {
-          File file = new File(path);
-          if (file.exists()) {
-            try {
-              return file.getCanonicalPath();
-            } catch (IOException e) {
-              // Pass through to return raw path
-            }
-          }
-          return path;
-        }
-      };
-
-  @Override
-  public String name() {
-    return "ActoolZip";
-  }
-
-  @Override
-  public String subtoolName() {
-    return "actool";
-  }
-
-  @Override
-  public Iterable<String> subCommand(Arguments args, String outputDirectory) {
-    return new ImmutableList.Builder<String>()
-        .add(args.subtoolCmd())
-        .add("--compile")
-        .add(outputDirectory)
-        // actool munges paths in some way which doesn't work if one of the directories in the path
-        // is a symlink.
-        .addAll(Iterables.transform(args.subtoolExtraArgs(), CANONICAL_PATH))
-        .build();
-  }
-
-  public static void main(String[] args) throws IOException, InterruptedException {
-    Optional<File> infoPlistPath = replaceInfoPlistPath(args);
-    try {
-      OutErr outErr = Wrappers.executeCapturingOutput(args, new ActoolZip());
-      if (infoPlistPath.isPresent() && !infoPlistPath.get().exists()) {
-        outErr.print();
-        System.exit(1);
-      }
-    } catch (CommandFailedException e) {
-      Wrappers.handleException(e);
-    }
-  }
-
-  /**
-   * Absolute-ify output partial info plist's path.
-   *
-   * <p>actool occasionally writes the partial info plist file to the wrong directory if a
-   * non-absolute path is passed as --output-partial-info-plist, so we optimistically try to
-   * absolute-ify its path. This isn't caught by the "CANONICAL_PATH" transform above, because the
-   * file doesn't exist at the time of flag parsing.
-   *
-   * <p>Modifies args in-place.
-   *
-   * @return new value of the output-partial-info-plist flag.
-   */
-  private static Optional<File> replaceInfoPlistPath(String[] args) {
-    String flag = "output-partial-info-plist";
-    Set<String> flagOptions = ImmutableSet.of(
-        "-" + flag,
-        "--" + flag);
-    Optional<File> newPath = Optional.absent();
-    for (int i = 0; i < args.length; ++i) {
-      for (String flagOption : flagOptions) {
-        String arg = args[i];
-        String flagEquals = flagOption + "=";
-        if (arg.startsWith(flagEquals)) {
-          newPath = Optional.of(new File(arg.substring(flagEquals.length())));
-          args[i] = flagEquals + newPath.get().getAbsolutePath();
-        }
-        if (arg.equals(flagOption) && i + 1 < args.length) {
-          newPath = Optional.of(new File(args[i + 1]));
-          args[i + 1] = newPath.get().getAbsolutePath();
-        }
-      }
-    }
-    return newPath;
-  }
-
-  @Override
-  public boolean outputDirectoryMustExist() {
-    return true;
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/README b/src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/README
deleted file mode 100644
index 7aaae16..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/actoolzip/README
+++ /dev/null
@@ -1,4 +0,0 @@
-actoolzip runs actool, which compiles asset catalog files and zips up the
-output, because actool returns an unpredictable number of output files.
-
-actool only runs on Darwin, so actoolzip only runs on Darwin.
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/BuildOptionsUtil.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/BuildOptionsUtil.java
deleted file mode 100644
index 50a726a..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/BuildOptionsUtil.java
+++ /dev/null
@@ -1,25 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.common;
-
-/**
- * Utility code related to build settings (referred to as <em>build configuration</em> within
- * Xcode).
- */
-public class BuildOptionsUtil {
-  private BuildOptionsUtil() {}
-
-  public static final String DEFAULT_OPTIONS_NAME = "Debug";
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/PathTransformer.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/PathTransformer.java
deleted file mode 100644
index 08b3f6d..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/PathTransformer.java
+++ /dev/null
@@ -1,46 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.common;
-
-import java.nio.file.Path;
-
-/** Defines operations common to file paths. */
-public interface PathTransformer<P> {
-  /** Returns the containing directory of the given path. */
-  P parent(P path);
-
-  /** Returns the result of joining a path component string to the given path. */
-  P join(P path, String segment);
-
-  /** Returns the name of the file at the given path, i.e. the last path component. */
-  String name(P path);
-
-  static final PathTransformer<Path> FOR_JAVA_PATH = new PathTransformer<Path>() {
-    @Override
-    public Path parent(Path path) {
-      return path.getParent();
-    }
-
-    @Override
-    public Path join(Path path, String segment) {
-      return path.resolve(segment);
-    }
-
-    @Override
-    public String name(Path path) {
-      return path.getFileName().toString();
-    }
-  };
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/Platform.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/Platform.java
deleted file mode 100644
index 6e7a059..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/Platform.java
+++ /dev/null
@@ -1,59 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.common;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableSet;
-import com.google.devtools.build.xcode.util.Containing;
-
-import java.util.Locale;
-import java.util.Set;
-
-/**
- * An enum that can be used to distinguish between an iOS simulator and device.
- */
-public enum Platform {
-  DEVICE("iPhoneOS"), SIMULATOR("iPhoneSimulator");
-
-  private static final Set<String> SIMULATOR_ARCHS = ImmutableSet.of("i386", "x86_64");
-
-  private final String nameInPlist;
-
-  Platform(String nameInPlist) {
-    this.nameInPlist = Preconditions.checkNotNull(nameInPlist);
-  }
-
-  /**
-   * Returns the name of the "platform" as it appears in the CFBundleSupportedPlatforms plist
-   * setting.
-   */
-  public String getNameInPlist() {
-    return nameInPlist;
-  }
-
-  /**
-   * Returns the name of the "platform" as it appears in the plist when it appears in all-lowercase.
-   */
-  public String getLowerCaseNameInPlist() {
-    return nameInPlist.toLowerCase(Locale.US);
-  }
-
-  /**
-   * Returns the platform for the arch.
-   */
-  public static Platform forArch(String arch) {
-    return Containing.item(SIMULATOR_ARCHS, arch) ? SIMULATOR : DEVICE;
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/XcodeprojPath.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/XcodeprojPath.java
deleted file mode 100644
index eedf326..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/common/XcodeprojPath.java
+++ /dev/null
@@ -1,121 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.common;
-
-import static com.google.common.base.Preconditions.checkArgument;
-import static com.google.common.base.Preconditions.checkNotNull;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.xcode.util.Equaling;
-import com.google.devtools.build.xcode.util.Value;
-
-import java.nio.file.Path;
-import java.util.List;
-
-/**
- * Represents the path to an xcodeproj directory. Contains utilities for getting related
- * information, including the project.pbxproj file and the project <em>name</em>, which is the
- * .xcodeproj directory name without the ".xcodeproj" extension.
- *
- * @param <T> The type of the backing path, such as {@link java.nio.file.Path}.
- */
-public class XcodeprojPath<T extends Comparable<T>>
-    extends Value<XcodeprojPath<T>>
-    implements Comparable<XcodeprojPath<T>> {
-  public static final String PBXPROJ_FILE_NAME = "project.pbxproj";
-  public static final String XCODEPROJ_DIRECTORY_SUFFIX = ".xcodeproj";
-
-  /**
-   * An object that knows how to create {@code XcodeprojPath}s from paths of some other type.
-   */
-  public static class Converter<T extends Comparable<T>> {
-    private final PathTransformer<T> transformer;
-
-    public Converter(PathTransformer<T> transformer) {
-      this.transformer = checkNotNull(transformer);
-    }
-
-    /**
-     * Converts a path to an XcodeprojPath. The given path may point to the {@code project.pbxproj}
-     * file or the {@code *.xcodeproj} directory.
-     */
-    public XcodeprojPath<T> fromPath(T path) {
-      if (Equaling.of(PBXPROJ_FILE_NAME, transformer.name(path))) {
-        path = transformer.parent(path);
-      }
-      return new XcodeprojPath<T>(path, transformer);
-    }
-
-    /**
-     * Converts normal paths to {@code ProjectFilePath}s using {@link #fromPath(Comparable)}.
-     */
-    public List<XcodeprojPath<T>> fromPaths(Iterable<? extends T> pbxprojFiles) {
-      ImmutableList.Builder<XcodeprojPath<T>> result = new ImmutableList.Builder<>();
-      for (T pbxprojFile : pbxprojFiles) {
-        result.add(fromPath(pbxprojFile));
-      }
-      return result.build();
-    }
-  }
-
-  private final T xcodeprojDirectory;
-  private final PathTransformer<T> transformer;
-
-  public XcodeprojPath(T xcodeprojDirectory, PathTransformer<T> transformer) {
-    super(xcodeprojDirectory);
-    checkArgument(transformer.name(xcodeprojDirectory).endsWith(XCODEPROJ_DIRECTORY_SUFFIX),
-        "xcodeprojDirectory should end with %s, but it is '%s'", XCODEPROJ_DIRECTORY_SUFFIX,
-        xcodeprojDirectory);
-    this.xcodeprojDirectory = xcodeprojDirectory;
-    this.transformer = transformer;
-  }
-
-  /** Returns a converter which works for the Java {@code Path} class. */
-  public static Converter<Path> converter() {
-    return new Converter<>(PathTransformer.FOR_JAVA_PATH);
-  }
-
-  public final T getXcodeprojDirectory() {
-    return xcodeprojDirectory;
-  }
-
-  public final T getPbxprojFile() {
-    return transformer.join(xcodeprojDirectory, PBXPROJ_FILE_NAME);
-  }
-
-  /**
-   * Returns the package or directory in which the project is located. For instance, if the project
-   * file is {@code /foo/bar/App.xcodeproj/project.pbxproj}, then this method returns
-   * {@code /foo/bar}.
-   */
-  public final T getXcodeprojContainerDir() {
-    return transformer.parent(xcodeprojDirectory);
-  }
-
-  /**
-   * Returns the name of the xcodeproj directory without the {@code .xcodeproj} extension or the
-   * containing directory. For instance, for an xcodeproj directory of
-   * {@code /client/foo.xcodeproj}, this method returns {@code "foo"}.
-   */
-  public final String getProjectName() {
-    String pathStr = transformer.name(xcodeprojDirectory);
-    return pathStr.substring(0, pathStr.length() - XCODEPROJ_DIRECTORY_SUFFIX.length());
-  }
-
-  @Override
-  public final int compareTo(XcodeprojPath<T> o) {
-    return getXcodeprojDirectory().compareTo(o.getXcodeprojDirectory());
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/IbtoolZip.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/IbtoolZip.java
deleted file mode 100644
index 892053b..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/IbtoolZip.java
+++ /dev/null
@@ -1,58 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.ibtoolzip;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.xcode.zippingoutput.Arguments;
-import com.google.devtools.build.xcode.zippingoutput.Wrapper;
-import com.google.devtools.build.xcode.zippingoutput.Wrappers;
-
-import java.io.IOException;
-
-/**
- * A tool which wraps ibtool by running ibtool and zipping its output. See the JavaDoc for
- * {@link Wrapper} for more information.
- */
-public class IbtoolZip implements Wrapper {
-
-  @Override
-  public String name() {
-    return "IbtoolZip";
-  }
-
-  @Override
-  public String subtoolName() {
-    return "ibtool";
-  }
-
-  @Override
-  public Iterable<String> subCommand(Arguments args, String outputDirectory) {
-    return new ImmutableList.Builder<String>()
-        .add(args.subtoolCmd())
-        .add("--compile")
-        .add(outputDirectory)
-        .addAll(args.subtoolExtraArgs())
-        .build();
-  }
-
-  public static void main(String[] args) throws IOException, InterruptedException {
-    Wrappers.executePipingOutput(args, new IbtoolZip());
-  }
-
-  @Override
-  public boolean outputDirectoryMustExist() {
-    return true;
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/README b/src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/README
deleted file mode 100644
index a439bc4..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/ibtoolzip/README
+++ /dev/null
@@ -1,4 +0,0 @@
-ibtoolzip runs ibtool, which compiles storyboards, and zips up the output,
-because ibtool returns an unpredictable number of output files.
-
-ibtool only runs on Darwin, so ibtoolzip only runs on Darwin.
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Containing.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Containing.java
deleted file mode 100644
index 8f2434d..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Containing.java
+++ /dev/null
@@ -1,71 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.util;
-
-import static com.google.common.base.Preconditions.checkNotNull;
-
-import com.google.common.collect.Multimap;
-
-import java.util.Collection;
-import java.util.Map;
-
-/**
- * Provides methods that make checking for the presence of an item in a collection type-safe. For
- * instance, in {@code foo.containsKey(bar)}, where {@code foo} is a {@code Map<K, V>}, {@code bar}
- * can be a type other than {@code K} and may be {@code null}, in which case the method will just
- * return false (collections that allow null references may of course return true in the latter
- * case).
- * <p>
- * The methods in this class, such as {@link #key(Map, Object)}, will cause a compiler error if you
- * use the wrong type and throw a {@link NullPointerException} if you pass {@code null} for the
- * object whose presence to check. In the case where you want to check for {@code null} in a
- * collection, add a new method to this class, use the methods in the plain Collections API
- * (such as {@link Collection#contains(Object)}), or use the {@code Optional} type as the element of
- * the collection.
- * <p>
- * TODO(bazel-team): This class should either be simplified or eliminated when the
- * CollectionIncompatibleType feature is available:
- * https://code.google.com/p/error-prone/wiki/CollectionIncompatibleType
- */
-public class Containing {
-  private Containing() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  public static <K> boolean key(Map<K, ?> map, K key) {
-    checkNotNull(key);
-    return map.containsKey(key);
-  }
-
-  public static <K> boolean key(Multimap<K, ?> map, K key) {
-    checkNotNull(key);
-    return map.containsKey(key);
-  }
-
-  public static <E> boolean item(Collection<E> collection, E item) {
-    checkNotNull(item);
-    return collection.contains(item);
-  }
-
-  public static <V> boolean value(Map<?, V> map, V value) {
-    checkNotNull(value);
-    return map.containsValue(value);
-  }
-
-  public static <V> boolean value(Multimap<?, V> map, V value) {
-    checkNotNull(value);
-    return map.containsValue(value);
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Equaling.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Equaling.java
deleted file mode 100644
index c359e57..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Equaling.java
+++ /dev/null
@@ -1,80 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.util;
-
-import static com.google.common.base.Preconditions.checkNotNull;
-
-import com.google.common.base.Optional;
-
-import java.io.File;
-import java.nio.file.Path;
-import java.util.List;
-import java.util.Set;
-
-/**
- * Provides utility methods that make equality comparison type safe. The
- * {@link Object#equals(Object)} method usually returns false when the other object is {@code null}
- * or a different runtime class. These utility methods try to force each object to be of the same
- * class (with the method signatures) and non-null (and throwing a {@link NullPointerException} if
- * either one is null.
- */
-public class Equaling {
-  private Equaling() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  // Note that we always checkNotNull(b) on a separate line from a.equals(b). This is to make it so
-  // the stack trace will tell you exactly which reference is null.
-
-  public static <T extends Value<T>> boolean of(Value<T> a, Value<T> b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-
-  public static boolean of(String a, String b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-
-  public static <T> boolean of(Optional<T> a, Optional<T> b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-
-  public static <T> boolean of(Set<T> a, Set<T> b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-
-  public static boolean of(File a, File b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-
-  public static boolean of(Path a, Path b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-
-  public static <T> boolean of(List<T> a, List<T> b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-
-  public static <T extends Enum<T>> boolean of(Enum<T> a, Enum<T> b) {
-    checkNotNull(b);
-    return a.equals(b);
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Mapping.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Mapping.java
deleted file mode 100644
index 0e5ef53..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Mapping.java
+++ /dev/null
@@ -1,39 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.util;
-
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-
-import java.util.Map;
-
-/**
- * Provides utility methods that make map lookup safe.
- */
-public class Mapping {
-  private Mapping() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  /**
-   * Returns the value mapped to the given key for a map. If the mapping is not present, an absent
-   * {@code Optional} is returned.
-   * @throws NullPointerException if the map or key argument is null
-   */
-  public static <K, V> Optional<V> of(Map<K, V> map, K key) {
-    Preconditions.checkNotNull(key);
-    return Optional.fromNullable(map.get(key));
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Value.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Value.java
deleted file mode 100644
index 6363af1..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/util/Value.java
+++ /dev/null
@@ -1,69 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.util;
-
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-
-/**
- * Represents a type whose equality, hash code, and string representation are defined by a single
- * immutable array. This class is designed to be extended by a final class, and to pass the member
- * data to this class's constructor.
- *
- * @param <V> the base class that extends {@code Value}
- */
-public class Value<V extends Value<V>> {
-  private final Object memberData;
-
-  /**
-   * Constructs a new instance with the given member data. Generally, all member data should be
-   * reflected in final fields in the child class.
-   * @throws NullPointerException if any element in {@code memberData} is null
-   */
-  public Value(Object... memberData) {
-    Preconditions.checkArgument(memberData.length > 0);
-    this.memberData = (memberData.length == 1)
-        ? Preconditions.checkNotNull(memberData[0]) : ImmutableList.copyOf(memberData);
-  }
-
-  /**
-   * A type-safe alternative to calling {@code a.equals(b)}. When using {@code a.equals(b)},
-   * {@code b} may accidentally be a different class from {@code a}, in which case there will be no
-   * compiler warning and the result will always be false. This method requires both values to have
-   * compatible types and to be non-null.
-   */
-  public boolean equalsOther(V other) {
-    return equals(Preconditions.checkNotNull(other));
-  }
-
-  @Override
-  public boolean equals(Object o) {
-    if ((o == null) || (o.getClass() != getClass())) {
-      return false;
-    }
-    Value<?> other = (Value<?>) o;
-    return memberData.equals(other.memberData);
-  }
-
-  @Override
-  public int hashCode() {
-    return memberData.hashCode();
-  }
-
-  @Override
-  public String toString() {
-    return getClass().getSimpleName() + ":" + memberData.toString();
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipFiles.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipFiles.java
deleted file mode 100644
index 21d6469..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipFiles.java
+++ /dev/null
@@ -1,153 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.zip;
-
-import com.google.common.collect.ImmutableMap;
-
-import java.io.IOException;
-import java.nio.ByteBuffer;
-import java.nio.channels.ReadableByteChannel;
-import java.nio.channels.SeekableByteChannel;
-import java.nio.charset.StandardCharsets;
-import java.nio.file.Files;
-import java.nio.file.Path;
-import java.util.Map;
-
-/**
- * Utility code for reading information from zip files.
- */
-public final class ZipFiles {
-  /** Read a little-endian integer comprised of {@code count} bytes from the input channel. */
-  private static int readBytes(int count, ReadableByteChannel input) throws IOException {
-    ByteBuffer buffer = ByteBuffer.allocate(count);
-    if (input.read(buffer) != count) {
-      throw new IOException("could not read expected number of bytes: " + count);
-    }
-    int result = 0;
-    for (int i = count - 1; i >= 0; i--) {
-      result <<= 8;
-      result |= buffer.get(i) & 0xff;
-    }
-    return result;
-  }
-
-  /**
-   * Returns the external file attributes of each entry as a mapping from the entry name to the
-   * 32-bit value. As long as the attributes are generated by a Unix host, this includes the POSIX
-   * file permissions in the upper two bytes. Entries not generated by a Unix host are not included
-   * in the result.
-   */
-  public static Map<String, Integer> unixExternalFileAttributes(Path zipFile) throws IOException {
-    // Field descriptions in comments were taken from this document:
-    // http://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT
-    ImmutableMap.Builder<String, Integer> attributes = new ImmutableMap.Builder<>();
-    try (SeekableByteChannel input = Files.newByteChannel(zipFile)) {
-      // The data we care about is toward the end of the file, after the compressed data for each
-      // file. We begin by looking for the start of the end of central directory record, which is
-      // marked by the signature 0x06054b50
-      //
-      // This contains the centralDirectoryStartOffset value, which tells us where to seek to find
-      // the first central directory entry. Each such entry is marked by the signature 0x02014b50
-      // and appear in sequence, one entry for each file in the .zip.
-      //
-      // The central directory entry contains many values, including the file name, the external
-      // file attributes, and the version made by value. If the version made by indicates a Unix
-      // host (0x03??), we include the external file attributes in the returned map.
-
-      long offset = input.size() - 4;
-      while (offset >= 0) {
-        input.position(offset);
-        int signature = readBytes(4, input);
-        if (signature == 0x06054b50) {
-          break;
-        } else if (signature == 0x06064b50) {
-          throw new IOException("Zip64 format not supported: " + zipFile);
-        }
-        offset--;
-      }
-      if (offset < 0) {
-        throw new IOException();
-      }
-
-      // Read end of central directory structure
-      input.position(input.position()
-          + 2 // number of this disk
-          + 2 // number of the disk with the start of the central directory
-      );
-      int entryCount = readBytes(2, input);
-      input.position(input.position()
-          + 2 // total number of entries in the central directory
-      );
-      input.position(input.position()
-          + 4 // size of the central directory
-      );
-      int centralDirectoryStartOffset = readBytes(4, input);
-      if (0xffffffff == centralDirectoryStartOffset) {
-        throw new IOException("Zip64 format not supported.");
-      }
-
-      input.position(centralDirectoryStartOffset);
-      int entriesFound = 0;
-
-      // Read each central directory entry
-      while ((entriesFound < entryCount) && (readBytes(4, input) == 0x02014b50)) {
-        int versionMadeBy = readBytes(2, input);
-        input.position(input.position()
-            + 2 // version needed to extract
-            + 2 // general purpose bit flag
-            + 2 // compression method
-            + 2 // last mod file time
-            + 2 // last mod file date
-            + 4 // crc-32
-            + 4 // compressed size
-            + 4 // uncompressed size
-        );
-        int filenameLength = readBytes(2, input);
-        int extraFieldLength = readBytes(2, input);
-        int fileCommentLength = readBytes(2, input);
-        input.position(input.position()
-            + 2 // disk number start
-            + 2 // internal file attributes
-        );
-        int externalFileAttributes = readBytes(4, input);
-        input.position(input.position()
-            + 4 // relative offset of local header
-        );
-        ByteBuffer filenameBuffer = ByteBuffer.allocate(filenameLength);
-        if (filenameLength != input.read(filenameBuffer)) {
-          throw new IOException(
-              String.format(
-                  "Could not read file name (length %d) in central directory record",
-                  filenameLength));
-        }
-        input.position(input.position() + extraFieldLength + fileCommentLength);
-        entriesFound++;
-        if ((versionMadeBy >> 8) == 3) {
-          // Zip made by a Unix host - the external file attributes are POSIX permissions.
-          String filename = new String(filenameBuffer.array(), StandardCharsets.UTF_8);
-          attributes.put(filename, externalFileAttributes);
-        }
-      }
-      if (entriesFound != entryCount) {
-        System.err.printf(
-            "WARNING: Expected %d entries in central directory record in '%s', but found %d\n",
-            entryCount, zipFile, entriesFound);
-      }
-    }
-    return attributes.build();
-  }
-
-  private ZipFiles() {}
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipInputEntry.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipInputEntry.java
deleted file mode 100644
index 01aaad0..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zip/ZipInputEntry.java
+++ /dev/null
@@ -1,141 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.zip;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.singlejar.ZipCombiner;
-import com.google.devtools.build.xcode.util.Value;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.nio.file.FileVisitResult;
-import java.nio.file.Files;
-import java.nio.file.Path;
-import java.nio.file.SimpleFileVisitor;
-import java.nio.file.attribute.BasicFileAttributes;
-
-/**
- * Describes an entry in a zip file when the zip file is being created.
- */
-public class ZipInputEntry extends Value<ZipInputEntry> {
-  /**
-   * The external file attribute used for files by default. This indicates a non-executable regular
-   * file that is readable by group and world.
-   */
-  public static final int DEFAULT_EXTERNAL_FILE_ATTRIBUTE = (0100644 << 16);
-
-  /**
-   * An external file attribute that indicates an executable regular file that is readable and
-   * executable by group and world.
-   */
-  public static final int EXECUTABLE_EXTERNAL_FILE_ATTRIBUTE = (0100755 << 16);
-
-  /**
-   * The central directory record information that is used when adding a plain, non-executable file.
-   */
-  public static final ZipCombiner.DirectoryEntryInfo DEFAULT_DIRECTORY_ENTRY_INFO =
-      ZipCombiner.DEFAULT_DIRECTORY_ENTRY_INFO
-          // This is what .ipa files built by Xcode are set to. Upper byte indicates Unix host.
-          // Lower byte indicates version of encoding software
-          // (note that 0x1e = 30 = (3.0 * 10), so 0x1e translates to 3.0).
-          // The Unix host value in the upper byte is what causes the external file attribute to be
-          // interpreted as POSIX permission and file type bits.
-          .withMadeByVersion((short) 0x031e)
-          .withExternalFileAttribute(DEFAULT_EXTERNAL_FILE_ATTRIBUTE);
-
-  private final Path source;
-  private final String zipPath;
-  private final int externalFileAttribute;
-
-  public ZipInputEntry(Path source, String zipPath) {
-    this(source, zipPath, DEFAULT_EXTERNAL_FILE_ATTRIBUTE);
-  }
-
-  public ZipInputEntry(Path source, String zipPath, int externalFileAttribute) {
-    super(source, zipPath, externalFileAttribute);
-    this.source = source;
-    this.zipPath = zipPath;
-    this.externalFileAttribute = externalFileAttribute;
-  }
-
-  /**
-   * The location of the source file to place in the zip.
-   */
-  public Path getSource() {
-    return source;
-  }
-
-  /**
-   * The full path of the item in the zip.
-   */
-  public String getZipPath() {
-    return zipPath;
-  }
-
-  /**
-   * The external file attribute field of the zip entry in the central directory record. On
-   * Unix-originated .zips, this corresponds to the permission bits (e.g. 0755 for an excutable
-   * file).
-   */
-  public int getExternalFileAttribute() {
-    return externalFileAttribute;
-  }
-
-  /**
-   * Adds this entry to a zip using the given {@code ZipCombiner}.
-   */
-  public void add(ZipCombiner combiner) throws IOException {
-    try (InputStream inputStream = Files.newInputStream(source)) {
-      combiner.addFile(zipPath, ZipCombiner.DOS_EPOCH, inputStream,
-          DEFAULT_DIRECTORY_ENTRY_INFO.withExternalFileAttribute(externalFileAttribute));
-    }
-  }
-
-  public static void addAll(ZipCombiner combiner, Iterable<ZipInputEntry> inputs)
-      throws IOException {
-    for (ZipInputEntry input : inputs) {
-      input.add(combiner);
-    }
-  }
-
-  /**
-   * Returns the entries to place in a zip file as if the zip file mirrors some directory structure.
-   * For instance, if {@code rootDirectory} is /tmp/foo, and the following files exist:
-   * <ul>
-   *   <li>/tmp/foo/a
-   *   <li>/tmp/foo/bar/c
-   *   <li>/tmp/foo/baz/d
-   * </ul>
-   * This function will return entries which point to these files and have in-zip paths of:
-   * <ul>
-   *   <li>a
-   *   <li>bar/c
-   *   <li>baz/d
-   * </ul>
-   */
-  public static Iterable<ZipInputEntry> fromDirectory(final Path rootDirectory) throws IOException {
-    final ImmutableList.Builder<ZipInputEntry> zipInputs = new ImmutableList.Builder<>();
-    Files.walkFileTree(rootDirectory, new SimpleFileVisitor<Path>() {
-      @Override
-      public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
-        // TODO(bazel-team): Set the external file attribute based on the attribute of the
-        // permissions of the file on-disk.
-        zipInputs.add(new ZipInputEntry(file, rootDirectory.relativize(file).toString()));
-        return FileVisitResult.CONTINUE;
-      }
-    });
-    return zipInputs.build();
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Arguments.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Arguments.java
deleted file mode 100644
index e6bea8c..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Arguments.java
+++ /dev/null
@@ -1,57 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.zippingoutput;
-
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.xcode.util.Value;
-
-/**
- * Arguments that have been parsed from a do-something-and-zip-output wrapper.
- */
-public class Arguments extends Value<Arguments> {
-
-  private final String outputZip;
-  private final String bundleRoot;
-  private final String subtoolCmd;
-  private final ImmutableList<String> subtoolExtraArgs;
-
-  Arguments(
-      String outputZip,
-      String bundleRoot,
-      String subtoolCmd,
-      ImmutableList<String> subtoolExtraArgs) {
-    super(outputZip, bundleRoot, subtoolCmd, subtoolExtraArgs);
-    this.outputZip = outputZip;
-    this.bundleRoot = bundleRoot;
-    this.subtoolCmd = subtoolCmd;
-    this.subtoolExtraArgs = subtoolExtraArgs;
-  }
-
-  public String outputZip() {
-    return outputZip;
-  }
-
-  public String bundleRoot() {
-    return bundleRoot;
-  }
-
-  public String subtoolCmd() {
-    return subtoolCmd;
-  }
-
-  public ImmutableList<String> subtoolExtraArgs() {
-    return subtoolExtraArgs;
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/ArgumentsParsing.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/ArgumentsParsing.java
deleted file mode 100644
index 06e0ae6..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/ArgumentsParsing.java
+++ /dev/null
@@ -1,99 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.zippingoutput;
-
-import com.google.common.base.Optional;
-import com.google.common.collect.ImmutableList;
-import com.google.devtools.build.xcode.util.Value;
-
-import java.nio.file.FileSystem;
-import java.nio.file.Files;
-import java.util.Locale;
-
-/**
- * Arguments passed to the do-something-then-zip wrapper tool.
- */
-class ArgumentsParsing extends Value<ArgumentsParsing> {
-
-  private final Optional<String> error;
-  private final Optional<Arguments> arguments;
-
-  private ArgumentsParsing(Optional<String> error, Optional<Arguments> arguments) {
-    super(error, arguments);
-    this.error = error;
-    this.arguments = arguments;
-  }
-
-  public Optional<String> error() {
-    return error;
-  }
-
-  public Optional<Arguments> arguments() {
-    return arguments;
-  }
-
-  private static final int MIN_ARGS = 3;
-
-  /**
-   * @param args raw arguments passed to wrapper tool through the {@code main} method
-   * @param subtoolName name of the subtool, such as "actool"
-   * @return an instance based on results of parsing the given arguments.
-   */
-  public static ArgumentsParsing parse(FileSystem fileSystem, String[] args, String wrapperName,
-      String subtoolName) {
-    String capitalizedSubtool = subtoolName.toUpperCase(Locale.US);
-    if (args.length < MIN_ARGS) {
-      return new ArgumentsParsing(Optional.of(String.format(
-              "Expected at least %1$d args.\n"
-                  + "Usage: java %2$s OUTZIP ARCHIVEROOT (%3$s_CMD %3$s ARGS)\n"
-                  + "Runs %4$s and zips the results.\n"
-                  + "OUTZIP - the path to place the output zip file.\n"
-                  + "ARCHIVEROOT - the path in the zip to place the output, or an empty\n"
-                  + "    string for the root of the zip. e.g. 'Payload/foo.app'. If\n"
-                  + "    this tool outputs a single file, ARCHIVEROOT is the name of\n"
-                  + "    the only file in the zip file.\n"
-                  + "%3$s_CMD - path to the subtool.\n"
-                  + "    e.g. /Applications/Xcode.app/Contents/Developer/usr/bin/actool\n"
-                  + "%3$s ARGS - the arguments to pass to %4$s besides the\n"
-                  + "    one that specifies the output directory.\n",
-              MIN_ARGS, wrapperName, capitalizedSubtool, subtoolName)),
-          Optional.<Arguments>absent());
-    }
-    String outputZip = args[0];
-    String archiveRoot = args[1];
-    String subtoolCmd = args[2];
-    if (archiveRoot.startsWith("/")) {
-      return new ArgumentsParsing(
-          Optional.of(String.format("Archive root cannot start with /: '%s'\n", archiveRoot)),
-          Optional.<Arguments>absent());
-    }
-
-    // TODO(bazel-team): Remove this hack when the released version of Bazel uses the correct momc
-    // path for device builds.
-    subtoolCmd = subtoolCmd.replace("/iPhoneOS.platform/", "/iPhoneSimulator.platform/");
-    if (!Files.isRegularFile(fileSystem.getPath(subtoolCmd))) {
-      return new ArgumentsParsing(
-          Optional.of(String.format(
-              "The given %s_CMD does not exist: '%s'\n", capitalizedSubtool, subtoolCmd)),
-          Optional.<Arguments>absent());
-    }
-    return new ArgumentsParsing(
-        Optional.<String>absent(),
-        Optional.<Arguments>of(
-            new Arguments(
-                outputZip, archiveRoot, subtoolCmd,
-                ImmutableList.copyOf(args).subList(MIN_ARGS, args.length))));
-  }
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrapper.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrapper.java
deleted file mode 100644
index 975cf72..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrapper.java
+++ /dev/null
@@ -1,55 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.zippingoutput;
-
-/**
- * Defines a zipping wrapper for a tool. A wrapper is a tool that runs some subcommand that writes
- * its output (usually multiple files in a non-trivial directory structure) to some directory, and
- * then zips the output of that subtool into a timestamp-less zip file whose location is specified
- * on the command line.
- * <p>
- * The arguments passed are passed in this form:
- * <pre>
- * java {wrapper_name} OUTZIP ARCHIVEROOT (SUBTOOL_CMD SUBTOOL ARGS)
- * </pre>
- * Where SUBTOOL ARGS are the arguments to pass to SUBTOOL_CMD unchanged, except the argument that
- * specifies the output directory. Note that the arguments are positional and do not use flags in
- * the form of -f or --foo, except for those flags passed directly to and interpreted by the
- * subtool itself.
- * <p>
- * A wrapper has some simple metadata the name of the wrapped tool
- * and how to transform {@link Arguments} passed to the wrapper tool into arguments for the subtool.
- */
-public interface Wrapper {
-  /** The name of the wrapper, such as {@code ActoolZip}. */
-  String name();
-
-  /** The subtool name, such as {@code actool}. */
-  String subtoolName();
-
-  /**
-   * Returns the command (i.e. argv), including the executable file, to be executed.
-   * @param arguments the parsed arguments passed to the wrapper tool
-   * @param outputDirectory the output directory which the subtool should write tool
-   */
-  Iterable<String> subCommand(Arguments arguments, String outputDirectory);
-
-  /**
-   * Indicates whether the output directory must exist before invoking the wrapped tool, this being
-   * dependent on the nature of the tool only. Note that the directory immediately containing the
-   * output directory is guaranteed to always exist, regardless of this method's return value.
-   */
-  boolean outputDirectoryMustExist();
-}
diff --git a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrappers.java b/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrappers.java
deleted file mode 100644
index 7d4df04..0000000
--- a/src/tools/xcode-common/java/com/google/devtools/build/xcode/zippingoutput/Wrappers.java
+++ /dev/null
@@ -1,161 +0,0 @@
-// Copyright 2014 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package com.google.devtools.build.xcode.zippingoutput;
-
-import com.google.common.collect.ImmutableList;
-import com.google.common.io.CharStreams;
-import com.google.devtools.build.singlejar.ZipCombiner;
-import com.google.devtools.build.xcode.zip.ZipInputEntry;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.InputStreamReader;
-import java.io.OutputStream;
-import java.nio.charset.StandardCharsets;
-import java.nio.file.FileSystem;
-import java.nio.file.FileSystems;
-import java.nio.file.Files;
-import java.nio.file.Path;
-import java.nio.file.Paths;
-
-import javax.annotation.Nullable;
-
-/** Utility code for working with {@link Wrapper}s. */
-public class Wrappers {
-  private Wrappers() {
-    throw new UnsupportedOperationException("static-only");
-  }
-
-  /**
-   * Executes the command specified by argsArray and wrapper, writing the output directly to this
-   * Java process's stdout/stderr. Calling this method should be the last thing you do in
-   * {@code main}, because it may exit prematurely with {@link System#exit(int)}.
-   */
-  public static void executePipingOutput(String[] argsArray, Wrapper wrapper)
-      throws IOException, InterruptedException {
-    try {
-      execute(argsArray, wrapper, true);
-    } catch (CommandFailedException e) {
-      handleException(e);
-    }
-  }
-
-  /**
-   * Runs the given wrapper using command-line arguments passed to the {@code main} method, and
-   * returns the stdout and stderr of the process.
-   *
-   * @throws CommandFailedException if the command did not successfully run
-   */
-  public static OutErr executeCapturingOutput(String[] argsArray, Wrapper wrapper)
-      throws CommandFailedException, IOException, InterruptedException {
-    return execute(argsArray, wrapper, false);
-  }
-
-  /**
-   * Outputs stdout and stderr, then exits with a non-zero status code.
-   */
-  public static void handleException(CommandFailedException e) {
-    e.outErr.print();
-    System.err.print(e.getMessage());
-    System.exit(1);
-  }
-
-  @Nullable
-  private static OutErr execute(String[] argsArray, Wrapper wrapper, boolean printOutput)
-      throws CommandFailedException, IOException, InterruptedException {
-    FileSystem filesystem = FileSystems.getDefault();
-    ArgumentsParsing argsParsing = ArgumentsParsing.parse(
-        filesystem, argsArray, wrapper.name(), wrapper.subtoolName());
-    for (String error : argsParsing.error().asSet()) {
-      throw new CommandFailedException(error, OutErr.empty());
-    }
-    if (!argsParsing.arguments().isPresent()) {
-      throw new IllegalStateException("No arguments or error present");
-    }
-    Arguments args = argsParsing.arguments().get();
-    Path tempDir = getTempDir(filesystem);
-    Path outputDir = Files.createTempDirectory(tempDir, "ZippingOutput");
-    Path rootedOutputDir = outputDir.resolve(args.bundleRoot());
-    Files.createDirectories(
-        wrapper.outputDirectoryMustExist() ? rootedOutputDir : rootedOutputDir.getParent());
-
-    ImmutableList<String> subCommandArguments =
-        ImmutableList.copyOf(wrapper.subCommand(args, rootedOutputDir.toString()));
-    ProcessBuilder processBuilder = new ProcessBuilder(subCommandArguments);
-    if (printOutput) {
-      processBuilder = processBuilder.inheritIO();
-    }
-    Process subProcess = processBuilder.start();
-    int exit = subProcess.waitFor();
-    OutErr outErr = new OutErr(
-        streamToString(subProcess.getInputStream()),
-        streamToString(subProcess.getErrorStream()));
-    if (exit != 0) {
-      throw new CommandFailedException("", outErr);
-    }
-
-    try (OutputStream out = Files.newOutputStream(Paths.get(args.outputZip()));
-        ZipCombiner combiner = new ZipCombiner(out)) {
-      ZipInputEntry.addAll(combiner, ZipInputEntry.fromDirectory(outputDir));
-    }
-    return outErr;
-  }
-
-  private static String streamToString(InputStream stream) throws IOException {
-    return CharStreams.toString(new InputStreamReader(stream, StandardCharsets.UTF_8));
-  }
-
-  private static Path getTempDir(FileSystem filesystem) {
-    String tempDir = System.getenv("TMPDIR");
-    if (tempDir == null) {
-      tempDir = "/tmp";
-    }
-    return filesystem.getPath(tempDir);
-  }
-
-  /** Thrown if command exception fails for some reason. */
-  public static class CommandFailedException extends Exception {
-    private OutErr outErr;
-
-    public CommandFailedException(String message, OutErr outErr) {
-      super(message);
-      this.outErr = outErr;
-    }
-
-    public OutErr outErr() {
-      return outErr;
-    }
-  }
-
-  /** Stdout and stderr of a process. */
-  public static class OutErr {
-    public final String stdout;
-    public final String stderr;
-
-    public OutErr(String stdout, String stderr) {
-      this.stdout = stdout;
-      this.stderr = stderr;
-    }
-
-    public static OutErr empty() {
-      return new OutErr("", "");
-    }
-
-    public void print() {
-      System.out.print(stdout);
-      System.err.print(stderr);
-    }
-  }
-}
diff --git a/third_party/iossim/BUILD b/third_party/iossim/BUILD
deleted file mode 100644
index 047c588..0000000
--- a/third_party/iossim/BUILD
+++ /dev/null
@@ -1,3 +0,0 @@
-licenses(["notice"])  # 3-clause BSD
-
-exports_files(["iossim"])
diff --git a/third_party/iossim/LICENSE b/third_party/iossim/LICENSE
deleted file mode 100644
index dbf5128..0000000
--- a/third_party/iossim/LICENSE
+++ /dev/null
@@ -1,27 +0,0 @@
-// Copyright (c) 2013 The Chromium Authors. All rights reserved.
-//
-// Redistribution and use in source and binary forms, with or without
-// modification, are permitted provided that the following conditions are
-// met:
-//
-//    * Redistributions of source code must retain the above copyright
-// notice, this list of conditions and the following disclaimer.
-//    * Redistributions in binary form must reproduce the above
-// copyright notice, this list of conditions and the following disclaimer
-// in the documentation and/or other materials provided with the
-// distribution.
-//    * Neither the name of Google Inc. nor the names of its
-// contributors may be used to endorse or promote products derived from
-// this software without specific prior written permission.
-//
-// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
-// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
-// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
-// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
-// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
\ No newline at end of file
diff --git a/third_party/iossim/iossim b/third_party/iossim/iossim
deleted file mode 100755
index 4dc6ac4..0000000
--- a/third_party/iossim/iossim
+++ /dev/null
@@ -1,75 +0,0 @@
-                      H   __PAGEZERO                                                        h  __TEXT                  p               p            
-       __text          __TEXT               V?                                 __stubs         __TEXT          fR            fR                         __stub_helper   __TEXT          S     (      S                           __const         __TEXT          8T            8T                             __objc_methname __TEXT          HT     y	      HT                             __cstring       __TEXT          ]           ]                             __objc_classname__TEXT          lj     3       lj                             __objc_methtype __TEXT          j            j                             __unwind_info   __TEXT          xk     \       xk                             __eh_frame      __TEXT          k     (      k                                  __DATA           p              p                           __program_vars  __DATA           p     (        p                             __nl_symbol_ptr __DATA          (p            (p                           __got           __DATA          8p             8p                           __la_symbol_ptr __DATA          Xp            Xp                "           __const         __DATA          8q     0       8q                             __cfstring      __DATA          hq           hq                             __objc_classlist__DATA          y            y                            __objc_protolist__DATA          y            y                             __objc_imageinfo__DATA          y            y                             __objc_const    __DATA           z     P       z                             __objc_selrefs  __DATA          P|           P|                           __objc_classrefs__DATA                                                  __objc_superrefs__DATA                                                  __objc_ivar     __DATA               0                                    __objc_data     __DATA               P                                    __data          __DATA               X                                    __common        __DATA          `                                           __bss           __DATA               	                                        H   __LINKEDIT             0             (*                    "  0                               p                      P                   6                           (  >                             /usr/lib/dyld             RPQ8
-s$       
-  	
-          *                                                                                                                                                                           `             ,/System/Library/Frameworks/Foundation.framework/Versions/C/Foundation      8           <    /usr/lib/libstdc++.6.dylib         8            /usr/lib/libSystem.B.dylib         h          W   /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation      8               /usr/lib/libobjc.A.dylib        &        8   )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    j HHH}HuHHHH9 uH  ]?  UHHPHEL\  M	LMH}HuHUHMLEHMHMHl  HMH5h  Hh?  HEH}    f   HEH5h  H=?  HuH=l  H>HEH5yh  H?  HuH=l  H>HEH5Wh  H>  HuH=l  H>H\  HMH H;EHM
-   HEHP]5>  ffff.     UHH0H[  H HEH}HuHEH5l  H0H5g  Hv>  HEH5k  H0H5g  HX>  HEH5k  H0H5g  H:>  H}HEHEHk  HEH5g  >  HF[  H H;E   H0]n=  fD  UHH   H[  H HEH}HuHUHj  H5-g  H=  H5f  H=  HEHj  HUH5k  H2H5f  H=  HET  <   HEH5f  H[=  H5f  HL=  H5f  H==  H5[  HEHEH=f  H}HHEHuHHU=  1H5f  H<  H5f  H<  HcHUH}   y   HEH5Hf  H<  H5if  H<  H5bf  H<  HEHEHuH=j  H>H5Df  H~<  HEHqi  HUH5e  H`<  HE    HNi  H5f  HA<  HEHEHi  <    Hi  H5e  H<  H5Ye  H<  HEHEHuH=e  H}HHuHE;  H5e  H}H;  <  Hh  H5e  H;  HEH5e  H;  VHEHMH5Re  HHxu;  H5De  HxHH\;  HEH57e  HI;  HxX  H H;E	   H   ]:  D  UHH0HIX  H HE=i      9  Hqi  ri  H=_i      	   E    H1Y  HBi  H5Sd  HH:  HEHEH5qg  H:  H=   	   E >   1HMH5d  Ho:  H5>g  H`:  HEH}   AADEHwW  MH H;EM   EH0]9  ff.     UHH`H9W  H HEH}HuHUHEHg  H<    R   HEHZg  HHW  H5xc  H9  HEHf  HUH5c  H9  HMH'g  H1HUH5g  H2HuH=]c  H}HHUHuHHUHMLED9  HEHEH53c  H-9  H=       HEHE   HEHEH;V  HMH H;EHM
-   HEH`]W8  ffffff.     UHHpLU  M	LMH}HuHUELE}   He  H5b  H8  HEHEHuH=e  H>H5wb  Ha8  < M   HEHe   HEHUH5Qb  H38  E1DHEHUH5<b  H8     7  HEH5'b  H7  HuH=b  H}HHuHE7  HuH=b  H}HHuHE7  H5:V  HHuHUH         67  HEH+e  Hd  H5`  Hk7  HMH5va  H}Ha  H}HHuHHHMLE77  HMHd  HHEHd  HH5Xa  H
-7  H9T  H H;E   Hp]a6  f     UHH  )) ))))))HLLHHxHpa   ()P()`()p()]()e()m( )u()}HHHHH@HH8HxH0HpH(LLMLR  MLULEL MALEMAAA0   A   Lb  H5^  Lq5  HMHUH5b  HZ5  H5i`  HK5  HR  HEH9Hc  HEH5`  HhHH`5  H5K  HhH`H 4  H-R  H9\4  HR  HUH	H;MXHP	   H  ]$4  fff.     UHH  HQ  H HEb< }  H=J   >4  H=MW  D
-$  HpHpHpH5_  H8H14  H5_  H8H4  1@   H}Hh3  HhH5_  3  HUH8A   H5m^  HH03  H=    H(  1HUH   HuH6H(H HHHHHHH2H H9>H H   H0H13  HEHHH`H8`  H`H5_  H 3  H`H5x^  H2  H5_  H2  HX  H57]  HHHI 2  HXHXH5g^  H2  H=[H  H P2  HH   H H9HHHUH8   AH5\  H0)2  E1DH=    HH    x  H=G   1  H=U  !  1@   HHP1  HPH5{^  1  HHxA   H5+\  HH1  H=    HG  1HH   HH6HHHHHHHHH2HH9>HH   H0  H HHHHHHH5YZ  0  H5\  H0  H=F  H v0  HH   HH9HHAHHx   AH5Z  HL0  E1DH=    HH    H=F   /  H=F   /  H=F   /  H=F   /  H=%F   /  H=4F   /  H=*F   q/  H='F   ]/  |HL  H H;E	   H  ].   UHH  H}HuHUHMHMH\   HMH\  H<           HEH\  HH5RY  H.  < 4   #   0  H[  H5X  H.  HEHh\  HH5X  H.  HEHJ\  H    H}    "  HEH5X  Hs.  HEHEHL  H5X  HU.  HEHEHUH5X  H:.  < b   HuHEHQX  HHpH.  HMH5<X  HHh-  HL  HHpHhH S	  g   HuHEHW  HH`H-  HMH5W  HHX-  HTL  HH`HXH    -      E HEH5V  HM-  H5V  H>-  H5V  H/-  H5K  HEHEH=V  HPHHPHHHHH,  1H5V  H,  H5~V  H,  HcHUH}   a     3,  H57  H7  a   HEH},  H}HUH5V  H@H<m,     H7  H@ 1,  =       H#K  H Q   +  H57     HUH}+  H57  H7     H}8|+  1Hu4c+  HEH}b+  HEH=    _   H5O7  H}*+  H5J  HxHxHH 
-  H597  Hxm+  H=       E  3<    HEH5T  H:+  H5T  H++  H5T  H+  H5;J  HhHhH=T  H(HH(H HH *  Hpg   HJ  HW  HUH5"U  HHHH *  H`HEHX  HH`H53T  Hm*  HpHuW  H5^T  HP*  HXHXHpH5BT  H,*  < Y     1AH/W  HpH=yT  HHHHHH)  HPHPHV  H5>T  HH )  H50T  H HH)  HHHV  HMH5S  HHp)  HH  H5S  HHH L)     H(H5H  H=H  H@H(H0HDV  H5S  H)  HH`A   E1A@   DH8HHHHHHLHq(  HHH55S  HHHHLHx(  H=    Hl  1HH   HH6HHHHHHHHH2HH9>HH   HH'  HHHH H H@H5QR  H'  HHPHXH9P  HH   A1@   HHHL'  H8H5Q  HHHHLHx'  H=    Hpy  1HH   HH6HpHhH`HXHPHPHXH`H2HhH9>HHH@   HxHz&  HH@HHHH HHH5P  HJ&  HHxHH9x!   HE  H H   E~       H@H   HHH9HPHXHH   AH5MP  Hx%  E1DH=    HXHP    }               HH   HH9HHHH`   AH5O  H%  E1DH=    HH    HpH5O  H$  H$  <   HD  HpH 1       }    HD  H    /$  1($  UHH  )) ))))))HLLHHxHpa   ()P()`()p()]()e()m( )u()}HHHHH@HH8HxH0HpH(LLML@  MLULEL MALEMAAA0   A   L>P  H5L  L#  HMHUH5O  H"  H5	N  H"  H"@  HEH9H,Q  HEH5N  HhHH`"  H58  HhH`H H"  H?  H9\-"  H?  HUH	H;MXHP	   H  ]!  fff.     UHHHi?  H HE<        HI?  H H;E   H]q!  f     UHH  H?  H HEE    }HuHN  H5+K  H!  H5J  H!  HE[HEH8y!  HEH}$!  HEH}    +   H}Q!  HEH}       HEHO      H}    	   H}   HE    HE    HE    HRA  H+A  < HEHMHE    H"N  H5K  H   HEHN  H5K  H   !  HEEK	  HEH}       H@  H    &   H}
-  HxHx       H@  H l     Hi-  }Hu  t=  tr=       H  HH  HHcHu       t      sT      H<  HL  HH5J  HX  HE5  H<  H_L  HH5I  H/  HE  H5L  H5I  H  H5O<  HH>HH  H5I  HHHH  HE  H<  HK  HH5mI  H  HF?  HhHhH5)I  HH  HHXH`H9X    H?  H h
-       HhHXH5H  H  HPHhHXH   H5H  H  HHHEHHHPH=H  HHHHHH     H:  H82  DD       *DE*   HO>  H:  H1H s	       '   1  	  1  	       H\:  ;M   HJ  H5F  H  H54:  Hc>HMHHcHuH<HH  H5|G  HHHH  HEHEH5tG  H  HEH9     ;MT   H9  HMHtI  Hc HuHH5G  HHH2  H5G  HHH      H=  H        H}  H8H8       H<  HuH    U  H}	  H0H0    $   H<  HuH      H<  HI
-  H=<  H(H(H5D  HHH)  H H    <    H<  H
-  HHH5E    HuH=E  HHHHHH  H=    $   Hb<  HuH    %     H}       H:  H}H
-  < '      HG  H5DE  H6  Hf   H	<  H}HE
-  < '      HIG  H5E  H  H   H;  HuH    o          H}    5   H}f
-  <    H;  HuH    '  	     HEH8H0H H HELELLULxIHxLpILpL$LT$
-  HHTF  H5mB  H  H HMLEH5C  H  H5C  H  H H u  HMHHHEH5C  H   *   HE  H5C  Ha  H5C  HR     HEH5hB  H:  HuH=]B  HhHHhH`  HuH==B  HXHHXHP  H5):  HH`HPH HEH5A  H  H4  H H;E      H  ]  ?eeYeeeM     UHH`H4  H HEHD  H5lC  H6  H5eC  H'  H5f<  HEHEH=OC  H}HHEHuHHU  HEHEH5@  H  H=       HEHE      HUH5:<  HuH5C  H=0A  H}HHu  H;  HH.  HEHEHC  H5B  HHE^  H5B  HMHHH  HEHEH57@  H1  H=       HE    HEHEHD3  HMH H;EHM
-   HEH`]`       UHH   H3  H HEH}HEH4  H5q?  H  HEHB  HUH5?  H  HEHEH5A  Hv  <    HE      HEH3  H5?  HG  HEHJB  HUH5?  H)  HEHEH58A  H  <    HE    k  H\9  H  H}HEHEH5A  H}HHU  < 4   HEH5>  H  H5/9  HH HE       h< |   HA9  H9  HMHEHEHUH5>  HU  HEHXA  HUH5->  H7  HEHEH5F@  H   <    HE    y      H8  HEHEHUH5=  H  HEH@  HUH5=  H  HEHEH5?  H  <    HE       HEHEH0  HMH H;EHx   HxH   ]  fff.     UHHH5#     Hu0  Hf0  H	HMH8   HN0  H	H;ME   H]s  ff.     UHH0H	7  H0  H	HMH}Hw  HEHEH5>  H  < D   H?  H5<  H  H5>  H  HEHEHUH50<  Hj  HEHEH5i>  HS  HEH^?  H5G<  H9  HEHEHUH54<  H  <    HU6  HuH      H}HEH5=  H  H/  HH;UHE
-   HEH0]/      UHH0H5  H.  H	HMH}H7  HEH}H5h=  u  HEH}       H}HEH5J=  HL  HEHw.  HMH H;EHM
-   HEH0]  ff.     UHH0H9.  H HEH}c  HUH5:  H  HEHEH5<  H  H  HEH}       HE       H=  HUH5N;  H  HEH-  HMH H;EHM
-   HEH0]      UHH Hy-  H HEH}H}  HEH}       H3  HuH &     H--  HMH H;EHM
-   HEH ]I  UHH@H,  H HEH}HuHE	   HEHUHMH5;  H  H,  HHEHUH9uAAHH;EDE   EH@]       UHH0Hi,  H HEH}H}  < 	   E    H=M-  HEH5:  H}H     H}H  =:   H=-  HEH5:  H}H     H}H  =   H1  H E    EH+  MH H;EM   EH0]  ffffff.     UHSH  HELUL0  HV+  HH]H HHHL LLHLHHH527    H57  H  H58  H  HHH H58  H}  HHH58  H`  H/  HH58  HH@  HHH58  H#  HHH5l8  H  HH H5W8  H  HHH5B8  H  HHH5-8  H  HHH58  H  k< 
-  H$.  H$HHH5W7  \  HH=L7  HHHHxHHx'  H.  HHHHH57  H  H5{7  H  HHH5f7    HH56  H  H.  HHMHHHH5!7  HpHt  H57  HpH^  1@   H}HH    
-  HH56  '  HUH0A   H55  HHh   H=    H`c  1HUH   HuH6H`HXHPHHH@H@HHHPH2HXH9>H8H0   HhHi
-  HEH0HHHH55  F
-  HH96   HH55  #
-  HH9   HH{       H0H   H8H9H@HHHUH0   AH5L4  Hh	  E1DH=    HHH@    H       Hs,  H(    Hy6  HH53  HH(HH( 2	  H(HHHHHL4  H LHHL L  HH(    "   H+  H(H    F      HHH5L4  HH{  H%  HH H;EH   HH  []  UHH0H*  Hb%  H	HMH}HHEH}H5x1    H5L1  H  H53  H  HEHEHMH5
-3  HH  H$  HMH H;EHM
-   HEH0]  fff.     UHH  H$  H HEH H4  H5j1  H\  H5*  H=*  H*  1AHHb4  L3  HHHLHHHHL   HMH8A   E1A@   DHHHHHHHLH`  HH5$1  HHHHLHg  H=    H  1HUH   HuH6HHHHHHHHH2HH9>HH   HH  HEHHHH HH5i/  H     E1L0H HH H5V1  Hp  < N   H H0Hy/  HHHA  H )  HHH D/        HH   HH9HHHUH8   AH5f/  H  E1DH=    HH    /H!  /H H;E   H  ]  ffffff.     UHH`Hy!  H HEH}HuH1  H5-  H  H5e-  H  H5/  H   HEHEHUH5C0  H  HEHUH540  H  H51  H5&0  H  HEHEHUH50  H  HEH50  H  HEHEH5/  Hs  HEH56-  H`  HEHEH5/  HI  HEH5/  H6  < M   H(  HuHMH/  HHuHH  H(  HHuH HE       HEH5t/  H  =    g   H(  HuHMHC/  HHuHH  HMH5./  HHE  Hc(  HHuHU HE    F       Hn/  H5+  HA     HUH5.  H)  H58-  H  HEHE  HMH H;EHM
-   HEH`]a  f     UHH`   HUH5N(  H=  H?H}HuH5.  H=6,  H}HHu  H'  HH4HEH.  HUH5N.  Hh  H(  E1DHEHEH52.  HHUHHM9  EHMHQ.  H5+  HHM  HMH5-  HUHH   E} "   H'  HuH HE       HEHEH  HMH H;EHM
-   HEH`]   %  %  %  %  %  %  %  %  %  %  %   %  %  %  %  %
-  %  %  %  %  %  %  %  %  %  %  %   %"    L  AS%	  h    h   h0   hL   hd   hs   h   h   h   h   h   h   xh   nh   dh  Zh  Ph+  Fh:  <hJ  2hY  (hh  hw  h  
-h   h  h  h  h  ?      >@init copy release dealloc alloc fileHandleForReadingAtPath: sessionConfig simulatedSystemRoot sdkVersion componentsSeparatedByString: objectAtIndex: intValue device dataPath stringByAppendingPathComponent: fileHandleWithStandardOutput readDataToEndOfFile writeData: sleepForTimeInterval: drain bundleWithPath: localizedStringForKey:value:table: length defaultManager fileExistsAtPath: tailOutputForSession: session:didEndWithError: localizedDescription domain code initWithTarget:selector:object: start isFinished localizedSimulatorErrorString: isEqual: simulatedApplicationPID stringWithFormat: stringWithContentsOfFile:encoding:error: newlineCharacterSet componentsSeparatedByCharactersInSet: arrayWithObjects:count: countByEnumeratingWithState:objects:count: rangeOfString: fileSystemRepresentation session:didStart:withError: initWithStdioPath:developerDir:simulatorHome: stdioPath_ developerDir_ simulatorHome_ outputThread_ simulatorBundle_ appRunning_ array dictionary stringWithUTF8String: stringWithFileSystemRepresentation:length: substringToIndex: substringFromIndex: setObject:forKey: lastPathComponent addObject: supportedDeviceTypesByName objectForKeyedSubscript: numberWithInt: autorelease requestStartWithConfig:timeout:error: mainRunLoop run setDelegate: setApplicationToSimulateOnStart: setSimulatedSystemRoot: setLocalizedClientName: setSimulatedApplicationStdErrPath: setSimulatedApplicationStdOutPath: setSimulatedApplicationLaunchArgs: setSimulatedApplicationLaunchEnvironment: setSimulatedDeviceInfoName: setSimulatedDeviceFamily: runtime identifier supportedRuntimesByIdentifier defaultSetPath setForSetPath: availableDevices deviceType createDeviceWithType:runtime:name:error: setDevice: UTF8String arrayWithObjects: createDirectoryAtPath:withIntermediateDirectories:attributes:error: rangeOfString:options: defaultRoot rootWithSDKVersion: isAbsolutePath currentDirectoryPath stringByStandardizingPath specifierWithApplicationPath: load loadAllPlatformsReturningError: processInfo environment objectForKey: whitespaceAndNewlineCharacterSet stringByTrimmingCharactersInSet: setLaunchPath: setArguments: pipe setStandardOutput: fileHandleForReading launch waitUntilExit isRunning componentsJoinedByString: terminationStatus initWithData:encoding: initWithFormat:arguments: name versionString knownRoots count integerValue scannerWithString: scanString:intoString: scanUpToCharactersFromSet:intoString: . Simulator failed to start: "%@" (%@:%ld) Ignoring that Simulator ended with: "%@" (%@:%ld) Simulator ended with error: "%@" (%@:%ld) Sender launchd %d Failed to get [session simulatedApplicationPID] RefPID Time -1m Message Console message: %s The following job tried to hijack the service Library/Logs/system.log Library/Logs/iOS Simulator/%@/system.log Service exited with abnormal code: Service exited due to signal: Console message: %@ Unable to find system log at '%@'. Simulated app crashed or exited with non-zero status iPhone 5 iPhone Unable to find developer directory. Failed to load the Simulator Framework. hs:d:u:e:t:l = Invalid key=value argument for -e. Invalid startup timeout (%s). Unable to parse command line arguments. Invalid app path: %@ Invalid SDK version: %@ iossim-XXXXXX stdio.txt SimDeviceType Invalid device name: %@. iPad Invalid device name: %@. Must begin with 'iPhone' or 'iPad' Unable to initialize home directory for simulator: %@ Simulator failed request to start:  "%@" (%@:%ld) DTiPhoneSimulatorSession DTiPhoneSimulatorSessionConfig chromium SimRuntime SimDeviceSet iossim - %@  Failed to create device: %@ Unable to set environment variables for home directory. HOME CFFIXED_USER_HOME Documents Library/Caches Library/Preferences Unable to create directory: %@. Error: %@ Failed to find class %@ at runtime. DTiPhoneSimulatorSystemRoot DTiPhoneSimulatorApplicationSpecifier File not found: %@ Usage: iossim [-d device] [-s sdkVersion] [-u homeDir] [-e envKey=value]* [-t startupTimeout] <appPath> [<appArgs>]
-  where <appPath> is the path to the .app directory and appArgs are any arguments to send the simulated app.
-
-Options:
-  -d  Specifies the device (must be one of the values from the iOS Simulator's Hardware -> Device menu. Defaults to 'iPhone'.
-  -s  Specifies the SDK version to use (e.g '4.3'). Will use system default if not specified.
-  -u  Specifies a user home directory for the simulator. Will create a new directory if not specified.
-  -e  Specifies an environment key=value pair that will be set in the simulated application's environment.
-  -t  Specifies the session startup timeout (in seconds). Defaults to %d.
-  -l  List supported devices and iOS versions.
- DVTPlatform Unable to loadAllPlatformsReturningError. Error: %@ ../SharedFrameworks/DVTiPhoneSimulatorRemoteClient.framework Library/PrivateFrameworks/CoreSimulator.framework Platforms/iPhoneSimulator.platform/Developer/Library/PrivateFrameworks/DVTiPhoneSimulatorRemoteClient.framework ../OtherFrameworks/DevToolsFoundation.framework ../SharedFrameworks/DVTFoundation.framework DEVELOPER_DIR /usr/bin/xcode-select -print-path Task '%@ %@' is still running.   Task '%@ %@' exited with return code %d. iossim %s: WARNING: %s
- The simulated application quit. Supported device/SDK combinations:
-   -d '%@' -s '%@'
- %s Supported SDK versions:
-   '%s'
- Supported devices:
-   'iPhone'
-   'iPhone Retina (3.5-inch)'
-   'iPhone Retina (4-inch)'
-   'iPhone Retina (4-inch 64-bit)'
-   'iPad'
-   'iPad Retina'
-   'iPad Retina (64-bit)'
- %s: ERROR: %s
- Platforms/iPhoneSimulator.platform/Developer/Applications/iPhone Simulator.app /usr/bin/xcodebuild -version Xcode  Unable to find Xcode version. 'xcodebuild -version' returned 
-%@ SimulatorDelegate DTiPhoneSimulatorSessionDelegate v32@0:8@16@24 v32@0:8@"DTiPhoneSimulatorSession"16@"NSError"24 v36@0:8@16c24@28 v36@0:8@"DTiPhoneSimulatorSession"16c24@"NSError"28 @40@0:8@16@24@32 v16@0:8 v24@0:8@16 @24@0:8@16 @"NSString" @"NSThread" @"NSBundle" c                              8   8   gR      8             @   1 7                  zR x  $      X        AC       $   D   0        AC       $   l          AC       $      p       AC       $      X1       AC       $      p       AC       $     84       AC       $   4  P=       AC       $   \  h
-       AC       $      4       AC       $     8G        AC       $     `d
-       AC       $     x       AC       $   $          AC       $   L  U        AC       $   t  9       AC       $             AC       $     P        AC       $             AC       $     @        AC       $   <          AC       $   d         ACH    $     X        AC       $     1       AC       $     g       AC       $     @F       AC              `     h     p     x                                                      S     *S     4S     >S     HS     RS     \S     fS     pS     zS     S     S     S     S     S     S     S     S     S     S     S     S     S     T     T     T     $T     .T     Hy     y     zb     ub     (x     x                   ]                          ]     (                     ]     1                     ^     )                     Z^     /                     ^                          ^                          ^     (                     W^                          %_     "                     H_                          f_                          z_     "                     _     4                     _                          _                          _     #                     `     '                     ;`                          =`     "                     ``                          ~`     '                     `                          `                          `                          `     	                     `                          `                          a                          a     ;                     Sa     5                     a     1                     a                          a                          a                          a     
-                     b                          b                          !b                          =b     7                     b     	                     b                          b                          b     )                     b     #                     c                          #c     %                     Ic                          of                          {f     3                     f     <                     f     1                     g     o                     g     /                     g     +                     g                          g                          h                          h                          9h                          ;h     (                     |h                          h                          i     N                     j                          j                          $j                          +j     @                               U     j             jW     j             j     j                            (   (               lj             Hz                                   W     #k     P     ZT     4k     P     U     <k          JV     Gk          jW     j     0     U     j     #                 W     Rk                W     Rk                W     Rk                W     ^k                W     jk                W     vk                  1               lj     z     Hz     @{                     HT     MT     RT     ZT     bT     hT     T     T     T     T     T     T     T     T     T     U     3U     GU     RU     hU     nU     ~U     U     U     U     U     U     U     V     V     V     9V     ?V     JV     iV     rV     V     V     V     V     V     W     BW     QW     X     X     X     .X     YX     kX     X     X     X     X     X     X     W     X     X     #Y     /Y     3Y     @Y     aY     yY     Y     Y     Y     Y     $Z     @Z     ZZ     bZ     mZ     Z     Z     Z     Z     Z     Z     Z     [     [     Z[     q[     }[     [     [     [     [     [     [     \     \     *\     8\     Y\     z\     \     \     \     \     \     \     \     \     \     ]     &]     @]     E]     S]     ^]     d]     q]     ]     ]                                                                                                                                                                    (       0                                            |                                     `z             ~j              z                                     P       8z     dh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     @_OBJC_CLASS_$_NSAutoreleasePool Qr@_OBJC_CLASS_$_NSBundle @_OBJC_CLASS_$_NSCharacterSet @_OBJC_CLASS_$_NSFileHandle @_OBJC_CLASS_$_NSFileManager @_OBJC_CLASS_$_NSNumber (@_OBJC_CLASS_$_NSPipe  @_OBJC_CLASS_$_NSProcessInfo @_OBJC_CLASS_$_NSScanner @_OBJC_CLASS_$_NSString @_OBJC_CLASS_$_NSTask @@_OBJC_CLASS_$_NSThread @___stack_chk_guard @___stderrp @_optarg @_optind @dyld_stub_binder @_OBJC_CLASS_$_NSArray  @_OBJC_CLASS_$_NSMutableArray @_OBJC_CLASS_$_NSMutableDictionary @_OBJC_CLASS_$_NSObject x@_OBJC_CLASS_$_NSRunLoop @_OBJC_METACLASS_$_NSObject @___CFConstantStringClassReference C@__objc_empty_cache @__objc_empty_vtable      rX@_NSClassFromString  r`@_NSHomeDirectory  rh@_NSTemporaryDirectory  rp@___stack_chk_fail  rx@_asl_get  r@_asl_new  r@_asl_search  r@_asl_set_query  r@_aslresponse_next  r@_atoi  r@_basename  r@_exit  r@_fflush  r@_fprintf  r@_free  r@_getopt  r@_memset  r@_mkdtemp  r@_printf  r@_remove  r@_setenv  r@_snprintf  r@_strdup  r@_strlen  r@_strstr  r@_objc_enumerationMutation  r@_objc_msgSend  r@_objc_msgSendSuper2     _ start E _ !NXArg Jenviron ^ mh_execute_header A_progname d    &  c Rv X              &@
-P`        d           O   d           Y   f zdT       .  P        $  P                      $             N            .  P       $  P        $             N            .       7  $          $            N           .       b  $          $            N           .         $          $   @         N  @         .  0       $  0        $            N           .          $           $   @         N  @         .  `        $  `        $   @         N  @         .  #     L  $  #        $   
-         N  
-         .  .     z  $  .        $   @         N  @         .  0       $  0        $   P          N  P          .  1       $  1        $   
-         N  
-         .  ;       $  ;        $            N           .   =       $   =        $            N           .  ?     2  $  ?        $   `          N  `          .  @     S  $  @        $   @         N  @         .  PA       $  PA        $             N            .  A       $  A        $             N            .  B       $  B        $             N            .  0C       $  0C        $             N            .  C     N  $  C        $             N            .  D       $  D        $             N            .  J     )  $  J        $             N            .  pK     _  $  pK        $   @         N  @         .  N       $  N        $   p         N  p         .   Q       $   Q        $   F         N  F        &  8q     !  &  @q     Q  &  Hq     |  &  Pq       &  Xq       &  `q     
-              4              a                                                                      7              [  &  X     y  &         &          d              P     @	    P     ]	         	         	         	    0     
-          F
-    `     r
-    #     
-    .     
-    0     
-    1     
-    ;     "     =     X    ?     y    @         PA         A         B     6    0C     t    C         D     O    J         pK         N          Q          p     !    8q     N    @q     ~    Hq         Pq         Xq         `q     7         a                                             D         d             X                       *    `     2    h     :    x     F          Z    p     c         i            |                                                                                    (            D            a                                                                                                )            >            U            p                                                                                                                                    (            .            8            >            F            O            U            ]            e            n                                                                                                                                                                                                                                                      @                                                                                                  /Users/lliabraa/chromium/src/out/Debug-iphonesimulator/../../testing/iossim/ iossim.mm /Users/lliabraa/chromium/src/out/Debug-iphonesimulator/obj.host/testing/iossim/iossim.iossim.o -[SimulatorDelegate initWithStdioPath:developerDir:simulatorHome:] ../../testing/iossim/iossim.mm -[SimulatorDelegate dealloc] -[SimulatorDelegate tailOutputForSession:] __ZN12_GLOBAL__N_126IsRunningWithXcode6OrLaterEv -[SimulatorDelegate localizedSimulatorErrorString:] -[SimulatorDelegate session:didStart:withError:] __ZN12_GLOBAL__N_18LogErrorEP8NSStringz __ZN12_GLOBAL__N_121PrintSupportedDevicesEv -[SimulatorDelegate session:didEndWithError:] __ZN12_GLOBAL__N_110LogWarningEP8NSStringz __Z35EnsureSupportForCurrentXcodeVersionv _main __ZN12_GLOBAL__N_116FindDeveloperDirEv __ZN12_GLOBAL__N_122LoadSimulatorFrameworkEP8NSString __ZN12_GLOBAL__N_110PrintUsageEv __ZN12_GLOBAL__N_112BuildAppSpecEP8NSString __ZN12_GLOBAL__N_115BuildSystemRootEP8NSString __ZN12_GLOBAL__N_119CreateTempDirectoryEP8NSString __ZN12_GLOBAL__N_115FindClassByNameEP8NSString __ZN12_GLOBAL__N_127CaseInsensitivePrefixSearchEP8NSStringS1_ __ZN12_GLOBAL__N_127InitializeSimulatorUserHomeEP8NSString __ZN12_GLOBAL__N_118BuildSessionConfigEP37DTiPhoneSimulatorApplicationSpecifierP27DTiPhoneSimulatorSystemRootP8NSStringS5_P7NSArrayP12NSDictionaryP8NSNumberS5_ __ZN12_GLOBAL__N_112BuildSessionEP17SimulatorDelegate __ZN12_GLOBAL__N_120CreateHomeDirSubDirsEP8NSString __ZN12_GLOBAL__N_117GetOutputFromTaskEP8NSStringP7NSArray __ZN12_GLOBAL__N_116FindXcodeVersionEv __ZN12_GLOBAL__N_1L22kSimulatorRelativePathE __ZN12_GLOBAL__N_1L25kSimulatorAppQuitErrorKeyE __ZN12_GLOBAL__N_1L20kUserHomeEnvVariableE __ZN12_GLOBAL__N_1L16kHomeEnvVariableE __ZN12_GLOBAL__N_1L26kDVTFoundationRelativePathE __ZN12_GLOBAL__N_1L31kDevToolsFoundationRelativePathE _OBJC_IVAR_$_SimulatorDelegate.stdioPath_ _OBJC_IVAR_$_SimulatorDelegate.developerDir_ _OBJC_IVAR_$_SimulatorDelegate.simulatorHome_ _OBJC_IVAR_$_SimulatorDelegate.simulatorBundle_ _OBJC_IVAR_$_SimulatorDelegate.appRunning_ _OBJC_IVAR_$_SimulatorDelegate.outputThread_ _OBJC_CLASS_$_SimulatorDelegate _OBJC_METACLASS_$_SimulatorDelegate __ZN12_GLOBAL__N_19gToolNameE __ZZN12_GLOBAL__N_126IsRunningWithXcode6OrLaterEvE12xcodeVersion __ZGVZN12_GLOBAL__N_126IsRunningWithXcode6OrLaterEvE12xcodeVersion -[SimulatorDelegate initWithStdioPath:developerDir:simulatorHome:] -[SimulatorDelegate dealloc] -[SimulatorDelegate tailOutputForSession:] __ZN12_GLOBAL__N_126IsRunningWithXcode6OrLaterEv -[SimulatorDelegate localizedSimulatorErrorString:] -[SimulatorDelegate session:didStart:withError:] __ZN12_GLOBAL__N_18LogErrorEP8NSStringz __ZN12_GLOBAL__N_121PrintSupportedDevicesEv -[SimulatorDelegate session:didEndWithError:] __ZN12_GLOBAL__N_110LogWarningEP8NSStringz __Z35EnsureSupportForCurrentXcodeVersionv _main __ZN12_GLOBAL__N_116FindDeveloperDirEv __ZN12_GLOBAL__N_122LoadSimulatorFrameworkEP8NSString __ZN12_GLOBAL__N_110PrintUsageEv __ZN12_GLOBAL__N_112BuildAppSpecEP8NSString __ZN12_GLOBAL__N_115BuildSystemRootEP8NSString __ZN12_GLOBAL__N_119CreateTempDirectoryEP8NSString __ZN12_GLOBAL__N_115FindClassByNameEP8NSString __ZN12_GLOBAL__N_127CaseInsensitivePrefixSearchEP8NSStringS1_ __ZN12_GLOBAL__N_127InitializeSimulatorUserHomeEP8NSString __ZN12_GLOBAL__N_118BuildSessionConfigEP37DTiPhoneSimulatorApplicationSpecifierP27DTiPhoneSimulatorSystemRootP8NSStringS5_P7NSArrayP12NSDictionaryP8NSNumberS5_ __ZN12_GLOBAL__N_112BuildSessionEP17SimulatorDelegate __ZN12_GLOBAL__N_120CreateHomeDirSubDirsEP8NSString __ZN12_GLOBAL__N_117GetOutputFromTaskEP8NSStringP7NSArray __ZN12_GLOBAL__N_116FindXcodeVersionEv _pvars __ZN12_GLOBAL__N_1L22kSimulatorRelativePathE __ZN12_GLOBAL__N_1L25kSimulatorAppQuitErrorKeyE __ZN12_GLOBAL__N_1L20kUserHomeEnvVariableE __ZN12_GLOBAL__N_1L16kHomeEnvVariableE __ZN12_GLOBAL__N_1L26kDVTFoundationRelativePathE __ZN12_GLOBAL__N_1L31kDevToolsFoundationRelativePathE _OBJC_IVAR_$_SimulatorDelegate.stdioPath_ _OBJC_IVAR_$_SimulatorDelegate.developerDir_ _OBJC_IVAR_$_SimulatorDelegate.simulatorHome_ _OBJC_IVAR_$_SimulatorDelegate.simulatorBundle_ _OBJC_IVAR_$_SimulatorDelegate.appRunning_ _OBJC_IVAR_$_SimulatorDelegate.outputThread_ _OBJC_CLASS_$_SimulatorDelegate _OBJC_METACLASS_$_SimulatorDelegate __ZN12_GLOBAL__N_19gToolNameE __ZZN12_GLOBAL__N_126IsRunningWithXcode6OrLaterEvE12xcodeVersion __ZGVZN12_GLOBAL__N_126IsRunningWithXcode6OrLaterEvE12xcodeVersion _NXArgc _NXArgv ___progname __mh_execute_header _environ start _NSClassFromString _NSHomeDirectory _NSTemporaryDirectory _OBJC_CLASS_$_NSArray _OBJC_CLASS_$_NSAutoreleasePool _OBJC_CLASS_$_NSBundle _OBJC_CLASS_$_NSCharacterSet _OBJC_CLASS_$_NSFileHandle _OBJC_CLASS_$_NSFileManager _OBJC_CLASS_$_NSMutableArray _OBJC_CLASS_$_NSMutableDictionary _OBJC_CLASS_$_NSNumber _OBJC_CLASS_$_NSObject _OBJC_CLASS_$_NSPipe _OBJC_CLASS_$_NSProcessInfo _OBJC_CLASS_$_NSRunLoop _OBJC_CLASS_$_NSScanner _OBJC_CLASS_$_NSString _OBJC_CLASS_$_NSTask _OBJC_CLASS_$_NSThread _OBJC_METACLASS_$_NSObject ___CFConstantStringClassReference ___stack_chk_fail ___stack_chk_guard ___stderrp __objc_empty_cache __objc_empty_vtable _asl_get _asl_new _asl_search _asl_set_query _aslresponse_next _atoi _basename _exit _fflush _fprintf _free _getopt _memset _mkdtemp _objc_enumerationMutation _objc_msgSend _objc_msgSendSuper2 _optarg _optind _printf _remove _setenv _snprintf _strdup _strlen _strstr dyld_stub_binder    
\ No newline at end of file
diff --git a/third_party/java/buck-ios-support/LICENSE b/third_party/java/buck-ios-support/LICENSE
deleted file mode 100644
index d645695..0000000
--- a/third_party/java/buck-ios-support/LICENSE
+++ /dev/null
@@ -1,202 +0,0 @@
-
-                                 Apache License
-                           Version 2.0, January 2004
-                        http://www.apache.org/licenses/
-
-   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
-
-   1. Definitions.
-
-      "License" shall mean the terms and conditions for use, reproduction,
-      and distribution as defined by Sections 1 through 9 of this document.
-
-      "Licensor" shall mean the copyright owner or entity authorized by
-      the copyright owner that is granting the License.
-
-      "Legal Entity" shall mean the union of the acting entity and all
-      other entities that control, are controlled by, or are under common
-      control with that entity. For the purposes of this definition,
-      "control" means (i) the power, direct or indirect, to cause the
-      direction or management of such entity, whether by contract or
-      otherwise, or (ii) ownership of fifty percent (50%) or more of the
-      outstanding shares, or (iii) beneficial ownership of such entity.
-
-      "You" (or "Your") shall mean an individual or Legal Entity
-      exercising permissions granted by this License.
-
-      "Source" form shall mean the preferred form for making modifications,
-      including but not limited to software source code, documentation
-      source, and configuration files.
-
-      "Object" form shall mean any form resulting from mechanical
-      transformation or translation of a Source form, including but
-      not limited to compiled object code, generated documentation,
-      and conversions to other media types.
-
-      "Work" shall mean the work of authorship, whether in Source or
-      Object form, made available under the License, as indicated by a
-      copyright notice that is included in or attached to the work
-      (an example is provided in the Appendix below).
-
-      "Derivative Works" shall mean any work, whether in Source or Object
-      form, that is based on (or derived from) the Work and for which the
-      editorial revisions, annotations, elaborations, or other modifications
-      represent, as a whole, an original work of authorship. For the purposes
-      of this License, Derivative Works shall not include works that remain
-      separable from, or merely link (or bind by name) to the interfaces of,
-      the Work and Derivative Works thereof.
-
-      "Contribution" shall mean any work of authorship, including
-      the original version of the Work and any modifications or additions
-      to that Work or Derivative Works thereof, that is intentionally
-      submitted to Licensor for inclusion in the Work by the copyright owner
-      or by an individual or Legal Entity authorized to submit on behalf of
-      the copyright owner. For the purposes of this definition, "submitted"
-      means any form of electronic, verbal, or written communication sent
-      to the Licensor or its representatives, including but not limited to
-      communication on electronic mailing lists, source code control systems,
-      and issue tracking systems that are managed by, or on behalf of, the
-      Licensor for the purpose of discussing and improving the Work, but
-      excluding communication that is conspicuously marked or otherwise
-      designated in writing by the copyright owner as "Not a Contribution."
-
-      "Contributor" shall mean Licensor and any individual or Legal Entity
-      on behalf of whom a Contribution has been received by Licensor and
-      subsequently incorporated within the Work.
-
-   2. Grant of Copyright License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      copyright license to reproduce, prepare Derivative Works of,
-      publicly display, publicly perform, sublicense, and distribute the
-      Work and such Derivative Works in Source or Object form.
-
-   3. Grant of Patent License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      (except as stated in this section) patent license to make, have made,
-      use, offer to sell, sell, import, and otherwise transfer the Work,
-      where such license applies only to those patent claims licensable
-      by such Contributor that are necessarily infringed by their
-      Contribution(s) alone or by combination of their Contribution(s)
-      with the Work to which such Contribution(s) was submitted. If You
-      institute patent litigation against any entity (including a
-      cross-claim or counterclaim in a lawsuit) alleging that the Work
-      or a Contribution incorporated within the Work constitutes direct
-      or contributory patent infringement, then any patent licenses
-      granted to You under this License for that Work shall terminate
-      as of the date such litigation is filed.
-
-   4. Redistribution. You may reproduce and distribute copies of the
-      Work or Derivative Works thereof in any medium, with or without
-      modifications, and in Source or Object form, provided that You
-      meet the following conditions:
-
-      (a) You must give any other recipients of the Work or
-          Derivative Works a copy of this License; and
-
-      (b) You must cause any modified files to carry prominent notices
-          stating that You changed the files; and
-
-      (c) You must retain, in the Source form of any Derivative Works
-          that You distribute, all copyright, patent, trademark, and
-          attribution notices from the Source form of the Work,
-          excluding those notices that do not pertain to any part of
-          the Derivative Works; and
-
-      (d) If the Work includes a "NOTICE" text file as part of its
-          distribution, then any Derivative Works that You distribute must
-          include a readable copy of the attribution notices contained
-          within such NOTICE file, excluding those notices that do not
-          pertain to any part of the Derivative Works, in at least one
-          of the following places: within a NOTICE text file distributed
-          as part of the Derivative Works; within the Source form or
-          documentation, if provided along with the Derivative Works; or,
-          within a display generated by the Derivative Works, if and
-          wherever such third-party notices normally appear. The contents
-          of the NOTICE file are for informational purposes only and
-          do not modify the License. You may add Your own attribution
-          notices within Derivative Works that You distribute, alongside
-          or as an addendum to the NOTICE text from the Work, provided
-          that such additional attribution notices cannot be construed
-          as modifying the License.
-
-      You may add Your own copyright statement to Your modifications and
-      may provide additional or different license terms and conditions
-      for use, reproduction, or distribution of Your modifications, or
-      for any such Derivative Works as a whole, provided Your use,
-      reproduction, and distribution of the Work otherwise complies with
-      the conditions stated in this License.
-
-   5. Submission of Contributions. Unless You explicitly state otherwise,
-      any Contribution intentionally submitted for inclusion in the Work
-      by You to the Licensor shall be under the terms and conditions of
-      this License, without any additional terms or conditions.
-      Notwithstanding the above, nothing herein shall supersede or modify
-      the terms of any separate license agreement you may have executed
-      with Licensor regarding such Contributions.
-
-   6. Trademarks. This License does not grant permission to use the trade
-      names, trademarks, service marks, or product names of the Licensor,
-      except as required for reasonable and customary use in describing the
-      origin of the Work and reproducing the content of the NOTICE file.
-
-   7. Disclaimer of Warranty. Unless required by applicable law or
-      agreed to in writing, Licensor provides the Work (and each
-      Contributor provides its Contributions) on an "AS IS" BASIS,
-      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
-      implied, including, without limitation, any warranties or conditions
-      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
-      PARTICULAR PURPOSE. You are solely responsible for determining the
-      appropriateness of using or redistributing the Work and assume any
-      risks associated with Your exercise of permissions under this License.
-
-   8. Limitation of Liability. In no event and under no legal theory,
-      whether in tort (including negligence), contract, or otherwise,
-      unless required by applicable law (such as deliberate and grossly
-      negligent acts) or agreed to in writing, shall any Contributor be
-      liable to You for damages, including any direct, indirect, special,
-      incidental, or consequential damages of any character arising as a
-      result of this License or out of the use or inability to use the
-      Work (including but not limited to damages for loss of goodwill,
-      work stoppage, computer failure or malfunction, or any and all
-      other commercial damages or losses), even if such Contributor
-      has been advised of the possibility of such damages.
-
-   9. Accepting Warranty or Additional Liability. While redistributing
-      the Work or Derivative Works thereof, You may choose to offer,
-      and charge a fee for, acceptance of support, warranty, indemnity,
-      or other liability obligations and/or rights consistent with this
-      License. However, in accepting such obligations, You may act only
-      on Your own behalf and on Your sole responsibility, not on behalf
-      of any other Contributor, and only if You agree to indemnify,
-      defend, and hold each Contributor harmless for any liability
-      incurred by, or claims asserted against, such Contributor by reason
-      of your accepting any such warranty or additional liability.
-
-   END OF TERMS AND CONDITIONS
-
-   APPENDIX: How to apply the Apache License to your work.
-
-      To apply the Apache License to your work, attach the following
-      boilerplate notice, with the fields enclosed by brackets "[]"
-      replaced with your own identifying information. (Don't include
-      the brackets!)  The text should be enclosed in the appropriate
-      comment syntax for the file format. We also recommend that a
-      file or class name and description of purpose be included on the
-      same "printed page" as the copyright notice for easier
-      identification within third-party archives.
-
-   Copyright [yyyy] [name of copyright owner]
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-   you may not use this file except in compliance with the License.
-   You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-   Unless required by applicable law or agreed to in writing, software
-   distributed under the License is distributed on an "AS IS" BASIS,
-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-   See the License for the specific language governing permissions and
-   limitations under the License.
diff --git a/third_party/java/buck-ios-support/README b/third_party/java/buck-ios-support/README
deleted file mode 100644
index 2799abe..0000000
--- a/third_party/java/buck-ios-support/README
+++ /dev/null
@@ -1,15 +0,0 @@
-URL: https://github.com/facebook/buck/tarball/2ff4f45a971776afcfbe88333d78c4ca6bf03df9
-Version: 2ff4f45a971776afcfbe88333d78c4ca6bf03df9
-License: Apache 2.0
-License File: LICENSE
-
-Description:
-Buck: An Android (and Java!) build tool
-
-This copy is stripped down to only include the files needed for Xcode project generation, specifically:
-com/facebook/buck/apple/{FileTypes,xcode/{xcodeproj/**,GidGenerator,XcodeprojSerializer}}.java
-
-Local Modifications:
-Add FILE_REFERENCE(2) to the PBXContainerItemProxy.ProxyType enum.
-Update LastUpgradeCheck from 600 to 610
-Add logic to automatically detect XCVersionGroup type even if there is no currentVersion set
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/FileTypes.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/FileTypes.java
deleted file mode 100644
index 1ea0c04..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/FileTypes.java
+++ /dev/null
@@ -1,121 +0,0 @@
-/*
- * Copyright 2014-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple;
-
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableMultimap;
-import com.google.common.collect.ImmutableSet;
-
-/**
- * File types used in Apple targets.
- */
-public final class FileTypes {
-
-  // Utility class. Do not instantiate.
-  private FileTypes() { }
-
-  /**
-   * Map of file extension to Apple UTI (Uniform Type Identifier).
-   */
-  public static final ImmutableMap<String, String> FILE_EXTENSION_TO_UTI =
-      ImmutableMap.<String, String>builder()
-          .put("a", "archive.ar")
-          .put("app", "wrapper.application")
-          .put("appex", "wrapper.app-extension")
-          .put("bdic", "file")
-          .put("bin", "archive.macbinary")
-          .put("bmp", "image.bmp")
-          .put("bundle", "wrapper.cfbundle")
-          .put("c", "sourcecode.c.c")
-          .put("cc", "sourcecode.cpp.cpp")
-          .put("cpp", "sourcecode.cpp.cpp")
-          .put("css", "text.css")
-          .put("cxx", "sourcecode.cpp.cpp")
-          .put("dart", "sourcecode")
-          .put("dylib", "compiled.mach-o.dylib")
-          .put("exp", "sourcecode.exports")
-          .put("framework", "wrapper.framework")
-          .put("fsh", "sourcecode.glsl")
-          .put("gyp", "sourcecode")
-          .put("gypi", "text")
-          .put("h", "sourcecode.c.h")
-          .put("hxx", "sourcecode.cpp.h")
-          .put("icns", "image.icns")
-          .put("java", "sourcecode.java")
-          .put("jar", "archive.jar")
-          .put("jpeg", "image.jpeg")
-          .put("jpg", "image.jpeg")
-          .put("js", "sourcecode.javascript")
-          .put("json", "text.json")
-          .put("m", "sourcecode.c.objc")
-          .put("mm", "sourcecode.cpp.objcpp")
-          .put("nib", "wrapper.nib")
-          .put("o", "compiled.mach-o.objfile")
-          .put("octest", "wrapper.cfbundle")
-          .put("pdf", "image.pdf")
-          .put("pl", "text.script.perl")
-          .put("plist", "text.plist.xml")
-          .put("pm", "text.script.perl")
-          .put("png", "image.png")
-          .put("proto", "text")
-          .put("py", "text.script.python")
-          .put("r", "sourcecode.rez")
-          .put("rez", "sourcecode.rez")
-          .put("rtf", "text.rtf")
-          .put("s", "sourcecode.asm")
-          .put("storyboard", "file.storyboard")
-          .put("strings", "text.plist.strings")
-          .put("tif", "image.tiff")
-          .put("tiff", "image.tiff")
-          .put("tcc", "sourcecode.cpp.cpp")
-          .put("ttf", "file")
-          .put("vsh", "sourcecode.glsl")
-          .put("xcassets", "folder.assetcatalog")
-          .put("xcconfig", "text.xcconfig")
-          .put("xcodeproj", "wrapper.pb-project")
-          .put("xcdatamodel", "wrapper.xcdatamodel")
-          .put("xcdatamodeld", "wrapper.xcdatamodeld")
-          .put("xctest", "wrapper.cfbundle")
-          .put("xib", "file.xib")
-          .put("y", "sourcecode.yacc")
-          .put("zip", "archive.zip")
-          .build();
-
-  /**
-   * Set of UTIs which only work as "lastKnownFileType" and not "explicitFileType"
-   * in a PBXFileReference.
-   *
-   * Yes, really. Because Xcode.
-   */
-  public static final ImmutableSet<String> EXPLICIT_FILE_TYPE_BROKEN_UTIS =
-    ImmutableSet.of("file.xib");
-
-  /**
-   * Multimap of Apple UTI (Uniform Type Identifier) to file extension(s).
-   */
-  public static final ImmutableMultimap<String, String> UTI_TO_FILE_EXTENSIONS;
-
-  static {
-    // Invert the map of (file extension -> UTI) pairs to
-    // (UTI -> [file extension 1, ...]) pairs.
-    ImmutableMultimap.Builder<String, String> builder = ImmutableMultimap.builder();
-    for (ImmutableMap.Entry<String, String> entry : FILE_EXTENSION_TO_UTI.entrySet()) {
-      builder.put(entry.getValue(), entry.getKey());
-    }
-    UTI_TO_FILE_EXTENSIONS = builder.build();
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/GidGenerator.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/GidGenerator.java
deleted file mode 100644
index 03395a0..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/GidGenerator.java
+++ /dev/null
@@ -1,50 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode;
-
-import com.google.common.collect.Sets;
-
-import java.util.Set;
-
-/**
- * Generator for Global ID (GID) which are present on every xcode project object.
- *
- * The GID is a 96 bit identifier that's unique on a per-project basis.
- */
-public class GidGenerator {
-  private final Set<String> generatedAndReservedIds;
-
-  public GidGenerator(Set<String> reservedIds) {
-    generatedAndReservedIds = Sets.newHashSet(reservedIds);
-  }
-
-  /**
-   * Generate a stable GID based on the class name and hash of some object info.
-   *
-   * GIDs generated this way will be in the form of
-   *  {@code <class-name-hash-32> <obj-hash-32> <counter-32>}
-   */
-  public String generateGid(String pbxClassName, int hash) {
-    int counter = 0;
-    String gid;
-    do {
-      gid = String.format("%08X%08X%08X", pbxClassName.hashCode(), hash, counter++);
-    } while (generatedAndReservedIds.contains(gid));
-    generatedAndReservedIds.add(gid);
-    return gid;
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/XcodeprojSerializer.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/XcodeprojSerializer.java
deleted file mode 100644
index b43081f..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/XcodeprojSerializer.java
+++ /dev/null
@@ -1,140 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode;
-
-import com.dd.plist.NSArray;
-import com.dd.plist.NSDictionary;
-import com.dd.plist.NSObject;
-import com.dd.plist.NSString;
-import com.facebook.buck.log.Logger;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXObject;
-import com.facebook.buck.apple.xcode.xcodeproj.PBXProject;
-
-import java.util.List;
-
-import javax.annotation.concurrent.NotThreadSafe;
-
-/**
- * Serializer that handles conversion of an in-memory object graph representation of an xcode
- * project (instances of {@link PBXObject}) into an Apple property list.
- *
- * Serialization proceeds from the root object, a ${link PBXProject} instance, to all of its
- * referenced objects. Each object being visited calls back into this class ({@link #addField}) to
- * populate the plist representation with its fields.
- */
-@NotThreadSafe
-public class XcodeprojSerializer {
-  private static final Logger LOG = Logger.get(XcodeprojSerializer.class);
-
-  private final PBXProject rootObject;
-  private final NSDictionary objects;
-  private final GidGenerator gidGenerator;
-  private NSDictionary currentObject;
-
-  public XcodeprojSerializer(GidGenerator gidGenerator, PBXProject project) {
-    rootObject = project;
-    objects = new NSDictionary();
-    this.gidGenerator = gidGenerator;
-  }
-
-  /**
-   * Generate a plist serialization of project bound to this serializer.
-   */
-  public NSDictionary toPlist() {
-    serializeObject(rootObject);
-
-    NSDictionary root = new NSDictionary();
-    root.put("archiveVersion", "1");
-    root.put("classes", new NSDictionary());
-    root.put("objectVersion", "46");
-    root.put("objects", objects);
-    root.put("rootObject", rootObject.getGlobalID());
-
-    return root;
-  }
-
-  /**
-   * Serialize a {@link PBXObject} and its recursive descendants into the object dictionary.
-   *
-   * @return the GID of the serialized object
-   *
-   * @see PBXObject#serializeInto
-   */
-  private String serializeObject(PBXObject obj) {
-    if (obj.getGlobalID() == null) {
-      obj.setGlobalID(obj.generateGid(gidGenerator));
-      LOG.verbose("Set new object GID: %s", obj);
-    } else {
-      // Check that the object has already been serialized.
-      NSObject object = objects.get(obj.getGlobalID());
-      if (object != null) {
-        LOG.verbose("Object %s found, returning existing object %s", obj, object);
-        return obj.getGlobalID();
-      } else {
-        LOG.verbose("Object already had GID set: %s", obj);
-      }
-    }
-
-    // Save the existing object being deserialized.
-    NSDictionary stack = currentObject;
-
-    currentObject = new NSDictionary();
-    currentObject.put("isa", obj.isa());
-    obj.serializeInto(this);
-    objects.put(obj.getGlobalID(), currentObject);
-
-    // Restore the existing object being deserialized.
-    currentObject = stack;
-    return obj.getGlobalID();
-  }
-
-  public void addField(String name, PBXObject obj) {
-    if (obj != null) {
-      String gid = serializeObject(obj);
-      currentObject.put(name, gid);
-    }
-  }
-
-  public void addField(String name, int val) {
-    currentObject.put(name, val);
-  }
-
-  public void addField(String name, String val) {
-    if (val != null) {
-      currentObject.put(name, val);
-    }
-  }
-
-  public void addField(String name, boolean val) {
-    currentObject.put(name, val);
-  }
-
-  public void addField(String name, List<? extends PBXObject> objectList) {
-    NSArray array = new NSArray(objectList.size());
-    for (int i = 0; i < objectList.size(); i++) {
-      String gid = serializeObject(objectList.get(i));
-      array.setValue(i, new NSString(gid));
-    }
-    currentObject.put(name, array);
-  }
-
-  public void addField(String name, NSObject v) {
-    if (v != null) {
-      currentObject.put(name, v);
-    }
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXAggregateTarget.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXAggregateTarget.java
deleted file mode 100644
index 1e66010..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXAggregateTarget.java
+++ /dev/null
@@ -1,31 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-/**
- * Target backed by shell scripts or nothing (only specifying dependencies).
- */
-public class PBXAggregateTarget extends PBXTarget {
-  public PBXAggregateTarget(String name, ProductType productType) {
-    super(name, productType);
-  }
-
-  @Override
-  public String isa() {
-    return "PBXAggregateTarget";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildFile.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildFile.java
deleted file mode 100644
index cdab5b6..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildFile.java
+++ /dev/null
@@ -1,80 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.dd.plist.NSDictionary;
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-
-/**
- * File referenced by a build phase, unique to each build phase.
- *
- * Contains a dictionary {@link #settings} which holds additional information to be interpreted by
- * the particular phase referencing this object, e.g.:
- *
- *  - {@link PBXHeadersBuildPhase } may read <code>{"ATTRIBUTES": ["Public"]}</code> and interpret
- *    the build file as a public (exported) header.
- *  - {@link PBXSourcesBuildPhase } may read <code>{"COMPILER_FLAGS": "-foo"}</code> and interpret
- *    that this file should be compiled with the additional flag {@code "-foo" }.
- */
-public class PBXBuildFile extends PBXProjectItem {
-  private final PBXReference fileRef;
-  private Optional<NSDictionary> settings;
-
-  public PBXBuildFile(PBXReference fileRef) {
-    this.fileRef = Preconditions.checkNotNull(fileRef);
-    this.settings = Optional.absent();
-  }
-
-  public PBXReference getFileRef() {
-    return fileRef;
-  }
-
-  public Optional<NSDictionary> getSettings() {
-    return settings;
-  }
-
-  public void setSettings(Optional<NSDictionary> v) {
-    settings = v;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXBuildFile";
-  }
-
-  @Override
-  public int stableHash() {
-    return fileRef.stableHash();
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("fileRef", fileRef);
-    if (settings.isPresent()) {
-      s.addField("settings", settings.get());
-    }
-  }
-
-  @Override
-  public String toString() {
-    return String.format("%s fileRef=%s settings=%s", super.toString(), fileRef, settings);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildPhase.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildPhase.java
deleted file mode 100644
index 96d0cd3..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildPhase.java
+++ /dev/null
@@ -1,44 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.collect.Lists;
-
-import java.util.List;
-
-/**
- * Superclass of build phases. Each build phase represents one step in building a target.
- */
-public abstract class PBXBuildPhase extends PBXProjectItem {
-  private final List<PBXBuildFile> files;
-
-  public PBXBuildPhase() {
-    this.files = Lists.newArrayList();
-  }
-
-  public List<PBXBuildFile> getFiles() {
-    return files;
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("files", files);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildStyle.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildStyle.java
deleted file mode 100644
index be572d5..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXBuildStyle.java
+++ /dev/null
@@ -1,61 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.dd.plist.NSDictionary;
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Preconditions;
-
-public class PBXBuildStyle extends PBXProjectItem {
-  private final String name;
-  private NSDictionary buildSettings;
-
-  public PBXBuildStyle(String name) {
-    this.name = Preconditions.checkNotNull(name);
-    this.buildSettings = new NSDictionary();
-  }
-
-  public String getName() {
-    return name;
-  }
-
-  public NSDictionary getBuildSettings() {
-    return buildSettings;
-  }
-
-  public void setBuildSettings(NSDictionary buildSettings) {
-    this.buildSettings = buildSettings;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXBuildStyle";
-  }
-
-  @Override
-  public int stableHash() {
-    return name.hashCode();
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("name", name);
-    s.addField("buildSettings", buildSettings);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainer.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainer.java
deleted file mode 100644
index 6954f7f..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainer.java
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-/**
- * Superclass of all container types. This is here to reflect Xcode's object hierarchy, and does
- * not implement any special functionality.
- */
-public abstract class PBXContainer extends PBXObject {
-  @Override
-  public String isa() {
-    return "PBXContainer";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItem.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItem.java
deleted file mode 100644
index c182b8a..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItem.java
+++ /dev/null
@@ -1,36 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-
-/**
- * Superclass in Xcode's object hierarchy, has no non-structural functionality here.
- */
-public abstract class PBXContainerItem extends PBXObject {
-
-  @Override
-  public String isa() {
-    return "PBXContainerItem";
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItemProxy.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItemProxy.java
deleted file mode 100644
index 72badae..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXContainerItemProxy.java
+++ /dev/null
@@ -1,88 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Preconditions;
-
-/**
- * Reference to another object used by {@link PBXTargetDependency}. Can reference a remote file
- * by specifying the {@link PBXFileReference} to the remote project file, and the GID of the object
- * within that file.
- */
-public class PBXContainerItemProxy extends PBXContainerItem {
-  public enum ProxyType {
-    TARGET_REFERENCE(1),
-    FILE_REFERENCE(2);
-
-    private final int intValue;
-    private ProxyType(int intValue) {
-      this.intValue = intValue;
-    }
-
-    public int getIntValue() {
-      return intValue;
-    }
-  }
-
-  private final PBXFileReference containerPortal;
-  private final String remoteGlobalIDString;
-  private final ProxyType proxyType;
-
-  public PBXContainerItemProxy(
-      PBXFileReference containerPortal,
-      String remoteGlobalIDString,
-      ProxyType proxyType) {
-    Preconditions.checkNotNull(containerPortal);
-    Preconditions.checkNotNull(remoteGlobalIDString);
-    Preconditions.checkNotNull(proxyType);
-    this.containerPortal = containerPortal;
-    this.remoteGlobalIDString = remoteGlobalIDString;
-    this.proxyType = proxyType;
-  }
-
-  public PBXFileReference getContainerPortal() {
-    return containerPortal;
-  }
-
-  public String getRemoteGlobalIDString() {
-    return remoteGlobalIDString;
-  }
-
-  public ProxyType getProxyType() {
-    return proxyType;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXContainerItemProxy";
-  }
-
-  @Override
-  public int stableHash() {
-    return remoteGlobalIDString.hashCode();
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("containerPortal", containerPortal);
-    s.addField("remoteGlobalIDString", remoteGlobalIDString);
-    s.addField("proxyType", proxyType.getIntValue());
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXCopyFilesBuildPhase.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXCopyFilesBuildPhase.java
deleted file mode 100644
index fcf2ed5..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXCopyFilesBuildPhase.java
+++ /dev/null
@@ -1,85 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Preconditions;
-
-public class PBXCopyFilesBuildPhase extends PBXBuildPhase {
-  /**
-   * The prefix path, this does not use SourceTreePath and build variables but rather some sort of
-   * enum.
-   */
-  public enum Destination {
-    ABSOLUTE(0),
-    WRAPPER(1),
-    EXECUTABLES(6),
-    RESOURCES(7),
-    FRAMEWORKS(10),
-    SHARED_FRAMEWORKS(11),
-    SHARED_SUPPORT(12),
-    PLUGINS(13),
-    JAVA_RESOURCES(15),
-    PRODUCTS(16),
-    ;
-
-    private int value;
-
-    public int getValue() {
-      return value;
-    }
-
-    private Destination(int value) {
-      this.value = value;
-    }
-  }
-
-  /**
-   * Base path of destination folder.
-   */
-  private Destination dstSubfolderSpec;
-
-  /**
-   * Subdirectory under the destination folder.
-   */
-  private String path;
-
-  public PBXCopyFilesBuildPhase(Destination dstSubfolderSpec, String path) {
-    this.dstSubfolderSpec = Preconditions.checkNotNull(dstSubfolderSpec);
-    this.path = Preconditions.checkNotNull(path);
-  }
-
-  public Destination getDstSubfolderSpec() {
-    return dstSubfolderSpec;
-  }
-
-  public String getPath() {
-    return path;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXCopyFilesBuildPhase";
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-    s.addField("dstSubfolderSpec", dstSubfolderSpec.getValue());
-    s.addField("dstPath", path);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFileReference.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFileReference.java
deleted file mode 100644
index 50b9144..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFileReference.java
+++ /dev/null
@@ -1,78 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.FileTypes;
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Optional;
-import com.google.common.io.Files;
-
-/**
- * Reference to a concrete file.
- */
-public class PBXFileReference extends PBXReference {
-  private Optional<String> explicitFileType;
-  private Optional<String> lastKnownFileType;
-
-  public PBXFileReference(String name, String path, SourceTree sourceTree) {
-    super(name, path, sourceTree);
-
-    // this is necessary to prevent O(n^2) behavior in xcode project loading
-    String fileType = FileTypes.FILE_EXTENSION_TO_UTI.get(Files.getFileExtension(name));
-    if (FileTypes.EXPLICIT_FILE_TYPE_BROKEN_UTIS.contains(fileType)) {
-      explicitFileType = Optional.absent();
-      lastKnownFileType = Optional.of(fileType);
-    } else {
-      explicitFileType = Optional.fromNullable(fileType);
-      lastKnownFileType = Optional.absent();
-    }
-  }
-
-  public Optional<String> getExplicitFileType() {
-    return explicitFileType;
-  }
-
-  public void setExplicitFileType(Optional<String> explicitFileType) {
-    this.explicitFileType = explicitFileType;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXFileReference";
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    if (explicitFileType.isPresent()) {
-      s.addField("explicitFileType", explicitFileType.get());
-    }
-
-    if (lastKnownFileType.isPresent()) {
-      s.addField("lastKnownFileType", lastKnownFileType.get());
-    }
-  }
-
-  @Override
-  public String toString() {
-    return String.format(
-        "%s explicitFileType=%s",
-        super.toString(),
-        getExplicitFileType());
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFrameworksBuildPhase.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFrameworksBuildPhase.java
deleted file mode 100644
index be4b613..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXFrameworksBuildPhase.java
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-/**
- * Build phase representing the linking step of a target. Contains references to libraries and
- * system frameworks. In library targets, it may alter the include path.
- */
-public class PBXFrameworksBuildPhase extends PBXBuildPhase {
-  @Override
-  public String isa() {
-    return "PBXFrameworksBuildPhase";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXGroup.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXGroup.java
deleted file mode 100644
index dc636b7..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXGroup.java
+++ /dev/null
@@ -1,165 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.cache.CacheBuilder;
-import com.google.common.cache.CacheLoader;
-import com.google.common.cache.LoadingCache;
-import com.google.common.collect.Lists;
-import com.google.common.base.Preconditions;
-
-import java.util.Collections;
-import java.util.Comparator;
-import java.util.List;
-
-import javax.annotation.Nullable;
-
-/**
- * A collection of files in Xcode's virtual filesystem hierarchy.
- */
-public class PBXGroup extends PBXReference {
-  /**
-   * Method by which group contents will be sorted.
-   */
-  public enum SortPolicy {
-      /**
-       * By name, in default Java sort order.
-       */
-      BY_NAME,
-
-      /**
-       * Group contents will not be sorted, and will remain in the
-       * order they were added.
-       */
-      UNSORTED;
-  }
-
-  // Unfortunately, we can't determine this at constructor time, because CacheBuilder
-  // calls our constructor and it's not easy to pass arguments to it.
-  private SortPolicy sortPolicy;
-
-  private final List<PBXReference> children;
-
-  private final LoadingCache<String, PBXGroup> childGroupsByName;
-  private final LoadingCache<String, PBXVariantGroup> childVariantGroupsByName;
-  private final LoadingCache<SourceTreePath, PBXFileReference> fileReferencesBySourceTreePath;
-  private final LoadingCache<SourceTreePath, XCVersionGroup> childVersionGroupsBySourceTreePath;
-
-  public PBXGroup(String name, @Nullable String path, SourceTree sourceTree) {
-    super(name, path, sourceTree);
-
-    sortPolicy = SortPolicy.BY_NAME;
-    children = Lists.newArrayList();
-
-    childGroupsByName = CacheBuilder.newBuilder().build(
-        new CacheLoader<String, PBXGroup>() {
-          @Override
-          public PBXGroup load(String key) throws Exception {
-            PBXGroup group = new PBXGroup(key, null, SourceTree.GROUP);
-            children.add(group);
-            return group;
-          }
-        });
-
-    childVariantGroupsByName = CacheBuilder.newBuilder().build(
-        new CacheLoader<String, PBXVariantGroup>() {
-          @Override
-          public PBXVariantGroup load(String key) throws Exception {
-            PBXVariantGroup group = new PBXVariantGroup(key, null, SourceTree.GROUP);
-            children.add(group);
-            return group;
-          }
-        });
-
-    fileReferencesBySourceTreePath = CacheBuilder.newBuilder().build(
-        new CacheLoader<SourceTreePath, PBXFileReference>() {
-          @Override
-          public PBXFileReference load(SourceTreePath key) throws Exception {
-            PBXFileReference ref = new PBXFileReference(
-                key.getPath().getFileName().toString(),
-                key.getPath().toString(),
-                key.getSourceTree());
-            children.add(ref);
-            return ref;
-          }
-        });
-
-    childVersionGroupsBySourceTreePath = CacheBuilder.newBuilder().build(
-        new CacheLoader<SourceTreePath, XCVersionGroup>() {
-          @Override
-          public XCVersionGroup load(SourceTreePath key) throws Exception {
-            XCVersionGroup ref = new XCVersionGroup(
-                key.getPath().getFileName().toString(),
-                key.getPath().toString(),
-                key.getSourceTree());
-            children.add(ref);
-            return ref;
-          }
-        });
-  }
-
-  public PBXGroup getOrCreateChildGroupByName(String name) {
-    return childGroupsByName.getUnchecked(name);
-  }
-
-  public PBXVariantGroup getOrCreateChildVariantGroupByName(String name) {
-    return childVariantGroupsByName.getUnchecked(name);
-  }
-
-  public PBXFileReference getOrCreateFileReferenceBySourceTreePath(SourceTreePath sourceTreePath) {
-    return fileReferencesBySourceTreePath.getUnchecked(sourceTreePath);
-  }
-
-  public XCVersionGroup getOrCreateChildVersionGroupsBySourceTreePath(
-      SourceTreePath sourceTreePath) {
-    return childVersionGroupsBySourceTreePath.getUnchecked(sourceTreePath);
-  }
-
-  public List<PBXReference> getChildren() {
-    return children;
-  }
-
-  public void setSortPolicy(SortPolicy sortPolicy) {
-    this.sortPolicy = Preconditions.checkNotNull(sortPolicy);
-  }
-
-  public SortPolicy getSortPolicy() {
-    return sortPolicy;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXGroup";
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    if (sortPolicy == SortPolicy.BY_NAME) {
-      Collections.sort(children, new Comparator<PBXReference>() {
-          @Override
-          public int compare(PBXReference o1, PBXReference o2) {
-            return o1.getName().compareTo(o2.getName());
-          }
-        });
-    }
-
-    s.addField("children", children);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXHeadersBuildPhase.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXHeadersBuildPhase.java
deleted file mode 100644
index 3793d2d..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXHeadersBuildPhase.java
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-/**
- * Build phase that copies header files into the output headers directory. Does nothing for binary
- * and test rules.
- */
-public class PBXHeadersBuildPhase extends PBXBuildPhase {
-  @Override
-  public String isa() {
-    return "PBXHeadersBuildPhase";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXNativeTarget.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXNativeTarget.java
deleted file mode 100644
index a99c6b7..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXNativeTarget.java
+++ /dev/null
@@ -1,32 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-/**
- * Concrete target type representing targets built by xcode itself, rather than an external build
- * system.
- */
-public class PBXNativeTarget extends PBXTarget {
-  public PBXNativeTarget(String name, ProductType productType) {
-    super(name, productType);
-  }
-
-  @Override
-  public String isa() {
-    return "PBXNativeTarget";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXObject.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXObject.java
deleted file mode 100644
index d665f75..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXObject.java
+++ /dev/null
@@ -1,67 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.GidGenerator;
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-
-import javax.annotation.Nullable;
-
-public abstract class PBXObject {
-  @Nullable
-  private String globalID;
-
-  @Nullable
-  public String getGlobalID() {
-    return globalID;
-  }
-
-  public void setGlobalID(String gid) {
-    globalID = gid;
-  }
-
-  /**
-   * @return  Type name of the serialized object.
-   */
-  public abstract String isa();
-
-  /**
-   * Populates the serializer with the fields of this object.
-   */
-  public void serializeInto(@SuppressWarnings("unused") XcodeprojSerializer serializer) {
-  }
-
-  /**
-   * This method is used to generate stable GIDs and must be stable for identical contents.
-   * Returning a constant value is ok but will make the generated project order-dependent.
-   */
-  public int stableHash() {
-    return 0;
-  }
-
-  @Override
-  public String toString() {
-    return String.format("%s isa=%s gid=%s", super.toString(), isa(), getGlobalID());
-  }
-
-  /**
-   * Generate a stable GID.
-   */
-  public final String generateGid(GidGenerator generator) {
-    return generator.generateGid(isa(), stableHash());
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProject.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProject.java
deleted file mode 100644
index 1eec5e9..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProject.java
+++ /dev/null
@@ -1,102 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Function;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.Lists;
-import com.google.common.collect.Ordering;
-import com.dd.plist.NSDictionary;
-
-import java.util.Collections;
-import java.util.List;
-
-/**
- * The root object representing the project itself.
- */
-public class PBXProject extends PBXContainer {
-  private String name;
-  private final PBXGroup mainGroup;
-  private final List<PBXTarget> targets;
-  private final XCConfigurationList buildConfigurationList;
-  private final String compatibilityVersion;
-
-  public PBXProject(String name) {
-    this.name = Preconditions.checkNotNull(name);
-    this.mainGroup = new PBXGroup("mainGroup", null, PBXReference.SourceTree.GROUP);
-    this.targets = Lists.newArrayList();
-    this.buildConfigurationList = new XCConfigurationList();
-    this.compatibilityVersion = "Xcode 3.2";
-  }
-
-  public String getName() {
-    return name;
-  }
-
-  public void setName(String v) {
-    name = v;
-  }
-
-  public PBXGroup getMainGroup() {
-    return mainGroup;
-  }
-
-  public List<PBXTarget> getTargets() {
-    return targets;
-  }
-
-  public XCConfigurationList getBuildConfigurationList() {
-    return buildConfigurationList;
-  }
-
-  public String getCompatibilityVersion() {
-    return compatibilityVersion;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXProject";
-  }
-
-  @Override
-  public int stableHash() {
-    return name.hashCode();
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("mainGroup", mainGroup);
-
-    Collections.sort(targets, Ordering.natural().onResultOf(new Function<PBXTarget, String>() {
-      @Override
-      public String apply(PBXTarget input) {
-        return input.getName();
-      }
-    }));
-    s.addField("targets", targets);
-    s.addField("buildConfigurationList", buildConfigurationList);
-    s.addField("compatibilityVersion", compatibilityVersion);
-
-    NSDictionary d = new NSDictionary();
-    d.put("LastUpgradeCheck", "0610");
-
-    s.addField("attributes", d);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProjectItem.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProjectItem.java
deleted file mode 100644
index 2b90034..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXProjectItem.java
+++ /dev/null
@@ -1,24 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-public abstract class PBXProjectItem extends PBXContainerItem {
-  @Override
-  public String isa() {
-    return "PBXProjectItem";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXReference.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXReference.java
deleted file mode 100644
index a7bed6d..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXReference.java
+++ /dev/null
@@ -1,158 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.CharMatcher;
-import com.google.common.base.Optional;
-import com.google.common.base.Preconditions;
-
-import javax.annotation.Nullable;
-
-/**
- * Superclass for file, directories, and groups. Xcode's virtual file hierarchy are made of these
- * objects.
- */
-public class PBXReference extends PBXContainerItem {
-  public enum SourceTree {
-    /**
-     * Relative to the path of the group containing this.
-     */
-    GROUP("<group>"),
-
-    /**
-     * Absolute system path.
-     */
-    ABSOLUTE("<absolute>"),
-    /**
-     * Relative to the build setting {@code BUILT_PRODUCTS_DIR}.
-     */
-    BUILT_PRODUCTS_DIR("BUILT_PRODUCTS_DIR"),
-
-    /**
-     * Relative to the build setting {@code SDKROOT}.
-     */
-    SDKROOT("SDKROOT"),
-
-    /**
-     * Relative to the directory containing the project file {@code SOURCE_ROOT}.
-     */
-    SOURCE_ROOT("SOURCE_ROOT"),
-
-    /**
-     * Relative to the Developer content directory inside the Xcode application
-     * (e.g. {@code /Applications/Xcode.app/Contents/Developer}).
-     */
-    DEVELOPER_DIR("DEVELOPER_DIR"),
-    ;
-
-    private final String rep;
-
-    SourceTree(String str) {
-      rep = str;
-    }
-
-    @Override
-    public String toString() {
-      return rep;
-    }
-
-    /**
-     * Return a sourceTree given a build setting that is typically used as a source tree prefix.
-     *
-     * The build setting may be optionally prefixed by '$' which will be stripped.
-     */
-    public static Optional<SourceTree> fromBuildSetting(String buildSetting) {
-      switch (CharMatcher.is('$').trimLeadingFrom(buildSetting)) {
-        case "BUILT_PRODUCTS_DIR":
-          return Optional.of(BUILT_PRODUCTS_DIR);
-        case "SDKROOT":
-          return Optional.of(SDKROOT);
-        case "SOURCE_ROOT":
-          return Optional.of(SOURCE_ROOT);
-        case "DEVELOPER_DIR":
-          return Optional.of(DEVELOPER_DIR);
-        default:
-          return Optional.absent();
-      }
-    }
-  }
-
-  private final String name;
-  @Nullable private String path;
-
-  /**
-   * The "base" path of the reference. The absolute path is resolved by prepending the resolved
-   * base path.
-   */
-  private SourceTree sourceTree;
-
-  public PBXReference(String name, @Nullable String path, SourceTree sourceTree) {
-    this.name = Preconditions.checkNotNull(name);
-    this.path = path;
-    this.sourceTree = Preconditions.checkNotNull(sourceTree);
-  }
-
-  public String getName() {
-    return name;
-  }
-
-  @Nullable
-  public String getPath() {
-    return path;
-  }
-  public void setPath(String v) {
-    path = v;
-  }
-  public SourceTree getSourceTree() {
-    return sourceTree;
-  }
-  public void setSourceTree(SourceTree v) {
-    sourceTree = v;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXReference";
-  }
-
-  @Override
-  public int stableHash() {
-    return name.hashCode();
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("name", name);
-    if (path != null) {
-      s.addField("path", path);
-    }
-    s.addField("sourceTree", sourceTree.toString());
-  }
-
-  @Override
-  public String toString() {
-    return String.format(
-        "%s name=%s path=%s sourceTree=%s",
-        super.toString(),
-        getName(),
-        getPath(),
-        getSourceTree());
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXResourcesBuildPhase.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXResourcesBuildPhase.java
deleted file mode 100644
index e0fd771..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXResourcesBuildPhase.java
+++ /dev/null
@@ -1,30 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-/**
- * Lists the files to be copied into the output resources directory for the containing
- * {@link PBXTarget}. Has no effect in library rules.
- *
- * A target should contain at most one of this build phase.
- */
-public class PBXResourcesBuildPhase extends PBXBuildPhase {
-  @Override
-  public String isa() {
-    return "PBXResourcesBuildPhase";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXShellScriptBuildPhase.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXShellScriptBuildPhase.java
deleted file mode 100644
index 7192826..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXShellScriptBuildPhase.java
+++ /dev/null
@@ -1,130 +0,0 @@
-/*
- * Copyright 2014-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.dd.plist.NSArray;
-import com.dd.plist.NSString;
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.collect.Lists;
-
-import java.util.List;
-
-import javax.annotation.Nullable;
-
-/**
- * Build phase which represents running a shell script.
- */
-public class PBXShellScriptBuildPhase extends PBXBuildPhase {
-  private List<String> inputPaths;
-  private List<String> outputPaths;
-  @Nullable private String shellPath;
-  @Nullable private String shellScript;
-
-  private static final NSString DEFAULT_SHELL_PATH = new NSString("/bin/sh");
-  private static final NSString DEFAULT_SHELL_SCRIPT = new NSString("");
-
-  public PBXShellScriptBuildPhase() {
-    this.inputPaths = Lists.newArrayList();
-    this.outputPaths = Lists.newArrayList();
-  }
-
-  @Override
-  public String isa() {
-    return "PBXShellScriptBuildPhase";
-  }
-
-  /**
-   * Returns the list (possibly empty) of files passed as input to the shell script.
-   * May not be actual paths, because they can have variable interpolations.
-   */
-  public List<String> getInputPaths() {
-    return inputPaths;
-  }
-
-  /**
-   * Returns the list (possibly empty) of files created as output of the shell script.
-   * May not be actual paths, because they can have variable interpolations.
-   */
-  public List<String> getOutputPaths() {
-    return outputPaths;
-  }
-
-  /**
-   * Returns the path to the shell under which the script is to be executed.
-   * Defaults to "/bin/sh".
-   */
-  @Nullable
-  public String getShellPath() {
-    return shellPath;
-  }
-
-  /**
-   * Sets the path to the shell under which the script is to be executed.
-   */
-  public void setShellPath(String shellPath) {
-    this.shellPath = shellPath;
-  }
-
-  /**
-   * Gets the contents of the shell script to execute under the shell
-   * returned by {@link #getShellPath()}.
-   */
-  @Nullable
-  public String getShellScript() {
-    return shellScript;
-  }
-
-  /**
-   * Sets the contents of the script to execute.
-   */
-  public void setShellScript(String shellScript) {
-    this.shellScript = shellScript;
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    NSArray inputPathsArray = new NSArray(inputPaths.size());
-    for (int i = 0; i < inputPaths.size(); i++) {
-      inputPathsArray.setValue(i, new NSString(inputPaths.get(i)));
-    }
-    s.addField("inputPaths", inputPathsArray);
-
-    NSArray outputPathsArray = new NSArray(outputPaths.size());
-    for (int i = 0; i < outputPaths.size(); i++) {
-      outputPathsArray.setValue(i, new NSString(outputPaths.get(i)));
-    }
-    s.addField("outputPaths", outputPathsArray);
-
-    NSString shellPathString;
-    if (shellPath == null) {
-      shellPathString = DEFAULT_SHELL_PATH;
-    } else {
-      shellPathString = new NSString(shellPath);
-    }
-    s.addField("shellPath", shellPathString);
-
-    NSString shellScriptString;
-    if (shellScript == null) {
-      shellScriptString = DEFAULT_SHELL_SCRIPT;
-    } else {
-      shellScriptString = new NSString(shellScript);
-    }
-    s.addField("shellScript", shellScriptString);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXSourcesBuildPhase.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXSourcesBuildPhase.java
deleted file mode 100644
index 8a43dc7..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXSourcesBuildPhase.java
+++ /dev/null
@@ -1,29 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-/**
- * Lists the files to be compiled for the containing {@link PBXTarget}.
- *
- * A target should contain at most one of this build phase.
- */
-public class PBXSourcesBuildPhase extends PBXBuildPhase {
-  @Override
-  public String isa() {
-    return "PBXSourcesBuildPhase";
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTarget.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTarget.java
deleted file mode 100644
index 0dc5998..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTarget.java
+++ /dev/null
@@ -1,138 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.Lists;
-
-import java.util.List;
-
-import javax.annotation.Nullable;
-
-/**
- * Information for building a specific artifact (a library, binary, or test).
- */
-public abstract class PBXTarget extends PBXProjectItem {
-  public enum ProductType {
-    STATIC_LIBRARY("com.apple.product-type.library.static"),
-    DYNAMIC_LIBRARY("com.apple.product-type.library.dynamic"),
-    TOOL("com.apple.product-type.tool"),
-    BUNDLE("com.apple.product-type.bundle"),
-    FRAMEWORK("com.apple.product-type.framework"),
-    STATIC_FRAMEWORK("com.apple.product-type.framework.static"),
-    APPLICATION("com.apple.product-type.application"),
-    UNIT_TEST("com.apple.product-type.bundle.unit-test"),
-    IN_APP_PURCHASE_CONTENT("com.apple.product-type.in-app-purchase-content"),
-    APP_EXTENSION("com.apple.product-type.app-extension");
-
-    public final String identifier;
-    private ProductType(String identifier) {
-      this.identifier = identifier;
-    }
-
-    @Override
-    public String toString() {
-      return identifier;
-    }
-  }
-
-  private final String name;
-  private final ProductType productType;
-  private final List<PBXTargetDependency> dependencies;
-  private final List<PBXBuildPhase> buildPhases;
-  private final XCConfigurationList buildConfigurationList;
-  @Nullable private String productName;
-  @Nullable private PBXFileReference productReference;
-
-  public PBXTarget(String name, ProductType productType) {
-    this.name = Preconditions.checkNotNull(name);
-    this.productType = Preconditions.checkNotNull(productType);
-    this.dependencies = Lists.newArrayList();
-    this.buildPhases = Lists.newArrayList();
-    this.buildConfigurationList = new XCConfigurationList();
-  }
-
-  public String getName() {
-    return name;
-  }
-
-  public ProductType getProductType() {
-    return productType;
-  }
-
-  public List<PBXTargetDependency> getDependencies() {
-    return dependencies;
-  }
-
-  public List<PBXBuildPhase> getBuildPhases() {
-    return buildPhases;
-  }
-
-  public XCConfigurationList getBuildConfigurationList() {
-    return buildConfigurationList;
-  }
-
-  @Nullable
-  public String getProductName() {
-    return productName;
-  }
-
-  public void setProductName(String productName) {
-    this.productName = productName;
-  }
-
-  @Nullable
-  public PBXFileReference getProductReference() {
-    return productReference;
-  }
-
-  public void setProductReference(PBXFileReference v) {
-    productReference = v;
-  }
-
-  @Override
-  public String isa() {
-    return "PBXTarget";
-  }
-
-  @Override
-  public int stableHash() {
-    return name.hashCode();
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("name", name);
-    if (productType != null) {
-      s.addField("productType", productType.toString());
-    }
-    if (productName != null) {
-      s.addField("productName", productName);
-    }
-    if (productReference != null) {
-      s.addField("productReference", productReference);
-    }
-    s.addField("dependencies", dependencies);
-    s.addField("buildPhases", buildPhases);
-    if (buildConfigurationList != null) {
-      s.addField("buildConfigurationList", buildConfigurationList);
-    }
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTargetDependency.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTargetDependency.java
deleted file mode 100644
index 164e196..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXTargetDependency.java
+++ /dev/null
@@ -1,53 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Preconditions;
-
-/**
- * Element of the {@link PBXTarget#dependencies}. Represents a dependency of one target upon another
- * target.
- */
-public class PBXTargetDependency extends PBXProjectItem {
-  private final PBXContainerItemProxy targetProxy;
-
-  public PBXTargetDependency(PBXContainerItemProxy targetProxy) {
-    this.targetProxy = Preconditions.checkNotNull(targetProxy);
-  }
-
-  @Override
-  public String isa() {
-    return "PBXTargetDependency";
-  }
-
-  public PBXContainerItemProxy getTargetProxy() {
-    return targetProxy;
-  }
-
-  @Override
-  public int stableHash() {
-    return targetProxy.stableHash();
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    s.addField("targetProxy", getTargetProxy());
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXVariantGroup.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXVariantGroup.java
deleted file mode 100644
index b1e351a..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/PBXVariantGroup.java
+++ /dev/null
@@ -1,96 +0,0 @@
-/*
- * Copyright 2014-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.google.common.base.Preconditions;
-import com.google.common.cache.CacheBuilder;
-import com.google.common.cache.CacheLoader;
-import com.google.common.cache.LoadingCache;
-
-import java.util.Objects;
-
-import javax.annotation.Nullable;
-
-public class PBXVariantGroup extends PBXGroup {
-
-  private final LoadingCache<VirtualNameAndSourceTreePath, PBXFileReference>
-      variantFileReferencesByNameAndSourceTreePath;
-
-  public PBXVariantGroup(String name, @Nullable String path, SourceTree sourceTree) {
-    super(name, path, sourceTree);
-
-    variantFileReferencesByNameAndSourceTreePath = CacheBuilder.newBuilder().build(
-        new CacheLoader<VirtualNameAndSourceTreePath, PBXFileReference>() {
-          @Override
-          public PBXFileReference load(VirtualNameAndSourceTreePath key) throws Exception {
-            PBXFileReference ref = new PBXFileReference(
-                key.getVirtualName(),
-                key.getSourceTreePath().getPath().toString(),
-                key.getSourceTreePath().getSourceTree());
-            getChildren().add(ref);
-            return ref;
-          }
-        });
-  }
-
-  public PBXFileReference getOrCreateVariantFileReferenceByNameAndSourceTreePath(
-      String virtualName,
-      SourceTreePath sourceTreePath) {
-    VirtualNameAndSourceTreePath key =
-        new VirtualNameAndSourceTreePath(virtualName, sourceTreePath);
-    return variantFileReferencesByNameAndSourceTreePath.getUnchecked(key);
-  }
-
-  @Override
-  public String isa() {
-    return "PBXVariantGroup";
-  }
-
-  private static class VirtualNameAndSourceTreePath {
-    private final String virtualName;
-    private final SourceTreePath sourceTreePath;
-
-    public VirtualNameAndSourceTreePath(String virtualName, SourceTreePath sourceTreePath) {
-      this.virtualName = Preconditions.checkNotNull(virtualName);
-      this.sourceTreePath = Preconditions.checkNotNull(sourceTreePath);
-    }
-
-    public String getVirtualName() {
-      return virtualName;
-    }
-
-    public SourceTreePath getSourceTreePath() {
-      return sourceTreePath;
-    }
-
-    @Override
-    public boolean equals(Object other) {
-      if (!(other instanceof VirtualNameAndSourceTreePath)) {
-        return false;
-      }
-
-      VirtualNameAndSourceTreePath that = (VirtualNameAndSourceTreePath) other;
-      return Objects.equals(this.virtualName, that.virtualName) &&
-          Objects.equals(this.sourceTreePath, that.sourceTreePath);
-    }
-
-    @Override
-    public int hashCode() {
-      return Objects.hash(virtualName, sourceTreePath);
-    }
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/SourceTreePath.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/SourceTreePath.java
deleted file mode 100644
index dc49f76..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/SourceTreePath.java
+++ /dev/null
@@ -1,65 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.google.common.base.Preconditions;
-
-import java.nio.file.Path;
-import java.util.Objects;
-
-/**
- * Utility class representing a tuple of (SourceTree, Path) used for uniquely describing a file
- * reference in a group.
- */
-public class SourceTreePath {
-  private final PBXReference.SourceTree sourceTree;
-  private final Path path;
-
-  public SourceTreePath(PBXReference.SourceTree sourceTree, Path path) {
-    this.sourceTree = Preconditions.checkNotNull(sourceTree);
-    Preconditions.checkState(
-        path != null && path.toString().length() > 0,
-        "A path to a file cannot be null or empty");
-    path = path.normalize();
-    Preconditions.checkState(path.toString().length() > 0, "A path to a file cannot be empty");
-    this.path = path;
-  }
-
-  public PBXReference.SourceTree getSourceTree() {
-    return sourceTree;
-  }
-
-  public Path getPath() {
-    return path;
-  }
-
-  @Override
-  public int hashCode() {
-    return Objects.hash(sourceTree, path);
-  }
-
-  @Override
-  public boolean equals(Object other) {
-    if (other == null || !(other instanceof SourceTreePath)) {
-      return false;
-    }
-
-    SourceTreePath that = (SourceTreePath) other;
-    return Objects.equals(this.sourceTree, that.sourceTree) &&
-        Objects.equals(this.path, that.path);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCBuildConfiguration.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCBuildConfiguration.java
deleted file mode 100644
index f55ccfc..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCBuildConfiguration.java
+++ /dev/null
@@ -1,55 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import javax.annotation.Nullable;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-
-/**
- * Build configuration containing a file reference ton an xcconfig file and additional inline
- * settings.
- */
-public class XCBuildConfiguration extends PBXBuildStyle {
-  @Nullable private PBXFileReference baseConfigurationReference;
-
-  public XCBuildConfiguration(String name) {
-    super(name);
-  }
-
-  @Nullable
-  public PBXFileReference getBaseConfigurationReference() {
-    return baseConfigurationReference;
-  }
-  public void setBaseConfigurationReference(PBXFileReference v) {
-    baseConfigurationReference = v;
-  }
-
-  @Override
-  public String isa() {
-    return "XCBuildConfiguration";
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    if (baseConfigurationReference != null) {
-      s.addField("baseConfigurationReference", baseConfigurationReference);
-    }
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCConfigurationList.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCConfigurationList.java
deleted file mode 100644
index 048ffa7..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCConfigurationList.java
+++ /dev/null
@@ -1,82 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Optional;
-import com.google.common.cache.CacheBuilder;
-import com.google.common.cache.CacheLoader;
-import com.google.common.cache.LoadingCache;
-import com.google.common.collect.Lists;
-
-import java.util.Comparator;
-import java.util.Collections;
-import java.util.List;
-
-/**
- * List of build configurations.
- */
-public class XCConfigurationList extends PBXProjectItem {
-  private List<XCBuildConfiguration> buildConfigurations;
-  private Optional<String> defaultConfigurationName;
-  private boolean defaultConfigurationIsVisible;
-
-  private final LoadingCache<String, XCBuildConfiguration> buildConfigurationsByName;
-
-  public XCConfigurationList() {
-    buildConfigurations = Lists.newArrayList();
-    defaultConfigurationName = Optional.absent();
-    defaultConfigurationIsVisible = false;
-
-    buildConfigurationsByName = CacheBuilder.newBuilder().build(
-        new CacheLoader<String, XCBuildConfiguration>() {
-          @Override
-          public XCBuildConfiguration load(String key) throws Exception {
-            XCBuildConfiguration configuration = new XCBuildConfiguration(key);
-            buildConfigurations.add(configuration);
-            return configuration;
-          }
-        });
-  }
-
-  public LoadingCache<String, XCBuildConfiguration> getBuildConfigurationsByName() {
-    return buildConfigurationsByName;
-  }
-
-  @Override
-  public String isa() {
-    return "XCConfigurationList";
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    Collections.sort(buildConfigurations, new Comparator<XCBuildConfiguration>() {
-      @Override
-      public int compare(XCBuildConfiguration o1, XCBuildConfiguration o2) {
-        return o1.getName().compareTo(o2.getName());
-      }
-    });
-    s.addField("buildConfigurations", buildConfigurations);
-
-    if (defaultConfigurationName.isPresent()) {
-      s.addField("defaultConfigurationName", defaultConfigurationName.get());
-    }
-    s.addField("defaultConfigurationIsVisible", defaultConfigurationIsVisible);
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCVersionGroup.java b/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCVersionGroup.java
deleted file mode 100644
index acd8458..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/apple/xcode/xcodeproj/XCVersionGroup.java
+++ /dev/null
@@ -1,114 +0,0 @@
-/*
- * Copyright 2013-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-package com.facebook.buck.apple.xcode.xcodeproj;
-
-import com.facebook.buck.apple.xcode.XcodeprojSerializer;
-import com.google.common.base.Optional;
-import com.google.common.cache.CacheBuilder;
-import com.google.common.cache.CacheLoader;
-import com.google.common.cache.LoadingCache;
-import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.Lists;
-import com.google.common.io.Files;
-
-import java.util.Collections;
-import java.util.Comparator;
-import java.util.List;
-
-public class XCVersionGroup extends PBXReference {
-  private static final ImmutableMap<String, String> FILE_EXTENSION_TO_UTI = ImmutableMap.of(
-      "xcdatamodeld", "wrapper.xcdatamodel");
-
-  private Optional<PBXFileReference> currentVersion;
-
-  private final List<PBXFileReference> children;
-
-  private final LoadingCache<SourceTreePath, PBXFileReference> fileReferencesBySourceTreePath;
-
-  public XCVersionGroup(String name, String path, SourceTree sourceTree) {
-    super(name, path, sourceTree);
-    children = Lists.newArrayList();
-
-    fileReferencesBySourceTreePath = CacheBuilder.newBuilder().build(
-        new CacheLoader<SourceTreePath, PBXFileReference>() {
-          @Override
-          public PBXFileReference load(SourceTreePath key) throws Exception {
-            PBXFileReference ref = new PBXFileReference(
-                key.getPath().getFileName().toString(),
-                key.getPath().toString(),
-                key.getSourceTree());
-            children.add(ref);
-            return ref;
-          }
-        });
-
-    currentVersion = Optional.absent();
-  }
-
-  /**
-   * The file type of the version group, which is the type of each file. If the current version is
-   * set, then this method returns the type of the item that is the current version. Otherwise, it
-   * attempts to autodetect the type based on the name, or {@link Optional#absent()} if it could
-   * not be autodetected.
-   */
-  public Optional<String> getVersionGroupType() {
-    if (currentVersion.isPresent()) {
-      return currentVersion.get().getExplicitFileType();
-    }
-    return Optional.fromNullable(FILE_EXTENSION_TO_UTI.get(Files.getFileExtension(getName())));
-  }
-
-  public Optional<PBXFileReference> getCurrentVersion() { return currentVersion; }
-
-  public void setCurrentVersion(Optional<PBXFileReference> v) { currentVersion = v; }
-
-  public List<PBXFileReference> getChildren() {
-    return children;
-  }
-
-  public PBXFileReference getOrCreateFileReferenceBySourceTreePath(SourceTreePath sourceTreePath) {
-    return fileReferencesBySourceTreePath.getUnchecked(sourceTreePath);
-  }
-
-  @Override
-  public String isa() {
-    return "XCVersionGroup";
-  }
-
-  @Override
-  public void serializeInto(XcodeprojSerializer s) {
-    super.serializeInto(s);
-
-    Collections.sort(children, new Comparator<PBXReference>() {
-          @Override
-          public int compare(PBXReference o1, PBXReference o2) {
-          return o1.getName().compareTo(o2.getName());
-        }
-      });
-    s.addField("children", children);
-
-
-    if (currentVersion.isPresent()) {
-      s.addField("currentVersion", currentVersion.get());
-    }
-
-    Optional<String> versionGroupType = getVersionGroupType();
-    if (versionGroupType.isPresent()) {
-      s.addField("versionGroupType", versionGroupType.get());
-    }
-  }
-}
diff --git a/third_party/java/buck-ios-support/java/com/facebook/buck/log/Logger.java b/third_party/java/buck-ios-support/java/com/facebook/buck/log/Logger.java
deleted file mode 100644
index 2c1fdb3..0000000
--- a/third_party/java/buck-ios-support/java/com/facebook/buck/log/Logger.java
+++ /dev/null
@@ -1,451 +0,0 @@
-/*
- * Copyright 2014-present Facebook, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may
- * not use this file except in compliance with the License. You may obtain
- * a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations
- * under the License.
- */
-
-/*
- * Copyright 2010 Proofpoint, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.facebook.buck.log;
-
-import java.util.IllegalFormatException;
-
-import static java.lang.String.format;
-import static java.util.Arrays.asList;
-import static java.util.logging.Level.FINE;
-import static java.util.logging.Level.FINER;
-import static java.util.logging.Level.INFO;
-import static java.util.logging.Level.SEVERE;
-import static java.util.logging.Level.WARNING;
-
-// This is open source software that we'd like to modify as little as
-// possible, and it doesn't match our coding style.
-@SuppressWarnings({"PMD", "checkstyle:leftcurly", "checkstyle:rightcurly", "checkstyle:linelength"})
-public class Logger
-{
-    private final java.util.logging.Logger logger;
-
-    Logger(java.util.logging.Logger logger)
-    {
-        this.logger = logger;
-    }
-
-    /**
-     * Gets a logger named after a class' fully qualified name.
-     *
-     * @param clazz the class
-     * @return the named logger
-     */
-    public static Logger get(Class<?> clazz)
-    {
-        return get(clazz.getName());
-    }
-
-    /**
-     * Gets a named logger
-     *
-     * @param name the name of the logger
-     * @return the named logger
-     */
-    public static Logger get(String name)
-    {
-        java.util.logging.Logger logger = java.util.logging.Logger.getLogger(name);
-        return new Logger(logger);
-    }
-
-    /**
-     * Logs a message at VERBOSE level.
-     *
-     * @param exception an exception associated with the verbose message being logged
-     * @param message a literal message to log
-     */
-    public void verbose(Throwable exception, String message)
-    {
-        logger.log(FINER, message, exception);
-    }
-
-    /**
-     * Logs a message at VERBOSE level.
-     *
-     * @param message a literal message to log
-     */
-    public void verbose(String message)
-    {
-        logger.finer(message);
-    }
-
-    /**
-     * Logs a message at VERBOSE level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.verbose("value is %s (%d ms)", value, time);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void verbose(String format, Object... args)
-    {
-        if (logger.isLoggable(FINER)) {
-            String message;
-            try {
-                message = format(format, args);
-            }
-            catch (IllegalFormatException e) {
-                logger.log(SEVERE, illegalFormatMessageFor("VERBOSE", format, args), e);
-                message = rawMessageFor(format, args);
-            }
-            logger.finer(message);
-        }
-    }
-
-    /**
-     * Logs a message at VERBOSE level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.verbose(e, "value is %s (%d ms)", value, time);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param exception an exception associated with the verbose message being logged
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void verbose(Throwable exception, String format, Object... args)
-    {
-        if (logger.isLoggable(FINER)) {
-            String message;
-            try {
-                message = format(format, args);
-            }
-            catch (IllegalFormatException e) {
-                logger.log(SEVERE, illegalFormatMessageFor("VERBOSE", format, args), e);
-                message = rawMessageFor(format, args);
-            }
-            logger.log(FINER, message, exception);
-        }
-    }
-
-    /**
-     * Logs a message at DEBUG level.
-     *
-     * @param exception an exception associated with the debug message being logged
-     * @param message a literal message to log
-     */
-    public void debug(Throwable exception, String message)
-    {
-        logger.log(FINE, message, exception);
-    }
-
-    /**
-     * Logs a message at DEBUG level.
-     *
-     * @param message a literal message to log
-     */
-    public void debug(String message)
-    {
-        logger.fine(message);
-    }
-
-    /**
-     * Logs a message at DEBUG level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.debug("value is %s (%d ms)", value, time);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void debug(String format, Object... args)
-    {
-        if (logger.isLoggable(FINE)) {
-            String message;
-            try {
-                message = format(format, args);
-            }
-            catch (IllegalFormatException e) {
-                logger.log(SEVERE, illegalFormatMessageFor("DEBUG", format, args), e);
-                message = rawMessageFor(format, args);
-            }
-            logger.fine(message);
-        }
-    }
-
-    /**
-     * Logs a message at DEBUG level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.debug(e, "value is %s (%d ms)", value, time);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param exception an exception associated with the debug message being logged
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void debug(Throwable exception, String format, Object... args)
-    {
-        if (logger.isLoggable(FINE)) {
-            String message;
-            try {
-                message = format(format, args);
-            }
-            catch (IllegalFormatException e) {
-                logger.log(SEVERE, illegalFormatMessageFor("DEBUG", format, args), e);
-                message = rawMessageFor(format, args);
-            }
-            logger.log(FINE, message, exception);
-        }
-    }
-
-    /**
-     * Logs a message at INFO level.
-     *
-     * @param message a literal message to log
-     */
-    public void info(String message)
-    {
-        logger.info(message);
-    }
-
-    /**
-     * Logs a message at INFO level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.info("value is %s (%d ms)", value, time);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void info(String format, Object... args)
-    {
-        if (logger.isLoggable(INFO)) {
-            String message;
-            try {
-                message = format(format, args);
-            }
-            catch (IllegalFormatException e) {
-                logger.log(SEVERE, illegalFormatMessageFor("INFO", format, args), e);
-                message = rawMessageFor(format, args);
-            }
-            logger.info(message);
-        }
-    }
-
-    /**
-     * Logs a message at WARN level.
-     *
-     * @param exception an exception associated with the warning being logged
-     * @param message a literal message to log
-     */
-    public void warn(Throwable exception, String message)
-    {
-        logger.log(WARNING, message, exception);
-    }
-
-    /**
-     * Logs a message at WARN level.
-     *
-     * @param message a literal message to log
-     */
-    public void warn(String message)
-    {
-        logger.warning(message);
-    }
-
-    /**
-     * Logs a message at WARN level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.warn(e, "something bad happened when connecting to %s:%d", host, port);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param exception an exception associated with the warning being logged
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void warn(Throwable exception, String format, Object... args)
-    {
-        if (logger.isLoggable(WARNING)) {
-            String message;
-            try {
-                message = format(format, args);
-            }
-            catch (IllegalFormatException e) {
-                logger.log(SEVERE, illegalFormatMessageFor("WARN", format, args), e);
-                message = rawMessageFor(format, args);
-            }
-            logger.log(WARNING, message, exception);
-        }
-    }
-
-    /**
-     * Logs a message at WARN level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.warn("something bad happened when connecting to %s:%d", host, port);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void warn(String format, Object... args)
-    {
-        warn(null, format, args);
-    }
-
-    /**
-     * Logs a message at ERROR level.
-     *
-     * @param exception an exception associated with the error being logged
-     * @param message a literal message to log
-     */
-    public void error(Throwable exception, String message)
-    {
-        logger.log(SEVERE, message, exception);
-    }
-
-    /**
-     * Logs a message at ERROR level.
-     *
-     * @param message a literal message to log
-     */
-    public void error(String message)
-    {
-        logger.severe(message);
-    }
-
-    /**
-     * Logs a message at ERROR level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.error(e, "something really bad happened when connecting to %s:%d", host, port);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param exception an exception associated with the error being logged
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void error(Throwable exception, String format, Object... args)
-    {
-        if (logger.isLoggable(SEVERE)) {
-            String message;
-            try {
-                message = format(format, args);
-            }
-            catch (IllegalFormatException e) {
-                logger.log(SEVERE, illegalFormatMessageFor("ERROR", format, args), e);
-                message = rawMessageFor(format, args);
-            }
-            logger.log(SEVERE, message, exception);
-        }
-    }
-
-    /**
-     * Logs a message at ERROR level. The value of {@code exception.getMessage()} will be used as the log message.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.error(e);
-     * </pre>
-     *
-     * @param exception an exception associated with the error being logged
-     */
-    public void error(Throwable exception)
-    {
-        if (logger.isLoggable(SEVERE)) {
-            logger.log(SEVERE, exception.getMessage(), exception);
-        }
-    }
-
-    /**
-     * Logs a message at ERROR level.
-     * <br/>
-     * Usage example:
-     * <pre>
-     *    logger.error("something really bad happened when connecting to %s:%d", host, port);
-     * </pre>
-     * If the format string is invalid or the arguments are insufficient, an error will be logged and execution
-     * will continue.
-     *
-     * @param format a format string compatible with String.format()
-     * @param args arguments for the format string
-     */
-    public void error(String format, Object... args)
-    {
-        error(null, format, args);
-    }
-
-    public boolean isVerboseEnabled()
-    {
-        return logger.isLoggable(FINER);
-    }
-
-    public boolean isDebugEnabled()
-    {
-        return logger.isLoggable(FINE);
-    }
-
-    public boolean isInfoEnabled()
-    {
-        return logger.isLoggable(INFO);
-    }
-
-    private String illegalFormatMessageFor(String level, String message, Object... args)
-    {
-        return format("Invalid format string while trying to log: %s '%s' %s", level, message, asList(args));
-    }
-
-    private String rawMessageFor(String format, Object... args)
-    {
-        return format("'%s' %s", format, asList(args));
-    }
-}
diff --git a/third_party/java/dd_plist/LICENSE b/third_party/java/dd_plist/LICENSE
deleted file mode 100644
index d187b74..0000000
--- a/third_party/java/dd_plist/LICENSE
+++ /dev/null
@@ -1,19 +0,0 @@
-Copyright (C) 2012 Daniel Dreibrodt
-
-Permission is hereby granted, free of charge, to any person obtaining a copy
-of this software and associated documentation files (the "Software"), to deal
-in the Software without restriction, including without limitation the rights
-to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
-copies of the Software, and to permit persons to whom the Software is
-furnished to do so, subject to the following conditions:
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
-AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
-LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
-OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
-SOFTWARE.
diff --git a/third_party/java/dd_plist/README b/third_party/java/dd_plist/README
deleted file mode 100644
index 72539f9..0000000
--- a/third_party/java/dd_plist/README
+++ /dev/null
@@ -1,34 +0,0 @@
-URL: http://plist.googlecode.com/svn-history/r111/trunk/
-Version: r111
-License: MIT Style
-License File: LICENSE
-
-Description:
-
-dd-plist
-This library enables Java applications to work with property lists in various
-formats.
-
-You can parse existing property lists (e.g. those created by an iOS application)
-and work with the contents on any operating system.
-
-The library also enables you to create your own property lists from scratch and
-store them in various formats.
-
-The provided API mimics the Cocoa/NeXTSTEP API, granting access to the basic
-functions of classes like NSDictionary, NSData, etc.
-
-dd-plist has full support for the Android operating system. Consequently this
-library can be of great help when it comes to porting iOS apps to Android.
-
-Local Modifications:
-- LICENSE file has been created for compliance purposes. Not included in
-  original distribution.
-- Made PropertyListParser.readAll react properly to InputStreams that sometimes
-  read fewer bytes than are available.
-- Rewrote some functions in ASCIIPropertyListParser.java to support characters
-  outside of the 7-bit ASCII range.
-- Support surrogate pairs from \u escaped chars in strings in
-  ASCIIPropertyListParser.java.
-- Allow \ escaping of characters that need not be escaped in
-  ASCIIPropertyListParser.java.
diff --git a/third_party/java/dd_plist/java/com/dd/plist/ASCIIPropertyListParser.java b/third_party/java/dd_plist/java/com/dd/plist/ASCIIPropertyListParser.java
deleted file mode 100644
index 533fb39..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/ASCIIPropertyListParser.java
+++ /dev/null
@@ -1,645 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2014 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-import java.io.ByteArrayOutputStream;
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.UnsupportedEncodingException;
-import java.nio.CharBuffer;
-import java.nio.charset.CharacterCodingException;
-import java.nio.charset.Charset;
-import java.nio.charset.CharsetEncoder;
-import java.text.ParseException;
-import java.text.StringCharacterIterator;
-import java.util.LinkedList;
-import java.util.List;
-
-/**
- * Parser for ASCII property lists. Supports Apple OS X/iOS and GnuStep/NeXTSTEP format.
- * This parser is based on the recursive descent paradigm, but the underlying grammar
- * is not explicitely defined.
- * <p/>
- * Resources on ASCII property list format:
- * <ul>
- * <li><a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/PropertyLists/OldStylePlists/OldStylePLists.html>
- * Property List Programming Guide - Old-Style ASCII Property Lists
- * </a></li>
- * <li><a href="http://www.gnustep.org/resources/documentation/Developer/Base/Reference/NSPropertyList.html">
- * GnuStep - NSPropertyListSerialization class documentation
- * </a></li>
- * </ul>
- *
- * @author Daniel Dreibrodt
- */
-public class ASCIIPropertyListParser {
-
-    /**
-     * Parses an ASCII property list file.
-     *
-     * @param f The ASCII property list file.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    public static NSObject parse(File f) throws IOException, ParseException {
-        return parse(new FileInputStream(f));
-    }
-
-    /**
-     * Parses an ASCII property list from an input stream.
-     *
-     * @param in The input stream that points to the property list's data.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    public static NSObject parse(InputStream in) throws ParseException, IOException {
-        byte[] buf = PropertyListParser.readAll(in);
-        in.close();
-        return parse(buf);
-    }
-
-    /**
-     * Parses an ASCII property list from a byte array.
-     *
-     * @param bytes The ASCII property list data.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    public static NSObject parse(byte[] bytes) throws ParseException {
-        ASCIIPropertyListParser parser = new ASCIIPropertyListParser(bytes);
-        return parser.parse();
-    }
-
-    public static final char WHITESPACE_SPACE = ' ';
-    public static final char WHITESPACE_TAB = '\t';
-    public static final char WHITESPACE_NEWLINE = '\n';
-    public static final char WHITESPACE_CARRIAGE_RETURN = '\r';
-
-    public static final char ARRAY_BEGIN_TOKEN = '(';
-    public static final char ARRAY_END_TOKEN = ')';
-    public static final char ARRAY_ITEM_DELIMITER_TOKEN = ',';
-
-    public static final char DICTIONARY_BEGIN_TOKEN = '{';
-    public static final char DICTIONARY_END_TOKEN = '}';
-    public static final char DICTIONARY_ASSIGN_TOKEN = '=';
-    public static final char DICTIONARY_ITEM_DELIMITER_TOKEN = ';';
-
-    public static final char QUOTEDSTRING_BEGIN_TOKEN = '"';
-    public static final char QUOTEDSTRING_END_TOKEN = '"';
-    public static final char QUOTEDSTRING_ESCAPE_TOKEN = '\\';
-
-    public static final char DATA_BEGIN_TOKEN = '<';
-    public static final char DATA_END_TOKEN = '>';
-
-    public static final char DATA_GSOBJECT_BEGIN_TOKEN = '*';
-    public static final char DATA_GSDATE_BEGIN_TOKEN = 'D';
-    public static final char DATA_GSBOOL_BEGIN_TOKEN = 'B';
-    public static final char DATA_GSBOOL_TRUE_TOKEN = 'Y';
-    public static final char DATA_GSBOOL_FALSE_TOKEN = 'N';
-    public static final char DATA_GSINT_BEGIN_TOKEN = 'I';
-    public static final char DATA_GSREAL_BEGIN_TOKEN = 'R';
-
-    public static final char DATE_DATE_FIELD_DELIMITER = '-';
-    public static final char DATE_TIME_FIELD_DELIMITER = ':';
-    public static final char DATE_GS_DATE_TIME_DELIMITER = ' ';
-    public static final char DATE_APPLE_DATE_TIME_DELIMITER = 'T';
-    public static final char DATE_APPLE_END_TOKEN = 'Z';
-
-    public static final char COMMENT_BEGIN_TOKEN = '/';
-    public static final char MULTILINE_COMMENT_SECOND_TOKEN = '*';
-    public static final char SINGLELINE_COMMENT_SECOND_TOKEN = '/';
-    public static final char MULTILINE_COMMENT_END_TOKEN = '/';
-
-    /**
-     * Property list source data
-     */
-    private byte[] data;
-    /**
-     * Current parsing index
-     */
-    private int index;
-
-    /**
-     * Only allow subclasses to change instantiation.
-     */
-    protected ASCIIPropertyListParser() {
-
-    }
-
-    /**
-     * Creates a new parser for the given property list content.
-     *
-     * @param propertyListContent The content of the property list that is to be parsed.
-     */
-    private ASCIIPropertyListParser(byte[] propertyListContent) {
-        data = propertyListContent;
-    }
-
-    /**
-     * Checks whether the given sequence of symbols can be accepted.
-     *
-     * @param sequence The sequence of tokens to look for.
-     * @return Whether the given tokens occur at the current parsing position.
-     */
-    private boolean acceptSequence(char... sequence) {
-        for (int i = 0; i < sequence.length; i++) {
-            if (data[index + i] != sequence[i])
-                return false;
-        }
-        return true;
-    }
-
-    /**
-     * Checks whether the given symbols can be accepted, that is, if one
-     * of the given symbols is found at the current parsing position.
-     *
-     * @param acceptableSymbols The symbols to check.
-     * @return Whether one of the symbols can be accepted or not.
-     */
-    private boolean accept(char... acceptableSymbols) {
-        boolean symbolPresent = false;
-        for (char c : acceptableSymbols) {
-            if (data[index] == c)
-                symbolPresent = true;
-        }
-        return symbolPresent;
-    }
-
-    /**
-     * Checks whether the given symbol can be accepted, that is, if
-     * the given symbols is found at the current parsing position.
-     *
-     * @param acceptableSymbol The symbol to check.
-     * @return Whether the symbol can be accepted or not.
-     */
-    private boolean accept(char acceptableSymbol) {
-        return data[index] == acceptableSymbol;
-    }
-
-    /**
-     * Expects the input to have one of the given symbols at the current parsing position.
-     *
-     * @param expectedSymbols The expected symbols.
-     * @throws ParseException If none of the expected symbols could be found.
-     */
-    private void expect(char... expectedSymbols) throws ParseException {
-        if (!accept(expectedSymbols)) {
-            String excString = "Expected '" + expectedSymbols[0] + "'";
-            for (int i = 1; i < expectedSymbols.length; i++) {
-                excString += " or '" + expectedSymbols[i] + "'";
-            }
-            excString += " but found '" + (char) data[index] + "'";
-            throw new ParseException(excString, index);
-        }
-    }
-
-    /**
-     * Expects the input to have the given symbol at the current parsing position.
-     *
-     * @param expectedSymbol The expected symbol.
-     * @throws ParseException If the expected symbol could be found.
-     */
-    private void expect(char expectedSymbol) throws ParseException {
-        if (!accept(expectedSymbol))
-            throw new ParseException("Expected '" + expectedSymbol + "' but found '" + (char) data[index] + "'", index);
-    }
-
-    /**
-     * Reads an expected symbol.
-     *
-     * @param symbol The symbol to read.
-     * @throws ParseException If the expected symbol could not be read.
-     */
-    private void read(char symbol) throws ParseException {
-        expect(symbol);
-        index++;
-    }
-
-    /**
-     * Skips the current symbol.
-     */
-    private void skip() {
-        index++;
-    }
-
-    /**
-     * Skips several symbols
-     *
-     * @param numSymbols The amount of symbols to skip.
-     */
-    private void skip(int numSymbols) {
-        index += numSymbols;
-    }
-
-    /**
-     * Skips all whitespaces and comments from the current parsing position onward.
-     */
-    private void skipWhitespacesAndComments() {
-        boolean commentSkipped;
-        do {
-            commentSkipped = false;
-
-            //Skip whitespaces
-            while (accept(WHITESPACE_CARRIAGE_RETURN, WHITESPACE_NEWLINE, WHITESPACE_SPACE, WHITESPACE_TAB)) {
-                skip();
-            }
-
-            //Skip single line comments "//..."
-            if (acceptSequence(COMMENT_BEGIN_TOKEN, SINGLELINE_COMMENT_SECOND_TOKEN)) {
-                skip(2);
-                readInputUntil(WHITESPACE_CARRIAGE_RETURN, WHITESPACE_NEWLINE);
-                commentSkipped = true;
-            }
-            //Skip multi line comments "/* ... */"
-            else if (acceptSequence(COMMENT_BEGIN_TOKEN, MULTILINE_COMMENT_SECOND_TOKEN)) {
-                skip(2);
-                while (true) {
-                    if (acceptSequence(MULTILINE_COMMENT_SECOND_TOKEN, MULTILINE_COMMENT_END_TOKEN)) {
-                        skip(2);
-                        break;
-                    }
-                    skip();
-                }
-                commentSkipped = true;
-            }
-        }
-        while (commentSkipped); //if a comment was skipped more whitespace or another comment can follow, so skip again
-    }
-
-    private String toUtf8String(ByteArrayOutputStream stream) {
-        try {
-            return stream.toString("UTF-8");
-        } catch (UnsupportedEncodingException e) {
-            throw new RuntimeException(e);
-        }
-    }
-
-    /**
-     * Reads input until one of the given symbols is found.
-     *
-     * @param symbols The symbols that can occur after the string to read.
-     * @return The input until one the given symbols.
-     */
-    private String readInputUntil(char... symbols) {
-        ByteArrayOutputStream stringBytes = new ByteArrayOutputStream();
-        while (!accept(symbols)) {
-            stringBytes.write(data[index]);
-            skip();
-        }
-        return toUtf8String(stringBytes);
-    }
-
-    /**
-     * Reads input until the given symbol is found.
-     *
-     * @param symbol The symbol that can occur after the string to read.
-     * @return The input until the given symbol.
-     */
-    private String readInputUntil(char symbol) {
-        ByteArrayOutputStream stringBytes = new ByteArrayOutputStream();
-        while (!accept(symbol)) {
-            stringBytes.write(data[index]);
-            skip();
-        }
-        return toUtf8String(stringBytes);
-    }
-
-    /**
-     * Parses the property list from the beginning and returns the root object
-     * of the property list.
-     *
-     * @return The root object of the property list. This can either be a NSDictionary or a NSArray.
-     * @throws ParseException When an error occured during parsing
-     */
-    public NSObject parse() throws ParseException {
-        index = 0;
-        skipWhitespacesAndComments();
-        expect(DICTIONARY_BEGIN_TOKEN, ARRAY_BEGIN_TOKEN, COMMENT_BEGIN_TOKEN);
-        try {
-            return parseObject();
-        } catch (ArrayIndexOutOfBoundsException ex) {
-            throw new ParseException("Reached end of input unexpectedly.", index);
-        }
-    }
-
-    /**
-     * Parses the NSObject found at the current position in the property list
-     * data stream.
-     *
-     * @return The parsed NSObject.
-     * @see ASCIIPropertyListParser#index
-     */
-    private NSObject parseObject() throws ParseException {
-        switch (data[index]) {
-            case ARRAY_BEGIN_TOKEN: {
-                return parseArray();
-            }
-            case DICTIONARY_BEGIN_TOKEN: {
-                return parseDictionary();
-            }
-            case DATA_BEGIN_TOKEN: {
-                return parseData();
-            }
-            case QUOTEDSTRING_BEGIN_TOKEN: {
-                String quotedString = parseQuotedString();
-                //apple dates are quoted strings of length 20 and after the 4 year digits a dash is found
-                if (quotedString.length() == 20 && quotedString.charAt(4) == DATE_DATE_FIELD_DELIMITER) {
-                    try {
-                        return new NSDate(quotedString);
-                    } catch (Exception ex) {
-                        //not a date? --> return string
-                        return new NSString(quotedString);
-                    }
-                } else {
-                    return new NSString(quotedString);
-                }
-            }
-            default: {
-                //0-9
-                if (data[index] > 0x2F && data[index] < 0x3A) {
-                    //could be a date or just a string
-                    return parseDateString();
-                } else {
-                    //non-numerical -> string or boolean
-                    String parsedString = parseString();
-                    return new NSString(parsedString);
-                }
-            }
-        }
-    }
-
-    /**
-     * Parses an array from the current parsing position.
-     * The prerequisite for calling this method is, that an array begin token has been read.
-     *
-     * @return The array found at the parsing position.
-     */
-    private NSArray parseArray() throws ParseException {
-        //Skip begin token
-        skip();
-        skipWhitespacesAndComments();
-        List<NSObject> objects = new LinkedList<NSObject>();
-        while (!accept(ARRAY_END_TOKEN)) {
-            objects.add(parseObject());
-            skipWhitespacesAndComments();
-            if (accept(ARRAY_ITEM_DELIMITER_TOKEN)) {
-                skip();
-            } else {
-                break; //must have reached end of array
-            }
-            skipWhitespacesAndComments();
-        }
-        //parse end token
-        read(ARRAY_END_TOKEN);
-        return new NSArray(objects.toArray(new NSObject[objects.size()]));
-    }
-
-    /**
-     * Parses a dictionary from the current parsing position.
-     * The prerequisite for calling this method is, that a dictionary begin token has been read.
-     *
-     * @return The dictionary found at the parsing position.
-     */
-    private NSDictionary parseDictionary() throws ParseException {
-        //Skip begin token
-        skip();
-        skipWhitespacesAndComments();
-        NSDictionary dict = new NSDictionary();
-        while (!accept(DICTIONARY_END_TOKEN)) {
-            //Parse key
-            String keyString;
-            if (accept(QUOTEDSTRING_BEGIN_TOKEN)) {
-                keyString = parseQuotedString();
-            } else {
-                keyString = parseString();
-            }
-            skipWhitespacesAndComments();
-
-            //Parse assign token
-            read(DICTIONARY_ASSIGN_TOKEN);
-            skipWhitespacesAndComments();
-
-            NSObject object = parseObject();
-            dict.put(keyString, object);
-            skipWhitespacesAndComments();
-            read(DICTIONARY_ITEM_DELIMITER_TOKEN);
-            skipWhitespacesAndComments();
-        }
-        //skip end token
-        skip();
-        return dict;
-    }
-
-    /**
-     * Parses a data object from the current parsing position.
-     * This can either be a NSData object or a GnuStep NSNumber or NSDate.
-     * The prerequisite for calling this method is, that a data begin token has been read.
-     *
-     * @return The data object found at the parsing position.
-     */
-    private NSObject parseData() throws ParseException {
-        NSObject obj = null;
-        //Skip begin token
-        skip();
-        if (accept(DATA_GSOBJECT_BEGIN_TOKEN)) {
-            skip();
-            expect(DATA_GSBOOL_BEGIN_TOKEN, DATA_GSDATE_BEGIN_TOKEN, DATA_GSINT_BEGIN_TOKEN, DATA_GSREAL_BEGIN_TOKEN);
-            if (accept(DATA_GSBOOL_BEGIN_TOKEN)) {
-                //Boolean
-                skip();
-                expect(DATA_GSBOOL_TRUE_TOKEN, DATA_GSBOOL_FALSE_TOKEN);
-                if (accept(DATA_GSBOOL_TRUE_TOKEN)) {
-                    obj = new NSNumber(true);
-                } else {
-                    obj = new NSNumber(false);
-                }
-                //Skip the parsed boolean token
-                skip();
-            } else if (accept(DATA_GSDATE_BEGIN_TOKEN)) {
-                //Date
-                skip();
-                String dateString = readInputUntil(DATA_END_TOKEN);
-                obj = new NSDate(dateString);
-            } else if (accept(DATA_GSINT_BEGIN_TOKEN, DATA_GSREAL_BEGIN_TOKEN)) {
-                //Number
-                skip();
-                String numberString = readInputUntil(DATA_END_TOKEN);
-                obj = new NSNumber(numberString);
-            }
-            //parse data end token
-            read(DATA_END_TOKEN);
-        } else {
-            String dataString = readInputUntil(DATA_END_TOKEN);
-            dataString = dataString.replaceAll("\\s+", "");
-
-            int numBytes = dataString.length() / 2;
-            byte[] bytes = new byte[numBytes];
-            for (int i = 0; i < bytes.length; i++) {
-                String byteString = dataString.substring(i * 2, i * 2 + 2);
-                int byteValue = Integer.parseInt(byteString, 16);
-                bytes[i] = (byte) byteValue;
-            }
-            obj = new NSData(bytes);
-
-            //skip end token
-            skip();
-        }
-
-        return obj;
-    }
-
-    /**
-     * Attempts to parse a plain string as a date if possible.
-     *
-     * @return A NSDate if the string represents such an object. Otherwise a NSString is returned.
-     */
-    private NSObject parseDateString() {
-        String numericalString = parseString();
-        if (numericalString.length() > 4 && numericalString.charAt(4) == DATE_DATE_FIELD_DELIMITER) {
-            try {
-                return new NSDate(numericalString);
-            } catch(Exception ex) {
-                //An exception occurs if the string is not a date but just a string
-            }
-        }
-        return new NSString(numericalString);
-    }
-
-    /**
-     * Parses a plain string from the current parsing position.
-     * The string is made up of all characters to the next whitespace, delimiter token or assignment token.
-     *
-     * @return The string found at the current parsing position.
-     */
-    private String parseString() {
-        return readInputUntil(WHITESPACE_SPACE, WHITESPACE_TAB, WHITESPACE_NEWLINE, WHITESPACE_CARRIAGE_RETURN,
-                ARRAY_ITEM_DELIMITER_TOKEN, DICTIONARY_ITEM_DELIMITER_TOKEN, DICTIONARY_ASSIGN_TOKEN, ARRAY_END_TOKEN);
-    }
-
-    /**
-     * Parses a quoted string from the current parsing position.
-     * The prerequisite for calling this method is, that a quoted string begin token has been read.
-     *
-     * @return The quoted string found at the parsing method with all special characters unescaped.
-     * @throws ParseException If an error occured during parsing.
-     */
-    private String parseQuotedString() throws ParseException {
-        //Skip begin token
-        skip();
-        ByteArrayOutputStream quotedString = new ByteArrayOutputStream();
-        boolean unescapedBackslash = true;
-        //Read from opening quotation marks to closing quotation marks and skip escaped quotation marks
-        while (data[index] != QUOTEDSTRING_END_TOKEN || (data[index - 1] == QUOTEDSTRING_ESCAPE_TOKEN && unescapedBackslash)) {
-            quotedString.write(data[index]);
-            if (accept(QUOTEDSTRING_ESCAPE_TOKEN)) {
-                unescapedBackslash = !(data[index - 1] == QUOTEDSTRING_ESCAPE_TOKEN && unescapedBackslash);
-            }
-            skip();
-        }
-        String unescapedString;
-        try {
-            unescapedString = parseQuotedString(toUtf8String(quotedString));
-        } catch (Exception ex) {
-            throw new ParseException("The quoted string could not be parsed.", index);
-        }
-        //skip end token
-        skip();
-        return unescapedString;
-    }
-
-    /**
-     * Used to encode the parsed strings
-     */
-    private static CharsetEncoder asciiEncoder;
-
-    /**
-     * Parses a string according to the format specified for ASCII property lists.
-     * Such strings can contain escape sequences which are unescaped in this method.
-     *
-     * @param s The escaped string according to the ASCII property list format, without leading and trailing quotation marks.
-     * @return The unescaped string in UTF-8 or ASCII format, depending on the contained characters.
-     * @throws Exception If the string could not be properly parsed.
-     */
-    public static synchronized String parseQuotedString(String s) throws UnsupportedEncodingException, CharacterCodingException {
-        StringBuilder parsed = new StringBuilder();
-        StringCharacterIterator iterator = new StringCharacterIterator(s);
-        char c = iterator.current();
-
-        while (iterator.getIndex() < iterator.getEndIndex()) {
-            switch (c) {
-                case '\\': { //An escaped sequence is following
-                    parsed.append(parseEscapedSequence(iterator));
-                    break;
-                }
-                default: {
-                    parsed.append(c);
-                    break;
-                }
-            }
-            c = iterator.next();
-        }
-        return parsed.toString();
-    }
-
-    /**
-     * Unescapes an escaped character sequence, e.g. \\u00FC.
-     *
-     * @param iterator The string character iterator pointing to the first character after the backslash
-     * @return The unescaped character
-     */
-    private static char parseEscapedSequence(StringCharacterIterator iterator) {
-        char c = iterator.next();
-        if (c == 'b') {
-            return '\b';
-        } else if (c == 'n') {
-            return '\n';
-        } else if (c == 'r') {
-            return '\r';
-        } else if (c == 't') {
-            return '\t';
-        } else if (c == 'U' || c == 'u') {
-            //4 digit hex Unicode value
-            String byte1 = "";
-            byte1 += iterator.next();
-            byte1 += iterator.next();
-            String byte2 = "";
-            byte2 += iterator.next();
-            byte2 += iterator.next();
-            return (char) ((Integer.parseInt(byte1, 16) << 8) + Integer.parseInt(byte2, 16));
-        } else if ((c >= '0') && (c <= '7')) {
-            //3 digit octal ASCII value
-            String num = "";
-            num += c;
-            num += iterator.next();
-            num += iterator.next();
-            return (char) Integer.parseInt(num, 8);
-        } else {
-            // Possibly something that needn't be escaped, but we should accept it
-            // it anyway for consistency with Apple tools.
-            return c;
-        }
-    }
-
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/Base64.java b/third_party/java/dd_plist/java/com/dd/plist/Base64.java
deleted file mode 100644
index 8a20f43..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/Base64.java
+++ /dev/null
@@ -1,2124 +0,0 @@
-/**
- * plist - An open source library to parse and generate property lists
- *
- * Copyright (C) 2012 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-/**
- * <p>Encodes and decodes to and from Base64 notation.</p>
- * <p>Homepage: <a href="http://iharder.net/base64">http://iharder.net/base64</a>.</p>
- * <p/>
- * <p>Example:</p>
- * <p/>
- * <code>String encoded = Base64.encode( myByteArray );</code>
- * <br />
- * <code>byte[] myByteArray = Base64.decode( encoded );</code>
- * <p/>
- * <p>The <tt>options</tt> parameter, which appears in a few places, is used to pass
- * several pieces of information to the encoder. In the "higher level" methods such as
- * encodeBytes( bytes, options ) the options parameter can be used to indicate such
- * things as first gzipping the bytes before encoding them, not inserting linefeeds,
- * and encoding using the URL-safe and Ordered dialects.</p>
- * <p/>
- * <p>Note, according to <a href="http://www.faqs.org/rfcs/rfc3548.html">RFC3548</a>,
- * Section 2.1, implementations should not add line feeds unless explicitly told
- * to do so. I've got Base64 set to this behavior now, although earlier versions
- * broke lines by default.</p>
- * <p/>
- * <p>The constants defined in Base64 can be OR-ed together to combine options, so you
- * might make a call like this:</p>
- * <p/>
- * <code>String encoded = Base64.encodeBytes( mybytes, Base64.GZIP | Base64.DO_BREAK_LINES );</code>
- * <p>to compress the data before encoding it and then making the output have newline characters.</p>
- * <p>Also...</p>
- * <code>String encoded = Base64.encodeBytes( crazyString.getBytes() );</code>
- * <p/>
- * <p/>
- * <p/>
- * <p>
- * Change Log:
- * </p>
- * <ul>
- * <li>v2.3.7 - Fixed subtle bug when base 64 input stream contained the
- * value 01111111, which is an invalid base 64 character but should not
- * throw an ArrayIndexOutOfBoundsException either. Led to discovery of
- * mishandling (or potential for better handling) of other bad input
- * characters. You should now get an IOException if you try decoding
- * something that has bad characters in it.</li>
- * <li>v2.3.6 - Fixed bug when breaking lines and the final byte of the encoded
- * string ended in the last column; the buffer was not properly shrunk and
- * contained an extra (null) byte that made it into the string.</li>
- * <li>v2.3.5 - Fixed bug in {@link #encodeFromFile} where estimated buffer size
- * was wrong for files of size 31, 34, and 37 bytes.</li>
- * <li>v2.3.4 - Fixed bug when working with gzipped streams whereby flushing
- * the Base64.B64OutputStream closed the Base64 encoding (by padding with equals
- * signs) too soon. Also added an option to suppress the automatic decoding
- * of gzipped streams. Also added experimental support for specifying a
- * class loader when using the
- * {@link #decodeToObject(java.lang.String, int, java.lang.ClassLoader)}
- * method.</li>
- * <li>v2.3.3 - Changed default char encoding to US-ASCII which reduces the internal Java
- * footprint with its CharEncoders and so forth. Fixed some javadocs that were
- * inconsistent. Removed imports and specified things like java.io.IOException
- * explicitly inline.</li>
- * <li>v2.3.2 - Reduced memory footprint! Finally refined the "guessing" of how big the
- * final encoded data will be so that the code doesn't have to create two output
- * arrays: an oversized initial one and then a final, exact-sized one. Big win
- * when using the {@link #encodeBytesToBytes(byte[])} family of methods (and not
- * using the gzip options which uses a different mechanism with streams and stuff).</li>
- * <li>v2.3.1 - Added {@link #encodeBytesToBytes(byte[], int, int, int)} and some
- * similar helper methods to be more efficient with memory by not returning a
- * String but just a byte array.</li>
- * <li>v2.3 - <strong>This is not a drop-in replacement!</strong> This is two years of comments
- * and bug fixes queued up and finally executed. Thanks to everyone who sent
- * me stuff, and I'm sorry I wasn't able to distribute your fixes to everyone else.
- * Much bad coding was cleaned up including throwing exceptions where necessary
- * instead of returning null values or something similar. Here are some changes
- * that may affect you:
- * <ul>
- * <li><em>Does not break lines, by default.</em> This is to keep in compliance with
- * <a href="http://www.faqs.org/rfcs/rfc3548.html">RFC3548</a>.</li>
- * <li><em>Throws exceptions instead of returning null values.</em> Because some operations
- * (especially those that may permit the GZIP option) use IO streams, there
- * is a possiblity of an java.io.IOException being thrown. After some discussion and
- * thought, I've changed the behavior of the methods to throw java.io.IOExceptions
- * rather than return null if ever there's an error. I think this is more
- * appropriate, though it will require some changes to your code. Sorry,
- * it should have been done this way to begin with.</li>
- * <li><em>Removed all references to System.out, System.err, and the like.</em>
- * Shame on me. All I can say is sorry they were ever there.</li>
- * <li><em>Throws NullPointerExceptions and IllegalArgumentExceptions</em> as needed
- * such as when passed arrays are null or offsets are invalid.</li>
- * <li>Cleaned up as much javadoc as I could to avoid any javadoc warnings.
- * This was especially annoying before for people who were thorough in their
- * own projects and then had gobs of javadoc warnings on this file.</li>
- * </ul>
- * <li>v2.2.1 - Fixed bug using URL_SAFE and ORDERED encodings. Fixed bug
- * when using very small files (~&lt; 40 bytes).</li>
- * <li>v2.2 - Added some helper methods for encoding/decoding directly from
- * one file to the next. Also added a main() method to support command line
- * encoding/decoding from one file to the next. Also added these Base64 dialects:
- * <ol>
- * <li>The default is RFC3548 format.</li>
- * <li>Calling Base64.setFormat(Base64.BASE64_FORMAT.URLSAFE_FORMAT) generates
- * URL and file name friendly format as described in Section 4 of RFC3548.
- * http://www.faqs.org/rfcs/rfc3548.html</li>
- * <li>Calling Base64.setFormat(Base64.BASE64_FORMAT.ORDERED_FORMAT) generates
- * URL and file name friendly format that preserves lexical ordering as described
- * in http://www.faqs.org/qa/rfcc-1940.html</li>
- * </ol>
- * Special thanks to Jim Kellerman at <a href="http://www.powerset.com/">http://www.powerset.com/</a>
- * for contributing the new Base64 dialects.
- * </li>
- * <p/>
- * <li>v2.1 - Cleaned up javadoc comments and unused variables and methods. Added
- * some convenience methods for reading and writing to and from files.</li>
- * <li>v2.0.2 - Now specifies UTF-8 encoding in places where the code fails on systems
- * with other encodings (like EBCDIC).</li>
- * <li>v2.0.1 - Fixed an error when decoding a single byte, that is, when the
- * encoded data was a single byte.</li>
- * <li>v2.0 - I got rid of methods that used booleans to set options.
- * Now everything is more consolidated and cleaner. The code now detects
- * when data that's being decoded is gzip-compressed and will decompress it
- * automatically. Generally things are cleaner. You'll probably have to
- * change some method calls that you were making to support the new
- * options format (<tt>int</tt>s that you "OR" together).</li>
- * <li>v1.5.1 - Fixed bug when decompressing and decoding to a
- * byte[] using <tt>decode( String s, boolean gzipCompressed )</tt>.
- * Added the ability to "suspend" encoding in the Output Stream so
- * you can turn on and off the encoding if you need to embed base64
- * data in an otherwise "normal" stream (like an XML file).</li>
- * <li>v1.5 - Output stream pases on flush() command but doesn't do anything itself.
- * This helps when using GZIP streams.
- * Added the ability to GZip-compress objects before encoding them.</li>
- * <li>v1.4 - Added helper methods to read/write files.</li>
- * <li>v1.3.6 - Fixed B64OutputStream.flush() so that 'position' is reset.</li>
- * <li>v1.3.5 - Added flag to turn on and off line breaks. Fixed bug in input stream
- * where last buffer being read, if not completely full, was not returned.</li>
- * <li>v1.3.4 - Fixed when "improperly padded stream" error was thrown at the wrong time.</li>
- * <li>v1.3.3 - Fixed I/O streams which were totally messed up.</li>
- * </ul>
- * <p/>
- * <p>
- * I am placing this code in the Public Domain. Do with it as you will.
- * This software comes with no guarantees or warranties but with
- * plenty of well-wishing instead!
- * Please visit <a href="http://iharder.net/base64">http://iharder.net/base64</a>
- * periodically to check for updates or to contribute improvements.
- * </p>
- *
- * @author Robert Harder
- * @author rob@iharder.net
- * @version 2.3.7
- */
-public class Base64 {
-
-/* ********  P U B L I C   F I E L D S  ******** */
-
-
-    /**
-     * No options specified. Value is zero.
-     */
-    public final static int NO_OPTIONS = 0;
-
-    /**
-     * Specify encoding in first bit. Value is one.
-     */
-    public final static int ENCODE = 1;
-
-
-    /**
-     * Specify decoding in first bit. Value is zero.
-     */
-    public final static int DECODE = 0;
-
-
-    /**
-     * Specify that data should be gzip-compressed in second bit. Value is two.
-     */
-    public final static int GZIP = 2;
-
-    /**
-     * Specify that gzipped data should <em>not</em> be automatically gunzipped.
-     */
-    public final static int DONT_GUNZIP = 4;
-
-
-    /**
-     * Do break lines when encoding. Value is 8.
-     */
-    public final static int DO_BREAK_LINES = 8;
-
-    /**
-     * Encode using Base64-like encoding that is URL- and Filename-safe as described
-     * in Section 4 of RFC3548:
-     * <a href="http://www.faqs.org/rfcs/rfc3548.html">http://www.faqs.org/rfcs/rfc3548.html</a>.
-     * It is important to note that data encoded this way is <em>not</em> officially valid Base64,
-     * or at the very least should not be called Base64 without also specifying that is
-     * was encoded using the URL- and Filename-safe dialect.
-     */
-    public final static int URL_SAFE = 16;
-
-
-    /**
-     * Encode using the special "ordered" dialect of Base64 described here:
-     * <a href="http://www.faqs.org/qa/rfcc-1940.html">http://www.faqs.org/qa/rfcc-1940.html</a>.
-     */
-    public final static int ORDERED = 32;
-
-
-/* ********  P R I V A T E   F I E L D S  ******** */
-
-
-    /**
-     * Maximum line length (76) of Base64 output.
-     */
-    private final static int MAX_LINE_LENGTH = 76;
-
-
-    /**
-     * The equals sign (=) as a byte.
-     */
-    private final static byte EQUALS_SIGN = (byte) '=';
-
-
-    /**
-     * The new line character (\n) as a byte.
-     */
-    private final static byte NEW_LINE = (byte) '\n';
-
-
-    /**
-     * Preferred encoding.
-     */
-    private final static String PREFERRED_ENCODING = "US-ASCII";
-
-
-    private final static byte WHITE_SPACE_ENC = -5; // Indicates white space in encoding
-    private final static byte EQUALS_SIGN_ENC = -1; // Indicates equals sign in encoding
-
-
-/* ********  S T A N D A R D   B A S E 6 4   A L P H A B E T  ******** */
-
-    /**
-     * The 64 valid Base64 values.
-     */
-    /* Host platform me be something funny like EBCDIC, so we hardcode these values. */
-    private final static byte[] _STANDARD_ALPHABET = {
-            (byte) 'A', (byte) 'B', (byte) 'C', (byte) 'D', (byte) 'E', (byte) 'F', (byte) 'G',
-            (byte) 'H', (byte) 'I', (byte) 'J', (byte) 'K', (byte) 'L', (byte) 'M', (byte) 'N',
-            (byte) 'O', (byte) 'P', (byte) 'Q', (byte) 'R', (byte) 'S', (byte) 'T', (byte) 'U',
-            (byte) 'V', (byte) 'W', (byte) 'X', (byte) 'Y', (byte) 'Z',
-            (byte) 'a', (byte) 'b', (byte) 'c', (byte) 'd', (byte) 'e', (byte) 'f', (byte) 'g',
-            (byte) 'h', (byte) 'i', (byte) 'j', (byte) 'k', (byte) 'l', (byte) 'm', (byte) 'n',
-            (byte) 'o', (byte) 'p', (byte) 'q', (byte) 'r', (byte) 's', (byte) 't', (byte) 'u',
-            (byte) 'v', (byte) 'w', (byte) 'x', (byte) 'y', (byte) 'z',
-            (byte) '0', (byte) '1', (byte) '2', (byte) '3', (byte) '4', (byte) '5',
-            (byte) '6', (byte) '7', (byte) '8', (byte) '9', (byte) '+', (byte) '/'
-    };
-
-
-    /**
-     * Translates a Base64 value to either its 6-bit reconstruction value
-     * or a negative number indicating some other meaning.
-     */
-    private final static byte[] _STANDARD_DECODABET = {
-            -9, -9, -9, -9, -9, -9, -9, -9, -9,                 // Decimal  0 -  8
-            -5, -5,                                      // Whitespace: Tab and Linefeed
-            -9, -9,                                      // Decimal 11 - 12
-            -5,                                         // Whitespace: Carriage Return
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 14 - 26
-            -9, -9, -9, -9, -9,                             // Decimal 27 - 31
-            -5,                                         // Whitespace: Space
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,              // Decimal 33 - 42
-            62,                                         // Plus sign at decimal 43
-            -9, -9, -9,                                   // Decimal 44 - 46
-            63,                                         // Slash at decimal 47
-            52, 53, 54, 55, 56, 57, 58, 59, 60, 61,              // Numbers zero through nine
-            -9, -9, -9,                                   // Decimal 58 - 60
-            -1,                                         // Equals sign at decimal 61
-            -9, -9, -9,                                      // Decimal 62 - 64
-            0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,            // Letters 'A' through 'N'
-            14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,        // Letters 'O' through 'Z'
-            -9, -9, -9, -9, -9, -9,                          // Decimal 91 - 96
-            26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,     // Letters 'a' through 'm'
-            39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51,     // Letters 'n' through 'z'
-            -9, -9, -9, -9, -9                              // Decimal 123 - 127
-            , -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,       // Decimal 128 - 139
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 140 - 152
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 153 - 165
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 166 - 178
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 179 - 191
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 192 - 204
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 205 - 217
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 218 - 230
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 231 - 243
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9         // Decimal 244 - 255
-    };
-
-
-/* ********  U R L   S A F E   B A S E 6 4   A L P H A B E T  ******** */
-
-    /**
-     * Used in the URL- and Filename-safe dialect described in Section 4 of RFC3548:
-     * <a href="http://www.faqs.org/rfcs/rfc3548.html">http://www.faqs.org/rfcs/rfc3548.html</a>.
-     * Notice that the last two bytes become "hyphen" and "underscore" instead of "plus" and "slash."
-     */
-    private final static byte[] _URL_SAFE_ALPHABET = {
-            (byte) 'A', (byte) 'B', (byte) 'C', (byte) 'D', (byte) 'E', (byte) 'F', (byte) 'G',
-            (byte) 'H', (byte) 'I', (byte) 'J', (byte) 'K', (byte) 'L', (byte) 'M', (byte) 'N',
-            (byte) 'O', (byte) 'P', (byte) 'Q', (byte) 'R', (byte) 'S', (byte) 'T', (byte) 'U',
-            (byte) 'V', (byte) 'W', (byte) 'X', (byte) 'Y', (byte) 'Z',
-            (byte) 'a', (byte) 'b', (byte) 'c', (byte) 'd', (byte) 'e', (byte) 'f', (byte) 'g',
-            (byte) 'h', (byte) 'i', (byte) 'j', (byte) 'k', (byte) 'l', (byte) 'm', (byte) 'n',
-            (byte) 'o', (byte) 'p', (byte) 'q', (byte) 'r', (byte) 's', (byte) 't', (byte) 'u',
-            (byte) 'v', (byte) 'w', (byte) 'x', (byte) 'y', (byte) 'z',
-            (byte) '0', (byte) '1', (byte) '2', (byte) '3', (byte) '4', (byte) '5',
-            (byte) '6', (byte) '7', (byte) '8', (byte) '9', (byte) '-', (byte) '_'
-    };
-
-    /**
-     * Used in decoding URL- and Filename-safe dialects of Base64.
-     */
-    private final static byte[] _URL_SAFE_DECODABET = {
-            -9, -9, -9, -9, -9, -9, -9, -9, -9,                 // Decimal  0 -  8
-            -5, -5,                                      // Whitespace: Tab and Linefeed
-            -9, -9,                                      // Decimal 11 - 12
-            -5,                                         // Whitespace: Carriage Return
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 14 - 26
-            -9, -9, -9, -9, -9,                             // Decimal 27 - 31
-            -5,                                         // Whitespace: Space
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,              // Decimal 33 - 42
-            -9,                                         // Plus sign at decimal 43
-            -9,                                         // Decimal 44
-            62,                                         // Minus sign at decimal 45
-            -9,                                         // Decimal 46
-            -9,                                         // Slash at decimal 47
-            52, 53, 54, 55, 56, 57, 58, 59, 60, 61,              // Numbers zero through nine
-            -9, -9, -9,                                   // Decimal 58 - 60
-            -1,                                         // Equals sign at decimal 61
-            -9, -9, -9,                                   // Decimal 62 - 64
-            0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,            // Letters 'A' through 'N'
-            14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,        // Letters 'O' through 'Z'
-            -9, -9, -9, -9,                                // Decimal 91 - 94
-            63,                                         // Underscore at decimal 95
-            -9,                                         // Decimal 96
-            26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,     // Letters 'a' through 'm'
-            39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51,     // Letters 'n' through 'z'
-            -9, -9, -9, -9, -9                              // Decimal 123 - 127
-            , -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 128 - 139
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 140 - 152
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 153 - 165
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 166 - 178
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 179 - 191
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 192 - 204
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 205 - 217
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 218 - 230
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 231 - 243
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9         // Decimal 244 - 255
-    };
-
-
-
-/* ********  O R D E R E D   B A S E 6 4   A L P H A B E T  ******** */
-
-    /**
-     * I don't get the point of this technique, but someone requested it,
-     * and it is described here:
-     * <a href="http://www.faqs.org/qa/rfcc-1940.html">http://www.faqs.org/qa/rfcc-1940.html</a>.
-     */
-    private final static byte[] _ORDERED_ALPHABET = {
-            (byte) '-',
-            (byte) '0', (byte) '1', (byte) '2', (byte) '3', (byte) '4',
-            (byte) '5', (byte) '6', (byte) '7', (byte) '8', (byte) '9',
-            (byte) 'A', (byte) 'B', (byte) 'C', (byte) 'D', (byte) 'E', (byte) 'F', (byte) 'G',
-            (byte) 'H', (byte) 'I', (byte) 'J', (byte) 'K', (byte) 'L', (byte) 'M', (byte) 'N',
-            (byte) 'O', (byte) 'P', (byte) 'Q', (byte) 'R', (byte) 'S', (byte) 'T', (byte) 'U',
-            (byte) 'V', (byte) 'W', (byte) 'X', (byte) 'Y', (byte) 'Z',
-            (byte) '_',
-            (byte) 'a', (byte) 'b', (byte) 'c', (byte) 'd', (byte) 'e', (byte) 'f', (byte) 'g',
-            (byte) 'h', (byte) 'i', (byte) 'j', (byte) 'k', (byte) 'l', (byte) 'm', (byte) 'n',
-            (byte) 'o', (byte) 'p', (byte) 'q', (byte) 'r', (byte) 's', (byte) 't', (byte) 'u',
-            (byte) 'v', (byte) 'w', (byte) 'x', (byte) 'y', (byte) 'z'
-    };
-
-    /**
-     * Used in decoding the "ordered" dialect of Base64.
-     */
-    private final static byte[] _ORDERED_DECODABET = {
-            -9, -9, -9, -9, -9, -9, -9, -9, -9,                 // Decimal  0 -  8
-            -5, -5,                                      // Whitespace: Tab and Linefeed
-            -9, -9,                                      // Decimal 11 - 12
-            -5,                                         // Whitespace: Carriage Return
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 14 - 26
-            -9, -9, -9, -9, -9,                             // Decimal 27 - 31
-            -5,                                         // Whitespace: Space
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,              // Decimal 33 - 42
-            -9,                                         // Plus sign at decimal 43
-            -9,                                         // Decimal 44
-            0,                                          // Minus sign at decimal 45
-            -9,                                         // Decimal 46
-            -9,                                         // Slash at decimal 47
-            1, 2, 3, 4, 5, 6, 7, 8, 9, 10,                       // Numbers zero through nine
-            -9, -9, -9,                                   // Decimal 58 - 60
-            -1,                                         // Equals sign at decimal 61
-            -9, -9, -9,                                   // Decimal 62 - 64
-            11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,     // Letters 'A' through 'M'
-            24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,     // Letters 'N' through 'Z'
-            -9, -9, -9, -9,                                // Decimal 91 - 94
-            37,                                         // Underscore at decimal 95
-            -9,                                         // Decimal 96
-            38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,     // Letters 'a' through 'm'
-            51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63,     // Letters 'n' through 'z'
-            -9, -9, -9, -9, -9                                 // Decimal 123 - 127
-            , -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 128 - 139
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 140 - 152
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 153 - 165
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 166 - 178
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 179 - 191
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 192 - 204
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 205 - 217
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 218 - 230
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9,     // Decimal 231 - 243
-            -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9         // Decimal 244 - 255
-    };
-
-
-/* ********  D E T E R M I N E   W H I C H   A L H A B E T  ******** */
-
-
-    /**
-     * Returns one of the _SOMETHING_ALPHABET byte arrays depending on
-     * the options specified.
-     * It's possible, though silly, to specify ORDERED <b>and</b> URLSAFE
-     * in which case one of them will be picked, though there is
-     * no guarantee as to which one will be picked.
-     */
-    private static byte[] getAlphabet(int options) {
-        if ((options & URL_SAFE) == URL_SAFE) {
-            return _URL_SAFE_ALPHABET;
-        } else if ((options & ORDERED) == ORDERED) {
-            return _ORDERED_ALPHABET;
-        } else {
-            return _STANDARD_ALPHABET;
-        }
-    }    // end getAlphabet
-
-
-    /**
-     * Returns one of the _SOMETHING_DECODABET byte arrays depending on
-     * the options specified.
-     * It's possible, though silly, to specify ORDERED and URL_SAFE
-     * in which case one of them will be picked, though there is
-     * no guarantee as to which one will be picked.
-     */
-    private static byte[] getDecodabet(int options) {
-        if ((options & URL_SAFE) == URL_SAFE) {
-            return _URL_SAFE_DECODABET;
-        } else if ((options & ORDERED) == ORDERED) {
-            return _ORDERED_DECODABET;
-        } else {
-            return _STANDARD_DECODABET;
-        }
-    }    // end getAlphabet
-
-
-    /**
-     * Defeats instantiation.
-     */
-    private Base64() {
-    }
-
-
-
-
-/* ********  E N C O D I N G   M E T H O D S  ******** */
-
-
-    /**
-     * Encodes up to the first three bytes of array <var>threeBytes</var>
-     * and returns a four-byte array in Base64 notation.
-     * The actual number of significant bytes in your array is
-     * given by <var>numSigBytes</var>.
-     * The array <var>threeBytes</var> needs only be as big as
-     * <var>numSigBytes</var>.
-     * Code can reuse a byte array by passing a four-byte array as <var>b4</var>.
-     *
-     * @param b4          A reusable byte array to reduce array instantiation
-     * @param threeBytes  the array to convert
-     * @param numSigBytes the number of significant bytes in your array
-     * @return four byte array in Base64 notation.
-     * @since 1.5.1
-     */
-    private static byte[] encode3to4(byte[] b4, byte[] threeBytes, int numSigBytes, int options) {
-        encode3to4(threeBytes, 0, numSigBytes, b4, 0, options);
-        return b4;
-    }   // end encode3to4
-
-
-    /**
-     * <p>Encodes up to three bytes of the array <var>source</var>
-     * and writes the resulting four Base64 bytes to <var>destination</var>.
-     * The source and destination arrays can be manipulated
-     * anywhere along their length by specifying
-     * <var>srcOffset</var> and <var>destOffset</var>.
-     * This method does not check to make sure your arrays
-     * are large enough to accomodate <var>srcOffset</var> + 3 for
-     * the <var>source</var> array or <var>destOffset</var> + 4 for
-     * the <var>destination</var> array.
-     * The actual number of significant bytes in your array is
-     * given by <var>numSigBytes</var>.</p>
-     * <p>This is the lowest level of the encoding methods with
-     * all possible parameters.</p>
-     *
-     * @param source      the array to convert
-     * @param srcOffset   the index where conversion begins
-     * @param numSigBytes the number of significant bytes in your array
-     * @param destination the array to hold the conversion
-     * @param destOffset  the index where output will be put
-     * @return the <var>destination</var> array
-     * @since 1.3
-     */
-    private static byte[] encode3to4(
-            byte[] source, int srcOffset, int numSigBytes,
-            byte[] destination, int destOffset, int options) {
-
-        byte[] ALPHABET = getAlphabet(options);
-
-        //           1         2         3
-        // 01234567890123456789012345678901 Bit position
-        // --------000000001111111122222222 Array position from threeBytes
-        // --------|    ||    ||    ||    | Six bit groups to index ALPHABET
-        //          >>18  >>12  >> 6  >> 0  Right shift necessary
-        //                0x3f  0x3f  0x3f  Additional AND
-
-        // Create buffer with zero-padding if there are only one or two
-        // significant bytes passed in the array.
-        // We have to shift left 24 in order to flush out the 1's that appear
-        // when Java treats a value as negative that is cast from a byte to an int.
-        int inBuff = (numSigBytes > 0 ? ((source[srcOffset] << 24) >>> 8) : 0)
-                | (numSigBytes > 1 ? ((source[srcOffset + 1] << 24) >>> 16) : 0)
-                | (numSigBytes > 2 ? ((source[srcOffset + 2] << 24) >>> 24) : 0);
-
-        switch (numSigBytes) {
-            case 3:
-                destination[destOffset] = ALPHABET[(inBuff >>> 18)];
-                destination[destOffset + 1] = ALPHABET[(inBuff >>> 12) & 0x3f];
-                destination[destOffset + 2] = ALPHABET[(inBuff >>> 6) & 0x3f];
-                destination[destOffset + 3] = ALPHABET[(inBuff) & 0x3f];
-                return destination;
-
-            case 2:
-                destination[destOffset] = ALPHABET[(inBuff >>> 18)];
-                destination[destOffset + 1] = ALPHABET[(inBuff >>> 12) & 0x3f];
-                destination[destOffset + 2] = ALPHABET[(inBuff >>> 6) & 0x3f];
-                destination[destOffset + 3] = EQUALS_SIGN;
-                return destination;
-
-            case 1:
-                destination[destOffset] = ALPHABET[(inBuff >>> 18)];
-                destination[destOffset + 1] = ALPHABET[(inBuff >>> 12) & 0x3f];
-                destination[destOffset + 2] = EQUALS_SIGN;
-                destination[destOffset + 3] = EQUALS_SIGN;
-                return destination;
-
-            default:
-                return destination;
-        }   // end switch
-    }   // end encode3to4
-
-
-    /**
-     * Performs Base64 encoding on the <code>raw</code> ByteBuffer,
-     * writing it to the <code>encoded</code> ByteBuffer.
-     * This is an experimental feature. Currently it does not
-     * pass along any options (such as {@link #DO_BREAK_LINES}
-     * or {@link #GZIP}.
-     *
-     * @param raw     input buffer
-     * @param encoded output buffer
-     * @since 2.3
-     */
-    public static void encode(java.nio.ByteBuffer raw, java.nio.ByteBuffer encoded) {
-        byte[] raw3 = new byte[3];
-        byte[] enc4 = new byte[4];
-
-        while (raw.hasRemaining()) {
-            int rem = Math.min(3, raw.remaining());
-            raw.get(raw3, 0, rem);
-            Base64.encode3to4(enc4, raw3, rem, Base64.NO_OPTIONS);
-            encoded.put(enc4);
-        }   // end input remaining
-    }
-
-
-    /**
-     * Performs Base64 encoding on the <code>raw</code> ByteBuffer,
-     * writing it to the <code>encoded</code> CharBuffer.
-     * This is an experimental feature. Currently it does not
-     * pass along any options (such as {@link #DO_BREAK_LINES}
-     * or {@link #GZIP}.
-     *
-     * @param raw     input buffer
-     * @param encoded output buffer
-     * @since 2.3
-     */
-    public static void encode(java.nio.ByteBuffer raw, java.nio.CharBuffer encoded) {
-        byte[] raw3 = new byte[3];
-        byte[] enc4 = new byte[4];
-
-        while (raw.hasRemaining()) {
-            int rem = Math.min(3, raw.remaining());
-            raw.get(raw3, 0, rem);
-            Base64.encode3to4(enc4, raw3, rem, Base64.NO_OPTIONS);
-            for (int i = 0; i < 4; i++) {
-                encoded.put((char) (enc4[i] & 0xFF));
-            }
-        }   // end input remaining
-    }
-
-
-    /**
-     * Serializes an object and returns the Base64-encoded
-     * version of that serialized object.
-     * <p/>
-     * <p>As of v 2.3, if the object
-     * cannot be serialized or there is another error,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned a null value, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     * <p/>
-     * The object is not GZip-compressed before being encoded.
-     *
-     * @param serializableObject The object to encode
-     * @return The Base64-encoded object
-     * @throws java.io.IOException  if there is an error
-     * @throws NullPointerException if serializedObject is null
-     * @since 1.4
-     */
-    public static String encodeObject(java.io.Serializable serializableObject)
-            throws java.io.IOException {
-        return encodeObject(serializableObject, NO_OPTIONS);
-    }   // end encodeObject
-
-
-    /**
-     * Serializes an object and returns the Base64-encoded
-     * version of that serialized object.
-     * <p/>
-     * <p>As of v 2.3, if the object
-     * cannot be serialized or there is another error,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned a null value, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     * <p/>
-     * The object is not GZip-compressed before being encoded.
-     * <p/>
-     * Example options:<pre>
-     *   GZIP: gzip-compresses object before encoding it.
-     *   DO_BREAK_LINES: break lines at 76 characters
-     * </pre>
-     * <p/>
-     * Example: <code>encodeObject( myObj, Base64.GZIP )</code> or
-     * <p/>
-     * Example: <code>encodeObject( myObj, Base64.GZIP | Base64.DO_BREAK_LINES )</code>
-     *
-     * @param serializableObject The object to encode
-     * @param options            Specified options
-     * @return The Base64-encoded object
-     * @throws java.io.IOException if there is an error
-     * @see Base64#GZIP
-     * @see Base64#DO_BREAK_LINES
-     * @since 2.0
-     */
-    public static String encodeObject(java.io.Serializable serializableObject, int options)
-            throws java.io.IOException {
-
-        if (serializableObject == null) {
-            throw new NullPointerException("Cannot serialize a null object.");
-        }   // end if: null
-
-        // Streams
-        java.io.ByteArrayOutputStream baos = null;
-        java.io.OutputStream b64os = null;
-        java.util.zip.GZIPOutputStream gzos = null;
-        java.io.ObjectOutputStream oos = null;
-
-
-        try {
-            // ObjectOutputStream -> (GZIP) -> Base64 -> ByteArrayOutputStream
-            baos = new java.io.ByteArrayOutputStream();
-            b64os = new B64OutputStream(baos, ENCODE | options);
-            if ((options & GZIP) != 0) {
-                // Gzip
-                gzos = new java.util.zip.GZIPOutputStream(b64os);
-                oos = new java.io.ObjectOutputStream(gzos);
-            } else {
-                // Not gzipped
-                oos = new java.io.ObjectOutputStream(b64os);
-            }
-            oos.writeObject(serializableObject);
-        }   // end try
-        catch (java.io.IOException e) {
-            // Catch it and then throw it immediately so that
-            // the finally{} block is called for cleanup.
-            throw e;
-        }   // end catch
-        finally {
-            try {
-                oos.close();
-            } catch (Exception e) {
-            }
-            try {
-                gzos.close();
-            } catch (Exception e) {
-            }
-            try {
-                b64os.close();
-            } catch (Exception e) {
-            }
-            try {
-                baos.close();
-            } catch (Exception e) {
-            }
-        }   // end finally
-
-        // Return value according to relevant encoding.
-        try {
-            return new String(baos.toByteArray(), PREFERRED_ENCODING);
-        }   // end try
-        catch (java.io.UnsupportedEncodingException uue) {
-            // Fall back to some Java default
-            return new String(baos.toByteArray());
-        }   // end catch
-
-    }   // end encode
-
-
-    /**
-     * Encodes a byte array into Base64 notation.
-     * Does not GZip-compress data.
-     *
-     * @param source The data to convert
-     * @return The data in Base64-encoded form
-     * @throws NullPointerException if source array is null
-     * @since 1.4
-     */
-    public static String encodeBytes(byte[] source) {
-        // Since we're not going to have the GZIP encoding turned on,
-        // we're not going to have an java.io.IOException thrown, so
-        // we should not force the user to have to catch it.
-        String encoded = null;
-        try {
-            encoded = encodeBytes(source, 0, source.length, NO_OPTIONS);
-        } catch (java.io.IOException ex) {
-            assert false : ex.getMessage();
-        }   // end catch
-        assert encoded != null;
-        return encoded;
-    }   // end encodeBytes
-
-
-    /**
-     * Encodes a byte array into Base64 notation.
-     * <p>
-     * Example options:<pre>
-     *   GZIP: gzip-compresses object before encoding it.
-     *   DO_BREAK_LINES: break lines at 76 characters
-     *     <i>Note: Technically, this makes your encoding non-compliant.</i>
-     * </pre>
-     * <p>
-     * Example: <code>encodeBytes( myData, Base64.GZIP )</code> or
-     * <p>
-     * Example: <code>encodeBytes( myData, Base64.GZIP | Base64.DO_BREAK_LINES )</code>
-     * <p/>
-     * <p/>
-     * <p>As of v 2.3, if there is an error with the GZIP stream,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned a null value, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     *
-     * @param source  The data to convert
-     * @param options Specified options
-     * @return The Base64-encoded data as a String
-     * @throws java.io.IOException  if there is an error
-     * @throws NullPointerException if source array is null
-     * @see Base64#GZIP
-     * @see Base64#DO_BREAK_LINES
-     * @since 2.0
-     */
-    public static String encodeBytes(byte[] source, int options) throws java.io.IOException {
-        return encodeBytes(source, 0, source.length, options);
-    }   // end encodeBytes
-
-
-    /**
-     * Encodes a byte array into Base64 notation.
-     * Does not GZip-compress data.
-     * <p/>
-     * <p>As of v 2.3, if there is an error,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned a null value, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     *
-     * @param source The data to convert
-     * @param off    Offset in array where conversion should begin
-     * @param len    Length of data to convert
-     * @return The Base64-encoded data as a String
-     * @throws NullPointerException     if source array is null
-     * @throws IllegalArgumentException if source array, offset, or length are invalid
-     * @since 1.4
-     */
-    public static String encodeBytes(byte[] source, int off, int len) {
-        // Since we're not going to have the GZIP encoding turned on,
-        // we're not going to have an java.io.IOException thrown, so
-        // we should not force the user to have to catch it.
-        String encoded = null;
-        try {
-            encoded = encodeBytes(source, off, len, NO_OPTIONS);
-        } catch (java.io.IOException ex) {
-            assert false : ex.getMessage();
-        }   // end catch
-        assert encoded != null;
-        return encoded;
-    }   // end encodeBytes
-
-
-    /**
-     * Encodes a byte array into Base64 notation.
-     * <p>
-     * Example options:<pre>
-     *   GZIP: gzip-compresses object before encoding it.
-     *   DO_BREAK_LINES: break lines at 76 characters
-     *     <i>Note: Technically, this makes your encoding non-compliant.</i>
-     * </pre>
-     * <p>
-     * Example: <code>encodeBytes( myData, Base64.GZIP )</code> or
-     * <p>
-     * Example: <code>encodeBytes( myData, Base64.GZIP | Base64.DO_BREAK_LINES )</code>
-     * <p/>
-     * <p/>
-     * <p>As of v 2.3, if there is an error with the GZIP stream,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned a null value, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     *
-     * @param source  The data to convert
-     * @param off     Offset in array where conversion should begin
-     * @param len     Length of data to convert
-     * @param options Specified options
-     * @return The Base64-encoded data as a String
-     * @throws java.io.IOException      if there is an error
-     * @throws NullPointerException     if source array is null
-     * @throws IllegalArgumentException if source array, offset, or length are invalid
-     * @see Base64#GZIP
-     * @see Base64#DO_BREAK_LINES
-     * @since 2.0
-     */
-    public static String encodeBytes(byte[] source, int off, int len, int options) throws java.io.IOException {
-        byte[] encoded = encodeBytesToBytes(source, off, len, options);
-
-        // Return value according to relevant encoding.
-        try {
-            return new String(encoded, PREFERRED_ENCODING);
-        }   // end try
-        catch (java.io.UnsupportedEncodingException uue) {
-            return new String(encoded);
-        }   // end catch
-
-    }   // end encodeBytes
-
-
-    /**
-     * Similar to {@link #encodeBytes(byte[])} but returns
-     * a byte array instead of instantiating a String. This is more efficient
-     * if you're working with I/O streams and have large data sets to encode.
-     *
-     * @param source The data to convert
-     * @return The Base64-encoded data as a byte[] (of ASCII characters)
-     * @throws NullPointerException if source array is null
-     * @since 2.3.1
-     */
-    public static byte[] encodeBytesToBytes(byte[] source) {
-        byte[] encoded = null;
-        try {
-            encoded = encodeBytesToBytes(source, 0, source.length, Base64.NO_OPTIONS);
-        } catch (java.io.IOException ex) {
-            assert false : "IOExceptions only come from GZipping, which is turned off: " + ex.getMessage();
-        }
-        return encoded;
-    }
-
-
-    /**
-     * Similar to {@link #encodeBytes(byte[], int, int, int)} but returns
-     * a byte array instead of instantiating a String. This is more efficient
-     * if you're working with I/O streams and have large data sets to encode.
-     *
-     * @param source  The data to convert
-     * @param off     Offset in array where conversion should begin
-     * @param len     Length of data to convert
-     * @param options Specified options
-     * @return The Base64-encoded data as a String
-     * @throws java.io.IOException      if there is an error
-     * @throws NullPointerException     if source array is null
-     * @throws IllegalArgumentException if source array, offset, or length are invalid
-     * @see Base64#GZIP
-     * @see Base64#DO_BREAK_LINES
-     * @since 2.3.1
-     */
-    public static byte[] encodeBytesToBytes(byte[] source, int off, int len, int options) throws java.io.IOException {
-
-        if (source == null) {
-            throw new NullPointerException("Cannot serialize a null array.");
-        }   // end if: null
-
-        if (off < 0) {
-            throw new IllegalArgumentException("Cannot have negative offset: " + off);
-        }   // end if: off < 0
-
-        if (len < 0) {
-            throw new IllegalArgumentException("Cannot have length offset: " + len);
-        }   // end if: len < 0
-
-        if (off + len > source.length) {
-            throw new IllegalArgumentException(
-                    String.format("Cannot have offset of %d and length of %d with array of length %d", off, len, source.length));
-        }   // end if: off < 0
-
-
-        // Compress?
-        if ((options & GZIP) != 0) {
-            java.io.ByteArrayOutputStream baos = null;
-            java.util.zip.GZIPOutputStream gzos = null;
-            B64OutputStream b64os = null;
-
-            try {
-                // GZip -> Base64 -> ByteArray
-                baos = new java.io.ByteArrayOutputStream();
-                b64os = new B64OutputStream(baos, ENCODE | options);
-                gzos = new java.util.zip.GZIPOutputStream(b64os);
-
-                gzos.write(source, off, len);
-                gzos.close();
-            }   // end try
-            catch (java.io.IOException e) {
-                // Catch it and then throw it immediately so that
-                // the finally{} block is called for cleanup.
-                throw e;
-            }   // end catch
-            finally {
-                try {
-                    gzos.close();
-                } catch (Exception e) {
-                }
-                try {
-                    b64os.close();
-                } catch (Exception e) {
-                }
-                try {
-                    baos.close();
-                } catch (Exception e) {
-                }
-            }   // end finally
-
-            return baos.toByteArray();
-        }   // end if: compress
-
-        // Else, don't compress. Better not to use streams at all then.
-        else {
-            boolean breakLines = (options & DO_BREAK_LINES) != 0;
-
-            //int    len43   = len * 4 / 3;
-            //byte[] outBuff = new byte[   ( len43 )                      // Main 4:3
-            //                           + ( (len % 3) > 0 ? 4 : 0 )      // Account for padding
-            //                           + (breakLines ? ( len43 / MAX_LINE_LENGTH ) : 0) ]; // New lines
-            // Try to determine more precisely how big the array needs to be.
-            // If we get it right, we don't have to do an array copy, and
-            // we save a bunch of memory.
-            int encLen = (len / 3) * 4 + (len % 3 > 0 ? 4 : 0); // Bytes needed for actual encoding
-            if (breakLines) {
-                encLen += encLen / MAX_LINE_LENGTH; // Plus extra newline characters
-            }
-            byte[] outBuff = new byte[encLen];
-
-
-            int d = 0;
-            int e = 0;
-            int len2 = len - 2;
-            int lineLength = 0;
-            for (; d < len2; d += 3, e += 4) {
-                encode3to4(source, d + off, 3, outBuff, e, options);
-
-                lineLength += 4;
-                if (breakLines && lineLength >= MAX_LINE_LENGTH) {
-                    outBuff[e + 4] = NEW_LINE;
-                    e++;
-                    lineLength = 0;
-                }   // end if: end of line
-            }   // en dfor: each piece of array
-
-            if (d < len) {
-                encode3to4(source, d + off, len - d, outBuff, e, options);
-                e += 4;
-            }   // end if: some padding needed
-
-
-            // Only resize array if we didn't guess it right.
-            if (e <= outBuff.length - 1) {
-                // If breaking lines and the last byte falls right at
-                // the line length (76 bytes per line), there will be
-                // one extra byte, and the array will need to be resized.
-                // Not too bad of an estimate on array size, I'd say.
-                byte[] finalOut = new byte[e];
-                System.arraycopy(outBuff, 0, finalOut, 0, e);
-                //System.err.println("Having to resize array from " + outBuff.length + " to " + e );
-                return finalOut;
-            } else {
-                //System.err.println("No need to resize array.");
-                return outBuff;
-            }
-
-        }   // end else: don't compress
-
-    }   // end encodeBytesToBytes
-
-
-
-
-
-/* ********  D E C O D I N G   M E T H O D S  ******** */
-
-
-    /**
-     * Decodes four bytes from array <var>source</var>
-     * and writes the resulting bytes (up to three of them)
-     * to <var>destination</var>.
-     * The source and destination arrays can be manipulated
-     * anywhere along their length by specifying
-     * <var>srcOffset</var> and <var>destOffset</var>.
-     * This method does not check to make sure your arrays
-     * are large enough to accomodate <var>srcOffset</var> + 4 for
-     * the <var>source</var> array or <var>destOffset</var> + 3 for
-     * the <var>destination</var> array.
-     * This method returns the actual number of bytes that
-     * were converted from the Base64 encoding.
-     * <p>This is the lowest level of the decoding methods with
-     * all possible parameters.</p>
-     *
-     * @param source      the array to convert
-     * @param srcOffset   the index where conversion begins
-     * @param destination the array to hold the conversion
-     * @param destOffset  the index where output will be put
-     * @param options     alphabet type is pulled from this (standard, url-safe, ordered)
-     * @return the number of decoded bytes converted
-     * @throws NullPointerException     if source or destination arrays are null
-     * @throws IllegalArgumentException if srcOffset or destOffset are invalid
-     *                                  or there is not enough room in the array.
-     * @since 1.3
-     */
-    private static int decode4to3(
-            byte[] source, int srcOffset,
-            byte[] destination, int destOffset, int options) {
-
-        // Lots of error checking and exception throwing
-        if (source == null) {
-            throw new NullPointerException("Source array was null.");
-        }   // end if
-        if (destination == null) {
-            throw new NullPointerException("Destination array was null.");
-        }   // end if
-        if (srcOffset < 0 || srcOffset + 3 >= source.length) {
-            throw new IllegalArgumentException(String.format(
-                    "Source array with length %d cannot have offset of %d and still process four bytes.", source.length, srcOffset));
-        }   // end if
-        if (destOffset < 0 || destOffset + 2 >= destination.length) {
-            throw new IllegalArgumentException(String.format(
-                    "Destination array with length %d cannot have offset of %d and still store three bytes.", destination.length, destOffset));
-        }   // end if
-
-
-        byte[] DECODABET = getDecodabet(options);
-
-        // Example: Dk==
-        if (source[srcOffset + 2] == EQUALS_SIGN) {
-            // Two ways to do the same thing. Don't know which way I like best.
-            //int outBuff =   ( ( DECODABET[ source[ srcOffset    ] ] << 24 ) >>>  6 )
-            //              | ( ( DECODABET[ source[ srcOffset + 1] ] << 24 ) >>> 12 );
-            int outBuff = ((DECODABET[source[srcOffset]] & 0xFF) << 18)
-                    | ((DECODABET[source[srcOffset + 1]] & 0xFF) << 12);
-
-            destination[destOffset] = (byte) (outBuff >>> 16);
-            return 1;
-        }
-
-        // Example: DkL=
-        else if (source[srcOffset + 3] == EQUALS_SIGN) {
-            // Two ways to do the same thing. Don't know which way I like best.
-            //int outBuff =   ( ( DECODABET[ source[ srcOffset     ] ] << 24 ) >>>  6 )
-            //              | ( ( DECODABET[ source[ srcOffset + 1 ] ] << 24 ) >>> 12 )
-            //              | ( ( DECODABET[ source[ srcOffset + 2 ] ] << 24 ) >>> 18 );
-            int outBuff = ((DECODABET[source[srcOffset]] & 0xFF) << 18)
-                    | ((DECODABET[source[srcOffset + 1]] & 0xFF) << 12)
-                    | ((DECODABET[source[srcOffset + 2]] & 0xFF) << 6);
-
-            destination[destOffset] = (byte) (outBuff >>> 16);
-            destination[destOffset + 1] = (byte) (outBuff >>> 8);
-            return 2;
-        }
-
-        // Example: DkLE
-        else {
-            // Two ways to do the same thing. Don't know which way I like best.
-            //int outBuff =   ( ( DECODABET[ source[ srcOffset     ] ] << 24 ) >>>  6 )
-            //              | ( ( DECODABET[ source[ srcOffset + 1 ] ] << 24 ) >>> 12 )
-            //              | ( ( DECODABET[ source[ srcOffset + 2 ] ] << 24 ) >>> 18 )
-            //              | ( ( DECODABET[ source[ srcOffset + 3 ] ] << 24 ) >>> 24 );
-            int outBuff = ((DECODABET[source[srcOffset]] & 0xFF) << 18)
-                    | ((DECODABET[source[srcOffset + 1]] & 0xFF) << 12)
-                    | ((DECODABET[source[srcOffset + 2]] & 0xFF) << 6)
-                    | ((DECODABET[source[srcOffset + 3]] & 0xFF));
-
-
-            destination[destOffset] = (byte) (outBuff >> 16);
-            destination[destOffset + 1] = (byte) (outBuff >> 8);
-            destination[destOffset + 2] = (byte) (outBuff);
-
-            return 3;
-        }
-    }   // end decodeToBytes
-
-
-    /**
-     * Low-level access to decoding ASCII characters in
-     * the form of a byte array. <strong>Ignores GUNZIP option, if
-     * it's set.</strong> This is not generally a recommended method,
-     * although it is used internally as part of the decoding process.
-     * Special case: if len = 0, an empty array is returned. Still,
-     * if you need more speed and reduced memory footprint (and aren't
-     * gzipping), consider this method.
-     *
-     * @param source The Base64 encoded data
-     * @return decoded data
-     * @since 2.3.1
-     */
-    public static byte[] decode(byte[] source)
-            throws java.io.IOException {
-        byte[] decoded = null;
-//        try {
-        decoded = decode(source, 0, source.length, Base64.NO_OPTIONS);
-//        } catch( java.io.IOException ex ) {
-//            assert false : "IOExceptions only come from GZipping, which is turned off: " + ex.getMessage();
-//        }
-        return decoded;
-    }
-
-
-    /**
-     * Low-level access to decoding ASCII characters in
-     * the form of a byte array. <strong>Ignores GUNZIP option, if
-     * it's set.</strong> This is not generally a recommended method,
-     * although it is used internally as part of the decoding process.
-     * Special case: if len = 0, an empty array is returned. Still,
-     * if you need more speed and reduced memory footprint (and aren't
-     * gzipping), consider this method.
-     *
-     * @param source  The Base64 encoded data
-     * @param off     The offset of where to begin decoding
-     * @param len     The length of characters to decode
-     * @param options Can specify options such as alphabet type to use
-     * @return decoded data
-     * @throws java.io.IOException If bogus characters exist in source data
-     * @since 1.3
-     */
-    public static byte[] decode(byte[] source, int off, int len, int options)
-            throws java.io.IOException {
-
-        // Lots of error checking and exception throwing
-        if (source == null) {
-            throw new NullPointerException("Cannot decode null source array.");
-        }   // end if
-        if (off < 0 || off + len > source.length) {
-            throw new IllegalArgumentException(String.format(
-                    "Source array with length %d cannot have offset of %d and process %d bytes.", source.length, off, len));
-        }   // end if
-
-        if (len == 0) {
-            return new byte[0];
-        } else if (len < 4) {
-            throw new IllegalArgumentException(
-                    "Base64-encoded string must have at least four characters, but length specified was " + len);
-        }   // end if
-
-        byte[] DECODABET = getDecodabet(options);
-
-        int len34 = len * 3 / 4;       // Estimate on array size
-        byte[] outBuff = new byte[len34]; // Upper limit on size of output
-        int outBuffPosn = 0;             // Keep track of where we're writing
-
-        byte[] b4 = new byte[4];     // Four byte buffer from source, eliminating white space
-        int b4Posn = 0;               // Keep track of four byte input buffer
-        int i = 0;               // Source array counter
-        byte sbiDecode = 0;               // Special value from DECODABET
-
-        for (i = off; i < off + len; i++) {  // Loop through source
-
-            sbiDecode = DECODABET[source[i] & 0xFF];
-
-            // White space, Equals sign, or legit Base64 character
-            // Note the values such as -5 and -9 in the
-            // DECODABETs at the top of the file.
-            if (sbiDecode >= WHITE_SPACE_ENC) {
-                if (sbiDecode >= EQUALS_SIGN_ENC) {
-                    b4[b4Posn++] = source[i];         // Save non-whitespace
-                    if (b4Posn > 3) {                  // Time to decode?
-                        outBuffPosn += decode4to3(b4, 0, outBuff, outBuffPosn, options);
-                        b4Posn = 0;
-
-                        // If that was the equals sign, break out of 'for' loop
-                        if (source[i] == EQUALS_SIGN) {
-                            break;
-                        }   // end if: equals sign
-                    }   // end if: quartet built
-                }   // end if: equals sign or better
-            }   // end if: white space, equals sign or better
-            else {
-                // There's a bad input character in the Base64 stream.
-                throw new java.io.IOException(String.format(
-                        "Bad Base64 input character decimal %d in array position %d", ((int) source[i]) & 0xFF, i));
-            }   // end else:
-        }   // each input character
-
-        byte[] out = new byte[outBuffPosn];
-        System.arraycopy(outBuff, 0, out, 0, outBuffPosn);
-        return out;
-    }   // end decode
-
-
-    /**
-     * Decodes data from Base64 notation, automatically
-     * detecting gzip-compressed data and decompressing it.
-     *
-     * @param s the string to decode
-     * @return the decoded data
-     * @throws java.io.IOException If there is a problem
-     * @since 1.4
-     */
-    public static byte[] decode(String s) throws java.io.IOException {
-        return decode(s, NO_OPTIONS);
-    }
-
-
-    /**
-     * Decodes data from Base64 notation, automatically
-     * detecting gzip-compressed data and decompressing it.
-     *
-     * @param s       the string to decode
-     * @param options encode options such as URL_SAFE
-     * @return the decoded data
-     * @throws java.io.IOException  if there is an error
-     * @throws NullPointerException if <tt>s</tt> is null
-     * @since 1.4
-     */
-    public static byte[] decode(String s, int options) throws java.io.IOException {
-
-        if (s == null) {
-            throw new NullPointerException("Input string was null.");
-        }   // end if
-
-        byte[] bytes;
-        try {
-            bytes = s.getBytes(PREFERRED_ENCODING);
-        }   // end try
-        catch (java.io.UnsupportedEncodingException uee) {
-            bytes = s.getBytes();
-        }   // end catch
-        //</change>
-
-        // Decode
-        bytes = decode(bytes, 0, bytes.length, options);
-
-        // Check to see if it's gzip-compressed
-        // GZIP Magic Two-Byte Number: 0x8b1f (35615)
-        boolean dontGunzip = (options & DONT_GUNZIP) != 0;
-        if ((bytes != null) && (bytes.length >= 4) && (!dontGunzip)) {
-
-            int head = ((int) bytes[0] & 0xff) | ((bytes[1] << 8) & 0xff00);
-            if (java.util.zip.GZIPInputStream.GZIP_MAGIC == head) {
-                java.io.ByteArrayInputStream bais = null;
-                java.util.zip.GZIPInputStream gzis = null;
-                java.io.ByteArrayOutputStream baos = null;
-                byte[] buffer = new byte[2048];
-                int length = 0;
-
-                try {
-                    baos = new java.io.ByteArrayOutputStream();
-                    bais = new java.io.ByteArrayInputStream(bytes);
-                    gzis = new java.util.zip.GZIPInputStream(bais);
-
-                    while ((length = gzis.read(buffer)) >= 0) {
-                        baos.write(buffer, 0, length);
-                    }   // end while: reading input
-
-                    // No error? Get new bytes.
-                    bytes = baos.toByteArray();
-
-                }   // end try
-                catch (java.io.IOException e) {
-                    e.printStackTrace();
-                    // Just return originally-decoded bytes
-                }   // end catch
-                finally {
-                    try {
-                        baos.close();
-                    } catch (Exception e) {
-                    }
-                    try {
-                        gzis.close();
-                    } catch (Exception e) {
-                    }
-                    try {
-                        bais.close();
-                    } catch (Exception e) {
-                    }
-                }   // end finally
-
-            }   // end if: gzipped
-        }   // end if: bytes.length >= 2
-
-        return bytes;
-    }   // end decode
-
-
-    /**
-     * Attempts to decode Base64 data and deserialize a Java
-     * Object within. Returns <tt>null</tt> if there was an error.
-     *
-     * @param encodedObject The Base64 data to decode
-     * @return The decoded and deserialized object
-     * @throws NullPointerException   if encodedObject is null
-     * @throws java.io.IOException    if there is a general error
-     * @throws ClassNotFoundException if the decoded object is of a
-     *                                class that cannot be found by the JVM
-     * @since 1.5
-     */
-    public static Object decodeToObject(String encodedObject)
-            throws java.io.IOException, java.lang.ClassNotFoundException {
-        return decodeToObject(encodedObject, NO_OPTIONS, null);
-    }
-
-
-    /**
-     * Attempts to decode Base64 data and deserialize a Java
-     * Object within. Returns <tt>null</tt> if there was an error.
-     * If <tt>loader</tt> is not null, it will be the class loader
-     * used when deserializing.
-     *
-     * @param encodedObject The Base64 data to decode
-     * @param options       Various parameters related to decoding
-     * @param loader        Optional class loader to use in deserializing classes.
-     * @return The decoded and deserialized object
-     * @throws NullPointerException   if encodedObject is null
-     * @throws java.io.IOException    if there is a general error
-     * @throws ClassNotFoundException if the decoded object is of a
-     *                                class that cannot be found by the JVM
-     * @since 2.3.4
-     */
-    public static Object decodeToObject(
-            String encodedObject, int options, final ClassLoader loader)
-            throws java.io.IOException, java.lang.ClassNotFoundException {
-
-        // Decode and gunzip if necessary
-        byte[] objBytes = decode(encodedObject, options);
-
-        java.io.ByteArrayInputStream bais = null;
-        java.io.ObjectInputStream ois = null;
-        Object obj = null;
-
-        try {
-            bais = new java.io.ByteArrayInputStream(objBytes);
-
-            // If no custom class loader is provided, use Java's builtin OIS.
-            if (loader == null) {
-                ois = new java.io.ObjectInputStream(bais);
-            }   // end if: no loader provided
-
-            // Else make a customized object input stream that uses
-            // the provided class loader.
-            else {
-                ois = new java.io.ObjectInputStream(bais) {
-                    @Override
-                    public Class<?> resolveClass(java.io.ObjectStreamClass streamClass)
-                            throws java.io.IOException, ClassNotFoundException {
-                        Class c = Class.forName(streamClass.getName(), false, loader);
-                        if (c == null) {
-                            return super.resolveClass(streamClass);
-                        } else {
-                            return c;   // Class loader knows of this class.
-                        }   // end else: not null
-                    }   // end resolveClass
-                };  // end ois
-            }   // end else: no custom class loader
-
-            obj = ois.readObject();
-        }   // end try
-        catch (java.io.IOException e) {
-            throw e;    // Catch and throw in order to execute finally{}
-        }   // end catch
-        catch (java.lang.ClassNotFoundException e) {
-            throw e;    // Catch and throw in order to execute finally{}
-        }   // end catch
-        finally {
-            try {
-                bais.close();
-            } catch (Exception e) {
-            }
-            try {
-                ois.close();
-            } catch (Exception e) {
-            }
-        }   // end finally
-
-        return obj;
-    }   // end decodeObject
-
-
-    /**
-     * Convenience method for encoding data to a file.
-     * <p/>
-     * <p>As of v 2.3, if there is a error,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned false, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     *
-     * @param dataToEncode byte array of data to encode in base64 form
-     * @param filename     Filename for saving encoded data
-     * @throws java.io.IOException  if there is an error
-     * @throws NullPointerException if dataToEncode is null
-     * @since 2.1
-     */
-    public static void encodeToFile(byte[] dataToEncode, String filename)
-            throws java.io.IOException {
-
-        if (dataToEncode == null) {
-            throw new NullPointerException("Data to encode was null.");
-        }   // end iff
-
-        B64OutputStream bos = null;
-        try {
-            bos = new B64OutputStream(
-                    new java.io.FileOutputStream(filename), Base64.ENCODE);
-            bos.write(dataToEncode);
-        }   // end try
-        catch (java.io.IOException e) {
-            throw e; // Catch and throw to execute finally{} block
-        }   // end catch: java.io.IOException
-        finally {
-            try {
-                bos.close();
-            } catch (Exception e) {
-            }
-        }   // end finally
-
-    }   // end encodeToFile
-
-
-    /**
-     * Convenience method for decoding data to a file.
-     * <p/>
-     * <p>As of v 2.3, if there is a error,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned false, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     *
-     * @param dataToDecode Base64-encoded data as a string
-     * @param filename     Filename for saving decoded data
-     * @throws java.io.IOException if there is an error
-     * @since 2.1
-     */
-    public static void decodeToFile(String dataToDecode, String filename)
-            throws java.io.IOException {
-
-        B64OutputStream bos = null;
-        try {
-            bos = new B64OutputStream(
-                    new java.io.FileOutputStream(filename), Base64.DECODE);
-            bos.write(dataToDecode.getBytes(PREFERRED_ENCODING));
-        }   // end try
-        catch (java.io.IOException e) {
-            throw e; // Catch and throw to execute finally{} block
-        }   // end catch: java.io.IOException
-        finally {
-            try {
-                bos.close();
-            } catch (Exception e) {
-            }
-        }   // end finally
-
-    }   // end decodeToFile
-
-
-    /**
-     * Convenience method for reading a base64-encoded
-     * file and decoding it.
-     * <p/>
-     * <p>As of v 2.3, if there is a error,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned false, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     *
-     * @param filename Filename for reading encoded data
-     * @return decoded byte array
-     * @throws java.io.IOException if there is an error
-     * @since 2.1
-     */
-    public static byte[] decodeFromFile(String filename)
-            throws java.io.IOException {
-
-        byte[] decodedData = null;
-        B64InputStream bis = null;
-        try {
-            // Set up some useful variables
-            java.io.File file = new java.io.File(filename);
-            byte[] buffer = null;
-            int length = 0;
-            int numBytes = 0;
-
-            // Check for size of file
-            if (file.length() > Integer.MAX_VALUE) {
-                throw new java.io.IOException("File is too big for this convenience method (" + file.length() + " bytes).");
-            }   // end if: file too big for int index
-            buffer = new byte[(int) file.length()];
-
-            // Open a stream
-            bis = new B64InputStream(
-                    new java.io.BufferedInputStream(
-                            new java.io.FileInputStream(file)), Base64.DECODE);
-
-            // Read until done
-            while ((numBytes = bis.read(buffer, length, 4096)) >= 0) {
-                length += numBytes;
-            }   // end while
-
-            // Save in a variable to return
-            decodedData = new byte[length];
-            System.arraycopy(buffer, 0, decodedData, 0, length);
-
-        }   // end try
-        catch (java.io.IOException e) {
-            throw e; // Catch and release to execute finally{}
-        }   // end catch: java.io.IOException
-        finally {
-            try {
-                bis.close();
-            } catch (Exception e) {
-            }
-        }   // end finally
-
-        return decodedData;
-    }   // end decodeFromFile
-
-
-    /**
-     * Convenience method for reading a binary file
-     * and base64-encoding it.
-     * <p/>
-     * <p>As of v 2.3, if there is a error,
-     * the method will throw an java.io.IOException. <b>This is new to v2.3!</b>
-     * In earlier versions, it just returned false, but
-     * in retrospect that's a pretty poor way to handle it.</p>
-     *
-     * @param filename Filename for reading binary data
-     * @return base64-encoded string
-     * @throws java.io.IOException if there is an error
-     * @since 2.1
-     */
-    public static String encodeFromFile(String filename)
-            throws java.io.IOException {
-
-        String encodedData = null;
-        B64InputStream bis = null;
-        try {
-            // Set up some useful variables
-            java.io.File file = new java.io.File(filename);
-            byte[] buffer = new byte[Math.max((int) (file.length() * 1.4 + 1), 40)]; // Need max() for math on small files (v2.2.1); Need +1 for a few corner cases (v2.3.5)
-            int length = 0;
-            int numBytes = 0;
-
-            // Open a stream
-            bis = new B64InputStream(
-                    new java.io.BufferedInputStream(
-                            new java.io.FileInputStream(file)), Base64.ENCODE);
-
-            // Read until done
-            while ((numBytes = bis.read(buffer, length, 4096)) >= 0) {
-                length += numBytes;
-            }   // end while
-
-            // Save in a variable to return
-            encodedData = new String(buffer, 0, length, Base64.PREFERRED_ENCODING);
-
-        }   // end try
-        catch (java.io.IOException e) {
-            throw e; // Catch and release to execute finally{}
-        }   // end catch: java.io.IOException
-        finally {
-            try {
-                bis.close();
-            } catch (Exception e) {
-            }
-        }   // end finally
-
-        return encodedData;
-    }   // end encodeFromFile
-
-    /**
-     * Reads <tt>infile</tt> and encodes it to <tt>outfile</tt>.
-     *
-     * @param infile  Input file
-     * @param outfile Output file
-     * @throws java.io.IOException if there is an error
-     * @since 2.2
-     */
-    public static void encodeFileToFile(String infile, String outfile)
-            throws java.io.IOException {
-
-        String encoded = Base64.encodeFromFile(infile);
-        java.io.OutputStream out = null;
-        try {
-            out = new java.io.BufferedOutputStream(
-                    new java.io.FileOutputStream(outfile));
-            out.write(encoded.getBytes("US-ASCII")); // Strict, 7-bit output.
-        }   // end try
-        catch (java.io.IOException e) {
-            throw e; // Catch and release to execute finally{}
-        }   // end catch
-        finally {
-            try {
-                out.close();
-            } catch (Exception ex) {
-            }
-        }   // end finally
-    }   // end encodeFileToFile
-
-
-    /**
-     * Reads <tt>infile</tt> and decodes it to <tt>outfile</tt>.
-     *
-     * @param infile  Input file
-     * @param outfile Output file
-     * @throws java.io.IOException if there is an error
-     * @since 2.2
-     */
-    public static void decodeFileToFile(String infile, String outfile)
-            throws java.io.IOException {
-
-        byte[] decoded = Base64.decodeFromFile(infile);
-        java.io.OutputStream out = null;
-        try {
-            out = new java.io.BufferedOutputStream(
-                    new java.io.FileOutputStream(outfile));
-            out.write(decoded);
-        }   // end try
-        catch (java.io.IOException e) {
-            throw e; // Catch and release to execute finally{}
-        }   // end catch
-        finally {
-            try {
-                out.close();
-            } catch (Exception ex) {
-            }
-        }   // end finally
-    }   // end decodeFileToFile
-
-
-    /* ********  I N N E R   C L A S S   I N P U T S T R E A M  ******** */
-
-
-    /**
-     * A {@link com.dd.plist.Base64.B64InputStream} will read data from another
-     * <tt>java.io.InputStream</tt>, given in the constructor,
-     * and encode/decode to/from Base64 notation on the fly.
-     *
-     * @see Base64
-     * @since 1.3
-     */
-    public static class B64InputStream extends java.io.FilterInputStream {
-
-        private boolean encode;         // Encoding or decoding
-        private int position;       // Current position in the buffer
-        private byte[] buffer;         // Small buffer holding converted data
-        private int bufferLength;   // Length of buffer (3 or 4)
-        private int numSigBytes;    // Number of meaningful bytes in the buffer
-        private int lineLength;
-        private boolean breakLines;     // Break lines at less than 80 characters
-        private int options;        // Record options used to create the stream.
-        private byte[] decodabet;      // Local copies to avoid extra method calls
-
-
-        /**
-         * Constructs a {@link com.dd.plist.Base64.B64InputStream} in DECODE mode.
-         *
-         * @param in the <tt>java.io.InputStream</tt> from which to read data.
-         * @since 1.3
-         */
-        public B64InputStream(java.io.InputStream in) {
-            this(in, DECODE);
-        }   // end constructor
-
-
-        /**
-         * Constructs a {@link com.dd.plist.Base64.B64InputStream} in
-         * either ENCODE or DECODE mode.
-         * <p/>
-         * Valid options:<pre>
-         *   ENCODE or DECODE: Encode or Decode as data is read.
-         *   DO_BREAK_LINES: break lines at 76 characters
-         *     (only meaningful when encoding)</i>
-         * </pre>
-         * <p/>
-         * Example: <code>new Base64.B64InputStream( in, Base64.DECODE )</code>
-         *
-         * @param in      the <tt>java.io.InputStream</tt> from which to read data.
-         * @param options Specified options
-         * @see Base64#ENCODE
-         * @see Base64#DECODE
-         * @see Base64#DO_BREAK_LINES
-         * @since 2.0
-         */
-        public B64InputStream(java.io.InputStream in, int options) {
-
-            super(in);
-            this.options = options; // Record for later
-            this.breakLines = (options & DO_BREAK_LINES) > 0;
-            this.encode = (options & ENCODE) > 0;
-            this.bufferLength = encode ? 4 : 3;
-            this.buffer = new byte[bufferLength];
-            this.position = -1;
-            this.lineLength = 0;
-            this.decodabet = getDecodabet(options);
-        }   // end constructor
-
-        /**
-         * Reads enough of the input stream to convert
-         * to/from Base64 and returns the next byte.
-         *
-         * @return next byte
-         * @since 1.3
-         */
-        @Override
-        public int read() throws java.io.IOException {
-
-            // Do we need to get data?
-            if (position < 0) {
-                if (encode) {
-                    byte[] b3 = new byte[3];
-                    int numBinaryBytes = 0;
-                    for (int i = 0; i < 3; i++) {
-                        int b = in.read();
-
-                        // If end of stream, b is -1.
-                        if (b >= 0) {
-                            b3[i] = (byte) b;
-                            numBinaryBytes++;
-                        } else {
-                            break; // out of for loop
-                        }   // end else: end of stream
-
-                    }   // end for: each needed input byte
-
-                    if (numBinaryBytes > 0) {
-                        encode3to4(b3, 0, numBinaryBytes, buffer, 0, options);
-                        position = 0;
-                        numSigBytes = 4;
-                    }   // end if: got data
-                    else {
-                        return -1;  // Must be end of stream
-                    }   // end else
-                }   // end if: encoding
-
-                // Else decoding
-                else {
-                    byte[] b4 = new byte[4];
-                    int i = 0;
-                    for (i = 0; i < 4; i++) {
-                        // Read four "meaningful" bytes:
-                        int b = 0;
-                        do {
-                            b = in.read();
-                        }
-                        while (b >= 0 && decodabet[b & 0x7f] <= WHITE_SPACE_ENC);
-
-                        if (b < 0) {
-                            break; // Reads a -1 if end of stream
-                        }   // end if: end of stream
-
-                        b4[i] = (byte) b;
-                    }   // end for: each needed input byte
-
-                    if (i == 4) {
-                        numSigBytes = decode4to3(b4, 0, buffer, 0, options);
-                        position = 0;
-                    }   // end if: got four characters
-                    else if (i == 0) {
-                        return -1;
-                    }   // end else if: also padded correctly
-                    else {
-                        // Must have broken out from above.
-                        throw new java.io.IOException("Improperly padded Base64 input.");
-                    }   // end
-
-                }   // end else: decode
-            }   // end else: get data
-
-            // Got data?
-            if (position >= 0) {
-                // End of relevant data?
-                if ( /*!encode &&*/ position >= numSigBytes) {
-                    return -1;
-                }   // end if: got data
-
-                if (encode && breakLines && lineLength >= MAX_LINE_LENGTH) {
-                    lineLength = 0;
-                    return '\n';
-                }   // end if
-                else {
-                    lineLength++;   // This isn't important when decoding
-                    // but throwing an extra "if" seems
-                    // just as wasteful.
-
-                    int b = buffer[position++];
-
-                    if (position >= bufferLength) {
-                        position = -1;
-                    }   // end if: end
-
-                    return b & 0xFF; // This is how you "cast" a byte that's
-                    // intended to be unsigned.
-                }   // end else
-            }   // end if: position >= 0
-
-            // Else error
-            else {
-                throw new java.io.IOException("Error in Base64 code reading stream.");
-            }   // end else
-        }   // end read
-
-
-        /**
-         * Calls {@link #read()} repeatedly until the end of stream
-         * is reached or <var>len</var> bytes are read.
-         * Returns number of bytes read into array or -1 if
-         * end of stream is encountered.
-         *
-         * @param dest array to hold values
-         * @param off  offset for array
-         * @param len  max number of bytes to read into array
-         * @return bytes read into array or -1 if end of stream is encountered.
-         * @since 1.3
-         */
-        @Override
-        public int read(byte[] dest, int off, int len)
-                throws java.io.IOException {
-            int i;
-            int b;
-            for (i = 0; i < len; i++) {
-                b = read();
-
-                if (b >= 0) {
-                    dest[off + i] = (byte) b;
-                } else if (i == 0) {
-                    return -1;
-                } else {
-                    break; // Out of 'for' loop
-                } // Out of 'for' loop
-            }   // end for: each byte read
-            return i;
-        }   // end read
-
-    }   // end inner class B64InputStream
-
-
-
-
-
-
-    /* ********  I N N E R   C L A S S   O U T P U T S T R E A M  ******** */
-
-
-    /**
-     * A {@link com.dd.plist.Base64.B64OutputStream} will write data to another
-     * <tt>java.io.OutputStream</tt>, given in the constructor,
-     * and encode/decode to/from Base64 notation on the fly.
-     *
-     * @see Base64
-     * @since 1.3
-     */
-    public static class B64OutputStream extends java.io.FilterOutputStream {
-
-        private boolean encode;
-        private int position;
-        private byte[] buffer;
-        private int bufferLength;
-        private int lineLength;
-        private boolean breakLines;
-        private byte[] b4;         // Scratch used in a few places
-        private boolean suspendEncoding;
-        private int options;    // Record for later
-        private byte[] decodabet;  // Local copies to avoid extra method calls
-
-        /**
-         * Constructs a {@link com.dd.plist.Base64.B64OutputStream} in ENCODE mode.
-         *
-         * @param out the <tt>java.io.OutputStream</tt> to which data will be written.
-         * @since 1.3
-         */
-        public B64OutputStream(java.io.OutputStream out) {
-            this(out, ENCODE);
-        }   // end constructor
-
-
-        /**
-         * Constructs a {@link com.dd.plist.Base64.B64OutputStream} in
-         * either ENCODE or DECODE mode.
-         * <p/>
-         * Valid options:<pre>
-         *   ENCODE or DECODE: Encode or Decode as data is read.
-         *   DO_BREAK_LINES: don't break lines at 76 characters
-         *     (only meaningful when encoding)</i>
-         * </pre>
-         * <p/>
-         * Example: <code>new Base64.B64OutputStream( out, Base64.ENCODE )</code>
-         *
-         * @param out     the <tt>java.io.B64OutputStream</tt> to which data will be written.
-         * @param options Specified options.
-         * @see Base64#ENCODE
-         * @see Base64#DECODE
-         * @see Base64#DO_BREAK_LINES
-         * @since 1.3
-         */
-        public B64OutputStream(java.io.OutputStream out, int options) {
-            super(out);
-            this.breakLines = (options & DO_BREAK_LINES) != 0;
-            this.encode = (options & ENCODE) != 0;
-            this.bufferLength = encode ? 3 : 4;
-            this.buffer = new byte[bufferLength];
-            this.position = 0;
-            this.lineLength = 0;
-            this.suspendEncoding = false;
-            this.b4 = new byte[4];
-            this.options = options;
-            this.decodabet = getDecodabet(options);
-        }   // end constructor
-
-
-        /**
-         * Writes the byte to the output stream after
-         * converting to/from Base64 notation.
-         * When encoding, bytes are buffered three
-         * at a time before the output stream actually
-         * gets a write() call.
-         * When decoding, bytes are buffered four
-         * at a time.
-         *
-         * @param theByte the byte to write
-         * @since 1.3
-         */
-        @Override
-        public void write(int theByte)
-                throws java.io.IOException {
-            // Encoding suspended?
-            if (suspendEncoding) {
-                this.out.write(theByte);
-                return;
-            }   // end if: supsended
-
-            // Encode?
-            if (encode) {
-                buffer[position++] = (byte) theByte;
-                if (position >= bufferLength) { // Enough to encode.
-
-                    this.out.write(encode3to4(b4, buffer, bufferLength, options));
-
-                    lineLength += 4;
-                    if (breakLines && lineLength >= MAX_LINE_LENGTH) {
-                        this.out.write(NEW_LINE);
-                        lineLength = 0;
-                    }   // end if: end of line
-
-                    position = 0;
-                }   // end if: enough to output
-            }   // end if: encoding
-
-            // Else, Decoding
-            else {
-                // Meaningful Base64 character?
-                if (decodabet[theByte & 0x7f] > WHITE_SPACE_ENC) {
-                    buffer[position++] = (byte) theByte;
-                    if (position >= bufferLength) { // Enough to output.
-
-                        int len = Base64.decode4to3(buffer, 0, b4, 0, options);
-                        out.write(b4, 0, len);
-                        position = 0;
-                    }   // end if: enough to output
-                }   // end if: meaningful base64 character
-                else if (decodabet[theByte & 0x7f] != WHITE_SPACE_ENC) {
-                    throw new java.io.IOException("Invalid character in Base64 data.");
-                }   // end else: not white space either
-            }   // end else: decoding
-        }   // end write
-
-
-        /**
-         * Calls {@link #write(int)} repeatedly until <var>len</var>
-         * bytes are written.
-         *
-         * @param theBytes array from which to read bytes
-         * @param off      offset for array
-         * @param len      max number of bytes to read into array
-         * @since 1.3
-         */
-        @Override
-        public void write(byte[] theBytes, int off, int len)
-                throws java.io.IOException {
-            // Encoding suspended?
-            if (suspendEncoding) {
-                this.out.write(theBytes, off, len);
-                return;
-            }   // end if: supsended
-
-            for (int i = 0; i < len; i++) {
-                write(theBytes[off + i]);
-            }   // end for: each byte written
-
-        }   // end write
-
-
-        /**
-         * Method added by PHIL. [Thanks, PHIL. -Rob]
-         * This pads the buffer without closing the stream.
-         *
-         * @throws java.io.IOException if there's an error.
-         */
-        public void flushBase64() throws java.io.IOException {
-            if (position > 0) {
-                if (encode) {
-                    out.write(encode3to4(b4, buffer, position, options));
-                    position = 0;
-                }   // end if: encoding
-                else {
-                    throw new java.io.IOException("Base64 input not properly padded.");
-                }   // end else: decoding
-            }   // end if: buffer partially full
-
-        }   // end flush
-
-
-        /**
-         * Flushes and closes (I think, in the superclass) the stream.
-         *
-         * @since 1.3
-         */
-        @Override
-        public void close() throws java.io.IOException {
-            // 1. Ensure that pending characters are written
-            flushBase64();
-
-            // 2. Actually close the stream
-            // Base class both flushes and closes.
-            super.close();
-
-            buffer = null;
-            out = null;
-        }   // end close
-
-
-        /**
-         * Suspends encoding of the stream.
-         * May be helpful if you need to embed a piece of
-         * base64-encoded data in a stream.
-         *
-         * @throws java.io.IOException if there's an error flushing
-         * @since 1.5.1
-         */
-        public void suspendEncoding() throws java.io.IOException {
-            flushBase64();
-            this.suspendEncoding = true;
-        }   // end suspendEncoding
-
-
-        /**
-         * Resumes encoding of the stream.
-         * May be helpful if you need to embed a piece of
-         * base64-encoded data in a stream.
-         *
-         * @since 1.5.1
-         */
-        public void resumeEncoding() {
-            this.suspendEncoding = false;
-        }   // end resumeEncoding
-
-
-    }   // end inner class B64OutputStream
-
-
-}   // end class Base64
diff --git a/third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListParser.java b/third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListParser.java
deleted file mode 100644
index ee2ca7a..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListParser.java
+++ /dev/null
@@ -1,541 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011-2014 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.io.InputStream;
-import java.math.BigInteger;
-
-/**
- * Parses property lists that are in Apple's binary format.
- * Use this class when you are sure about the format of the property list.
- * Otherwise use the PropertyListParser class.
- * <p/>
- * Parsing is done by calling the static <code>parse</code> methods.
- *
- * @author Daniel Dreibrodt
- */
-public class BinaryPropertyListParser {
-
-    private int majorVersion, minorVersion;
-
-    /**
-     * property list in bytes *
-     */
-    private byte[] bytes;
-    /**
-     * Length of an offset definition in bytes *
-     */
-    private int offsetSize;
-    /**
-     * Length of an object reference in bytes *
-     */
-    private int objectRefSize;
-    /**
-     * Number of objects stored in this property list *
-     */
-    private int numObjects;
-    /**
-     * Reference to the top object of the property list *
-     */
-    private int topObject;
-    /**
-     * Offset of the offset table from the beginning of the file *
-     */
-    private int offsetTableOffset;
-    /**
-     * The table holding the information at which offset each object is found *
-     */
-    private int[] offsetTable;
-
-    /**
-     * Protected constructor so that instantiation is fully controlled by the
-     * static parse methods.
-     *
-     * @see BinaryPropertyListParser#parse(byte[])
-     */
-    protected BinaryPropertyListParser() {
-        /** empty **/
-    }
-
-    /**
-     * Parses a binary property list from a byte array.
-     *
-     * @param data The binary property list's data.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    public static NSObject parse(byte[] data) throws IOException, PropertyListFormatException {
-        BinaryPropertyListParser parser = new BinaryPropertyListParser();
-        return parser.doParse(data);
-    }
-
-    /**
-     * Parses a binary property list from a byte array.
-     *
-     * @param data The binary property list's data.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    private NSObject doParse(byte[] data) throws IOException, PropertyListFormatException {
-        bytes = data;
-        String magic = new String(copyOfRange(bytes, 0, 8));
-        if (!magic.startsWith("bplist")) {
-            throw new IllegalArgumentException("The given data is no binary property list. Wrong magic bytes: " + magic);
-        }
-
-        majorVersion = magic.charAt(6) - 0x30; //ASCII number
-        minorVersion = magic.charAt(7) - 0x30; //ASCII number
-
-        // 0.0 - OS X Tiger and earlier
-        // 0.1 - Leopard
-        // 0.? - Snow Leopard
-        // 1.5 - Lion
-        // 2.0 - Snow Lion
-
-        if (majorVersion > 0) {
-            throw new IllegalArgumentException("Unsupported binary property list format: v" + majorVersion + "." + minorVersion + ". " +
-                    "Version 1.0 and later are not yet supported.");
-        }
-
-        /*
-         * Handle trailer, last 32 bytes of the file
-         */
-        byte[] trailer = copyOfRange(bytes, bytes.length - 32, bytes.length);
-        //6 null bytes (index 0 to 5)
-        offsetSize = (int) parseUnsignedInt(trailer, 6, 7);
-        //System.out.println("offsetSize: "+offsetSize);
-        objectRefSize = (int) parseUnsignedInt(trailer, 7, 8);
-        //System.out.println("objectRefSize: "+objectRefSize);
-        numObjects = (int) parseUnsignedInt(trailer, 8, 16);
-        //System.out.println("numObjects: "+numObjects);
-        topObject = (int) parseUnsignedInt(trailer, 16, 24);
-        //System.out.println("topObject: "+topObject);
-        offsetTableOffset = (int) parseUnsignedInt(trailer, 24, 32);
-        //System.out.println("offsetTableOffset: "+offsetTableOffset);
-
-        /*
-         * Handle offset table
-         */
-        offsetTable = new int[numObjects];
-
-        for (int i = 0; i < numObjects; i++) {
-            byte[] offsetBytes = copyOfRange(bytes, offsetTableOffset + i * offsetSize, offsetTableOffset + (i + 1) * offsetSize);
-            offsetTable[i] = (int) parseUnsignedInt(offsetBytes);
-            /*System.out.print("Offset for Object #"+i+" is "+offsetTable[i]+" [");
-            for(byte b:offsetBytes) System.out.print(Integer.toHexString(b)+" ");
-            System.out.println("]");*/
-        }
-
-        return parseObject(topObject);
-    }
-
-    /**
-     * Parses a binary property list from an input stream.
-     *
-     * @param is The input stream that points to the property list's data.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    public static NSObject parse(InputStream is) throws IOException, PropertyListFormatException {
-        //Read all bytes into a list
-        byte[] buf = PropertyListParser.readAll(is);
-        is.close();
-        return parse(buf);
-    }
-
-    /**
-     * Parses a binary property list file.
-     *
-     * @param f The binary property list file
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    public static NSObject parse(File f) throws IOException, PropertyListFormatException {
-        if (f.length() > Runtime.getRuntime().freeMemory()) {
-            throw new OutOfMemoryError("To little heap space available! Wanted to read " + f.length() + " bytes, but only " + Runtime.getRuntime().freeMemory() + " are available.");
-        }
-        return parse(new FileInputStream(f));
-    }
-
-    /**
-     * Parses an object inside the currently parsed binary property list.
-     * For the format specification check
-     * <a href="http://www.opensource.apple.com/source/CF/CF-744/CFBinaryPList.c">
-     * Apple's binary property list parser implementation</a>.
-     *
-     * @param obj The object ID.
-     * @return The parsed object.
-     * @throws java.lang.Exception When an error occurs during parsing.
-     */
-    private NSObject parseObject(int obj) throws IOException, PropertyListFormatException {
-        int offset = offsetTable[obj];
-        byte type = bytes[offset];
-        int objType = (type & 0xF0) >> 4; //First  4 bits
-        int objInfo = (type & 0x0F);      //Second 4 bits
-        switch (objType) {
-            case 0x0: {
-                //Simple
-                switch (objInfo) {
-                    case 0x0: {
-                        //null object (v1.0 and later)
-                        return null;
-                    }
-                    case 0x8: {
-                        //false
-                        return new NSNumber(false);
-                    }
-                    case 0x9: {
-                        //true
-                        return new NSNumber(true);
-                    }
-                    case 0xC: {
-                        //URL with no base URL (v1.0 and later)
-                        //TODO
-                        break;
-                    }
-                    case 0xD: {
-                        //URL with base URL (v1.0 and later)
-                        //TODO
-                        break;
-                    }
-                    case 0xE: {
-                        //16-byte UUID (v1.0 and later)
-                        //TODO
-                        break;
-                    }
-                    case 0xF: {
-                        //filler byte
-                        return null;
-                    }
-                }
-                break;
-            }
-            case 0x1: {
-                //integer
-                int length = (int) Math.pow(2, objInfo);
-                if (length < Runtime.getRuntime().freeMemory()) {
-                    return new NSNumber(copyOfRange(bytes, offset + 1, offset + 1 + length), NSNumber.INTEGER);
-                } else {
-                    throw new OutOfMemoryError("To little heap space available! Wanted to read " + length + " bytes, but only " + Runtime.getRuntime().freeMemory() + " are available.");
-                }
-            }
-            case 0x2: {
-                //real
-                int length = (int) Math.pow(2, objInfo);
-                if (length < Runtime.getRuntime().freeMemory()) {
-                    return new NSNumber(copyOfRange(bytes, offset + 1, offset + 1 + length), NSNumber.REAL);
-                } else {
-                    throw new OutOfMemoryError("To little heap space available! Wanted to read " + length + " bytes, but only " + Runtime.getRuntime().freeMemory() + " are available.");
-                }
-            }
-            case 0x3: {
-                //Date
-                if (objInfo != 0x3) {
-                    throw new PropertyListFormatException("The given binary property list contains a date object of an unknown type ("+objInfo+")");
-                }
-                return new NSDate(copyOfRange(bytes, offset + 1, offset + 9));
-            }
-            case 0x4: {
-                //Data
-                int[] lenAndoffset = readLengthAndOffset(objInfo, offset);
-                int length = lenAndoffset[0];
-                int dataoffset = lenAndoffset[1];
-
-                if (length < Runtime.getRuntime().freeMemory()) {
-                    return new NSData(copyOfRange(bytes, offset + dataoffset, offset + dataoffset + length));
-                } else {
-                    throw new OutOfMemoryError("To little heap space available! Wanted to read " + length + " bytes, but only " + Runtime.getRuntime().freeMemory() + " are available.");
-                }
-            }
-            case 0x5: {
-                //ASCII String
-                int[] lenAndoffset = readLengthAndOffset(objInfo, offset);
-                int length = lenAndoffset[0];
-                int stroffset = lenAndoffset[1];
-
-                if (length < Runtime.getRuntime().freeMemory()) {
-                    return new NSString(copyOfRange(bytes, offset + stroffset, offset + stroffset + length), "ASCII");
-                } else {
-                    throw new OutOfMemoryError("To little heap space available! Wanted to read " + length + " bytes, but only " + Runtime.getRuntime().freeMemory() + " are available.");
-                }
-            }
-            case 0x6: {
-                //UTF-16-BE String
-                int[] lenAndoffset = readLengthAndOffset(objInfo, offset);
-                int length = lenAndoffset[0];
-                int stroffset = lenAndoffset[1];
-
-                //length is String length -> to get byte length multiply by 2, as 1 character takes 2 bytes in UTF-16
-                length *= 2;
-                if (length < Runtime.getRuntime().freeMemory()) {
-                    return new NSString(copyOfRange(bytes, offset + stroffset, offset + stroffset + length), "UTF-16BE");
-                } else {
-                    throw new OutOfMemoryError("To little heap space available! Wanted to read " + length + " bytes, but only " + Runtime.getRuntime().freeMemory() + " are available.");
-                }
-            }
-            case 0x8: {
-                //UID
-                int length = objInfo + 1;
-                if (length < Runtime.getRuntime().freeMemory()) {
-                    return new UID(String.valueOf(obj), copyOfRange(bytes, offset + 1, offset + 1 + length));
-                } else {
-                    throw new OutOfMemoryError("To little heap space available! Wanted to read " + length + " bytes, but only " + Runtime.getRuntime().freeMemory() + " are available.");
-                }
-            }
-            case 0xA: {
-                //Array
-                int[] lenAndoffset = readLengthAndOffset(objInfo, offset);
-                int length = lenAndoffset[0];
-                int arrayoffset = lenAndoffset[1];
-
-                if (length * objectRefSize > Runtime.getRuntime().freeMemory()) {
-                    throw new OutOfMemoryError("To little heap space available!");
-                }
-                NSArray array = new NSArray(length);
-                for (int i = 0; i < length; i++) {
-                    int objRef = (int) parseUnsignedInt(copyOfRange(bytes,
-                            offset + arrayoffset + i * objectRefSize,
-                            offset + arrayoffset + (i + 1) * objectRefSize));
-                    array.setValue(i, parseObject(objRef));
-                }
-                return array;
-
-            }
-            case 0xB: {
-                //Ordered set
-                int[] lenAndoffset = readLengthAndOffset(objInfo, offset);
-                int length = lenAndoffset[0];
-                int contentOffset = lenAndoffset[1];
-
-                if (length * objectRefSize > Runtime.getRuntime().freeMemory()) {
-                    throw new OutOfMemoryError("To little heap space available!");
-                }
-                NSSet set = new NSSet(true);
-                for (int i = 0; i < length; i++) {
-                    int objRef = (int) parseUnsignedInt(copyOfRange(bytes,
-                            offset + contentOffset + i * objectRefSize,
-                            offset + contentOffset + (i + 1) * objectRefSize));
-                    set.addObject(parseObject(objRef));
-                }
-                return set;
-            }
-            case 0xC: {
-                //Set
-                int[] lenAndoffset = readLengthAndOffset(objInfo, offset);
-                int length = lenAndoffset[0];
-                int contentOffset = lenAndoffset[1];
-
-                if (length * objectRefSize > Runtime.getRuntime().freeMemory()) {
-                    throw new OutOfMemoryError("To little heap space available!");
-                }
-                NSSet set = new NSSet();
-                for (int i = 0; i < length; i++) {
-                    int objRef = (int) parseUnsignedInt(copyOfRange(bytes,
-                            offset + contentOffset + i * objectRefSize,
-                            offset + contentOffset + (i + 1) * objectRefSize));
-                    set.addObject(parseObject(objRef));
-                }
-                return set;
-            }
-            case 0xD: {
-                //Dictionary
-                int[] lenAndoffset = readLengthAndOffset(objInfo, offset);
-                int length = lenAndoffset[0];
-                int contentOffset = lenAndoffset[1];
-
-                if (length * 2 * objectRefSize > Runtime.getRuntime().freeMemory()) {
-                    throw new OutOfMemoryError("To little heap space available!");
-                }
-                //System.out.println("Parsing dictionary #"+obj);
-                NSDictionary dict = new NSDictionary();
-                for (int i = 0; i < length; i++) {
-                    int keyRef = (int) parseUnsignedInt(copyOfRange(bytes,
-                            offset + contentOffset + i * objectRefSize,
-                            offset + contentOffset + (i + 1) * objectRefSize));
-                    int valRef = (int) parseUnsignedInt(copyOfRange(bytes,
-                            offset + contentOffset + (length * objectRefSize) + i * objectRefSize,
-                            offset + contentOffset + (length * objectRefSize) + (i + 1) * objectRefSize));
-                    NSObject key = parseObject(keyRef);
-                    NSObject val = parseObject(valRef);
-                    dict.put(key.toString(), val);
-                }
-                return dict;
-            }
-            default: {
-                System.err.println("WARNING: The given binary property list contains an object of unknown type (" + objType + ")");
-            }
-        }
-        return null;
-    }
-
-    /**
-     * Reads the length for arrays, sets and dictionaries.
-     *
-     * @param objInfo Object information byte.
-     * @param offset  Offset in the byte array at which the object is located.
-     * @return An array with the length two. First entry is the length, second entry the offset at which the content starts.
-     */
-    private int[] readLengthAndOffset(int objInfo, int offset) {
-        int length = objInfo;
-        int stroffset = 1;
-        if (objInfo == 0xF) {
-            int int_type = bytes[offset + 1];
-            int intType = (int_type & 0xF0) >> 4;
-            if (intType != 0x1) {
-                System.err.println("BinaryPropertyListParser: Length integer has an unexpected type" + intType + ". Attempting to parse anyway...");
-            }
-            int intInfo = int_type & 0x0F;
-            int intLength = (int) Math.pow(2, intInfo);
-            stroffset = 2 + intLength;
-            if (intLength < 3) {
-                length = (int) parseUnsignedInt(copyOfRange(bytes, offset + 2, offset + 2 + intLength));
-            } else {
-                length = new BigInteger(copyOfRange(bytes, offset + 2, offset + 2 + intLength)).intValue();
-            }
-        }
-        return new int[]{length, stroffset};
-    }
-
-    /**
-     * Parses an unsigned integers from a byte array.
-     *
-     * @param bytes The byte array containing the unsigned integer.
-     * @return The unsigned integer represented by the given bytes.
-     */
-    public static long parseUnsignedInt(byte[] bytes) {
-        long l = 0;
-        for (byte b : bytes) {
-            l <<= 8;
-            l |= b & 0xFF;
-        }
-        l &= 0xFFFFFFFFL;
-        return l;
-    }
-
-    /**
-     * Parses an unsigned integer from a byte array.
-     *
-     * @param bytes The byte array containing the unsigned integer.
-     * @param startIndex Beginning of the unsigned int in the byte array.
-     * @param endIndex End of the unsigned int in the byte array.
-     * @return The unsigned integer represented by the given bytes.
-     */
-    public static long parseUnsignedInt(byte[] bytes, int startIndex, int endIndex) {
-        long l = 0;
-        for (int i = startIndex; i < endIndex; i++) {
-            l <<= 8;
-            l |= bytes[i] & 0xFF;
-        }
-        l &= 0xFFFFFFFFL;
-        return l;
-    }
-
-    /**
-     * Parses a long from a (big-endian) byte array.
-     *
-     * @param bytes The bytes representing the long integer.
-     * @return The long integer represented by the given bytes.
-     */
-    public static long parseLong(byte[] bytes) {
-        long l = 0;
-        for (byte b : bytes) {
-            l <<= 8;
-            l |= b & 0xFF;
-        }
-        return l;
-    }
-
-    /**
-     * Parses a long from a (big-endian) byte array.
-     *
-     * @param bytes The bytes representing the long integer.
-     * @param startIndex Beginning of the long in the byte array.
-     * @param endIndex End of the long in the byte array.
-     * @return The long integer represented by the given bytes.
-     */
-    public static long parseLong(byte[] bytes, int startIndex, int endIndex) {
-        long l = 0;
-        for (int i = startIndex; i < endIndex; i++) {
-            l <<= 8;
-            l |= bytes[i] & 0xFF;
-        }
-        return l;
-    }
-
-    /**
-     * Parses a double from a (big-endian) byte array.
-     *
-     * @param bytes The bytes representing the double.
-     * @return The double represented by the given bytes.
-     */
-    public static double parseDouble(byte[] bytes) {
-        if (bytes.length == 8) {
-            return Double.longBitsToDouble(parseLong(bytes));
-        } else if (bytes.length == 4) {
-            return Float.intBitsToFloat((int) parseLong(bytes));
-        } else {
-            throw new IllegalArgumentException("bad byte array length " + bytes.length);
-        }
-    }
-
-    /**
-     * Parses a double from a (big-endian) byte array.
-     *
-     * @param bytes The bytes representing the double.
-     * @param startIndex Beginning of the double in the byte array.
-     * @param endIndex End of the double in the byte array.
-     * @return The double represented by the given bytes.
-     */
-    public static double parseDouble(byte[] bytes, int startIndex, int endIndex) {
-        if (endIndex - startIndex == 8) {
-            return Double.longBitsToDouble(parseLong(bytes, startIndex, endIndex));
-        } else if (endIndex - startIndex == 4) {
-            return Float.intBitsToFloat((int)parseLong(bytes, startIndex, endIndex));
-        } else {
-            throw new IllegalArgumentException("endIndex ("+endIndex+") - startIndex ("+startIndex+") != 4 or 8");
-        }
-    }
-
-    /**
-     * Copies a part of a byte array into a new array.
-     *
-     * @param src        The source array.
-     * @param startIndex The index from which to start copying.
-     * @param endIndex   The index until which to copy.
-     * @return The copied array.
-     */
-    public static byte[] copyOfRange(byte[] src, int startIndex, int endIndex) {
-        int length = endIndex - startIndex;
-        if (length < 0) {
-            throw new IllegalArgumentException("startIndex (" + startIndex + ")" + " > endIndex (" + endIndex + ")");
-        }
-        byte[] dest = new byte[length];
-        System.arraycopy(src, startIndex, dest, 0, length);
-        return dest;
-    }
-}
-
diff --git a/third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListWriter.java b/third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListWriter.java
deleted file mode 100644
index 1ab0b5d..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/BinaryPropertyListWriter.java
+++ /dev/null
@@ -1,301 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2012 Keith Randall
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-import java.io.BufferedOutputStream;
-import java.io.ByteArrayOutputStream;
-import java.io.File;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.OutputStream;
-import java.util.HashMap;
-import java.util.Map;
-
-/**
- * A BinaryPropertyListWriter is a helper class for writing out
- * binary property list files.  It contains an output stream and
- * various structures for keeping track of which NSObjects have
- * already been serialized, and where they were put in the file.
- *
- * @author Keith Randall
- */
-public class BinaryPropertyListWriter {
-
-    public static final int VERSION_00 = 0;
-    public static final int VERSION_10 = 10;
-    public static final int VERSION_15 = 15;
-    public static final int VERSION_20 = 20;
-
-    /**
-     * Finds out the minimum binary property list format version that
-     * can be used to save the given NSObject tree.
-     *
-     * @param root Object root
-     * @return Version code
-     */
-    private static int getMinimumRequiredVersion(NSObject root) {
-        int minVersion = VERSION_00;
-        if (root == null) {
-            minVersion = VERSION_10;
-        }
-        if (root instanceof NSDictionary) {
-            NSDictionary dict = (NSDictionary) root;
-            for (NSObject o : dict.getHashMap().values()) {
-                int v = getMinimumRequiredVersion(o);
-                if (v > minVersion)
-                    minVersion = v;
-            }
-        } else if (root instanceof NSArray) {
-            NSArray array = (NSArray) root;
-            for (NSObject o : array.getArray()) {
-                int v = getMinimumRequiredVersion(o);
-                if (v > minVersion)
-                    minVersion = v;
-            }
-        } else if (root instanceof NSSet) {
-            //Sets are only allowed in property lists v1+
-            minVersion = VERSION_10;
-            NSSet set = (NSSet) root;
-            for (NSObject o : set.allObjects()) {
-                int v = getMinimumRequiredVersion(o);
-                if (v > minVersion)
-                    minVersion = v;
-            }
-        }
-        return minVersion;
-    }
-
-    /**
-     * Writes a binary plist file with the given object as the root.
-     *
-     * @param file the file to write to
-     * @param root the source of the data to write to the file
-     * @throws IOException
-     */
-    public static void write(File file, NSObject root) throws IOException {
-        OutputStream out = new FileOutputStream(file);
-        write(out, root);
-        out.close();
-    }
-
-    /**
-     * Writes a binary plist serialization of the given object as the root.
-     *
-     * @param out  the stream to write to
-     * @param root the source of the data to write to the stream
-     * @throws IOException
-     */
-    public static void write(OutputStream out, NSObject root) throws IOException {
-        int minVersion = getMinimumRequiredVersion(root);
-        if (minVersion > VERSION_00) {
-            String versionString = ((minVersion == VERSION_10) ? "v1.0" : ((minVersion == VERSION_15) ? "v1.5" : ((minVersion == VERSION_20) ? "v2.0" : "v0.0")));
-            throw new IOException("The given property list structure cannot be saved. " +
-                    "The required version of the binary format (" + versionString + ") is not yet supported.");
-        }
-        BinaryPropertyListWriter w = new BinaryPropertyListWriter(out, minVersion);
-        w.write(root);
-    }
-
-    /**
-     * Writes a binary plist serialization of the given object as the root
-     * into a byte array.
-     *
-     * @param root The root object of the property list
-     * @return The byte array containing the serialized property list
-     * @throws IOException
-     */
-    public static byte[] writeToArray(NSObject root) throws IOException {
-        ByteArrayOutputStream bout = new ByteArrayOutputStream();
-        write(bout, root);
-        return bout.toByteArray();
-    }
-
-    private int version = VERSION_00;
-
-    // raw output stream to result file
-    private OutputStream out;
-
-    // # of bytes written so far
-    private long count;
-
-    // map from object to its ID
-    private Map<NSObject, Integer> idMap = new HashMap<NSObject, Integer>();
-    private int idSizeInBytes;
-
-    /**
-     * Creates a new binary property list writer
-     *
-     * @param outStr The output stream into which the binary property list will be written
-     * @throws IOException If an error occured while writing to the stream
-     */
-    BinaryPropertyListWriter(OutputStream outStr) throws IOException {
-        out = new BufferedOutputStream(outStr);
-    }
-
-    BinaryPropertyListWriter(OutputStream outStr, int version) throws IOException {
-        this.version = version;
-        out = new BufferedOutputStream(outStr);
-    }
-
-    void write(NSObject root) throws IOException {
-        // magic bytes
-        write(new byte[]{'b', 'p', 'l', 'i', 's', 't'});
-
-        //version
-        switch (version) {
-            case VERSION_00: {
-                write(new byte[]{'0', '0'});
-                break;
-            }
-            case VERSION_10: {
-                write(new byte[]{'1', '0'});
-                break;
-            }
-            case VERSION_15: {
-                write(new byte[]{'1', '5'});
-                break;
-            }
-            case VERSION_20: {
-                write(new byte[]{'2', '0'});
-                break;
-            }
-        }
-
-        // assign IDs to all the objects.
-        root.assignIDs(this);
-
-        idSizeInBytes = computeIdSizeInBytes(idMap.size());
-
-        // offsets of each object, indexed by ID
-        long[] offsets = new long[idMap.size()];
-
-        // write each object, save offset
-        for (Map.Entry<NSObject, Integer> entry : idMap.entrySet()) {
-            NSObject obj = entry.getKey();
-            int id = entry.getValue();
-            offsets[id] = count;
-            if (obj == null) {
-                write(0x00);
-            } else {
-                obj.toBinary(this);
-            }
-        }
-
-        // write offset table
-        long offsetTableOffset = count;
-        int offsetSizeInBytes = computeOffsetSizeInBytes(count);
-        for (long offset : offsets) {
-            writeBytes(offset, offsetSizeInBytes);
-        }
-
-        if (version != VERSION_15) {
-            // write trailer
-            // 6 null bytes
-            write(new byte[6]);
-            // size of an offset
-            write(offsetSizeInBytes);
-            // size of a ref
-            write(idSizeInBytes);
-            // number of objects
-            writeLong(idMap.size());
-            // top object
-            writeLong(idMap.get(root));
-            // offset table offset
-            writeLong(offsetTableOffset);
-        }
-
-        out.flush();
-    }
-
-    void assignID(NSObject obj) {
-        if (!idMap.containsKey(obj)) {
-            idMap.put(obj, idMap.size());
-        }
-    }
-
-    int getID(NSObject obj) {
-        return idMap.get(obj);
-    }
-
-    private static int computeIdSizeInBytes(int numberOfIds) {
-        if (numberOfIds < 256) return 1;
-        if (numberOfIds < 65536) return 2;
-        return 4;
-    }
-
-    private int computeOffsetSizeInBytes(long maxOffset) {
-        if (maxOffset < 256) return 1;
-        if (maxOffset < 65536) return 2;
-        if (maxOffset < 4294967296L) return 4;
-        return 8;
-    }
-
-    void writeIntHeader(int kind, int value) throws IOException {
-        assert value >= 0;
-        if (value < 15) {
-            write((kind << 4) + value);
-        } else if (value < 256) {
-            write((kind << 4) + 15);
-            write(0x10);
-            writeBytes(value, 1);
-        } else if (value < 65536) {
-            write((kind << 4) + 15);
-            write(0x11);
-            writeBytes(value, 2);
-        } else {
-            write((kind << 4) + 15);
-            write(0x12);
-            writeBytes(value, 4);
-        }
-    }
-
-    void write(int b) throws IOException {
-        out.write(b);
-        count++;
-    }
-
-    void write(byte[] bytes) throws IOException {
-        out.write(bytes);
-        count += bytes.length;
-    }
-
-    void writeBytes(long value, int bytes) throws IOException {
-        // write low-order bytes big-endian style
-        for (int i = bytes - 1; i >= 0; i--) {
-            write((int) (value >> (8 * i)));
-        }
-    }
-
-    void writeID(int id) throws IOException {
-        writeBytes(id, idSizeInBytes);
-    }
-
-    void writeLong(long value) throws IOException {
-        writeBytes(value, 8);
-    }
-
-    void writeDouble(double value) throws IOException {
-        writeLong(Double.doubleToRawLongBits(value));
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSArray.java b/third_party/java/dd_plist/java/com/dd/plist/NSArray.java
deleted file mode 100644
index b8324c1..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSArray.java
+++ /dev/null
@@ -1,335 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2014 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-import java.io.IOException;
-import java.util.Arrays;
-
-/**
- * Represents an Array.
- *
- * @author Daniel Dreibrodt
- */
-public class NSArray extends NSObject {
-
-    private NSObject[] array;
-
-    /**
-     * Creates an empty array of the given length.
-     *
-     * @param length The number of elements this array will be able to hold.
-     */
-    public NSArray(int length) {
-        array = new NSObject[length];
-    }
-
-    /**
-     * Creates a array from an existing one
-     *
-     * @param a The array which should be wrapped by the NSArray
-     */
-    public NSArray(NSObject... a) {
-        array = a;
-    }
-
-    /**
-     * Returns the object stored at the given index.
-     * Equivalent to <code>getArray()[i]</code>.
-     *
-     * @param i The index of the object.
-     * @return The object at the given index.
-     */
-    public NSObject objectAtIndex(int i) {
-        return array[i];
-    }
-
-    /**
-     * Remove the i-th element from the array.
-     * The array will be resized.
-     *
-     * @param i The index of the object
-     */
-    public void remove(int i) {
-        if ((i >= array.length) || (i < 0))
-            throw new ArrayIndexOutOfBoundsException("invalid index:" + i + ";the array length is " + array.length);
-        NSObject[] newArray = new NSObject[array.length - 1];
-        System.arraycopy(array, 0, newArray, 0, i);
-        System.arraycopy(array, i + 1, newArray, i, array.length - i - 1);
-        array = newArray;
-    }
-
-    /**
-     * Stores an object at the specified index.
-     * If there was another object stored at that index it will be replaced.
-     * Equivalent to <code>getArray()[key] = value</code>.
-     *
-     * @param key   The index where to store the object.
-     * @param value The object.
-     */
-    public void setValue(int key, Object value) {
-        if(value == null)
-            throw new NullPointerException("Cannot add null values to an NSArray!");
-        array[key] = NSObject.wrap(value);
-    }
-
-    /**
-     * Returns the array of NSObjects represented by this NSArray.
-     * Any changes to the values of this array will also affect the NSArray.
-     *
-     * @return The actual array represented by this NSArray.
-     */
-    public NSObject[] getArray() {
-        return array;
-    }
-
-    /**
-     * Returns the size of the array.
-     *
-     * @return The number of elements that this array can store.
-     */
-    public int count() {
-        return array.length;
-    }
-
-    /**
-     * Checks whether an object is present in the array or whether it is equal
-     * to any of the objects in the array.
-     *
-     * @param obj The object to look for.
-     * @return <code>true</code>, when the object could be found. <code>false</code> otherwise.
-     * @see Object#equals(java.lang.Object)
-     */
-    public boolean containsObject(Object obj) {
-        NSObject nso = NSObject.wrap(obj);
-        for (NSObject elem : array) {
-            if (elem.equals(nso)) {
-                return true;
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Searches for an object in the array. If it is found its index will be
-     * returned. This method also returns an index if the object is not the same
-     * as the one stored in the array but has equal contents.
-     *
-     * @param obj The object to look for.
-     * @return The index of the object, if it was found. -1 otherwise.
-     * @see Object#equals(java.lang.Object)
-     * @see #indexOfIdenticalObject(Object)
-     */
-    public int indexOfObject(Object obj) {
-        NSObject nso = NSObject.wrap(obj);
-        for (int i = 0; i < array.length; i++) {
-            if (array[i].equals(nso)) {
-                return i;
-            }
-        }
-        return -1;
-    }
-
-    /**
-     * Searches for an object in the array. If it is found its index will be
-     * returned. This method only returns the index of an object that is
-     * <b>identical</b> to the given one. Thus objects that might contain the
-     * same value as the given one will not be considered.
-     *
-     * @param obj The object to look for.
-     * @return The index of the object, if it was found. -1 otherwise.
-     * @see #indexOfObject(Object)
-     */
-    public int indexOfIdenticalObject(Object obj) {
-        NSObject nso = NSObject.wrap(obj);
-        for (int i = 0; i < array.length; i++) {
-            if (array[i] == nso) {
-                return i;
-            }
-        }
-        return -1;
-    }
-
-    /**
-     * Returns the last object contained in this array.
-     * Equivalent to <code>getArray()[getArray().length-1]</code>.
-     *
-     * @return The value of the highest index in the array.
-     */
-    public NSObject lastObject() {
-        return array[array.length - 1];
-    }
-
-    /**
-     * Returns a new array containing only the values stored at the given
-     * indices. The values are sorted by their index.
-     *
-     * @param indexes The indices of the objects.
-     * @return The new array containing the objects stored at the given indices.
-     */
-    public NSObject[] objectsAtIndexes(int... indexes) {
-        NSObject[] result = new NSObject[indexes.length];
-        Arrays.sort(indexes);
-        for (int i = 0; i < indexes.length; i++)
-            result[i] = array[indexes[i]];
-        return result;
-    }
-
-    @Override
-    public boolean equals(Object obj) {
-        if(obj.getClass().equals(NSArray.class)) {
-            return Arrays.equals(((NSArray) obj).getArray(), this.array);
-        } else {
-            NSObject nso = NSObject.wrap(obj);
-            if(nso.getClass().equals(NSArray.class)) {
-                return Arrays.equals(((NSArray) nso).getArray(), this.array);
-            }
-        }
-        return false;
-    }
-
-    @Override
-    public int hashCode() {
-        int hash = 7;
-        hash = 89 * hash + Arrays.deepHashCode(this.array);
-        return hash;
-    }
-
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        xml.append("<array>");
-        xml.append(NSObject.NEWLINE);
-        for (NSObject o : array) {
-            o.toXML(xml, level + 1);
-            xml.append(NSObject.NEWLINE);
-        }
-        indent(xml, level);
-        xml.append("</array>");
-    }
-
-    @Override
-    void assignIDs(BinaryPropertyListWriter out) {
-        super.assignIDs(out);
-        for (NSObject obj : array) {
-            obj.assignIDs(out);
-        }
-    }
-
-    @Override
-    void toBinary(BinaryPropertyListWriter out) throws IOException {
-        out.writeIntHeader(0xA, array.length);
-        for (NSObject obj : array) {
-            out.writeID(out.getID(obj));
-        }
-    }
-
-    /**
-     * Generates a valid ASCII property list which has this NSArray as its
-     * root object. The generated property list complies with the format as
-     * described in <a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/PropertyLists/OldStylePlists/OldStylePLists.html">
-     * Property List Programming Guide - Old-Style ASCII Property Lists</a>.
-     *
-     * @return ASCII representation of this object.
-     */
-    public String toASCIIPropertyList() {
-        StringBuilder ascii = new StringBuilder();
-        toASCII(ascii, 0);
-        ascii.append(NEWLINE);
-        return ascii.toString();
-    }
-
-    /**
-     * Generates a valid ASCII property list in GnuStep format which has this
-     * NSArray as its root object. The generated property list complies with
-     * the format as described in <a href="http://www.gnustep.org/resources/documentation/Developer/Base/Reference/NSPropertyList.html">
-     * GnuStep - NSPropertyListSerialization class documentation
-     * </a>
-     *
-     * @return GnuStep ASCII representation of this object.
-     */
-    public String toGnuStepASCIIPropertyList() {
-        StringBuilder ascii = new StringBuilder();
-        toASCIIGnuStep(ascii, 0);
-        ascii.append(NEWLINE);
-        return ascii.toString();
-    }
-
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append(ASCIIPropertyListParser.ARRAY_BEGIN_TOKEN);
-        int indexOfLastNewLine = ascii.lastIndexOf(NEWLINE);
-        for (int i = 0; i < array.length; i++) {
-            Class<?> objClass = array[i].getClass();
-            if ((objClass.equals(NSDictionary.class) || objClass.equals(NSArray.class) || objClass.equals(NSData.class))
-                    && indexOfLastNewLine != ascii.length()) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-                array[i].toASCII(ascii, level + 1);
-            } else {
-                if (i != 0)
-                    ascii.append(" ");
-                array[i].toASCII(ascii, 0);
-            }
-
-            if (i != array.length - 1)
-                ascii.append(ASCIIPropertyListParser.ARRAY_ITEM_DELIMITER_TOKEN);
-
-            if (ascii.length() - indexOfLastNewLine > ASCII_LINE_LENGTH) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-            }
-        }
-        ascii.append(ASCIIPropertyListParser.ARRAY_END_TOKEN);
-    }
-
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append(ASCIIPropertyListParser.ARRAY_BEGIN_TOKEN);
-        int indexOfLastNewLine = ascii.lastIndexOf(NEWLINE);
-        for (int i = 0; i < array.length; i++) {
-            Class<?> objClass = array[i].getClass();
-            if ((objClass.equals(NSDictionary.class) || objClass.equals(NSArray.class) || objClass.equals(NSData.class))
-                    && indexOfLastNewLine != ascii.length()) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-                array[i].toASCIIGnuStep(ascii, level + 1);
-            } else {
-                if (i != 0)
-                    ascii.append(" ");
-                array[i].toASCIIGnuStep(ascii, 0);
-            }
-
-            if (i != array.length - 1)
-                ascii.append(ASCIIPropertyListParser.ARRAY_ITEM_DELIMITER_TOKEN);
-
-            if (ascii.length() - indexOfLastNewLine > ASCII_LINE_LENGTH) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-            }
-        }
-        ascii.append(ASCIIPropertyListParser.ARRAY_END_TOKEN);
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSData.java b/third_party/java/dd_plist/java/com/dd/plist/NSData.java
deleted file mode 100644
index d156a2f..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSData.java
+++ /dev/null
@@ -1,182 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-import java.io.File;
-import java.io.FileNotFoundException;
-import java.io.IOException;
-import java.io.RandomAccessFile;
-import java.nio.ByteBuffer;
-import java.util.Arrays;
-
-/**
- * NSData objects are wrappers for byte buffers.
- *
- * @author Daniel Dreibrodt
- */
-public class NSData extends NSObject {
-
-    private byte[] bytes;
-
-    /**
-     * Creates the NSData object from the binary representation of it.
-     *
-     * @param bytes The raw data contained in the NSData object.
-     */
-    public NSData(byte[] bytes) {
-        this.bytes = bytes;
-    }
-
-    /**
-     * Creates a NSData object from its textual representation, which is a Base64 encoded amount of bytes.
-     *
-     * @param base64 The Base64 encoded contents of the NSData object.
-     * @throws IOException When the given string is not a proper Base64 formatted string.
-     */
-    public NSData(String base64) throws IOException {
-        //Remove all white spaces from the string so that it is parsed completely
-        //and not just until the first white space occurs.
-        String data = base64.replaceAll("\\s+", "");
-        bytes = Base64.decode(data);
-    }
-
-    /**
-     * Creates a NSData object from a file. Using the files contents as the contents of this NSData object.
-     *
-     * @param file The file containing the data.
-     * @throws FileNotFoundException If the file could not be found.
-     * @throws IOException           If the file could not be read.
-     */
-    public NSData(File file) throws IOException {
-        bytes = new byte[(int) file.length()];
-        RandomAccessFile raf = new RandomAccessFile(file, "r");
-        raf.read(bytes);
-        raf.close();
-    }
-
-    /**
-     * The bytes contained in this NSData object.
-     *
-     * @return The data as bytes
-     */
-    public byte[] bytes() {
-        return bytes;
-    }
-
-    /**
-     * Gets the amount of data stored in this object.
-     *
-     * @return The number of bytes contained in this object.
-     */
-    public int length() {
-        return bytes.length;
-    }
-
-    /**
-     * Loads the bytes from this NSData object into a byte buffer
-     *
-     * @param buf    The byte buffer which will contain the data
-     * @param length The amount of data to copy
-     */
-    public void getBytes(ByteBuffer buf, int length) {
-        buf.put(bytes, 0, Math.min(bytes.length, length));
-    }
-
-    /**
-     * Loads the bytes from this NSData object into a byte buffer
-     *
-     * @param buf        The byte buffer which will contain the data
-     * @param rangeStart The start index
-     * @param rangeStop  The stop index
-     */
-    public void getBytes(ByteBuffer buf, int rangeStart, int rangeStop) {
-        buf.put(bytes, rangeStart, Math.min(bytes.length, rangeStop));
-    }
-
-    /**
-     * Gets the Base64 encoded data contained in this NSData object.
-     *
-     * @return The Base64 encoded data as a <code>String</code>.
-     */
-    public String getBase64EncodedData() {
-        return Base64.encodeBytes(bytes);
-    }
-
-    @Override
-    public boolean equals(Object obj) {
-        return obj.getClass().equals(getClass()) && Arrays.equals(((NSData) obj).bytes, bytes);
-    }
-
-    @Override
-    public int hashCode() {
-        int hash = 5;
-        hash = 67 * hash + Arrays.hashCode(this.bytes);
-        return hash;
-    }
-
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        xml.append("<data>");
-        xml.append(NSObject.NEWLINE);
-        String base64 = getBase64EncodedData();
-        for (String line : base64.split("\n")) {
-            indent(xml, level + 1);
-            xml.append(line);
-            xml.append(NSObject.NEWLINE);
-        }
-        indent(xml, level);
-        xml.append("</data>");
-    }
-
-    @Override
-    void toBinary(BinaryPropertyListWriter out) throws IOException {
-        out.writeIntHeader(0x4, bytes.length);
-        out.write(bytes);
-    }
-
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append(ASCIIPropertyListParser.DATA_BEGIN_TOKEN);
-        int indexOfLastNewLine = ascii.lastIndexOf(NEWLINE);
-        for (int i = 0; i < bytes.length; i++) {
-            int b = bytes[i] & 0xFF;
-            if (b < 16)
-                ascii.append("0");
-            ascii.append(Integer.toHexString(b));
-            if (ascii.length() - indexOfLastNewLine > ASCII_LINE_LENGTH) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-            } else if ((i + 1) % 2 == 0 && i != bytes.length - 1) {
-                ascii.append(" ");
-            }
-        }
-        ascii.append(ASCIIPropertyListParser.DATA_END_TOKEN);
-    }
-
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        toASCII(ascii, level);
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSDate.java b/third_party/java/dd_plist/java/com/dd/plist/NSDate.java
deleted file mode 100644
index 5fb11f8..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSDate.java
+++ /dev/null
@@ -1,185 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011 Daniel Dreibrodt, Keith Randall
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-import java.io.IOException;
-import java.text.ParseException;
-import java.text.SimpleDateFormat;
-import java.util.Date;
-import java.util.TimeZone;
-
-/**
- * Represents a date.
- *
- * @author Daniel Dreibrodt
- */
-public class NSDate extends NSObject {
-
-    private Date date;
-
-    // EPOCH = new SimpleDateFormat("yyyy MM dd zzz").parse("2001 01 01 GMT").getTime();
-    // ...but that's annoying in a static initializer because it can throw exceptions, ick.
-    // So we just hardcode the correct value.
-    private final static long EPOCH = 978307200000L;
-
-    private static final SimpleDateFormat sdfDefault = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
-    private static final SimpleDateFormat sdfGnuStep = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss Z");
-
-    static {
-        sdfDefault.setTimeZone(TimeZone.getTimeZone("GMT"));
-        sdfGnuStep.setTimeZone(TimeZone.getTimeZone("GMT"));
-    }
-
-    /**
-     * Parses the XML date string and creates a Java Date object from it.
-     * This function is synchronized as SimpleDateFormat is not thread-safe.
-     *
-     * @param textRepresentation The date string as found in the XML property list
-     * @return The parsed Date
-     * @throws ParseException If the given string cannot be parsed.
-     * @see SimpleDateFormat#parse(java.lang.String)
-     */
-    private static synchronized Date parseDateString(String textRepresentation) throws ParseException {
-        try {
-            return sdfDefault.parse(textRepresentation);
-        } catch (ParseException ex) {
-            return sdfGnuStep.parse(textRepresentation);
-        }
-    }
-
-    /**
-     * Generates a String representation of a Java Date object. The string
-     * is formatted according to the specification for XML property list dates.
-     *
-     * @param date The date which should be represented.
-     * @return The string representation of the date.
-     */
-    private static synchronized String makeDateString(Date date) {
-        return sdfDefault.format(date);
-    }
-
-    /**
-     * Generates a String representation of a Java Date object. The string
-     * is formatted according to the specification for GnuStep ASCII property
-     * list dates.
-     *
-     * @param date The date which should be represented.
-     * @return The string representation of the date.
-     */
-    private static synchronized String makeDateStringGnuStep(Date date) {
-        return sdfGnuStep.format(date);
-    }
-
-    /**
-     * Creates a date from its binary representation.
-     *
-     * @param bytes The date bytes
-     */
-    public NSDate(byte[] bytes) {
-        //dates are 8 byte big-endian double, seconds since the epoch
-        date = new Date(EPOCH + (long) (1000 * BinaryPropertyListParser.parseDouble(bytes)));
-    }
-
-    /**
-     * Parses a date from its textual representation.
-     * That representation has the following pattern: <code>yyyy-MM-dd'T'HH:mm:ss'Z'</code>
-     *
-     * @param textRepresentation The textual representation of the date (ISO 8601 format)
-     * @throws ParseException When the date could not be parsed, i.e. it does not match the expected pattern.
-     */
-    public NSDate(String textRepresentation) throws ParseException {
-        date = parseDateString(textRepresentation);
-    }
-
-    /**
-     * Creates a NSDate from a Java Date
-     *
-     * @param d The date
-     */
-    public NSDate(Date d) {
-        if (d == null)
-            throw new IllegalArgumentException("Date cannot be null");
-        date = d;
-    }
-
-    /**
-     * Gets the date.
-     *
-     * @return The date.
-     */
-    public Date getDate() {
-        return date;
-    }
-
-    @Override
-    public boolean equals(Object obj) {
-        return obj.getClass().equals(getClass()) && date.equals(((NSDate) obj).getDate());
-    }
-
-    @Override
-    public int hashCode() {
-        return date.hashCode();
-    }
-
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        xml.append("<date>");
-        xml.append(makeDateString(date));
-        xml.append("</date>");
-    }
-
-    @Override
-    public void toBinary(BinaryPropertyListWriter out) throws IOException {
-        out.write(0x33);
-        out.writeDouble((date.getTime() - EPOCH) / 1000.0);
-    }
-
-    /**
-     * Generates a string representation of the date.
-     *
-     * @return A string representation of the date.
-     * @see java.util.Date#toString()
-     */
-    @Override
-    public String toString() {
-        return date.toString();
-    }
-
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append("\"");
-        ascii.append(makeDateString(date));
-        ascii.append("\"");
-    }
-
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append("<*D");
-        ascii.append(makeDateStringGnuStep(date));
-        ascii.append(">");
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSDictionary.java b/third_party/java/dd_plist/java/com/dd/plist/NSDictionary.java
deleted file mode 100644
index 5d432ad..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSDictionary.java
+++ /dev/null
@@ -1,539 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2014 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-import java.io.IOException;
-import java.util.Arrays;
-import java.util.Collection;
-import java.util.Date;
-import java.util.HashMap;
-import java.util.LinkedHashMap;
-import java.util.Map;
-import java.util.Set;
-
-/**
- * A NSDictionary is a collection of keys and values, essentially a Hashtable.
- * The keys are simple Strings whereas the values can be any kind of NSObject.
- * <p/>
- * You can access the keys through the function <code>allKeys()</code>. Access
- * to the objects stored for each key is given through the function
- * <code>objectoForKey(String key)</code>.
- *
- * @author Daniel Dreibrodt
- * @see java.util.Hashtable
- * @see com.dd.plist.NSObject
- */
-public class NSDictionary extends NSObject  implements Map<String, NSObject> {
-
-    private HashMap<String, NSObject> dict;
-
-    /**
-     * Creates a new empty NSDictionary.
-     */
-    public NSDictionary() {
-        //With a linked HashMap the order of elements in the dictionary is kept.
-        dict = new LinkedHashMap<String, NSObject>();
-    }
-
-    /**
-     * Gets the hashmap which stores the keys and values of this dictionary.
-     * Changes to the hashmap's contents are directly reflected in this
-     * dictionary.
-     *
-     * @return The hashmap which is used by this dictionary to store its contents.
-     */
-    public HashMap<String, NSObject> getHashMap() {
-        return dict;
-    }
-
-    /**
-     * Gets the NSObject stored for the given key.
-     *
-     * @param key The key.
-     * @return The object.
-     */
-    public NSObject objectForKey(String key) {
-        return dict.get(key);
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#size()
-	 */
-    public int size() {
-        return dict.size();
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#isEmpty()
-	 */
-    public boolean isEmpty() {
-        return dict.isEmpty();
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#containsKey(java.lang.Object)
-	 */
-    public boolean containsKey(Object key) {
-        return dict.containsKey(key);
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#containsValue(java.lang.Object)
-	 */
-    public boolean containsValue(Object value) {
-        if(value == null)
-            return false;
-        NSObject wrap = NSObject.wrap(value);
-        return dict.containsValue(wrap);
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#get(java.lang.Object)
-	 */
-    public NSObject get(Object key) {
-        return dict.get(key);
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#putAll(java.util.Map)
-	 */
-    public void putAll(Map<? extends String, ? extends NSObject> values) {
-        for (Object object : values.entrySet()) {
-            @SuppressWarnings("unchecked")
-            Map.Entry<String, NSObject> entry = (Map.Entry<String, NSObject>) object;
-            put(entry.getKey(), entry.getValue());
-        }
-    }
-
-    /**
-     * Puts a new key-value pair into this dictionary.
-     * If the value is null, no operation will be performed on the dictionary.
-     *
-     * @param key The key.
-     * @param obj The value.
-     * @return The value previously associated to the given key,
-     *         or null, if no value was associated to it.
-     */
-    public NSObject put(String key, NSObject obj) {
-        if(obj == null)
-            return dict.get(key);
-        return dict.put(key, obj);
-    }
-
-    /**
-     * Puts a new key-value pair into this dictionary.
-     * If the value is null, no operation will be performed on the dictionary.
-     *
-     * @param key The key.
-     * @param obj The value. Supported object types are numbers, byte-arrays, dates, strings and arrays or sets of those.
-     * @return The value previously associated to the given key,
-     *         or null, if no value was associated to it.
-     */
-    public NSObject put(String key, Object obj) {
-        if(obj == null)
-            return dict.get(key);
-        return put(key, NSObject.wrap(obj));
-    }
-
-    /**
-     * Puts a new key-value pair into this dictionary.
-     *
-     * @param key The key.
-     * @param obj The value.
-     */
-    public NSObject put(String key, long obj) {
-        return put(key, new NSNumber(obj));
-    }
-
-    /**
-     * Puts a new key-value pair into this dictionary.
-     *
-     * @param key The key.
-     * @param obj The value.
-     */
-    public NSObject put(String key, double obj) {
-        return put(key, new NSNumber(obj));
-    }
-
-    /**
-     * Puts a new key-value pair into this dictionary.
-     *
-     * @param key The key.
-     * @param obj The value.
-     */
-    public NSObject put(String key, boolean obj) {
-        return put(key, new NSNumber(obj));
-    }
-
-    /**
-     * Removes a key-value pair from this dictionary.
-     *
-     * @param key The key
-     * @return the value previously associated to the given key.
-     */
-    public NSObject remove(String key) {
-        return dict.remove(key);
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#remove(java.lang.Object)
-	 */
-    public NSObject remove(Object key) {
-        return dict.remove(key);
-    }
-
-    /**
-     * Removes all key-value pairs from this dictionary.
-     * @see java.util.Map#clear()
-     */
-    public void clear() {
-        dict.clear();
-    }
-
-    /*
-	 * (non-Javadoc)
-	 *
-	 * @see java.util.Map#keySet()
-	 */
-    public Set<String> keySet() {
-        return dict.keySet();
-    }
-
-    /*
-     * (non-Javadoc)
-     *
-     * @see java.util.Map#values()
-     */
-    public Collection<NSObject> values() {
-        return dict.values();
-    }
-
-    /*
-     * (non-Javadoc)
-     *
-     * @see java.util.Map#entrySet()
-     */
-    public Set<Entry<String, NSObject>> entrySet() {
-        return dict.entrySet();
-    }
-
-    /**
-     * Checks whether a given key is contained in this dictionary.
-     *
-     * @param key The key that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsKey(String key) {
-        return dict.containsKey(key);
-    }
-
-    /**
-     * Checks whether a given value is contained in this dictionary.
-     *
-     * @param val The value that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsValue(NSObject val) {
-        return val != null && dict.containsValue(val);
-    }
-
-    /**
-     * Checks whether a given value is contained in this dictionary.
-     *
-     * @param val The value that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsValue(String val) {
-        for (NSObject o : dict.values()) {
-            if (o.getClass().equals(NSString.class)) {
-                NSString str = (NSString) o;
-                if (str.getContent().equals(val))
-                    return true;
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Checks whether a given value is contained in this dictionary.
-     *
-     * @param val The value that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsValue(long val) {
-        for (NSObject o : dict.values()) {
-            if (o.getClass().equals(NSNumber.class)) {
-                NSNumber num = (NSNumber) o;
-                if (num.isInteger() && num.intValue() == val)
-                    return true;
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Checks whether a given value is contained in this dictionary.
-     *
-     * @param val The value that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsValue(double val) {
-        for (NSObject o : dict.values()) {
-            if (o.getClass().equals(NSNumber.class)) {
-                NSNumber num = (NSNumber) o;
-                if (num.isReal() && num.doubleValue() == val)
-                    return true;
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Checks whether a given value is contained in this dictionary.
-     *
-     * @param val The value that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsValue(boolean val) {
-        for (NSObject o : dict.values()) {
-            if (o.getClass().equals(NSNumber.class)) {
-                NSNumber num = (NSNumber) o;
-                if (num.isBoolean() && num.boolValue() == val)
-                    return true;
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Checks whether a given value is contained in this dictionary.
-     *
-     * @param val The value that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsValue(Date val) {
-        for (NSObject o : dict.values()) {
-            if (o.getClass().equals(NSDate.class)) {
-                NSDate dat = (NSDate) o;
-                if (dat.getDate().equals(val))
-                    return true;
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Checks whether a given value is contained in this dictionary.
-     *
-     * @param val The value that will be searched for.
-     * @return Whether the key is contained in this dictionary.
-     */
-    public boolean containsValue(byte[] val) {
-        for (NSObject o : dict.values()) {
-            if (o.getClass().equals(NSData.class)) {
-                NSData dat = (NSData) o;
-                if (Arrays.equals(dat.bytes(), val))
-                    return true;
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Counts the number of contained key-value pairs.
-     *
-     * @return The size of this NSDictionary.
-     */
-    public int count() {
-        return dict.size();
-    }
-
-    @Override
-    public boolean equals(Object obj) {
-        return (obj.getClass().equals(this.getClass()) && ((NSDictionary) obj).dict.equals(dict));
-    }
-
-    /**
-     * Gets a list of all keys used in this NSDictionary.
-     *
-     * @return The list of all keys used in this NSDictionary.
-     */
-    public String[] allKeys() {
-        return dict.keySet().toArray(new String[count()]);
-    }
-
-    @Override
-    public int hashCode() {
-        int hash = 7;
-        hash = 83 * hash + (this.dict != null ? this.dict.hashCode() : 0);
-        return hash;
-    }
-
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        xml.append("<dict>");
-        xml.append(NSObject.NEWLINE);
-        for (String key : dict.keySet()) {
-            NSObject val = objectForKey(key);
-            indent(xml, level + 1);
-            xml.append("<key>");
-            //According to http://www.w3.org/TR/REC-xml/#syntax node values must not
-            //contain the characters < or &. Also the > character should be escaped.
-            if (key.contains("&") || key.contains("<") || key.contains(">")) {
-                xml.append("<![CDATA[");
-                xml.append(key.replaceAll("]]>", "]]]]><![CDATA[>"));
-                xml.append("]]>");
-            } else {
-                xml.append(key);
-            }
-            xml.append("</key>");
-            xml.append(NSObject.NEWLINE);
-            val.toXML(xml, level + 1);
-            xml.append(NSObject.NEWLINE);
-        }
-        indent(xml, level);
-        xml.append("</dict>");
-    }
-
-    @Override
-    void assignIDs(BinaryPropertyListWriter out) {
-        super.assignIDs(out);
-        for (Map.Entry<String, NSObject> entry : dict.entrySet()) {
-            new NSString(entry.getKey()).assignIDs(out);
-            entry.getValue().assignIDs(out);
-        }
-    }
-
-    @Override
-    void toBinary(BinaryPropertyListWriter out) throws IOException {
-        out.writeIntHeader(0xD, dict.size());
-        Set<Map.Entry<String, NSObject>> entries = dict.entrySet();
-        for (Map.Entry<String, NSObject> entry : entries) {
-            out.writeID(out.getID(new NSString(entry.getKey())));
-        }
-        for (Map.Entry<String, NSObject> entry : entries) {
-            out.writeID(out.getID(entry.getValue()));
-        }
-    }
-
-    /**
-     * Generates a valid ASCII property list which has this NSDictionary as its
-     * root object. The generated property list complies with the format as
-     * described in <a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/PropertyLists/OldStylePlists/OldStylePLists.html">
-     * Property List Programming Guide - Old-Style ASCII Property Lists</a>.
-     *
-     * @return ASCII representation of this object.
-     */
-    public String toASCIIPropertyList() {
-        StringBuilder ascii = new StringBuilder();
-        toASCII(ascii, 0);
-        ascii.append(NEWLINE);
-        return ascii.toString();
-    }
-
-    /**
-     * Generates a valid ASCII property list in GnuStep format which has this
-     * NSDictionary as its root object. The generated property list complies with
-     * the format as described in <a href="http://www.gnustep.org/resources/documentation/Developer/Base/Reference/NSPropertyList.html">
-     * GnuStep - NSPropertyListSerialization class documentation
-     * </a>
-     *
-     * @return GnuStep ASCII representation of this object.
-     */
-    public String toGnuStepASCIIPropertyList() {
-        StringBuilder ascii = new StringBuilder();
-        toASCIIGnuStep(ascii, 0);
-        ascii.append(NEWLINE);
-        return ascii.toString();
-    }
-
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append(ASCIIPropertyListParser.DICTIONARY_BEGIN_TOKEN);
-        ascii.append(NEWLINE);
-        String[] keys = allKeys();
-        for (String key : keys) {
-            NSObject val = objectForKey(key);
-            indent(ascii, level + 1);
-            ascii.append("\"");
-            ascii.append(NSString.escapeStringForASCII(key));
-            ascii.append("\" =");
-            Class<?> objClass = val.getClass();
-            if (objClass.equals(NSDictionary.class) || objClass.equals(NSArray.class) || objClass.equals(NSData.class)) {
-                ascii.append(NEWLINE);
-                val.toASCII(ascii, level + 2);
-            } else {
-                ascii.append(" ");
-                val.toASCII(ascii, 0);
-            }
-            ascii.append(ASCIIPropertyListParser.DICTIONARY_ITEM_DELIMITER_TOKEN);
-            ascii.append(NEWLINE);
-        }
-        indent(ascii, level);
-        ascii.append(ASCIIPropertyListParser.DICTIONARY_END_TOKEN);
-    }
-
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append(ASCIIPropertyListParser.DICTIONARY_BEGIN_TOKEN);
-        ascii.append(NEWLINE);
-        String[] keys = dict.keySet().toArray(new String[dict.size()]);
-        for (String key : keys) {
-            NSObject val = objectForKey(key);
-            indent(ascii, level + 1);
-            ascii.append("\"");
-            ascii.append(NSString.escapeStringForASCII(key));
-            ascii.append("\" =");
-            Class<?> objClass = val.getClass();
-            if (objClass.equals(NSDictionary.class) || objClass.equals(NSArray.class) || objClass.equals(NSData.class)) {
-                ascii.append(NEWLINE);
-                val.toASCIIGnuStep(ascii, level + 2);
-            } else {
-                ascii.append(" ");
-                val.toASCIIGnuStep(ascii, 0);
-            }
-            ascii.append(ASCIIPropertyListParser.DICTIONARY_ITEM_DELIMITER_TOKEN);
-            ascii.append(NEWLINE);
-        }
-        indent(ascii, level);
-        ascii.append(ASCIIPropertyListParser.DICTIONARY_END_TOKEN);
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSNumber.java b/third_party/java/dd_plist/java/com/dd/plist/NSNumber.java
deleted file mode 100644
index 9baf6f5..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSNumber.java
+++ /dev/null
@@ -1,407 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011 Daniel Dreibrodt, Keith Randall
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-import java.io.IOException;
-
-/**
- * A number whose value is either an integer, a real number or boolean.
- *
- * @author Daniel Dreibrodt
- */
-public class NSNumber extends NSObject implements Comparable<Object> {
-
-    /**
-     * Indicates that the number's value is an integer.
-     * The number is stored as a Java <code>long</code>.
-     * Its original value could have been char, short, int, long or even long long.
-     */
-    public static final int INTEGER = 0;
-
-    /**
-     * Indicates that the number's value is a real number.
-     * The number is stored as a Java <code>double</code>.
-     * Its original value could have been float or double.
-     */
-    public static final int REAL = 1;
-
-    /**
-     * Indicates that the number's value is boolean.
-     */
-    public static final int BOOLEAN = 2;
-
-    //Holds the current type of this number
-    private int type;
-
-    private long longValue;
-    private double doubleValue;
-    private boolean boolValue;
-
-    /**
-     * Parses integers and real numbers from their binary representation.
-     * <i>Note: real numbers are not yet supported.</i>
-     *
-     * @param bytes The binary representation
-     * @param type  The type of number
-     * @see #INTEGER
-     * @see #REAL
-     */
-    public NSNumber(byte[] bytes, int type) {
-        switch (type) {
-            case INTEGER: {
-                doubleValue = longValue = BinaryPropertyListParser.parseLong(bytes);
-                break;
-            }
-            case REAL: {
-                doubleValue = BinaryPropertyListParser.parseDouble(bytes);
-                longValue = Math.round(doubleValue);
-                break;
-            }
-            default: {
-                throw new IllegalArgumentException("Type argument is not valid.");
-            }
-        }
-        this.type = type;
-    }
-
-    /**
-     * Creates a number from its textual representation.
-     *
-     * @param text The textual representation of the number.
-     * @throws IllegalArgumentException If the text does not represent an integer, real number or boolean value.
-     * @see Boolean#parseBoolean(java.lang.String)
-     * @see Long#parseLong(java.lang.String)
-     * @see Double#parseDouble(java.lang.String)
-     */
-    public NSNumber(String text) {
-        if (text == null)
-            throw new IllegalArgumentException("The given string is null and cannot be parsed as number.");
-        try {
-            long l = Long.parseLong(text);
-            doubleValue = longValue = l;
-            type = INTEGER;
-        } catch (Exception ex) {
-            try {
-                doubleValue = Double.parseDouble(text);
-                longValue = Math.round(doubleValue);
-                type = REAL;
-            } catch (Exception ex2) {
-                try {
-                    boolValue = text.toLowerCase().equals("true") || text.toLowerCase().equals("yes");
-                    if(!boolValue && !(text.toLowerCase().equals("false") || text.toLowerCase().equals("no"))) {
-                        throw new Exception("not a boolean");
-                    }
-                    type = BOOLEAN;
-                    doubleValue = longValue = boolValue ? 1 : 0;
-                } catch (Exception ex3) {
-                    throw new IllegalArgumentException("The given string neither represents a double, an int nor a boolean value.");
-                }
-            }
-        }
-    }
-
-    /**
-     * Creates an integer number.
-     *
-     * @param i The integer value.
-     */
-    public NSNumber(int i) {
-        doubleValue = longValue = i;
-        type = INTEGER;
-    }
-
-    /**
-     * Creates an integer number.
-     *
-     * @param l The long integer value.
-     */
-    public NSNumber(long l) {
-        doubleValue = longValue = l;
-        type = INTEGER;
-    }
-
-    /**
-     * Creates a real number.
-     *
-     * @param d The real value.
-     */
-    public NSNumber(double d) {
-        longValue = (long) (doubleValue = d);
-        type = REAL;
-    }
-
-    /**
-     * Creates a boolean number.
-     *
-     * @param b The boolean value.
-     */
-    public NSNumber(boolean b) {
-        boolValue = b;
-        doubleValue = longValue = b ? 1 : 0;
-        type = BOOLEAN;
-    }
-
-    /**
-     * Gets the type of this number's value.
-     *
-     * @return The type flag.
-     * @see #BOOLEAN
-     * @see #INTEGER
-     * @see #REAL
-     */
-    public int type() {
-        return type;
-    }
-
-    /**
-     * Checks whether the value of this NSNumber is a boolean.
-     *
-     * @return Whether the number's value is a boolean.
-     */
-    public boolean isBoolean() {
-        return type == BOOLEAN;
-    }
-
-    /**
-     * Checks whether the value of this NSNumber is an integer.
-     *
-     * @return Whether the number's value is an integer.
-     */
-    public boolean isInteger() {
-        return type == INTEGER;
-    }
-
-    /**
-     * Checks whether the value of this NSNumber is a real number.
-     *
-     * @return Whether the number's value is a real number.
-     */
-    public boolean isReal() {
-        return type == REAL;
-    }
-
-    /**
-     * The number's boolean value.
-     *
-     * @return <code>true</code> if the value is true or non-zero, false</code> otherwise.
-     */
-    public boolean boolValue() {
-        if (type == BOOLEAN)
-            return boolValue;
-        else
-            return longValue != 0;
-    }
-
-    /**
-     * The number's long value.
-     *
-     * @return The value of the number as long
-     */
-    public long longValue() {
-        return longValue;
-    }
-
-    /**
-     * The number's int value.
-     * <i>Note: Even though the number's type might be INTEGER it can be larger than a Java int.
-     * Use intValue() only if you are certain that it contains a number from the int range.
-     * Otherwise the value might be innaccurate.</i>
-     *
-     * @return The value of the number as int
-     */
-    public int intValue() {
-        return (int) longValue;
-    }
-
-    /**
-     * The number's double value.
-     *
-     * @return The value of the number as double.
-     */
-    public double doubleValue() {
-        return doubleValue;
-    }
-
-    /**
-     * The number's float value.
-     * WARNING: Possible loss of precision if the value is outside the float range.
-     *
-     * @return The value of the number as float.
-     */
-    public float floatValue() {
-        return (float) doubleValue;
-    }
-
-    /**
-     * Checks whether the other object is a NSNumber of the same value.
-     *
-     * @param obj The object to compare to.
-     * @return Whether the objects are equal in terms of numeric value and type.
-     */
-    @Override
-    public boolean equals(Object obj) {
-        if (!(obj instanceof NSNumber)) return false;
-        NSNumber n = (NSNumber) obj;
-        return type == n.type && longValue == n.longValue && doubleValue == n.doubleValue && boolValue == n.boolValue;
-    }
-
-    @Override
-    public int hashCode() {
-        int hash = type;
-        hash = 37 * hash + (int) (this.longValue ^ (this.longValue >>> 32));
-        hash = 37 * hash + (int) (Double.doubleToLongBits(this.doubleValue) ^ (Double.doubleToLongBits(this.doubleValue) >>> 32));
-        hash = 37 * hash + (boolValue() ? 1 : 0);
-        return hash;
-    }
-
-
-    @Override
-    public String toString() {
-        switch (type) {
-            case INTEGER: {
-                return String.valueOf(longValue());
-            }
-            case REAL: {
-                return String.valueOf(doubleValue());
-            }
-            case BOOLEAN: {
-                return String.valueOf(boolValue());
-            }
-            default: {
-                return super.toString();
-            }
-        }
-    }
-
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        switch (type) {
-            case INTEGER: {
-                xml.append("<integer>");
-                xml.append(longValue());
-                xml.append("</integer>");
-                break;
-            }
-            case REAL: {
-                xml.append("<real>");
-                xml.append(doubleValue());
-                xml.append("</real>");
-                break;
-            }
-            case BOOLEAN: {
-                if (boolValue())
-                    xml.append("<true/>");
-                else
-                    xml.append("<false/>");
-                break;
-            }
-        }
-    }
-
-    @Override
-    void toBinary(BinaryPropertyListWriter out) throws IOException {
-        switch (type()) {
-            case INTEGER: {
-                if (longValue() < 0) {
-                    out.write(0x13);
-                    out.writeBytes(longValue(), 8);
-                } else if (longValue() <= 0xff) {
-                    out.write(0x10);
-                    out.writeBytes(longValue(), 1);
-                } else if (longValue() <= 0xffff) {
-                    out.write(0x11);
-                    out.writeBytes(longValue(), 2);
-                } else if (longValue() <= 0xffffffffL) {
-                    out.write(0x12);
-                    out.writeBytes(longValue(), 4);
-                } else {
-                    out.write(0x13);
-                    out.writeBytes(longValue(), 8);
-                }
-                break;
-            }
-            case REAL: {
-                out.write(0x23);
-                out.writeDouble(doubleValue());
-                break;
-            }
-            case BOOLEAN: {
-                out.write(boolValue() ? 0x09 : 0x08);
-                break;
-            }
-        }
-    }
-
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        if (type == BOOLEAN) {
-            ascii.append(boolValue ? "YES" : "NO");
-        } else {
-            ascii.append(toString());
-        }
-    }
-
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        switch (type) {
-            case INTEGER: {
-                ascii.append("<*I");
-                ascii.append(toString());
-                ascii.append(">");
-                break;
-            }
-            case REAL: {
-                ascii.append("<*R");
-                ascii.append(toString());
-                ascii.append(">");
-                break;
-            }
-            case BOOLEAN: {
-                if (boolValue) {
-                    ascii.append("<*BY>");
-                } else {
-                    ascii.append("<*BN>");
-                }
-            }
-        }
-    }
-
-    public int compareTo(Object o) {
-        double x = doubleValue();
-        double y;
-        if (o instanceof NSNumber) {
-            NSNumber num = (NSNumber) o;
-            y = num.doubleValue();
-            return (x < y) ? -1 : ((x == y) ? 0 : 1);
-        } else if (o instanceof Number) {
-            y = ((Number) o).doubleValue();
-            return (x < y) ? -1 : ((x == y) ? 0 : 1);
-        } else {
-            return -1;
-        }
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSObject.java b/third_party/java/dd_plist/java/com/dd/plist/NSObject.java
deleted file mode 100644
index 6618fa1..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSObject.java
+++ /dev/null
@@ -1,431 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2014 Daniel Dreibrodt
- *
-* Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-import java.io.ByteArrayOutputStream;
-import java.io.IOException;
-import java.io.ObjectOutputStream;
-import java.util.*;
-
-/**
- * Abstract interface for any object contained in a property list.
- * The names and functions of the various objects orient themselves
- * towards Apple's Cocoa API.
- *
- * @author Daniel Dreibrodt
- */
-public abstract class NSObject {
-
-    /**
-     * The newline character used for generating the XML output.
-     * This constant will be different depending on the operating system on
-     * which you use this library.
-     */
-    final static String NEWLINE = System.getProperty("line.separator");
-
-    /**
-     * The identation character used for generating the XML output. This is the
-     * tabulator character.
-     */
-    final static String INDENT = "\t";
-
-    /**
-     * The maximum length of the text lines to be used when generating
-     * ASCII property lists. But this number is only a guideline it is not
-     * guaranteed that it will not be overstepped.
-     */
-    final static int ASCII_LINE_LENGTH = 80;
-
-    /**
-     * Generates the XML representation of the object (without XML headers or enclosing plist-tags).
-     *
-     * @param xml   The StringBuilder onto which the XML representation is appended.
-     * @param level The indentation level of the object.
-     */
-    abstract void toXML(StringBuilder xml, int level);
-
-    /**
-     * Assigns IDs to all the objects in this NSObject subtree.
-     *
-     * @param out The writer object that handles the binary serialization.
-     */
-    void assignIDs(BinaryPropertyListWriter out) {
-        out.assignID(this);
-    }
-
-    /**
-     * Generates the binary representation of the object.
-     *
-     * @param out The output stream to serialize the object to.
-     */
-    abstract void toBinary(BinaryPropertyListWriter out) throws IOException;
-
-    /**
-     * Generates a valid XML property list including headers using this object as root.
-     *
-     * @return The XML representation of the property list including XML header and doctype information.
-     */
-    public String toXMLPropertyList() {
-        StringBuilder xml = new StringBuilder("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
-        xml.append(NSObject.NEWLINE);
-        xml.append("<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">");
-        xml.append(NSObject.NEWLINE);
-        xml.append("<plist version=\"1.0\">");
-        xml.append(NSObject.NEWLINE);
-        toXML(xml, 0);
-        xml.append(NSObject.NEWLINE);
-        xml.append("</plist>");
-        return xml.toString();
-    }
-
-    /**
-     * Generates the ASCII representation of this object.
-     * The generated ASCII representation does not end with a newline.
-     * Complies with https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/PropertyLists/OldStylePlists/OldStylePLists.html
-     *
-     * @param ascii The StringBuilder onto which the ASCII representation is appended.
-     * @param level The indentation level of the object.
-     */
-    protected abstract void toASCII(StringBuilder ascii, int level);
-
-    /**
-     * Generates the ASCII representation of this object in the GnuStep format.
-     * The generated ASCII representation does not end with a newline.
-     *
-     * @param ascii The StringBuilder onto which the ASCII representation is appended.
-     * @param level The indentation level of the object.
-     */
-    protected abstract void toASCIIGnuStep(StringBuilder ascii, int level);
-
-    /**
-     * Helper method that adds correct identation to the xml output.
-     * Calling this method will add <code>level</code> number of tab characters
-     * to the <code>xml</code> string.
-     *
-     * @param xml   The string builder for the XML document.
-     * @param level The level of identation.
-     */
-    void indent(StringBuilder xml, int level) {
-        for (int i = 0; i < level; i++)
-            xml.append(INDENT);
-    }
-
-    /**
-     * Wraps the given value inside a NSObject.
-     *
-     * @param value The value to represent as a NSObject.
-     * @return A NSObject representing the given value.
-     */
-    public static NSNumber wrap(long value) {
-        return new NSNumber(value);
-    }
-
-    /**
-     * Wraps the given value inside a NSObject.
-     *
-     * @param value The value to represent as a NSObject.
-     * @return A NSObject representing the given value.
-     */
-    public static NSNumber wrap(double value) {
-        return new NSNumber(value);
-    }
-
-    /**
-     * Wraps the given value inside a NSObject.
-     *
-     * @param value The value to represent as a NSObject.
-     * @return A NSObject representing the given value.
-     */
-    public static NSNumber wrap(boolean value) {
-        return new NSNumber(value);
-    }
-
-    /**
-     * Wraps the given value inside a NSObject.
-     *
-     * @param value The value to represent as a NSObject.
-     * @return A NSObject representing the given value.
-     */
-    public static NSData wrap(byte[] value) {
-        return new NSData(value);
-    }
-
-    /**
-     * Creates a NSArray with the contents of the given array.
-     *
-     * @param value The value to represent as a NSObject.
-     * @return A NSObject representing the given value.
-     * @throws RuntimeException When one of the objects contained in the array cannot be represented by a NSObject.
-     */
-    public static NSArray wrap(Object[] value) {
-        NSArray arr = new NSArray(value.length);
-        for (int i = 0; i < value.length; i++) {
-            arr.setValue(i, wrap(value[i]));
-        }
-        return arr;
-    }
-
-    /**
-     * Creates a NSDictionary with the contents of the given map.
-     *
-     * @param value The value to represent as a NSObject.
-     * @return A NSObject representing the given value.
-     * @throws RuntimeException When one of the values contained in the map cannot be represented by a NSObject.
-     */
-    public static NSDictionary wrap(Map<String, Object> value) {
-        NSDictionary dict = new NSDictionary();
-        for (String key : value.keySet())
-            dict.put(key, wrap(value.get(key)));
-        return dict;
-    }
-
-    /**
-     * Creates a NSSet with the contents of this set.
-     *
-     * @param value The value to represent as a NSObject.
-     * @return A NSObject representing the given value.
-     * @throws RuntimeException When one of the values contained in the set cannot be represented by a NSObject.
-     */
-    public static NSSet wrap(Set<Object> value) {
-        NSSet set = new NSSet();
-        for (Object o : value.toArray())
-            set.addObject(wrap(o));
-        return set;
-    }
-
-    /**
-     * Creates a NSObject representing the given Java Object.
-     *
-     * Numerics of type bool, int, long, short, byte, float or double are wrapped as NSNumber objects.
-     *
-     * Strings are wrapped as NSString objects abd byte arrays as NSData objects.
-     *
-     * Date objects are wrapped as NSDate objects.
-     *
-     * Serializable classes are serialized and their data is stored in NSData objects.
-     *
-     * Arrays and Collection objects are converted to NSArrays where each array member is wrapped into a NSObject.
-     *
-     * Map objects are converted to NSDictionaries. Each key is converted to a string and each value wrapped into a NSObject.
-     *
-     * @param o The object to represent.
-     * @return A NSObject equivalent to the given object.
-     */
-    public static NSObject wrap(Object o) {
-        if(o == null)
-            throw new NullPointerException("A null object cannot be wrapped as a NSObject");
-
-        if(o instanceof NSObject)
-            return (NSObject)o;
-
-        Class<?> c = o.getClass();
-        if (Boolean.class.equals(c)) {
-            return wrap((boolean) (Boolean) o);
-        }
-        if (Byte.class.equals(c)) {
-            return wrap((int) (Byte) o);
-        }
-        if (Short.class.equals(c)) {
-            return wrap((int) (Short) o);
-        }
-        if (Integer.class.equals(c)) {
-            return wrap((int) (Integer) o);
-        }
-        if (Long.class.isAssignableFrom(c)) {
-            return wrap((long) (Long) o);
-        }
-        if (Float.class.equals(c)) {
-            return wrap((double) (Float) o);
-        }
-        if (Double.class.isAssignableFrom(c)) {
-            return wrap((double) (Double) o);
-        }
-        if (String.class.equals(c)) {
-            return new NSString((String)o);
-        }
-        if (Date.class.equals(c)) {
-            return new NSDate((Date)o);
-        }
-        if(c.isArray()) {
-            Class<?> cc = c.getComponentType();
-            if (cc.equals(byte.class)) {
-                return wrap((byte[]) o);
-            }
-            else if(cc.equals(boolean.class)) {
-                boolean[] array = (boolean[])o;
-                NSArray nsa = new NSArray(array.length);
-                for(int i=0;i<array.length;i++)
-                    nsa.setValue(i, wrap(array[i]));
-                return nsa;
-            }
-            else if(float.class.equals(cc)) {
-                float[] array = (float[])o;
-                NSArray nsa = new NSArray(array.length);
-                for(int i=0;i<array.length;i++)
-                    nsa.setValue(i, wrap(array[i]));
-                return nsa;
-            }
-            else if(double.class.equals(cc)) {
-                double[] array = (double[])o;
-                NSArray nsa = new NSArray(array.length);
-                for(int i=0;i<array.length;i++)
-                    nsa.setValue(i, wrap(array[i]));
-                return nsa;
-            }
-            else if(short.class.equals(cc)) {
-                short[] array = (short[])o;
-                NSArray nsa = new NSArray(array.length);
-                for(int i=0;i<array.length;i++)
-                    nsa.setValue(i, wrap(array[i]));
-                return nsa;
-            }
-            else if(int.class.equals(cc)) {
-                int[] array = (int[])o;
-                NSArray nsa = new NSArray(array.length);
-                for(int i=0;i<array.length;i++)
-                    nsa.setValue(i, wrap(array[i]));
-                return nsa;
-            }
-            else if(long.class.equals(cc)) {
-                long[] array = (long[])o;
-                NSArray nsa = new NSArray(array.length);
-                for(int i=0;i<array.length;i++)
-                    nsa.setValue(i, wrap(array[i]));
-                return nsa;
-            }
-            else {
-                return wrap((Object[]) o);
-            }
-        }
-        if (Map.class.isAssignableFrom(c)) {
-            Map map = (Map)o;
-            Set keys = map.keySet();
-            NSDictionary dict = new NSDictionary();
-            for(Object key:keys) {
-                Object val = map.get(key);
-                dict.put(String.valueOf(key), wrap(val));
-            }
-            return dict;
-        }
-        if (Collection.class.isAssignableFrom(c)) {
-            Collection coll = (Collection)o;
-            return wrap(coll.toArray());
-        }
-        return wrapSerialized(o);
-    }
-
-    /**
-     * Serializes the given object using Java's default object serialization
-     * and wraps the serialized object in a NSData object.
-     *
-     * @param o The object to serialize and wrap.
-     * @return A NSData object
-     * @throws RuntimeException When the object could not be serialized.
-     */
-    public static NSData wrapSerialized(Object o) {
-        try {
-            ByteArrayOutputStream baos = new ByteArrayOutputStream();
-            ObjectOutputStream oos = new ObjectOutputStream(baos);
-            oos.writeObject(o);
-            return new NSData(baos.toByteArray());
-        } catch (IOException ex) {
-            throw new RuntimeException("The given object of class " + o.getClass().toString() + " could not be serialized and stored in a NSData object.");
-        }
-    }
-
-    /**
-     * Converts this NSObject into an equivalent object
-     * of the Java Runtime Environment.
-     * <ul>
-     * <li>NSArray objects are converted to arrays.</li>
-     * <li>NSDictionary objects are converted to objects extending the java.util.Map class.</li>
-     * <li>NSSet objects are converted to objects extending the java.util.Set class.</li>
-     * <li>NSNumber objects are converted to primitive number values (int, long, double or boolean).</li>
-     * <li>NSString objects are converted to String objects.</li>
-     * <li>NSData objects are converted to byte arrays.</li>
-     * <li>NSDate objects are converted to java.util.Date objects.</li>
-     * <li>UID objects are converted to byte arrays.</li>
-     * </ul>
-     * @return A native java object representing this NSObject's value.
-     */
-    public Object toJavaObject() {
-        if(this instanceof NSArray) {
-            NSObject[] arrayA = ((NSArray)this).getArray();
-            Object[] arrayB = new Object[arrayA.length];
-            for(int i = 0; i < arrayA.length; i++) {
-                arrayB[i] = arrayA[i].toJavaObject();
-            }
-            return arrayB;
-        } else if (this instanceof NSDictionary) {
-            HashMap<String, NSObject> hashMapA = ((NSDictionary)this).getHashMap();
-            HashMap<String, Object> hashMapB = new HashMap<String, Object>(hashMapA.size());
-            for(String key:hashMapA.keySet()) {
-                hashMapB.put(key, hashMapA.get(key).toJavaObject());
-            }
-            return hashMapB;
-        } else if(this instanceof NSSet) {
-            Set<NSObject> setA = ((NSSet)this).getSet();
-            Set<Object> setB;
-            if(setA instanceof LinkedHashSet) {
-                setB = new LinkedHashSet<Object>(setA.size());
-            } else {
-                setB = new TreeSet<Object>();
-            }
-            for(NSObject o:setA) {
-                setB.add(o.toJavaObject());
-            }
-            return setB;
-        } else if(this instanceof NSNumber) {
-            NSNumber num = (NSNumber)this;
-            switch(num.type()) {
-                case NSNumber.INTEGER : {
-                    long longVal = num.longValue();
-                    if(longVal > Integer.MAX_VALUE || longVal < Integer.MIN_VALUE) {
-                        return longVal;
-                    } else {
-                        return num.intValue();
-                    }
-                }
-                case NSNumber.REAL : {
-                    return num.doubleValue();
-                }
-                case NSNumber.BOOLEAN : {
-                    return num.boolValue();
-                }
-                default : {
-                    return num.doubleValue();
-                }
-            }
-        } else if(this instanceof NSString) {
-            return ((NSString)this).getContent();
-        } else if(this instanceof NSData) {
-            return ((NSData)this).bytes();
-        } else if(this instanceof NSDate) {
-            return ((NSDate)this).getDate();
-        } else if(this instanceof UID) {
-            return ((UID)this).getBytes();
-        } else {
-            return this;
-        }
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSSet.java b/third_party/java/dd_plist/java/com/dd/plist/NSSet.java
deleted file mode 100644
index 2528951..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSSet.java
+++ /dev/null
@@ -1,354 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-import java.io.IOException;
-import java.util.*;
-
-/**
- * A set is an interface to an unordered collection of objects.
- * This implementation uses a <code>LinkedHashSet</code> or <code>TreeSet</code>as the underlying
- * data structure.
- * <p/>
- * <b>Warning:</b> Sets cannot yet be used for saving in binary property lists, as binary property list format v1+ is required to save them.
- *
- * @author Daniel Dreibrodt
- * @see LinkedHashSet
- */
-public class NSSet extends NSObject {
-
-    private Set<NSObject> set;
-
-    private boolean ordered = false;
-
-    /**
-     * Creates an empty unordered set.
-     *
-     * @see java.util.LinkedHashSet
-     */
-    public NSSet() {
-        set = new LinkedHashSet<NSObject>();
-    }
-
-    /**
-     * Creates an empty set.
-     *
-     * @param ordered Indicates whether the created set should be ordered or unordered.
-     * @see java.util.LinkedHashSet
-     * @see java.util.TreeSet
-     */
-    public NSSet(boolean ordered) {
-        this.ordered = ordered;
-        if (!ordered)
-            set = new LinkedHashSet<NSObject>();
-        else
-            set = new TreeSet<NSObject>();
-    }
-
-    /**
-     * Create a set and fill it with the given objects.
-     *
-     * @param objects The objects to populate the set.
-     * @see java.util.LinkedHashSet
-     */
-    public NSSet(NSObject... objects) {
-        set = new LinkedHashSet<NSObject>();
-        set.addAll(Arrays.asList(objects));
-    }
-
-    /**
-     * Create a set and fill it with the given objects.
-     *
-     * @param objects The objects to populate the set.
-     * @see java.util.LinkedHashSet
-     * @see java.util.TreeSet
-     */
-    public NSSet(boolean ordered, NSObject... objects) {
-        this.ordered = ordered;
-        if (!ordered)
-            set = new LinkedHashSet<NSObject>();
-        else
-            set = new TreeSet<NSObject>();
-        set.addAll(Arrays.asList(objects));
-    }
-
-    /**
-     * Adds an object to the set.
-     *
-     * @param obj The object to add.
-     */
-    public synchronized void addObject(NSObject obj) {
-        set.add(obj);
-    }
-
-    /**
-     * Removes an object from the set.
-     *
-     * @param obj The object to remove.
-     */
-    public synchronized void removeObject(NSObject obj) {
-        set.remove(obj);
-    }
-
-    /**
-     * Returns all objects contained in the set.
-     *
-     * @return An array of all objects in the set.
-     */
-    public synchronized NSObject[] allObjects() {
-        return set.toArray(new NSObject[count()]);
-    }
-
-    /**
-     * Returns one of the objects in the set, or <code>null</code>
-     * if the set contains no objects.
-     *
-     * @return The first object in the set, or <code>null</code> if the set is empty.
-     */
-    public synchronized NSObject anyObject() {
-        if (set.isEmpty())
-            return null;
-        else
-            return set.iterator().next();
-    }
-
-    /**
-     * Finds out whether a given object is contained in the set.
-     *
-     * @param obj The object to look for.
-     * @return <code>true</code>, when the object was found, <code>false</code> otherwise.
-     */
-    public boolean containsObject(NSObject obj) {
-        return set.contains(obj);
-    }
-
-    /**
-     * Determines whether the set contains an object equal to a given object
-     * and returns that object if it is present.
-     *
-     * @param obj The object to look for.
-     * @return The object if it is present, <code>null</code> otherwise.
-     */
-    public synchronized NSObject member(NSObject obj) {
-        for (NSObject o : set) {
-            if (o.equals(obj))
-                return o;
-        }
-        return null;
-    }
-
-    /**
-     * Finds out whether at least one object is present in both sets.
-     *
-     * @param otherSet The other set.
-     * @return <code>false</code> if the intersection of both sets is empty, <code>true</code> otherwise.
-     */
-    public synchronized boolean intersectsSet(NSSet otherSet) {
-        for (NSObject o : set) {
-            if (otherSet.containsObject(o))
-                return true;
-        }
-        return false;
-    }
-
-    /**
-     * Finds out if this set is a subset of the given set.
-     *
-     * @param otherSet The other set.
-     * @return <code>true</code> if all elements in this set are also present in the other set, <code>false</code> otherwise.
-     */
-    public synchronized boolean isSubsetOfSet(NSSet otherSet) {
-        for (NSObject o : set) {
-            if (!otherSet.containsObject(o))
-                return false;
-        }
-        return true;
-    }
-
-    /**
-     * Returns an iterator object that lets you iterate over all elements of the set.
-     * This is the equivalent to <code>objectEnumerator</code> in the Cocoa implementation
-     * of NSSet.
-     *
-     * @return The iterator for the set.
-     */
-    public synchronized Iterator<NSObject> objectIterator() {
-        return set.iterator();
-    }
-
-    /**
-     * Gets the underlying data structure in which this NSSets stores its content.
-     * @return A Set object.
-     */
-    Set<NSObject> getSet() {
-        return set;
-    }
-
-    @Override
-    public int hashCode() {
-        int hash = 7;
-        hash = 29 * hash + (this.set != null ? this.set.hashCode() : 0);
-        return hash;
-    }
-
-    @Override
-    public boolean equals(Object obj) {
-        if (obj == null) {
-            return false;
-        }
-        if (getClass() != obj.getClass()) {
-            return false;
-        }
-        final NSSet other = (NSSet) obj;
-        return !(this.set != other.set && (this.set == null || !this.set.equals(other.set)));
-    }
-
-    /**
-     * Gets the number of elements in the set.
-     *
-     * @return The number of elements in the set.
-     * @see Set#size()
-     */
-    public synchronized int count() {
-        return set.size();
-    }
-
-    /**
-     * Returns the XML representantion for this set.
-     * There is no official XML representation specified for sets.
-     * In this implementation it is represented by an array.
-     *
-     * @param xml   The XML StringBuilder
-     * @param level The indentation level
-     */
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        xml.append("<array>");
-        xml.append(NSObject.NEWLINE);
-        for (NSObject o : set) {
-            o.toXML(xml, level + 1);
-            xml.append(NSObject.NEWLINE);
-        }
-        indent(xml, level);
-        xml.append("</array>");
-    }
-
-    @Override
-    void assignIDs(BinaryPropertyListWriter out) {
-        super.assignIDs(out);
-        for (NSObject obj : set) {
-            obj.assignIDs(out);
-        }
-    }
-
-    @Override
-    void toBinary(BinaryPropertyListWriter out) throws IOException {
-        if (ordered) {
-            out.writeIntHeader(0xB, set.size());
-        } else {
-            out.writeIntHeader(0xC, set.size());
-        }
-        for (NSObject obj : set) {
-            out.writeID(out.getID(obj));
-        }
-    }
-
-    /**
-     * Returns the ASCII representation of this set.
-     * There is no official ASCII representation for sets.
-     * In this implementation sets are represented as arrays.
-     *
-     * @param ascii The ASCII file string builder
-     * @param level The indentation level
-     */
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        NSObject[] array = allObjects();
-        ascii.append(ASCIIPropertyListParser.ARRAY_BEGIN_TOKEN);
-        int indexOfLastNewLine = ascii.lastIndexOf(NEWLINE);
-        for (int i = 0; i < array.length; i++) {
-            Class<?> objClass = array[i].getClass();
-            if ((objClass.equals(NSDictionary.class) || objClass.equals(NSArray.class) || objClass.equals(NSData.class))
-                    && indexOfLastNewLine != ascii.length()) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-                array[i].toASCII(ascii, level + 1);
-            } else {
-                if (i != 0)
-                    ascii.append(" ");
-                array[i].toASCII(ascii, 0);
-            }
-
-            if (i != array.length - 1)
-                ascii.append(ASCIIPropertyListParser.ARRAY_ITEM_DELIMITER_TOKEN);
-
-            if (ascii.length() - indexOfLastNewLine > ASCII_LINE_LENGTH) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-            }
-        }
-        ascii.append(ASCIIPropertyListParser.ARRAY_END_TOKEN);
-    }
-
-    /**
-     * Returns the ASCII representation of this set according to the GnuStep format.
-     * There is no official ASCII representation for sets.
-     * In this implementation sets are represented as arrays.
-     *
-     * @param ascii The ASCII file string builder
-     * @param level The indentation level
-     */
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        NSObject[] array = allObjects();
-        ascii.append(ASCIIPropertyListParser.ARRAY_BEGIN_TOKEN);
-        int indexOfLastNewLine = ascii.lastIndexOf(NEWLINE);
-        for (int i = 0; i < array.length; i++) {
-            Class<?> objClass = array[i].getClass();
-            if ((objClass.equals(NSDictionary.class) || objClass.equals(NSArray.class) || objClass.equals(NSData.class))
-                    && indexOfLastNewLine != ascii.length()) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-                array[i].toASCIIGnuStep(ascii, level + 1);
-            } else {
-                if (i != 0)
-                    ascii.append(" ");
-                array[i].toASCIIGnuStep(ascii, 0);
-            }
-
-            if (i != array.length - 1)
-                ascii.append(ASCIIPropertyListParser.ARRAY_ITEM_DELIMITER_TOKEN);
-
-            if (ascii.length() - indexOfLastNewLine > ASCII_LINE_LENGTH) {
-                ascii.append(NEWLINE);
-                indexOfLastNewLine = ascii.length();
-            }
-        }
-        ascii.append(ASCIIPropertyListParser.ARRAY_END_TOKEN);
-    }
-
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/NSString.java b/third_party/java/dd_plist/java/com/dd/plist/NSString.java
deleted file mode 100644
index d692bbf..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/NSString.java
+++ /dev/null
@@ -1,270 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-import java.io.IOException;
-import java.io.UnsupportedEncodingException;
-import java.nio.ByteBuffer;
-import java.nio.CharBuffer;
-import java.nio.charset.Charset;
-import java.nio.charset.CharsetEncoder;
-
-/**
- * A NSString contains a string.
- *
- * @author Daniel Dreibrodt
- */
-public class NSString extends NSObject implements Comparable<Object> {
-
-    private String content;
-
-    /**
-     * Creates an NSString from its binary representation.
-     *
-     * @param bytes    The binary representation.
-     * @param encoding The encoding of the binary representation, the name of a supported charset.
-     * @throws UnsupportedEncodingException
-     * @see java.lang.String
-     */
-    public NSString(byte[] bytes, String encoding) throws UnsupportedEncodingException {
-        content = new String(bytes, encoding);
-    }
-
-    /**
-     * Creates a NSString from a string.
-     *
-     * @param string The string that will be contained in the NSString.
-     */
-    public NSString(String string) {
-        content = string;
-    }
-
-    /**
-     * Gets this strings content.
-     *
-     * @return This NSString as Java String object.
-     */
-    public String getContent() {
-        return content;
-    }
-
-    /**
-     * Sets the contents of this string.
-     *
-     * @param c The new content of this string object.
-     */
-    public void setContent(String c) {
-        content = c;
-    }
-
-    /**
-     * Appends a string to this string.
-     *
-     * @param s The string to append.
-     */
-    public void append(NSString s) {
-        append(s.getContent());
-    }
-
-    /**
-     * Appends a string to this string.
-     *
-     * @param s The string to append.
-     */
-    public void append(String s) {
-        content += s;
-    }
-
-    /**
-     * Prepends a string to this string.
-     *
-     * @param s The string to prepend.
-     */
-    public void prepend(String s) {
-        content = s + content;
-    }
-
-    /**
-     * Prepends a string to this string.
-     *
-     * @param s The string to prepend.
-     */
-    public void prepend(NSString s) {
-        prepend(s.getContent());
-    }
-
-    @Override
-    public boolean equals(Object obj) {
-        if (!(obj instanceof NSString)) return false;
-        return content.equals(((NSString) obj).content);
-    }
-
-    @Override
-    public int hashCode() {
-        return content.hashCode();
-    }
-
-    /**
-     * The textual representation of this NSString.
-     *
-     * @return The NSString's contents.
-     */
-    @Override
-    public String toString() {
-        return content;
-    }
-
-    private static CharsetEncoder asciiEncoder, utf16beEncoder, utf8Encoder;
-
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        xml.append("<string>");
-
-        //Make sure that the string is encoded in UTF-8 for the XML output
-        synchronized (NSString.class) {
-            if (utf8Encoder == null)
-                utf8Encoder = Charset.forName("UTF-8").newEncoder();
-            else
-                utf8Encoder.reset();
-
-            try {
-                ByteBuffer byteBuf = utf8Encoder.encode(CharBuffer.wrap(content));
-                byte[] bytes = new byte[byteBuf.remaining()];
-                byteBuf.get(bytes);
-                content = new String(bytes, "UTF-8");
-            } catch (Exception ex) {
-                throw new RuntimeException("Could not encode the NSString into UTF-8: " + String.valueOf(ex.getMessage()));
-            }
-        }
-
-        //According to http://www.w3.org/TR/REC-xml/#syntax node values must not
-        //contain the characters < or &. Also the > character should be escaped.
-        if (content.contains("&") || content.contains("<") || content.contains(">")) {
-            xml.append("<![CDATA[");
-            xml.append(content.replaceAll("]]>", "]]]]><![CDATA[>"));
-            xml.append("]]>");
-        } else {
-            xml.append(content);
-        }
-        xml.append("</string>");
-    }
-
-
-    @Override
-    public void toBinary(BinaryPropertyListWriter out) throws IOException {
-        CharBuffer charBuf = CharBuffer.wrap(content);
-        int kind;
-        ByteBuffer byteBuf;
-        synchronized (NSString.class) {
-            if (asciiEncoder == null)
-                asciiEncoder = Charset.forName("ASCII").newEncoder();
-            else
-                asciiEncoder.reset();
-
-            if (asciiEncoder.canEncode(charBuf)) {
-                kind = 0x5; // standard ASCII
-                byteBuf = asciiEncoder.encode(charBuf);
-            } else {
-                if (utf16beEncoder == null)
-                    utf16beEncoder = Charset.forName("UTF-16BE").newEncoder();
-                else
-                    utf16beEncoder.reset();
-
-                kind = 0x6; // UTF-16-BE
-                byteBuf = utf16beEncoder.encode(charBuf);
-            }
-        }
-        byte[] bytes = new byte[byteBuf.remaining()];
-        byteBuf.get(bytes);
-        out.writeIntHeader(kind, content.length());
-        out.write(bytes);
-    }
-
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append("\"");
-        //According to https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/PropertyLists/OldStylePlists/OldStylePLists.html
-        //non-ASCII characters are not escaped but simply written into the
-        //file, thus actually violating the ASCII plain text format.
-        //We will escape the string anyway because current Xcode project files (ASCII property lists) also escape their strings.
-        ascii.append(escapeStringForASCII(content));
-        ascii.append("\"");
-    }
-
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append("\"");
-        ascii.append(escapeStringForASCII(content));
-        ascii.append("\"");
-    }
-
-    /**
-     * Escapes a string for use in ASCII property lists.
-     *
-     * @param s The unescaped string.
-     * @return The escaped string.
-     */
-    static String escapeStringForASCII(String s) {
-        String out = "";
-        char[] cArray = s.toCharArray();
-        for (int i = 0; i < cArray.length; i++) {
-            char c = cArray[i];
-            if (c > 127) {
-                //non-ASCII Unicode
-                out += "\\U";
-                String hex = Integer.toHexString(c);
-                while (hex.length() < 4)
-                    hex = "0" + hex;
-                out += hex;
-            } else if (c == '\\') {
-                out += "\\\\";
-            } else if (c == '\"') {
-                out += "\\\"";
-            } else if (c == '\b') {
-                out += "\\b";
-            } else if (c == '\n') {
-                out += "\\n";
-            } else if (c == '\r') {
-                out += "\\r";
-            } else if (c == '\t') {
-                out += "\\t";
-            } else {
-                out += c;
-            }
-        }
-        return out;
-    }
-
-    public int compareTo(Object o) {
-        if (o instanceof NSString) {
-            return getContent().compareTo(((NSString) o).getContent());
-        } else if (o instanceof String) {
-            return getContent().compareTo(((String) o));
-        } else {
-            return -1;
-        }
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/PropertyListFormatException.java b/third_party/java/dd_plist/java/com/dd/plist/PropertyListFormatException.java
deleted file mode 100644
index 13988a0..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/PropertyListFormatException.java
+++ /dev/null
@@ -1,40 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2014 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-
-package com.dd.plist;
-
-/**
- * A PropertyListFormatException is thrown by the various property list format parsers
- * when an error in the format of the given property list is encountered.
- * @author Daniel Dreibrodt
- */
-public class PropertyListFormatException extends Exception {
-
-    /**
-     * Creates a new exception with the given message.
-     * @param message A message containing information about the nature of the exception.
-     */
-    public PropertyListFormatException(String message) {
-        super(message);
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/PropertyListParser.java b/third_party/java/dd_plist/java/com/dd/plist/PropertyListParser.java
deleted file mode 100644
index 66cac14..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/PropertyListParser.java
+++ /dev/null
@@ -1,383 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011-2014 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-import org.xml.sax.SAXException;
-
-import javax.xml.parsers.ParserConfigurationException;
-import java.io.ByteArrayOutputStream;
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.OutputStream;
-import java.io.OutputStreamWriter;
-import java.text.ParseException;
-
-/**
- * This class provides methods to parse property lists. It can handle files,
- * input streams and byte arrays. All known property list formats are supported.
- * <p/>
- * This class also provides methods to save and convert property lists.
- *
- * @author Daniel Dreibrodt
- */
-public class PropertyListParser {
-
-    private static final int TYPE_XML = 0;
-    private static final int TYPE_BINARY = 1;
-    private static final int TYPE_ASCII = 2;
-    private static final int TYPE_ERROR_BLANK = 10;
-    private static final int TYPE_ERROR_UNKNOWN = 11;
-
-    /**
-     * Prevent instantiation.
-     */
-    protected PropertyListParser() {
-        /** empty **/
-    }
-
-    /**
-     * Determines the type of a property list by means of the first bytes of its data
-     * @param dataBeginning The very first bytes of data of the property list (minus any whitespace) as a string
-     * @return The type of the property list
-     */
-    private static int determineType(String dataBeginning) {
-        dataBeginning = dataBeginning.trim();
-        if(dataBeginning.length() == 0) {
-            return TYPE_ERROR_BLANK;
-        }
-        if(dataBeginning.startsWith("bplist")) {
-            return TYPE_BINARY;
-        }
-        if(dataBeginning.startsWith("(") || dataBeginning.startsWith("{") || dataBeginning.startsWith("/")) {
-            return TYPE_ASCII;
-        }
-        if(dataBeginning.startsWith("<")) {
-            return TYPE_XML;
-        }
-        return TYPE_ERROR_UNKNOWN;
-    }
-
-    /**
-     * Determines the type of a property list by means of the first bytes of its data
-     * @param bytes The very first bytes of data of the property list (minus any whitespace)
-     * @return The type of the property list
-     */
-    private static int determineType(byte[] bytes) {
-        //Skip any possible whitespace at the beginning of the file
-        int offset = 0;
-        while(offset < bytes.length && bytes[offset] == ' ' || bytes[offset] == '\t' || bytes[offset] == '\r' || bytes[offset] == '\n' || bytes[offset] == '\f') {
-            offset++;
-        }
-        return determineType(new String(bytes, offset, Math.min(8, bytes.length - offset)));
-    }
-
-    /**
-     * Determines the type of a property list by means of the first bytes of its data
-     * @param is An input stream pointing to the beginning of the property list data.
-     *           If the stream supports marking it will be reset to the beginning of the property
-     *           list data after the type has been determined.
-     * @return The type of the property list
-     */
-    private static int determineType(InputStream is) throws IOException {
-        //Skip any possible whitespace at the beginning of the file
-        byte[] magicBytes = new byte[8];
-        int b;
-        do {
-            if(is.markSupported())
-                is.mark(16);
-            b = is.read();
-        }
-        while(b != -1 && b == ' ' || b == '\t' || b == '\r' || b == '\n' || b == '\f');
-        magicBytes[0] = (byte)b;
-        int read = is.read(magicBytes, 1, 7);
-        int type = determineType(new String(magicBytes, 0, read));
-        if(is.markSupported())
-            is.reset();
-        return type;
-    }
-
-    /**
-     * Reads all bytes from an InputStream and stores them in an array, up to
-     * a maximum count.
-     *
-     * @param in  The InputStream pointing to the data that should be stored in the array.
-     */
-    protected static byte[] readAll(InputStream in) throws IOException {
-        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
-        byte[] buf = new byte[512];
-        int read;
-        while ((read = in.read(buf)) > 0) {
-            outputStream.write(buf, 0, read);
-        }
-        return outputStream.toByteArray();
-    }
-
-    /**
-     * Parses a property list from a file.
-     *
-     * @param filePath Path to the property list file.
-     * @return The root object in the property list. This is usually a NSDictionary but can also be a NSArray.
-     * @throws Exception If an error occurred while parsing.
-     */
-    public static NSObject parse(String filePath) throws ParserConfigurationException, ParseException, SAXException, PropertyListFormatException, IOException {
-        return parse(new File(filePath));
-    }
-
-    /**
-     * Parses a property list from a file.
-     *
-     * @param f The property list file.
-     * @return The root object in the property list. This is usually a NSDictionary but can also be a NSArray.
-     * @throws Exception If an error occurred while parsing.
-     */
-    public static NSObject parse(File f) throws IOException, PropertyListFormatException, ParseException, ParserConfigurationException, SAXException {
-        FileInputStream fis = new FileInputStream(f);
-        int type = determineType(fis);
-        fis.close();
-        switch(type) {
-            case TYPE_BINARY:
-                return BinaryPropertyListParser.parse(f);
-            case TYPE_XML:
-                return XMLPropertyListParser.parse(f);
-            case TYPE_ASCII:
-                return ASCIIPropertyListParser.parse(f);
-            default:
-                throw new PropertyListFormatException("The given file is not a property list of a supported format.");
-        }
-    }
-
-    /**
-     * Parses a property list from a byte array.
-     *
-     * @param bytes The property list data as a byte array.
-     * @return The root object in the property list. This is usually a NSDictionary but can also be a NSArray.
-     * @throws Exception If an error occurred while parsing.
-     */
-    public static NSObject parse(byte[] bytes) throws IOException, PropertyListFormatException, ParseException, ParserConfigurationException, SAXException {
-        switch(determineType(bytes)) {
-            case TYPE_BINARY:
-                return BinaryPropertyListParser.parse(bytes);
-            case TYPE_XML:
-                return XMLPropertyListParser.parse(bytes);
-            case TYPE_ASCII:
-                return ASCIIPropertyListParser.parse(bytes);
-            default:
-                throw new PropertyListFormatException("The given data is not a property list of a supported format.");
-        }
-    }
-
-    /**
-     * Parses a property list from an InputStream.
-     *
-     * @param is The InputStream delivering the property list data.
-     * @return The root object of the property list. This is usually a NSDictionary but can also be a NSArray.
-     * @throws Exception If an error occurred while parsing.
-     */
-    public static NSObject parse(InputStream is) throws IOException, PropertyListFormatException, ParseException, ParserConfigurationException, SAXException {
-        return parse(readAll(is));
-    }
-
-    /**
-     * Saves a property list with the given object as root into a XML file.
-     *
-     * @param root The root object.
-     * @param out  The output file.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsXML(NSObject root, File out) throws IOException {
-        File parent = out.getParentFile();
-        if (!parent.exists())
-            parent.mkdirs();
-        FileOutputStream fous = new FileOutputStream(out);
-        saveAsXML(root, fous);
-        fous.close();
-    }
-
-    /**
-     * Saves a property list with the given object as root in XML format into an output stream.
-     *
-     * @param root The root object.
-     * @param out  The output stream.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsXML(NSObject root, OutputStream out) throws IOException {
-        OutputStreamWriter w = new OutputStreamWriter(out, "UTF-8");
-        w.write(root.toXMLPropertyList());
-        w.close();
-    }
-
-    /**
-     * Converts a given property list file into the OS X and iOS XML format.
-     *
-     * @param in  The source file.
-     * @param out The target file.
-     * @throws Exception When an error occurs during parsing or converting.
-     */
-    public static void convertToXml(File in, File out) throws ParserConfigurationException, ParseException, SAXException, PropertyListFormatException, IOException {
-        NSObject root = parse(in);
-        saveAsXML(root, out);
-    }
-
-    /**
-     * Saves a property list with the given object as root into a binary file.
-     *
-     * @param root The root object.
-     * @param out  The output file.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsBinary(NSObject root, File out) throws IOException {
-        File parent = out.getParentFile();
-        if (!parent.exists())
-            parent.mkdirs();
-        BinaryPropertyListWriter.write(out, root);
-    }
-
-    /**
-     * Saves a property list with the given object as root in binary format into an output stream.
-     *
-     * @param root The root object.
-     * @param out  The output stream.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsBinary(NSObject root, OutputStream out) throws IOException {
-        BinaryPropertyListWriter.write(out, root);
-    }
-
-    /**
-     * Converts a given property list file into the OS X and iOS binary format.
-     *
-     * @param in  The source file.
-     * @param out The target file.
-     * @throws Exception When an error occurs during parsing or converting.
-     */
-    public static void convertToBinary(File in, File out) throws IOException, ParserConfigurationException, ParseException, SAXException, PropertyListFormatException {
-        NSObject root = parse(in);
-        saveAsBinary(root, out);
-    }
-
-    /**
-     * Saves a property list with the given object as root into a ASCII file.
-     *
-     * @param root The root object.
-     * @param out  The output file.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsASCII(NSDictionary root, File out) throws IOException {
-        File parent = out.getParentFile();
-        if (!parent.exists())
-            parent.mkdirs();
-        OutputStreamWriter w = new OutputStreamWriter(new FileOutputStream(out), "ASCII");
-        w.write(root.toASCIIPropertyList());
-        w.close();
-    }
-
-    /**
-     * Saves a property list with the given object as root into a ASCII file.
-     *
-     * @param root The root object.
-     * @param out  The output file.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsASCII(NSArray root, File out) throws IOException {
-        OutputStreamWriter w = new OutputStreamWriter(new FileOutputStream(out), "ASCII");
-        w.write(root.toASCIIPropertyList());
-        w.close();
-    }
-
-    /**
-     * Converts a given property list file into ASCII format.
-     *
-     * @param in  The source file.
-     * @param out The target file.
-     * @throws Exception When an error occurs during parsing or converting.
-     */
-    public static void convertToASCII(File in, File out) throws ParserConfigurationException, ParseException, SAXException, PropertyListFormatException, IOException {
-        NSObject root = parse(in);
-        if(root instanceof NSDictionary) {
-            saveAsASCII((NSDictionary) root, out);
-        }
-        else if(root instanceof NSArray) {
-            saveAsASCII((NSArray) root, out);
-        }
-        else {
-            throw new PropertyListFormatException("The root of the given input property list "
-                    + "is neither a Dictionary nor an Array!");
-        }
-    }
-
-    /**
-     * Saves a property list with the given object as root into a ASCII file.
-     *
-     * @param root The root object.
-     * @param out  The output file.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsGnuStepASCII(NSDictionary root, File out) throws IOException {
-        File parent = out.getParentFile();
-        if (!parent.exists())
-            parent.mkdirs();
-        OutputStreamWriter w = new OutputStreamWriter(new FileOutputStream(out), "ASCII");
-        w.write(root.toGnuStepASCIIPropertyList());
-        w.close();
-    }
-
-    /**
-     * Saves a property list with the given object as root into a ASCII file.
-     *
-     * @param root The root object.
-     * @param out  The output file.
-     * @throws IOException When an error occurs during the writing process.
-     */
-    public static void saveAsGnuStepASCII(NSArray root, File out) throws IOException {
-        File parent = out.getParentFile();
-        if (!parent.exists())
-            parent.mkdirs();
-        OutputStreamWriter w = new OutputStreamWriter(new FileOutputStream(out), "ASCII");
-        w.write(root.toGnuStepASCIIPropertyList());
-        w.close();
-    }
-
-    /**
-     * Converts a given property list file into ASCII format.
-     *
-     * @param in  The source file.
-     * @param out The target file.
-     * @throws Exception When an error occurs during parsing or converting.
-     */
-    public static void convertToGnuStepASCII(File in, File out) throws ParserConfigurationException, ParseException, SAXException, PropertyListFormatException, IOException {
-        NSObject root = parse(in);
-        if(root instanceof NSDictionary) {
-            saveAsGnuStepASCII((NSDictionary) root, out);
-        }
-        else if(root instanceof NSArray) {
-            saveAsGnuStepASCII((NSArray) root, out);
-        }
-        else {
-            throw new PropertyListFormatException("The root of the given input property list "
-                    + "is neither a Dictionary nor an Array!");
-        }
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/UID.java b/third_party/java/dd_plist/java/com/dd/plist/UID.java
deleted file mode 100644
index 9dde01c..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/UID.java
+++ /dev/null
@@ -1,93 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2011 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-import java.io.IOException;
-
-/**
- * A UID. Only found in binary property lists that are keyed archives.
- *
- * @author Daniel Dreibrodt
- */
-public class UID extends NSObject {
-
-    private byte[] bytes;
-    private String name;
-
-    public UID(String name, byte[] bytes) {
-        this.name = name;
-        this.bytes = bytes;
-    }
-
-    public byte[] getBytes() {
-        return bytes;
-    }
-
-    public String getName() {
-        return name;
-    }
-
-    /**
-     * There is no XML representation specified for UIDs.
-     * In this implementation UIDs are represented as strings in the XML output.
-     *
-     * @param xml   The xml StringBuilder
-     * @param level The indentation level
-     */
-    @Override
-    void toXML(StringBuilder xml, int level) {
-        indent(xml, level);
-        xml.append("<string>");
-        for (int i = 0; i < bytes.length; i++) {
-            byte b = bytes[i];
-            if (b < 16)
-                xml.append("0");
-            xml.append(Integer.toHexString(b));
-        }
-        xml.append("</string>");
-    }
-
-    @Override
-    void toBinary(BinaryPropertyListWriter out) throws IOException {
-        out.write(0x80 + bytes.length - 1);
-        out.write(bytes);
-    }
-
-    @Override
-    protected void toASCII(StringBuilder ascii, int level) {
-        indent(ascii, level);
-        ascii.append("\"");
-        for (int i = 0; i < bytes.length; i++) {
-            byte b = bytes[i];
-            if (b < 16)
-                ascii.append("0");
-            ascii.append(Integer.toHexString(b));
-        }
-        ascii.append("\"");
-    }
-
-    @Override
-    protected void toASCIIGnuStep(StringBuilder ascii, int level) {
-        toASCII(ascii, level);
-    }
-}
diff --git a/third_party/java/dd_plist/java/com/dd/plist/XMLPropertyListParser.java b/third_party/java/dd_plist/java/com/dd/plist/XMLPropertyListParser.java
deleted file mode 100644
index 14776ea..0000000
--- a/third_party/java/dd_plist/java/com/dd/plist/XMLPropertyListParser.java
+++ /dev/null
@@ -1,273 +0,0 @@
-/*
- * plist - An open source library to parse and generate property lists
- * Copyright (C) 2014 Daniel Dreibrodt
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
- * SOFTWARE.
- */
-package com.dd.plist;
-
-import org.w3c.dom.*;
-import org.xml.sax.EntityResolver;
-import org.xml.sax.InputSource;
-import org.xml.sax.SAXException;
-
-import javax.xml.parsers.DocumentBuilder;
-import javax.xml.parsers.DocumentBuilderFactory;
-import javax.xml.parsers.ParserConfigurationException;
-import java.io.ByteArrayInputStream;
-import java.io.File;
-import java.io.IOException;
-import java.io.InputStream;
-import java.text.ParseException;
-import java.util.ArrayList;
-import java.util.List;
-
-/**
- * Parses XML property lists.
- *
- * @author Daniel Dreibrodt
- */
-public class XMLPropertyListParser {
-
-    /**
-     * Instantiation is prohibited by outside classes.
-     */
-    protected XMLPropertyListParser() {
-        /** empty **/
-    }
-
-    private static DocumentBuilderFactory docBuilderFactory = null;
-
-    /**
-     * Initialize the document builder factory so that it can be reuused and does not need to
-     * be reinitialized for each new parsing.
-     */
-    private static synchronized void initDocBuilderFactory() {
-        docBuilderFactory = DocumentBuilderFactory.newInstance();
-        docBuilderFactory.setIgnoringComments(true);
-        docBuilderFactory.setCoalescing(true);
-    }
-
-    /**
-     * Gets a DocumentBuilder to parse a XML property list.
-     * As DocumentBuilders are not thread-safe a new DocBuilder is generated for each request.
-     *
-     * @return A new DocBuilder that can parse property lists w/o an internet connection.
-     */
-    private static synchronized DocumentBuilder getDocBuilder() throws ParserConfigurationException {
-        if (docBuilderFactory == null)
-            initDocBuilderFactory();
-        DocumentBuilder docBuilder = docBuilderFactory.newDocumentBuilder();
-        docBuilder.setEntityResolver(new EntityResolver() {
-            public InputSource resolveEntity(String publicId, String systemId) {
-                if ("-//Apple Computer//DTD PLIST 1.0//EN".equals(publicId) || // older publicId
-                        "-//Apple//DTD PLIST 1.0//EN".equals(publicId)) { // newer publicId
-                    // return a dummy, zero length DTD so we don't have to fetch
-                    // it from the network.
-                    return new InputSource(new ByteArrayInputStream(new byte[0]));
-                }
-                return null;
-            }
-        });
-        return docBuilder;
-    }
-
-    /**
-     * Parses a XML property list file.
-     *
-     * @param f The XML property list file.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     * @see javax.xml.parsers.DocumentBuilder#parse(java.io.File)
-     */
-    public static NSObject parse(File f) throws ParseException, IOException, PropertyListFormatException, SAXException, ParserConfigurationException {
-        DocumentBuilder docBuilder = getDocBuilder();
-
-        Document doc = docBuilder.parse(f);
-
-        return parseDocument(doc);
-    }
-
-    /**
-     * Parses a XML property list from a byte array.
-     *
-     * @param bytes The byte array containing the property list's data.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     */
-    public static NSObject parse(final byte[] bytes) throws ParserConfigurationException, ParseException, SAXException, PropertyListFormatException, IOException {
-        ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
-        return parse(bis);
-    }
-
-    /**
-     * Parses a XML property list from an input stream.
-     *
-     * @param is The input stream pointing to the property list's data.
-     * @return The root object of the property list. This is usally a NSDictionary but can also be a NSArray.
-     * @throws Exception When an error occurs during parsing.
-     * @see javax.xml.parsers.DocumentBuilder#parse(java.io.InputStream)
-     */
-    public static NSObject parse(InputStream is) throws ParserConfigurationException, IOException, SAXException, PropertyListFormatException, ParseException {
-        DocumentBuilder docBuilder = getDocBuilder();
-
-        Document doc = docBuilder.parse(is);
-
-        return parseDocument(doc);
-    }
-
-    /**
-     * Parses the XML document by generating the appropriate NSObjects for each XML node.
-     *
-     * @param doc The XML document.
-     * @return The root NSObject of the property list contained in the XML document.
-     * @throws Exception If an error occured during parsing.
-     */
-    private static NSObject parseDocument(Document doc) throws PropertyListFormatException, IOException, ParseException {
-        DocumentType docType = doc.getDoctype();
-        if (docType == null) {
-            if (!doc.getDocumentElement().getNodeName().equals("plist")) {
-                throw new UnsupportedOperationException("The given XML document is not a property list.");
-            }
-        } else if (!docType.getName().equals("plist")) {
-            throw new UnsupportedOperationException("The given XML document is not a property list.");
-        }
-
-        Node rootNode;
-
-        if (doc.getDocumentElement().getNodeName().equals("plist")) {
-            //Root element wrapped in plist tag
-            List<Node> rootNodes = filterElementNodes(doc.getDocumentElement().getChildNodes());
-            if (rootNodes.isEmpty()) {
-                throw new PropertyListFormatException("The given XML property list has no root element!");
-            } else if (rootNodes.size() == 1) {
-                rootNode = rootNodes.get(0);
-            } else {
-                throw new PropertyListFormatException("The given XML property list has more than one root element!");
-            }
-        } else {
-            //Root NSObject not wrapped in plist-tag
-            rootNode = doc.getDocumentElement();
-        }
-
-        return parseObject(rootNode);
-    }
-
-    /**
-     * Parses a node in the XML structure and returns the corresponding NSObject
-     *
-     * @param n The XML node.
-     * @return The corresponding NSObject.
-     * @throws Exception If an error occured during parsing the node.
-     */
-    private static NSObject parseObject(Node n) throws ParseException, IOException {
-        String type = n.getNodeName();
-        if (type.equals("dict")) {
-            NSDictionary dict = new NSDictionary();
-            List<Node> children = filterElementNodes(n.getChildNodes());
-            for (int i = 0; i < children.size(); i += 2) {
-                Node key = children.get(i);
-                Node val = children.get(i + 1);
-
-                String keyString = getNodeTextContents(key);
-
-                dict.put(keyString, parseObject(val));
-            }
-            return dict;
-        } else if (type.equals("array")) {
-            List<Node> children = filterElementNodes(n.getChildNodes());
-            NSArray array = new NSArray(children.size());
-            for (int i = 0; i < children.size(); i++) {
-                array.setValue(i, parseObject(children.get(i)));
-            }
-            return array;
-        } else if (type.equals("true")) {
-            return new NSNumber(true);
-        } else if (type.equals("false")) {
-            return new NSNumber(false);
-        } else if (type.equals("integer")) {
-            return new NSNumber(getNodeTextContents(n));
-        } else if (type.equals("real")) {
-            return new NSNumber(getNodeTextContents(n));
-        } else if (type.equals("string")) {
-            return new NSString(getNodeTextContents(n));
-        } else if (type.equals("data")) {
-            return new NSData(getNodeTextContents(n));
-        } else if (type.equals("date")) {
-            return new NSDate(getNodeTextContents(n));
-        }
-        return null;
-    }
-
-    /**
-     * Returns all element nodes that are contained in a list of nodes.
-     *
-     * @param list The list of nodes to search.
-     * @return The sublist containing only nodes representing actual elements.
-     */
-    private static List<Node> filterElementNodes(NodeList list) {
-        List<Node> result = new ArrayList<Node>(list.getLength());
-        for (int i = 0; i < list.getLength(); i++) {
-            if (list.item(i).getNodeType() == Node.ELEMENT_NODE) {
-                result.add(list.item(i));
-            }
-        }
-        return result;
-    }
-
-    /**
-     * Returns a node's text content.
-     * This method will return the text value represented by the node's direct children.
-     * If the given node is a TEXT or CDATA node, then its value is returned.
-     *
-     * @param n The node.
-     * @return The node's text content.
-     */
-    private static String getNodeTextContents(Node n) {
-        if (n.getNodeType() == Node.TEXT_NODE || n.getNodeType() == Node.CDATA_SECTION_NODE) {
-            Text txtNode = (Text) n;
-            String content = txtNode.getWholeText(); //This concatenates any adjacent text/cdata/entity nodes
-            if (content == null)
-                return "";
-            else
-                return content;
-        } else {
-            if (n.hasChildNodes()) {
-                NodeList children = n.getChildNodes();
-
-                for (int i = 0; i < children.getLength(); i++) {
-                    //Skip any non-text nodes, like comments or entities
-                    Node child = children.item(i);
-                    if (child.getNodeType() == Node.TEXT_NODE || child.getNodeType() == Node.CDATA_SECTION_NODE) {
-                        Text txtNode = (Text) child;
-                        String content = txtNode.getWholeText(); //This concatenates any adjacent text/cdata/entity nodes
-                        if (content == null)
-                            return "";
-                        else
-                            return content;
-                    }
-                }
-
-                return "";
-            } else {
-                return "";
-            }
-        }
-    }
-}
diff --git a/tools/BUILD b/tools/BUILD
index 39af650..7b8683c 100644
--- a/tools/BUILD
+++ b/tools/BUILD
@@ -10,7 +10,6 @@ filegroup(
         "//tools/jdk:srcs",
         "//tools/genrule:srcs",
         "//tools/cpp:srcs",
-        "//tools/objc:srcs",
         "//tools/test:srcs",
         "//tools/python:srcs",
     ],
diff --git a/tools/objc/BUILD b/tools/objc/BUILD
deleted file mode 100644
index 4beb725..0000000
--- a/tools/objc/BUILD
+++ /dev/null
@@ -1,45 +0,0 @@
-package(default_visibility = ["//visibility:public"])
-
-# Files which shouldn't be publicly visible and dependencies of all objc_* or ios_* rules shouldn't be in this package.
-exports_files(glob(["**"]))
-
-java_binary(
-    name = "actoolzip",
-    srcs = [":precomp_actoolzip_deploy.jar"],
-    main_class = "com.google.devtools.build.xcode.actoolzip.ActoolZip",
-)
-
-java_binary(
-    name = "ibtoolzip",
-    srcs = [":precomp_ibtoolzip_deploy.jar"],
-    main_class = "com.google.devtools.build.xcode.ibtoolzip.IbtoolZip",
-)
-
-java_binary(
-    name = "bundlemerge",
-    srcs = [":precomp_bundlemerge_deploy.jar"],
-    main_class = "com.google.devtools.build.xcode.bundlemerge.BundleMerge",
-)
-
-java_binary(
-    name = "momczip",
-    srcs = [":precomp_momczip_deploy.jar"],
-    main_class = "com.google.devtools.build.xcode.momczip.MomcZip",
-)
-
-java_binary(
-    name = "plmerge",
-    srcs = [":precomp_plmerge_deploy.jar"],
-    main_class = "com.google.devtools.build.xcode.plmerge.PlMerge",
-)
-
-java_binary(
-    name = "xcodegen",
-    srcs = [":precomp_xcodegen_deploy.jar"],
-    main_class = "com.google.devtools.build.xcode.xcodegen.XcodeGen",
-)
-
-filegroup(
-    name = "srcs",
-    srcs = glob(["**"]),
-)
diff --git a/tools/objc/dummy.c b/tools/objc/dummy.c
deleted file mode 100644
index bedfc07..0000000
--- a/tools/objc/dummy.c
+++ /dev/null
@@ -1,25 +0,0 @@
-// Copyright 2015 Google Inc. All rights reserved.
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//    http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-/*
- * Include this file in a target if it requires some source but you don't have
- * any.
- *
- * ios_extension_binary rules only generate a static library Xcode target, and
- * the ios_extension will generate an actual bundling Xcode target. Application
- * and app extension targets need at least one source file for Xcode to be
- * happy, so we can add this file for them.
- */
-
-static int dummy __attribute__((unused,used)) = 0;
diff --git a/tools/objc/ios_runner.sh.mac_template b/tools/objc/ios_runner.sh.mac_template
deleted file mode 100644
index 79aa4d2..0000000
--- a/tools/objc/ios_runner.sh.mac_template
+++ /dev/null
@@ -1,42 +0,0 @@
-#!/bin/bash
-
-# Copyright 2015 Google Inc. All rights reserved.
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#    http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-
-set -e
-
-if [[ "$(uname)" != Darwin ]]; then
-  echo "Cannot run iOS targets on a non-mac machine."
-  exit 1
-fi
-
-# TODO(bazel-team): Use %sdk_version% and %sim_device% when available.
-readonly SDK_VERSION='8.1'
-readonly SIM_DEVICE='iPhone 6'
-readonly APP_DIR=$(mktemp -d -t extracted_app)
-
-args=()
-# Pass environment variables prefixed with IOS_ to the simulator, stripping
-# the prefix.
-while read -r envvar; do
-  if [[ "${envvar}" == IOS_* ]]; then
-    args+=(-e "${envvar#IOS_}")
-  fi
-done < <(env)
-
-unzip -qq '%ipa_file%' -d "${APP_DIR}"
-%iossim% -d "${SIM_DEVICE}" -s "${SDK_VERSION}" \
-    "${args[@]}" \
-    "${APP_DIR}/Payload/%app_name%.app" \
-    "$@"
